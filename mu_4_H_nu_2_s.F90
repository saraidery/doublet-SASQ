   subroutine mu_4_H_nu_1_s_doublet_ccsd(wf, rho_aibj, FAx_v, FxI_o, LAIxx_ov, LAIxx_vo, LAxxx_oov, LAxxx_voo, LAxxx_vvv, L_oooo, L_ovov, L_voov, L_vvoo, L_vvvv, LxIxx_ooo, LxIxx_vov, LxxxI_vvo, gAIAx_o, gAIxI_v, gAIxx_ov, gAIxx_vo, gAxAx_vv, gAxxI_ov, gAxxI_vo, gAxxx_oov, gAxxx_ovo, gAxxx_voo, gAxxx_vvv, g_oooo, g_ovov, g_voov, g_vvoo, g_vvvv, gxIxI_oo, gxIxx_ooo, gxIxx_vov, gxIxx_vvo, gxxxI_vvo, rAIAI, rAIAx_o, rAIxI_v, rAIxx_vo, rAxAx_oo, rAxxI_ov, rAxxx_ovo, r_vovo, rxIxI_vv, rxIxx_vvo, rxxxI_vov, tAIAx_o, tAIxI_v, tAIxx_vo, tAxAx_oo, tAxxI_ov, tAxxx_ovo, t_aibj, txIxI_vv, txIxx_vvo, txxxI_vov, uAIxx_vo, uAxxx_ovo, u_aibj, uxIxx_vvo, uxxxI_vov)
!!
!! Generated function
!!
      implicit none
!
      class(doublet_ccsd), intent(in) :: wf
!
      real(dp), dimension(wf%n_v,wf%n_o,wf%n_v,wf%n_o), intent(inout) :: rho_aibj
!
      real(dp), intent(in) :: rAIAI
      real(dp), dimension(wf%n_o), intent(in) :: FxI_o, gAIAx_o, rAIAx_o, tAIAx_o
      real(dp), dimension(wf%n_v), intent(in) :: FAx_v, gAIxI_v, rAIxI_v, tAIxI_v
      real(dp), dimension(wf%n_o,wf%n_o), intent(in) :: gxIxI_oo, rAxAx_oo, tAxAx_oo
      real(dp), dimension(wf%n_o,wf%n_v), intent(in) :: LAIxx_ov, gAIxx_ov, gAxxI_ov, rAxxI_ov, tAxxI_ov
      real(dp), dimension(wf%n_v,wf%n_o), intent(in) :: LAIxx_vo, gAIxx_vo, gAxxI_vo, rAIxx_vo, tAIxx_vo, uAIxx_vo
      real(dp), dimension(wf%n_v,wf%n_v), intent(in) :: gAxAx_vv, rxIxI_vv, txIxI_vv
      real(dp), dimension(wf%n_o,wf%n_o,wf%n_o), intent(in) :: LxIxx_ooo, gxIxx_ooo
      real(dp), dimension(wf%n_o,wf%n_o,wf%n_v), intent(in) :: LAxxx_oov, gAxxx_oov
      real(dp), dimension(wf%n_o,wf%n_v,wf%n_o), intent(in) :: gAxxx_ovo, rAxxx_ovo, tAxxx_ovo, uAxxx_ovo
      real(dp), dimension(wf%n_v,wf%n_o,wf%n_o), intent(in) :: LAxxx_voo, gAxxx_voo
      real(dp), dimension(wf%n_v,wf%n_o,wf%n_v), intent(in) :: LxIxx_vov, gxIxx_vov, rxxxI_vov, txxxI_vov, uxxxI_vov
      real(dp), dimension(wf%n_v,wf%n_v,wf%n_o), intent(in) :: LxxxI_vvo, gxIxx_vvo, gxxxI_vvo, rxIxx_vvo, txIxx_vvo, uxIxx_vvo
      real(dp), dimension(wf%n_v,wf%n_v,wf%n_v), intent(in) :: LAxxx_vvv, gAxxx_vvv
      real(dp), dimension(wf%n_o,wf%n_o,wf%n_o,wf%n_o), intent(in) :: L_oooo, g_oooo
      real(dp), dimension(wf%n_o,wf%n_v,wf%n_o,wf%n_v), intent(in) :: L_ovov, g_ovov
      real(dp), dimension(wf%n_v,wf%n_o,wf%n_o,wf%n_v), intent(in) :: L_voov, g_voov
      real(dp), dimension(wf%n_v,wf%n_o,wf%n_v,wf%n_o), intent(in) :: r_vovo, t_aibj, u_aibj
      real(dp), dimension(wf%n_v,wf%n_v,wf%n_o,wf%n_o), intent(in) :: L_vvoo, g_vvoo
      real(dp), dimension(wf%n_v,wf%n_v,wf%n_v,wf%n_v), intent(in) :: L_vvvv, g_vvvv
!
      real(dp), dimension(:), allocatable :: X52, X53, X57, X59, X72, X75, X79, X81, X83, X85, X102, X105, X106, X109, X110, X112, X406, X410, X423, X426, X446, X448, X489, X492, X500, X504, X516, X519, X521, X524, X653, X662, X708, X723, X732, X752, X764, X767, X783, X787, X931, X940, X954, X968, X1021, X1031, X1034, X1045, X1671, X1731, X1883, X1891, X1913, X1916, X1993, X2272, X2277, X2340, X2383, X2441, X2454, X2468, X2473, X2514, X2524, X2561, X2562, X2571, X2572, X2651, X2661, X2698, X2699, X2708, X2709, X2765, X2779, X2835, X2836, X2848, X2849, X2897, X2907, X2966, X2972, X3065, X3099, X3103, X3122, X3126, X3163, X3164, X3167, X3168, X3203, X3207, X3247, X3248, X3251, X3252, X3284, X3288, X3325, X3326, X3329, X3330, X3366, X3371, X3409, X3414
      real(dp), dimension(:,:), allocatable :: X1, X8, X30, X32, X33, X35, X36, X38, X40, X41, X43, X45, X46, X48, X49, X50, X51, X55, X62, X63, X66, X68, X70, X71, X77, X90, X91, X93, X95, X96, X98, X100, X101, X123, X124, X131, X132, X159, X160, X161, X191, X192, X193, X194, X196, X197, X200, X201, X202, X203, X205, X206, X208, X213, X214, X240, X242, X248, X262, X264, X265, X348, X361, X365, X366, X389, X390, X393, X395, X398, X399, X401, X404, X405, X409, X422, X425, X439, X442, X445, X462, X463, X466, X468, X471, X472, X475, X477, X480, X483, X485, X488, X499, X503, X518, X523, X554, X557, X564, X567, X575, X578, X591, X596, X597, X610, X615, X616, X622, X623, X626, X627, X629, X630, X641, X642, X684, X687, X690, X722, X731, X763, X766, X776, X777, X779, X805, X808, X817, X820, X844, X867, X868, X872, X873, X883, X888, X889, X891, X892, X930, X939, X973, X976, X986, X989, X997, X1000, X1014, X1015, X1033, X1044, X1151, X1154, X1173, X1174, X1178, X1179, X1183, X1184, X1187, X1188, X1189, X1190, X1191, X1192, X1193, X1194, X1196, X1197, X1198, X1202, X1203, X1204, X1210, X1211, X1212, X1215, X1216, X1217, X1218, X1219, X1227, X1241, X1242, X1243, X1244, X1245, X1252, X1265, X1268, X1324, X1332, X1335, X1400, X1403, X1408, X1424, X1427, X1433, X1437, X1446, X1449, X1453, X1458, X1462, X1467, X1486, X1487, X1489, X1490, X1494, X1495, X1498, X1499, X1518, X1519, X1521, X1522, X1526, X1527, X1530, X1531, X1540, X1541, X1543, X1544, X1548, X1549, X1552, X1553, X1567, X1568, X1570, X1571, X1575, X1576, X1579, X1580, X1588, X1589, X1590, X1591, X1592, X1593, X1596, X1597, X1598, X1600, X1601, X1602, X1610, X1612, X1615, X1632, X1635, X1676, X1681, X1685, X1734, X1739, X1742, X1746, X1751, X1757, X1761, X1765, X1769, X1774, X1806, X1809, X1840, X1841, X1843, X1844, X1846, X1847, X1850, X1851, X1881, X1884, X1888, X1892, X1914, X1917, X1953, X1954, X1962, X1963, X1967, X1968, X1984, X1988, X1994, X2030, X2032, X2051, X2053, X2072, X2073, X2074, X2094, X2095, X2098, X2099, X2106, X2107, X2115, X2116, X2118, X2119, X2121, X2122, X2126, X2127, X2130, X2131, X2138, X2139, X2147, X2148, X2150, X2151, X2155, X2156, X2160, X2190, X2195, X2201, X2207, X2211, X2262, X2266, X2273, X2274, X2278, X2299, X2303, X2322, X2326, X2332, X2333, X2337, X2338, X2342, X2347, X2380, X2381, X2384, X2409, X2410, X2411, X2413, X2414, X2415, X2416, X2417, X2418, X2419, X2421, X2422, X2423, X2426, X2427, X2428, X2429, X2430, X2433, X2434, X2438, X2439, X2442, X2443, X2447, X2455, X2456, X2461, X2464, X2467, X2472, X2513, X2523, X2526, X2539, X2593, X2607, X2610, X2650, X2660, X2667, X2671, X2730, X2744, X2747, X2763, X2777, X2781, X2786, X2844, X2868, X2875, X2895, X2896, X2905, X2906, X2914, X2919, X2963, X2964, X2965, X2969, X2970, X2971, X2978, X2979, X2989, X2990, X2994, X2995, X2998, X2999, X3001, X3002, X3021, X3022, X3029, X3030, X3032, X3033, X3057, X3061, X3067, X3098, X3102, X3121, X3125, X3129, X3153, X3184, X3218, X3237, X3269, X3283, X3287, X3295, X3310, X3346, X3364, X3365, X3369, X3370, X3378, X3393, X3406, X3407, X3408, X3411, X3412, X3413, X3420, X3421, X3425, X3426, X3434, X3435, X3477, X3484, X3529, X3532, X3575, X3582, X3623, X3624, X3626, X3627
      real(dp), dimension(:,:,:), allocatable :: X4, X10, X12, X16, X17, X18, X20, X21, X22, X23, X24, X26, X27, X28, X54, X61, X65, X73, X76, X80, X84, X87, X88, X103, X107, X111, X115, X116, X118, X119, X120, X122, X162, X163, X164, X165, X167, X168, X169, X172, X177, X178, X180, X181, X183, X184, X187, X189, X211, X212, X217, X219, X220, X221, X223, X224, X226, X227, X228, X230, X231, X232, X234, X235, X237, X238, X245, X246, X251, X252, X253, X254, X256, X257, X259, X260, X266, X267, X268, X269, X270, X274, X275, X279, X280, X281, X288, X289, X292, X295, X296, X298, X299, X302, X305, X307, X308, X310, X312, X313, X314, X317, X320, X323, X324, X325, X407, X411, X412, X414, X415, X417, X418, X419, X420, X424, X428, X429, X431, X432, X433, X434, X436, X437, X447, X450, X451, X452, X454, X455, X457, X458, X459, X460, X490, X493, X494, X496, X497, X501, X505, X507, X508, X509, X511, X512, X513, X514, X517, X520, X526, X527, X529, X530, X532, X533, X535, X536, X538, X539, X540, X541, X543, X544, X546, X548, X551, X553, X556, X558, X561, X563, X566, X568, X569, X570, X572, X574, X577, X579, X582, X583, X585, X587, X590, X593, X594, X599, X600, X603, X604, X608, X609, X612, X614, X618, X621, X625, X628, X631, X632, X633, X635, X637, X638, X639, X640, X643, X644, X647, X648, X649, X651, X652, X654, X658, X661, X663, X664, X665, X666, X667, X669, X670, X671, X672, X674, X676, X680, X686, X689, X692, X693, X694, X695, X697, X698, X699, X700, X702, X703, X705, X706, X707, X710, X712, X713, X716, X717, X719, X720, X721, X725, X727, X728, X734, X736, X739, X740, X741, X745, X747, X748, X750, X751, X756, X758, X759, X761, X762, X769, X771, X772, X782, X784, X786, X788, X789, X791, X793, X794, X795, X796, X798, X799, X800, X802, X803, X804, X807, X809, X813, X814, X816, X819, X821, X822, X824, X825, X827, X828, X829, X830, X832, X833, X835, X836, X837, X839, X840, X841, X843, X846, X847, X848, X849, X850, X852, X853, X855, X856, X858, X862, X866, X870, X871, X875, X876, X877, X879, X880, X882, X885, X886, X887, X890, X893, X894, X895, X896, X898, X899, X900, X901, X902, X903, X904, X906, X907, X908, X909, X910, X911, X913, X914, X915, X916, X917, X918, X919, X921, X922, X923, X924, X925, X926, X928, X929, X932, X933, X935, X941, X942, X943, X944, X945, X946, X948, X949, X950, X951, X952, X953, X956, X957, X959, X961, X962, X963, X965, X966, X967, X971, X972, X975, X977, X978, X982, X983, X984, X988, X991, X992, X993, X995, X996, X999, X1002, X1003, X1004, X1006, X1007, X1008, X1010, X1011, X1012, X1013, X1016, X1017, X1022, X1023, X1024, X1026, X1027, X1032, X1035, X1036, X1037, X1039, X1040, X1046, X1047, X1048, X1049, X1050, X1051, X1052, X1053, X1055, X1056, X1057, X1058, X1059, X1060, X1061, X1062, X1064, X1065, X1066, X1067, X1068, X1069, X1070, X1071, X1073, X1075, X1076, X1077, X1078, X1079, X1080, X1081, X1083, X1085, X1149, X1150, X1153, X1157, X1158, X1159, X1160, X1162, X1163, X1164, X1166, X1167, X1168, X1169, X1170, X1171, X1172, X1175, X1176, X1180, X1181, X1185, X1220, X1225, X1226, X1246, X1247, X1248, X1249, X1250, X1251, X1255, X1256, X1257, X1258, X1259, X1260, X1262, X1263, X1264, X1267, X1271, X1272, X1275, X1276, X1277, X1278, X1280, X1281, X1282, X1284, X1285, X1286, X1287, X1289, X1290, X1293, X1294, X1295, X1297, X1298, X1299, X1300, X1302, X1303, X1304, X1306, X1307, X1308, X1309, X1310, X1311, X1313, X1314, X1315, X1322, X1323, X1326, X1327, X1328, X1329, X1330, X1331, X1334, X1338, X1339, X1340, X1341, X1344, X1345, X1346, X1347, X1349, X1350, X1351, X1352, X1353, X1354, X1355, X1356, X1358, X1359, X1360, X1362, X1363, X1364, X1365, X1366, X1367, X1368, X1370, X1371, X1372, X1373, X1376, X1377, X1378, X1379, X1380, X1381, X1382, X1383, X1385, X1386, X1387, X1388, X1391, X1392, X1393, X1394, X1395, X1396, X1399, X1401, X1402, X1406, X1407, X1411, X1413, X1414, X1419, X1422, X1423, X1426, X1431, X1432, X1436, X1440, X1442, X1444, X1445, X1448, X1450, X1451, X1452, X1456, X1457, X1461, X1464, X1465, X1466, X1470, X1471, X1472, X1477, X1479, X1481, X1483, X1618, X1619, X1620, X1622, X1623, X1624, X1625, X1627, X1629, X1631, X1634, X1637, X1639, X1640, X1643, X1644, X1645, X1648, X1650, X1655, X1657, X1658, X1659, X1661, X1663, X1665, X1666, X1667, X1668, X1670, X1672, X1673, X1677, X1678, X1682, X1686, X1688, X1689, X1690, X1692, X1693, X1694, X1696, X1697, X1698, X1699, X1701, X1703, X1707, X1708, X1709, X1710, X1711, X1712, X1714, X1716, X1718, X1719, X1720, X1725, X1726, X1727, X1728, X1729, X1730, X1732, X1735, X1736, X1737, X1740, X1743, X1744, X1745, X1750, X1754, X1755, X1756, X1759, X1760, X1763, X1764, X1767, X1768, X1772, X1773, X1777, X1778, X1782, X1783, X1786, X1787, X1790, X1791, X1795, X1796, X1797, X1800, X1801, X1802, X1805, X1808, X1812, X1816, X1817, X1821, X1822, X1823, X1827, X1828, X1831, X1832, X1833, X1836, X1837, X1878, X1879, X1880, X1882, X1885, X1886, X1887, X1890, X1894, X1895, X1896, X1899, X1900, X1901, X1903, X1904, X1905, X1906, X1908, X1909, X1910, X1911, X1912, X1915, X1919, X1920, X1921, X1924, X1925, X1926, X1928, X1930, X1931, X1932, X1933, X1937, X1938, X1940, X1941, X1970, X1971, X1972, X1975, X1976, X1977, X1980, X1981, X1985, X1986, X1989, X1990, X1992, X1996, X1997, X1998, X1999, X2002, X2003, X2006, X2007, X2009, X2010, X2011, X2012, X2014, X2015, X2016, X2019, X2020, X2021, X2024, X2025, X2026, X2027, X2028, X2158, X2159, X2163, X2164, X2165, X2168, X2169, X2172, X2173, X2177, X2178, X2181, X2182, X2186, X2187, X2191, X2192, X2196, X2197, X2200, X2204, X2205, X2206, X2210, X2214, X2215, X2216, X2219, X2220, X2221, X2225, X2226, X2229, X2230, X2231, X2234, X2235, X2239, X2240, X2243, X2244, X2245, X2248, X2249, X2253, X2254, X2255, X2258, X2263, X2267, X2268, X2269, X2271, X2276, X2280, X2281, X2282, X2283, X2285, X2286, X2287, X2289, X2290, X2291, X2294, X2295, X2296, X2300, X2301, X2304, X2305, X2309, X2310, X2313, X2314, X2316, X2317, X2320, X2323, X2327, X2330, X2331, X2335, X2336, X2339, X2341, X2345, X2346, X2349, X2350, X2351, X2354, X2355, X2359, X2360, X2361, X2364, X2365, X2366, X2367, X2368, X2369, X2372, X2373, X2375, X2376, X2379, X2382, X2386, X2387, X2388, X2389, X2392, X2393, X2394, X2395, X2396, X2400, X2401, X2405, X2406, X2407, X2435, X2436, X2437, X2440, X2444, X2445, X2446, X2449, X2450, X2451, X2452, X2453, X2457, X2458, X2459, X2462, X2465, X2469, X2474, X2475, X2476, X2478, X2480, X2482, X2483, X2484, X2489, X2490, X2491, X2492, X2494, X2495, X2496, X2498, X2499, X2503, X2504, X2505, X2508, X2509, X2515, X2518, X2519, X2520, X2521, X2527, X2530, X2531, X2534, X2535, X2540, X2541, X2542, X2545, X2546, X2547, X2549, X2550, X2551, X2553, X2556, X2557, X2558, X2560, X2563, X2565, X2566, X2567, X2568, X2569, X2570, X2573, X2574, X2575, X2578, X2579, X2580, X2581, X2582, X2583, X2584, X2588, X2589, X2590, X2594, X2595, X2597, X2598, X2599, X2602, X2603, X2608, X2611, X2615, X2616, X2617, X2618, X2621, X2622, X2623, X2626, X2627, X2628, X2629, X2631, X2632, X2633, X2635, X2636, X2640, X2641, X2642, X2645, X2646, X2652, X2655, X2656, X2657, X2658, X2663, X2664, X2668, X2672, X2673, X2674, X2677, X2678, X2682, X2683, X2684, X2686, X2687, X2688, X2690, X2691, X2692, X2694, X2697, X2700, X2702, X2703, X2704, X2705, X2706, X2707, X2710, X2711, X2712, X2715, X2716, X2717, X2718, X2719, X2720, X2721, X2725, X2726, X2727, X2731, X2732, X2734, X2735, X2736, X2739, X2740, X2745, X2748, X2752, X2753, X2754, X2755, X2758, X2759, X2760, X2764, X2766, X2769, X2770, X2771, X2773, X2774, X2775, X2778, X2782, X2783, X2787, X2790, X2791, X2792, X2796, X2797, X2798, X2802, X2803, X2805, X2806, X2808, X2809, X2812, X2813, X2817, X2819, X2821, X2824, X2827, X2828, X2829, X2831, X2832, X2834, X2837, X2839, X2840, X2841, X2842, X2845, X2846, X2847, X2850, X2851, X2852, X2855, X2856, X2860, X2862, X2864, X2865, X2866, X2869, X2870, X2871, X2872, X2876, X2878, X2882, X2884, X2885, X2887, X2888, X2890, X2891, X2892, X2898, X2901, X2902, X2903, X2909, X2910, X2911, X2915, X2916, X2920, X2921, X2924, X2925, X2926, X2930, X2931, X2933, X2934, X2936, X2937, X2939, X2940, X2944, X2945, X2946, X2948, X2949, X2951, X2952, X2956, X2957, X2960, X2967, X2973, X2974, X2975, X2976, X2980, X2981, X2983, X2984, X2985, X2986, X2991, X2992, X2996, X2997, X3000, X3003, X3007, X3008, X3010, X3037, X3038, X3040, X3043, X3047, X3048, X3049, X3053, X3054, X3058, X3059, X3062, X3064, X3066, X3069, X3070, X3071, X3074, X3075, X3076, X3077, X3078, X3083, X3085, X3088, X3089, X3091, X3092, X3094, X3095, X3096, X3100, X3108, X3110, X3111, X3112, X3113, X3115, X3117, X3118, X3123, X3130, X3131, X3134, X3135, X3138, X3139, X3144, X3145, X3146, X3148, X3149, X3154, X3155, X3158, X3159, X3160, X3162, X3165, X3166, X3170, X3171, X3172, X3175, X3176, X3178, X3179, X3180, X3185, X3186, X3189, X3190, X3191, X3194, X3195, X3197, X3198, X3199, X3202, X3204, X3206, X3210, X3211, X3214, X3215, X3216, X3219, X3220, X3221, X3224, X3225, X3228, X3229, X3230, X3233, X3234, X3235, X3238, X3239, X3242, X3243, X3244, X3246, X3249, X3250, X3254, X3255, X3256, X3257, X3258, X3259, X3260, X3261, X3264, X3265, X3266, X3270, X3271, X3273, X3274, X3275, X3278, X3279, X3280, X3285, X3291, X3292, X3296, X3297, X3301, X3302, X3303, X3305, X3306, X3311, X3312, X3315, X3316, X3320, X3321, X3322, X3324, X3327, X3328, X3332, X3333, X3334, X3337, X3338, X3340, X3341, X3342, X3347, X3348, X3351, X3352, X3353, X3356, X3357, X3359, X3360, X3361, X3367, X3374, X3375, X3379, X3380, X3384, X3385, X3386, X3388, X3389, X3394, X3395, X3398, X3399, X3403, X3404, X3410, X3416, X3417, X3418, X3422, X3423, X3427, X3428, X3429, X3430, X3431, X3436, X3437, X3440, X3441, X3443, X3448, X3449, X3451, X3456, X3457, X3459, X3460, X3461, X3464, X3465, X3466, X3469, X3470, X3472, X3473, X3478, X3479, X3480, X3485, X3487, X3488, X3489, X3491, X3492, X3496, X3497, X3499, X3500, X3502, X3503, X3504, X3507, X3508, X3510, X3511, X3513, X3514, X3516, X3517, X3518, X3519, X3520, X3521, X3524, X3525, X3526, X3530, X3533, X3535, X3536, X3538, X3539, X3542, X3543, X3545, X3550, X3551, X3554, X3557, X3558, X3559, X3561, X3562, X3563, X3567, X3568, X3570, X3571, X3576, X3577, X3578, X3583, X3585, X3586, X3587, X3589, X3590, X3595, X3596, X3598, X3603, X3604, X3607, X3610, X3611, X3612, X3614, X3615, X3616, X3620, X3621, X3625, X3628, X3631, X3632
      real(dp), dimension(:,:,:,:), allocatable :: X2, X3, X5, X6, X7, X9, X11, X13, X14, X15, X19, X25, X29, X31, X34, X37, X39, X42, X44, X47, X56, X58, X60, X64, X67, X69, X74, X78, X82, X86, X89, X92, X94, X97, X99, X104, X108, X113, X114, X117, X121, X125, X126, X127, X128, X129, X130, X133, X134, X135, X136, X137, X138, X139, X140, X141, X142, X143, X144, X145, X146, X147, X148, X149, X150, X151, X152, X153, X154, X155, X156, X157, X158, X166, X170, X171, X173, X174, X175, X176, X179, X182, X185, X186, X188, X190, X195, X198, X199, X204, X207, X209, X210, X215, X216, X218, X222, X225, X229, X233, X236, X239, X241, X243, X244, X247, X249, X250, X255, X258, X261, X263, X271, X272, X273, X276, X277, X278, X282, X283, X284, X285, X286, X287, X290, X291, X293, X294, X297, X300, X301, X303, X304, X306, X309, X311, X315, X316, X318, X319, X321, X322, X326, X327, X328, X329, X330, X331, X332, X333, X334, X335, X336, X337, X338, X339, X340, X341, X342, X343, X344, X345, X346, X347, X349, X350, X351, X352, X353, X354, X355, X356, X357, X358, X359, X360, X362, X363, X364, X367, X368, X369, X370, X371, X372, X373, X374, X375, X376, X377, X378, X379, X380, X381, X382, X383, X384, X385, X386, X387, X388, X391, X392, X394, X396, X397, X400, X402, X403, X408, X413, X416, X421, X427, X430, X435, X438, X440, X441, X443, X444, X449, X453, X456, X461, X464, X465, X467, X469, X470, X473, X474, X476, X478, X479, X481, X482, X484, X486, X487, X491, X495, X498, X502, X506, X510, X515, X522, X525, X528, X531, X534, X537, X542, X545, X547, X549, X550, X552, X555, X559, X560, X562, X565, X571, X573, X576, X580, X581, X584, X586, X588, X589, X592, X595, X598, X601, X602, X605, X606, X607, X611, X613, X617, X619, X620, X624, X634, X636, X645, X646, X650, X655, X656, X657, X659, X660, X668, X673, X675, X677, X678, X679, X681, X682, X683, X685, X688, X691, X696, X701, X704, X709, X711, X714, X715, X718, X724, X726, X729, X730, X733, X735, X737, X738, X742, X743, X744, X746, X749, X753, X754, X755, X757, X760, X765, X768, X770, X773, X774, X775, X778, X780, X781, X785, X790, X792, X797, X801, X806, X810, X811, X812, X815, X818, X823, X826, X831, X834, X838, X842, X845, X851, X854, X857, X859, X860, X861, X863, X864, X865, X869, X874, X878, X881, X884, X897, X905, X912, X920, X927, X934, X936, X937, X938, X947, X955, X958, X960, X964, X969, X970, X974, X979, X980, X981, X985, X987, X990, X994, X998, X1001, X1005, X1009, X1018, X1019, X1020, X1025, X1028, X1029, X1030, X1038, X1041, X1042, X1043, X1054, X1063, X1072, X1074, X1082, X1084, X1086, X1087, X1088, X1089, X1090, X1091, X1092, X1093, X1094, X1095, X1096, X1097, X1098, X1099, X1100, X1101, X1102, X1103, X1104, X1105, X1106, X1107, X1108, X1109, X1110, X1111, X1112, X1113, X1114, X1115, X1116, X1117, X1118, X1119, X1120, X1121, X1122, X1123, X1124, X1125, X1126, X1127, X1128, X1129, X1130, X1131, X1132, X1133, X1134, X1135, X1136, X1137, X1138, X1139, X1140, X1141, X1142, X1143, X1144, X1145, X1146, X1147, X1148, X1152, X1155, X1156, X1161, X1165, X1177, X1182, X1186, X1195, X1199, X1200, X1201, X1205, X1206, X1207, X1208, X1209, X1213, X1214, X1221, X1222, X1223, X1224, X1228, X1229, X1230, X1231, X1232, X1233, X1234, X1235, X1236, X1237, X1238, X1239, X1240, X1253, X1254, X1261, X1266, X1269, X1270, X1273, X1274, X1279, X1283, X1288, X1291, X1292, X1296, X1301, X1305, X1312, X1316, X1317, X1318, X1319, X1320, X1321, X1325, X1333, X1336, X1337, X1342, X1343, X1348, X1357, X1361, X1369, X1374, X1375, X1384, X1389, X1390, X1397, X1398, X1404, X1405, X1409, X1410, X1412, X1415, X1416, X1417, X1418, X1420, X1421, X1425, X1428, X1429, X1430, X1434, X1435, X1438, X1439, X1441, X1443, X1447, X1454, X1455, X1459, X1460, X1463, X1468, X1469, X1473, X1474, X1475, X1476, X1478, X1480, X1482, X1484, X1485, X1488, X1491, X1492, X1493, X1496, X1497, X1500, X1501, X1502, X1503, X1504, X1505, X1506, X1507, X1508, X1509, X1510, X1511, X1512, X1513, X1514, X1515, X1516, X1517, X1520, X1523, X1524, X1525, X1528, X1529, X1532, X1533, X1534, X1535, X1536, X1537, X1538, X1539, X1542, X1545, X1546, X1547, X1550, X1551, X1554, X1555, X1556, X1557, X1558, X1559, X1560, X1561, X1562, X1563, X1564, X1565, X1566, X1569, X1572, X1573, X1574, X1577, X1578, X1581, X1582, X1583, X1584, X1585, X1586, X1587, X1594, X1595, X1599, X1603, X1604, X1605, X1606, X1607, X1608, X1609, X1611, X1613, X1614, X1616, X1617, X1621, X1626, X1628, X1630, X1633, X1636, X1638, X1641, X1642, X1646, X1647, X1649, X1651, X1652, X1653, X1654, X1656, X1660, X1662, X1664, X1669, X1674, X1675, X1679, X1680, X1683, X1684, X1687, X1691, X1695, X1700, X1702, X1704, X1705, X1706, X1713, X1715, X1717, X1721, X1722, X1723, X1724, X1733, X1738, X1741, X1747, X1748, X1749, X1752, X1753, X1758, X1762, X1766, X1770, X1771, X1775, X1776, X1779, X1780, X1781, X1784, X1785, X1788, X1789, X1792, X1793, X1794, X1798, X1799, X1803, X1804, X1807, X1810, X1811, X1813, X1814, X1815, X1818, X1819, X1820, X1824, X1825, X1826, X1829, X1830, X1834, X1835, X1838, X1839, X1842, X1845, X1848, X1849, X1852, X1853, X1854, X1855, X1856, X1857, X1858, X1859, X1860, X1861, X1862, X1863, X1864, X1865, X1866, X1867, X1868, X1869, X1870, X1871, X1872, X1873, X1874, X1875, X1876, X1877, X1889, X1893, X1897, X1898, X1902, X1907, X1918, X1922, X1923, X1927, X1929, X1934, X1935, X1936, X1939, X1942, X1943, X1944, X1945, X1946, X1947, X1948, X1949, X1950, X1951, X1952, X1955, X1956, X1957, X1958, X1959, X1960, X1961, X1964, X1965, X1966, X1969, X1973, X1974, X1978, X1979, X1982, X1983, X1987, X1991, X1995, X2000, X2001, X2004, X2005, X2008, X2013, X2017, X2018, X2022, X2023, X2029, X2031, X2033, X2034, X2035, X2036, X2037, X2038, X2039, X2040, X2041, X2042, X2043, X2044, X2045, X2046, X2047, X2048, X2049, X2050, X2052, X2054, X2055, X2056, X2057, X2058, X2059, X2060, X2061, X2062, X2063, X2064, X2065, X2066, X2067, X2068, X2069, X2070, X2071, X2075, X2076, X2077, X2078, X2079, X2080, X2081, X2082, X2083, X2084, X2085, X2086, X2087, X2088, X2089, X2090, X2091, X2092, X2093, X2096, X2097, X2100, X2101, X2102, X2103, X2104, X2105, X2108, X2109, X2110, X2111, X2112, X2113, X2114, X2117, X2120, X2123, X2124, X2125, X2128, X2129, X2132, X2133, X2134, X2135, X2136, X2137, X2140, X2141, X2142, X2143, X2144, X2145, X2146, X2149, X2152, X2153, X2154, X2157, X2161, X2162, X2166, X2167, X2170, X2171, X2174, X2175, X2176, X2179, X2180, X2183, X2184, X2185, X2188, X2189, X2193, X2194, X2198, X2199, X2202, X2203, X2208, X2209, X2212, X2213, X2217, X2218, X2222, X2223, X2224, X2227, X2228, X2232, X2233, X2236, X2237, X2238, X2241, X2242, X2246, X2247, X2250, X2251, X2252, X2256, X2257, X2259, X2260, X2261, X2264, X2265, X2270, X2275, X2279, X2284, X2288, X2292, X2293, X2297, X2298, X2302, X2306, X2307, X2308, X2311, X2312, X2315, X2318, X2319, X2321, X2324, X2325, X2328, X2329, X2334, X2343, X2344, X2348, X2352, X2353, X2356, X2357, X2358, X2362, X2363, X2370, X2371, X2374, X2377, X2378, X2385, X2390, X2391, X2397, X2398, X2399, X2402, X2403, X2404, X2408, X2412, X2420, X2424, X2425, X2431, X2432, X2448, X2460, X2463, X2466, X2470, X2471, X2477, X2479, X2481, X2485, X2486, X2487, X2488, X2493, X2497, X2500, X2501, X2502, X2506, X2507, X2510, X2511, X2512, X2516, X2517, X2522, X2525, X2528, X2529, X2532, X2533, X2536, X2537, X2538, X2543, X2544, X2548, X2552, X2554, X2555, X2559, X2564, X2576, X2577, X2585, X2586, X2587, X2591, X2592, X2596, X2600, X2601, X2604, X2605, X2606, X2609, X2612, X2613, X2614, X2619, X2620, X2624, X2625, X2630, X2634, X2637, X2638, X2639, X2643, X2644, X2647, X2648, X2649, X2653, X2654, X2659, X2662, X2665, X2666, X2669, X2670, X2675, X2676, X2679, X2680, X2681, X2685, X2689, X2693, X2695, X2696, X2701, X2713, X2714, X2722, X2723, X2724, X2728, X2729, X2733, X2737, X2738, X2741, X2742, X2743, X2746, X2749, X2750, X2751, X2756, X2757, X2761, X2762, X2767, X2768, X2772, X2776, X2780, X2784, X2785, X2788, X2789, X2793, X2794, X2795, X2799, X2800, X2801, X2804, X2807, X2810, X2811, X2814, X2815, X2816, X2820, X2825, X2826, X2830, X2833, X2838, X2843, X2853, X2854, X2857, X2858, X2859, X2863, X2867, X2873, X2874, X2877, X2883, X2886, X2889, X2893, X2894, X2899, X2900, X2904, X2908, X2912, X2913, X2917, X2918, X2922, X2923, X2927, X2928, X2929, X2932, X2935, X2938, X2941, X2942, X2943, X2947, X2950, X2953, X2954, X2955, X2958, X2959, X2961, X2962, X2968, X2977, X2982, X2987, X2988, X2993, X3004, X3005, X3006, X3009, X3011, X3012, X3013, X3014, X3015, X3016, X3017, X3018, X3019, X3020, X3023, X3024, X3025, X3026, X3027, X3028, X3031, X3034, X3035, X3036, X3039, X3044, X3045, X3046, X3050, X3051, X3052, X3055, X3056, X3060, X3063, X3068, X3072, X3073, X3079, X3080, X3081, X3082, X3086, X3087, X3090, X3093, X3097, X3101, X3104, X3105, X3106, X3107, X3109, X3114, X3116, X3119, X3120, X3124, X3127, X3128, X3132, X3133, X3136, X3137, X3140, X3141, X3142, X3143, X3147, X3150, X3151, X3152, X3156, X3157, X3161, X3169, X3173, X3174, X3177, X3181, X3182, X3183, X3187, X3188, X3192, X3193, X3196, X3200, X3201, X3205, X3208, X3209, X3212, X3213, X3217, X3222, X3223, X3226, X3227, X3231, X3232, X3236, X3240, X3241, X3245, X3253, X3262, X3263, X3267, X3268, X3272, X3276, X3277, X3281, X3282, X3286, X3289, X3290, X3293, X3294, X3298, X3299, X3300, X3304, X3307, X3308, X3309, X3313, X3314, X3317, X3318, X3319, X3323, X3331, X3335, X3336, X3339, X3343, X3344, X3345, X3349, X3350, X3354, X3355, X3358, X3362, X3363, X3368, X3372, X3373, X3376, X3377, X3381, X3382, X3383, X3387, X3390, X3391, X3392, X3396, X3397, X3400, X3401, X3402, X3405, X3415, X3419, X3424, X3432, X3433, X3438, X3439, X3442, X3444, X3445, X3446, X3447, X3450, X3452, X3453, X3454, X3455, X3458, X3462, X3463, X3467, X3468, X3471, X3474, X3475, X3476, X3481, X3482, X3483, X3486, X3490, X3493, X3494, X3495, X3498, X3501, X3505, X3506, X3509, X3512, X3515, X3522, X3523, X3527, X3528, X3531, X3534, X3537, X3540, X3541, X3544, X3546, X3547, X3548, X3549, X3552, X3553, X3555, X3556, X3560, X3564, X3565, X3566, X3569, X3572, X3573, X3574, X3579, X3580, X3581, X3584, X3588, X3591, X3592, X3593, X3594, X3597, X3599, X3600, X3601, X3602, X3605, X3606, X3608, X3609, X3613, X3617, X3618, X3619, X3622, X3629, X3630
      real(dp), dimension(:,:,:,:,:), allocatable :: X2818, X2822, X2823, X2861, X2879, X2880, X2881, X3041, X3042, X3084
!
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         LAIxx_vo, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X1, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X1, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         LAIxx_vo, 1, &
         X1, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1)
      call mem%alloc(X2, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         -four, &
         rxIxx_vvo, 1, &
         gAIAx_o, 1, &
         X2, &
         wf%n_v**2*wf%n_o)
!
      call add_1342_to_1234(one, X2, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2)
      call mem%alloc(X3, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         rxxxI_vov, 1, &
         gAIAx_o, 1, &
         X3, &
         wf%n_v**2*wf%n_o)
!
      call add_1432_to_1234(one, X3, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -four, &
         gAIxI_v, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%alloc(X4, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(rAxxx_ovo, X4, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         two, &
         gAIxI_v, 1, &
         X4, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X4)
      call mem%alloc(X5, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         gAIxx_vo, 1, &
         rAIxx_vo, 1, &
         X5, &
         wf%n_v*wf%n_o)
!
      call add_1432_to_1234(one, X5, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X5)
      call mem%alloc(X6, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gAIxx_vo, 1, &
         rAxxI_ov, 1, &
         X6, &
         wf%n_v*wf%n_o)
!
      call add_1423_to_1234(one, X6, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X6)
      call mem%alloc(X7, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAIxx_vo, 1, &
         gAxxI_ov, 1, &
         X7, &
         wf%n_v*wf%n_o)
!
      call add_1423_to_1234(one, X7, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X7)
      call mem%alloc(X8, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X8, wf%n_o, wf%n_v)
      call mem%alloc(X9, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X8, 1, &
         gAxxI_ov, 1, &
         X9, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X8)
      call add_1423_to_1234(one, X9, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X9)
      call mem%alloc(X10, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(gAxxx_ovo, X10, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X11, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         X10, 1, &
         rAIxI_v, 1, &
         X11, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X10)
      call add_1243_to_1234(one, X11, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X11)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -four, &
         rAIxI_v, 1, &
         gAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%alloc(X12, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxIxx_vvo, X12, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         X12, 1, &
         rAIAx_o, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X12)
      call mem%alloc(X13, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         -four, &
         gxIxx_vvo, 1, &
         rAIAx_o, 1, &
         X13, &
         wf%n_v**2*wf%n_o)
!
      call add_1342_to_1234(one, X13, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X13)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two*rAIAI, &
         wf%fock_ab, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%alloc(X14, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X14, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X15, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         -two*rAIAI, &
         X14, &
         wf%n_v**2*wf%n_o, &
         wf%fock_ij, &
         wf%n_o, &
         zero, &
         X15, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X14)
      call add_1342_to_1234(rAIAI, X15, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X15)
      call mem%alloc(X16, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_312(uxIxx_vvo, X16, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X17, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         wf%fock_ab, &
         wf%n_v, &
         X16, &
         wf%n_v*wf%n_o, &
         zero, &
         X17, &
         wf%n_v)
!
      call mem%dealloc(X16)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X17, 1, &
         rAIAx_o, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X17)
      call mem%alloc(X18, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         wf%fock_ab, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X18, &
         wf%n_v)
!
      call mem%alloc(X19, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X18, 1, &
         rAIAx_o, 1, &
         X19, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X18)
      call add_1342_to_1234(one, X19, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X19)
      call mem%alloc(X20, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X20, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X21, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         X20, &
         wf%n_v**2, &
         wf%fock_ij, &
         wf%n_o, &
         zero, &
         X21, &
         wf%n_v**2)
!
      call mem%dealloc(X20)
      call mem%alloc(X22, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X21, X22, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X21)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X22, 1, &
         rAIAx_o, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X22)
      call mem%alloc(X23, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X23, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X24, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         wf%fock_ab, &
         wf%n_v, &
         X23, &
         wf%n_o**2, &
         zero, &
         X24, &
         wf%n_v)
!
      call mem%dealloc(X23)
      call mem%alloc(X25, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X24, 1, &
         rAIxI_v, 1, &
         X25, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X24)
      call add_1423_to_1234(one, X25, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X25)
      call mem%alloc(X26, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         two, &
         wf%fock_ij, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X26, &
         wf%n_o)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X26, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X26)
      call mem%alloc(X27, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X27, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X28, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         two, &
         X27, &
         wf%n_v*wf%n_o, &
         wf%fock_ij, &
         wf%n_o, &
         zero, &
         X28, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X27)
      call mem%alloc(X29, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X28, 1, &
         rAIxI_v, 1, &
         X29, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X28)
      call add_1423_to_1234(one, X29, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X29)
      call mem%alloc(X30, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         wf%fock_ab, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X30, &
         wf%n_v)
!
      call mem%alloc(X31, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X30, 1, &
         rAIxx_vo, 1, &
         X31, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X30)
      call add_1432_to_1234(one, X31, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X31)
      call mem%alloc(X32, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         four, &
         wf%fock_ab, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X32, &
         wf%n_v)
!
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X32, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X32)
      call mem%alloc(X33, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o, &
         two, &
         wf%fock_ij, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X33, &
         wf%n_o)
!
      call mem%alloc(X34, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X33, 1, &
         X34, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X33)
      call add_1423_to_1234(one, X34, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X34)
      call mem%alloc(X35, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o, &
         -four, &
         uAIxx_vo, &
         wf%n_v, &
         wf%fock_ij, &
         wf%n_o, &
         zero, &
         X35, &
         wf%n_v)
!
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X35, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X35)
      call mem%alloc(X36, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         two, &
         wf%fock_ab, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X36, &
         wf%n_v)
!
      call mem%alloc(X37, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X36, 1, &
         rAxAx_oo, 1, &
         X37, &
         wf%n_v**2)
!
      call mem%dealloc(X36)
      call add_1324_to_1234(one, X37, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X37)
      call mem%alloc(X38, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         two, &
         wf%fock_ab, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X38, &
         wf%n_v)
!
      call mem%alloc(X39, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X38, 1, &
         rAxxI_ov, 1, &
         X39, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X38)
      call add_1423_to_1234(one, X39, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X39)
      call mem%alloc(X40, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         wf%fock_ij, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X40, &
         wf%n_o)
!
      call mem%alloc(X41, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X41, wf%n_o, wf%n_v)
      call mem%alloc(X42, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X41, 1, &
         X40, 1, &
         X42, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X40)
      call mem%dealloc(X41)
      call add_1423_to_1234(one, X42, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X42)
      call mem%alloc(X43, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         two, &
         wf%fock_ab, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X43, &
         wf%n_v)
!
      call mem%alloc(X44, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X43, 1, &
         rAxxI_ov, 1, &
         X44, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X43)
      call add_1423_to_1234(one, X44, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X44)
      call mem%alloc(X45, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         wf%fock_ij, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X45, &
         wf%n_o)
!
      call mem%alloc(X46, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X46, wf%n_o, wf%n_v)
      call mem%alloc(X47, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X46, 1, &
         X45, 1, &
         X47, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X45)
      call mem%dealloc(X46)
      call add_1423_to_1234(one, X47, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X47)
      call mem%alloc(X48, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         wf%fock_ab, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X48, &
         wf%n_v)
!
      call mem%alloc(X49, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X49, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X48, 1, &
         X49, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X48)
      call mem%dealloc(X49)
      call mem%alloc(X50, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o, &
         two, &
         uAIxx_vo, &
         wf%n_v, &
         wf%fock_ij, &
         wf%n_o, &
         zero, &
         X50, &
         wf%n_v)
!
      call mem%alloc(X51, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X51, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X50, 1, &
         X51, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X50)
      call mem%dealloc(X51)
      call mem%alloc(X52, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v, &
         -four, &
         wf%fock_ab, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X52, 1)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X52, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X52)
      call mem%alloc(X53, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v, &
         two, &
         wf%fock_ab, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X53, 1)
!
      call mem%alloc(X54, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(rAxxx_ovo, X54, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X53, 1, &
         X54, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X53)
      call mem%dealloc(X54)
      call mem%alloc(X55, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         wf%fock_ij, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X55, &
         wf%n_o)
!
      call mem%alloc(X56, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X55, 1, &
         X56, &
         wf%n_v**2)
!
      call mem%dealloc(X55)
      call add_1324_to_1234(one, X56, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X56)
      call mem%alloc(X57, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o, &
         four, &
         wf%fock_ij, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X57, 1)
!
      call mem%alloc(X58, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X57, 1, &
         X58, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X57)
      call add_1342_to_1234(one, X58, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X58)
      call mem%alloc(X59, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o, &
         -two, &
         wf%fock_ij, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X59, 1)
!
      call mem%alloc(X60, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxxxI_vov, 1, &
         X59, 1, &
         X60, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X59)
      call add_1432_to_1234(one, X60, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X60)
      call mem%alloc(X61, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -two, &
         u_aibj, &
         wf%n_v, &
         FAx_v, 1, &
         zero, &
         X61, 1)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X61, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X61)
      call mem%alloc(X62, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         four, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         FAx_v, 1, &
         zero, &
         X62, 1)
!
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X62, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X62)
      call mem%alloc(X63, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         FAx_v, 1, &
         zero, &
         X63, 1)
!
      call mem%alloc(X64, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X63, 1, &
         X64, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X63)
      call add_1432_to_1234(one, X64, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X64)
      call mem%alloc(X65, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X65, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X66, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         X65, &
         wf%n_v*wf%n_o, &
         FAx_v, 1, &
         zero, &
         X66, 1)
!
      call mem%dealloc(X65)
      call mem%alloc(X67, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X66, 1, &
         rAxxI_ov, 1, &
         X67, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X66)
      call add_1423_to_1234(one, X67, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X67)
      call mem%alloc(X68, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         FAx_v, 1, &
         zero, &
         X68, 1)
!
      call mem%alloc(X69, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X68, 1, &
         rAxxI_ov, 1, &
         X69, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X68)
      call add_1423_to_1234(one, X69, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X69)
      call mem%alloc(X70, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         FAx_v, 1, &
         zero, &
         X70, 1)
!
      call mem%alloc(X71, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X71, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X71, 1, &
         X70, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X70)
      call mem%dealloc(X71)
      call mem%alloc(X72, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v, &
         two, &
         txIxI_vv, &
         wf%n_v, &
         FAx_v, 1, &
         zero, &
         X72, 1)
!
      call mem%alloc(X73, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X73, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X74, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X73, 1, &
         X72, 1, &
         X74, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X72)
      call mem%dealloc(X73)
      call add_1243_to_1234(one, X74, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X74)
      call mem%alloc(X75, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v, &
         -four, &
         txIxI_vv, &
         wf%n_v, &
         FAx_v, 1, &
         zero, &
         X75, 1)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X75, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X75)
      call mem%alloc(X76, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X76, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X77, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X76, &
         wf%n_o**2, &
         FAx_v, 1, &
         zero, &
         X77, 1)
!
      call mem%dealloc(X76)
      call mem%alloc(X78, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X77, 1, &
         X78, &
         wf%n_v**2)
!
      call mem%dealloc(X77)
      call add_1324_to_1234(one, X78, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X78)
      call mem%alloc(X79, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         FAx_v, 1, &
         zero, &
         X79, 1)
!
      call mem%alloc(X80, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X80, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X80, 1, &
         X79, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X79)
      call mem%dealloc(X80)
      call mem%alloc(X81, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o, &
         -four, &
         tAIxx_vo, &
         wf%n_v, &
         FAx_v, 1, &
         zero, &
         X81, 1)
!
      call mem%alloc(X82, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X81, 1, &
         X82, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X81)
      call add_1342_to_1234(one, X82, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X82)
      call mem%alloc(X83, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v, &
         two, &
         tAxxI_ov, &
         wf%n_o, &
         FAx_v, 1, &
         zero, &
         X83, 1)
!
      call mem%alloc(X84, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X84, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X84, 1, &
         X83, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X83)
      call mem%dealloc(X84)
      call mem%alloc(X85, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v, &
         -four, &
         tAxxI_ov, &
         wf%n_o, &
         FAx_v, 1, &
         zero, &
         X85, 1)
!
      call mem%alloc(X86, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X85, 1, &
         X86, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X85)
      call add_1342_to_1234(one, X86, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X86)
      call mem%alloc(X87, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         u_aibj, &
         wf%n_v**2*wf%n_o, &
         FxI_o, 1, &
         zero, &
         X87, 1)
!
      call mem%alloc(X88, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_312(X87, X88, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X87)
      call mem%alloc(X89, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X88, 1, &
         rAIAx_o, 1, &
         X89, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X88)
      call add_1342_to_1234(one, X89, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X89)
      call mem%alloc(X90, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         uAxxx_ovo, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X90, 1)
!
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X90, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X90)
      call mem%alloc(X91, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         uAxxx_ovo, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X91, 1)
!
      call mem%alloc(X92, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X91, 1, &
         X92, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X91)
      call add_1432_to_1234(one, X92, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X92)
      call mem%alloc(X93, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         -two, &
         txIxx_vvo, &
         wf%n_v**2, &
         FxI_o, 1, &
         zero, &
         X93, 1)
!
      call mem%alloc(X94, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X93, 1, &
         rAxAx_oo, 1, &
         X94, &
         wf%n_v**2)
!
      call mem%dealloc(X93)
      call add_1324_to_1234(one, X94, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X94)
      call mem%alloc(X95, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         FxI_o, 1, &
         zero, &
         X95, 1)
!
      call mem%alloc(X96, wf%n_v, wf%n_o)
      call sort_to_21(X95, X96, wf%n_o, wf%n_v)
      call mem%dealloc(X95)
      call mem%alloc(X97, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X96, 1, &
         rAxxI_ov, 1, &
         X97, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X96)
      call add_1423_to_1234(one, X97, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X97)
      call mem%alloc(X98, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X98, 1)
!
      call mem%alloc(X99, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X98, 1, &
         rAxxI_ov, 1, &
         X99, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X98)
      call add_1423_to_1234(one, X99, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X99)
      call mem%alloc(X100, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         uAxxx_ovo, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X100, 1)
!
      call mem%alloc(X101, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X101, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X101, 1, &
         X100, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X100)
      call mem%dealloc(X101)
      call mem%alloc(X102, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_o, &
         -two, &
         tAIxx_vo, &
         wf%n_v, &
         FxI_o, 1, &
         zero, &
         X102, 1)
!
      call mem%alloc(X103, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X103, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X104, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X103, 1, &
         X102, 1, &
         X104, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X102)
      call mem%dealloc(X103)
      call add_1243_to_1234(one, X104, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X104)
      call mem%alloc(X105, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_o, &
         four, &
         tAIxx_vo, &
         wf%n_v, &
         FxI_o, 1, &
         zero, &
         X105, 1)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X105, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X105)
      call mem%alloc(X106, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v, &
         -two, &
         tAxxI_ov, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X106, 1)
!
      call mem%alloc(X107, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X107, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X108, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X107, 1, &
         X106, 1, &
         X108, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X106)
      call mem%dealloc(X107)
      call add_1243_to_1234(one, X108, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X108)
      call mem%alloc(X109, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v, &
         four, &
         tAxxI_ov, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X109, 1)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X109, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X109)
      call mem%alloc(X110, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_o, &
         -two, &
         tAxAx_oo, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X110, 1)
!
      call mem%alloc(X111, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X111, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X111, 1, &
         X110, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X110)
      call mem%dealloc(X111)
      call mem%alloc(X112, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_o, &
         four, &
         tAxAx_oo, &
         wf%n_o, &
         FxI_o, 1, &
         zero, &
         X112, 1)
!
      call mem%alloc(X113, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X112, 1, &
         X113, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X112)
      call add_1342_to_1234(one, X113, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X113)
      call mem%alloc(X114, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(L_voov, X114, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two*rAIAI, &
         X114, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X114)
      call mem%alloc(X115, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X115, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X116, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         L_voov, &
         wf%n_v*wf%n_o, &
         X115, &
         wf%n_v, &
         zero, &
         X116, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X115)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X116, 1, &
         rAIAx_o, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X116)
      call mem%alloc(X117, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(L_voov, X117, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X118, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         -two, &
         X117, &
         wf%n_v**2*wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X118, 1)
!
      call mem%dealloc(X117)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X118, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X118)
      call mem%alloc(X119, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X119, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X120, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_voov, &
         wf%n_v*wf%n_o, &
         X119, &
         wf%n_o, &
         zero, &
         X120, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X119)
      call mem%alloc(X121, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X120, 1, &
         rAIxI_v, 1, &
         X121, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X120)
      call add_1243_to_1234(one, X121, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X121)
      call mem%alloc(X122, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X122, 1)
!
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X122, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X122)
      call mem%alloc(X123, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X123, wf%n_v, wf%n_o)
      call mem%alloc(X124, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         L_voov, &
         wf%n_v*wf%n_o, &
         X123, 1, &
         zero, &
         X124, 1)
!
      call mem%dealloc(X123)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X124, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X124)
      call mem%alloc(X125, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X125, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X126, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X125, X126, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X125)
      call mem%alloc(X127, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X126, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X127, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X126)
      call add_1243_to_1234(one, X127, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X127)
      call mem%alloc(X128, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X128, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X129, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X128, X129, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X128)
      call mem%alloc(X130, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X129, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X130, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X129)
      call add_1243_to_1234(one, X130, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X130)
      call mem%alloc(X131, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X131, wf%n_v, wf%n_o)
      call mem%alloc(X132, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_voov, &
         wf%n_v*wf%n_o, &
         X131, 1, &
         zero, &
         X132, 1)
!
      call mem%dealloc(X131)
      call mem%alloc(X133, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X132, 1, &
         rAIxx_vo, 1, &
         X133, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X132)
      call add_1432_to_1234(one, X133, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X133)
      call mem%alloc(X134, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(L_vvoo, X134, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X135, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         X134, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X135, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X134)
      call mem%alloc(X136, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X135, X136, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X135)
      call mem%alloc(X137, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X136, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X137, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X136)
      call add_1423_to_1234(one, X137, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X137)
      call mem%alloc(X138, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(L_vvoo, X138, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X139, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         X138, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X139, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X138)
      call mem%alloc(X140, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X139, X140, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X139)
      call mem%alloc(X141, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X140, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X141, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X140)
      call add_1423_to_1234(one, X141, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X141)
      call mem%alloc(X142, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(L_oooo, X142, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X143, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o**3, &
         wf%n_v, &
         wf%n_o, &
         two, &
         X142, &
         wf%n_o**3, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X143, &
         wf%n_o**3)
!
      call mem%dealloc(X142)
      call mem%alloc(X144, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(X143, X144, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X143)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X144, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X144)
      call mem%alloc(X145, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X145, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X146, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(X145, X146, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X145)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X146, &
         wf%n_v**2*wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X146)
      call mem%alloc(X147, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X147, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X148, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X147, X148, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X147)
      call mem%alloc(X149, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X148, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X149, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X148)
      call add_1243_to_1234(one, X149, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X149)
      call mem%alloc(X150, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X150, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X151, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X150, X151, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X150)
      call mem%alloc(X152, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X151, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X152, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X151)
      call add_1243_to_1234(one, X152, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X152)
      call mem%alloc(X153, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X153, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X154, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X153, X154, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X153)
      call mem%alloc(X155, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X154, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X155, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X154)
      call add_1243_to_1234(one, X155, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X155)
      call mem%alloc(X156, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X156, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X157, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X156, X157, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X156)
      call mem%alloc(X158, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X157, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X158, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X157)
      call add_1243_to_1234(one, X158, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X158)
      call mem%alloc(X159, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X159, wf%n_v, wf%n_o)
      call mem%alloc(X160, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_voov, &
         wf%n_v*wf%n_o, &
         X159, 1, &
         zero, &
         X160, 1)
!
      call mem%dealloc(X159)
      call mem%alloc(X161, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X161, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X160, 1, &
         X161, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X160)
      call mem%dealloc(X161)
      call mem%alloc(X162, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X162, 1)
!
      call mem%alloc(X163, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X163, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X162, &
         wf%n_v*wf%n_o, &
         X163, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X162)
      call mem%dealloc(X163)
      call mem%alloc(X164, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -four, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X164, 1)
!
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X164, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X164)
      call mem%alloc(X165, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X165, 1)
!
      call mem%alloc(X166, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X165, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         zero, &
         X166, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X165)
      call add_1432_to_1234(one, X166, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X166)
      call mem%alloc(X167, wf%n_v, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**3, &
         wf%n_v, &
         -two, &
         L_vvvv, &
         wf%n_v**3, &
         tAIxI_v, 1, &
         zero, &
         X167, 1)
!
      call mem%alloc(X168, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(X167, X168, wf%n_v, wf%n_v, wf%n_v)
      call mem%dealloc(X167)
      call mem%alloc(X169, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X169, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X170, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X168, &
         wf%n_v**2, &
         X169, &
         wf%n_o**2, &
         zero, &
         X170, &
         wf%n_v**2)
!
      call mem%dealloc(X168)
      call mem%dealloc(X169)
      call add_3124_to_1234(one, X170, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X170)
      call mem%alloc(X171, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1432(L_vvoo, X171, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X172, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         X171, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X172, 1)
!
      call mem%dealloc(X171)
      call mem%alloc(X173, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X172, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X173, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X172)
      call add_1423_to_1234(one, X173, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X173)
      call mem%alloc(X174, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         two, &
         L_voov, &
         wf%n_v*wf%n_o**2, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X174, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X175, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(X174, X175, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X174)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X175, &
         wf%n_v**2*wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X175)
      call mem%alloc(X176, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(L_voov, X176, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X177, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         X176, &
         wf%n_v**2*wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X177, 1)
!
      call mem%dealloc(X176)
      call mem%alloc(X178, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X178, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X177, &
         wf%n_v*wf%n_o, &
         X178, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X177)
      call mem%dealloc(X178)
      call mem%alloc(X179, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1423(L_vvoo, X179, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X180, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         X179, &
         wf%n_v**2*wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X180, 1)
!
      call mem%dealloc(X179)
      call mem%alloc(X181, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X181, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X182, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X180, &
         wf%n_v*wf%n_o, &
         X181, &
         wf%n_v*wf%n_o, &
         zero, &
         X182, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X180)
      call mem%dealloc(X181)
      call add_1432_to_1234(one, X182, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X182)
      call mem%alloc(X183, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**3, &
         -two, &
         L_oooo, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X183, 1)
!
      call mem%alloc(X184, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(X183, X184, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X183)
      call mem%alloc(X185, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X184, &
         wf%n_o**2, &
         zero, &
         X185, &
         wf%n_v**2)
!
      call mem%dealloc(X184)
      call add_1324_to_1234(one, X185, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X185)
      call mem%alloc(X186, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(L_voov, X186, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X187, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         -four, &
         X186, &
         wf%n_v**2*wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X187, 1)
!
      call mem%dealloc(X186)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X187, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X187)
      call mem%alloc(X188, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(L_voov, X188, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X189, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         X188, &
         wf%n_v**2*wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X189, 1)
!
      call mem%dealloc(X188)
      call mem%alloc(X190, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X189, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X190, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X189)
      call add_1432_to_1234(one, X190, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X190)
      call mem%alloc(X191, wf%n_v, wf%n_o)
      call sort_to_21(LAIxx_ov, X191, wf%n_o, wf%n_v)
      call mem%alloc(X192, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X191, 1, &
         zero, &
         X192, 1)
!
      call mem%dealloc(X191)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X192, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X192)
      call mem%alloc(X193, wf%n_v, wf%n_o)
      call sort_to_21(LAIxx_ov, X193, wf%n_o, wf%n_v)
      call mem%alloc(X194, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X193, 1, &
         zero, &
         X194, 1)
!
      call mem%dealloc(X193)
      call mem%alloc(X195, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X194, 1, &
         X195, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X194)
      call add_1432_to_1234(one, X195, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X195)
      call mem%alloc(X196, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         LAIxx_ov, &
         wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X196, &
         wf%n_v)
!
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X196, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X196)
      call mem%alloc(X197, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         LAIxx_ov, &
         wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X197, &
         wf%n_o)
!
      call mem%alloc(X198, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X198, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X199, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X198, &
         wf%n_v**2*wf%n_o, &
         X197, &
         wf%n_o, &
         zero, &
         X199, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X197)
      call mem%dealloc(X198)
      call add_1342_to_1234(one, X199, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X199)
      call mem%alloc(X200, wf%n_v, wf%n_o)
      call sort_to_21(LAIxx_ov, X200, wf%n_o, wf%n_v)
      call mem%alloc(X201, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X200, 1, &
         zero, &
         X201, 1)
!
      call mem%dealloc(X200)
      call mem%alloc(X202, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X202, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X202, 1, &
         X201, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X201)
      call mem%dealloc(X202)
      call mem%alloc(X203, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_v**2, &
         -two, &
         LAxxx_vvv, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X203, 1)
!
      call mem%alloc(X204, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X203, &
         wf%n_v, &
         r_vovo, &
         wf%n_v, &
         zero, &
         X204, &
         wf%n_v)
!
      call mem%dealloc(X203)
      call add_1432_to_1234(one, X204, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X204)
      call mem%alloc(X205, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_v**2, &
         four, &
         LAxxx_vvv, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X205, 1)
!
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X205, &
         wf%n_v, &
         r_vovo, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X205)
      call mem%alloc(X206, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o**2, &
         two, &
         LAxxx_voo, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X206, 1)
!
      call mem%alloc(X207, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X206, &
         wf%n_o, &
         zero, &
         X207, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X206)
      call add_1432_to_1234(one, X207, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X207)
      call mem%alloc(X208, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o**2, &
         -four, &
         LAxxx_voo, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X208, 1)
!
      call mem%alloc(X209, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(r_vovo, X209, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X210, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X209, &
         wf%n_v**2*wf%n_o, &
         X208, &
         wf%n_o, &
         zero, &
         X210, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X208)
      call mem%dealloc(X209)
      call add_1342_to_1234(one, X210, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X210)
      call mem%alloc(X211, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(LAxxx_oov, X211, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X212, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X211, &
         wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X212, &
         wf%n_o)
!
      call mem%dealloc(X211)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X212, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X212)
      call mem%alloc(X213, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_v**2, &
         two, &
         LAxxx_vvv, &
         wf%n_v, &
         rAIxI_v, 1, &
         zero, &
         X213, 1)
!
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X213, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X213)
      call mem%alloc(X214, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o**2, &
         -two, &
         LAxxx_voo, &
         wf%n_v, &
         rAIxI_v, 1, &
         zero, &
         X214, 1)
!
      call mem%alloc(X215, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X215, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X216, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X215, &
         wf%n_v**2*wf%n_o, &
         X214, &
         wf%n_o, &
         zero, &
         X216, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X214)
      call mem%dealloc(X215)
      call add_1342_to_1234(one, X216, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X216)
      call mem%alloc(X217, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         LAxxx_vvv, &
         wf%n_v**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X217, &
         wf%n_v**2)
!
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X217, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X217)
      call mem%alloc(X218, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         LAxxx_voo, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X218, &
         wf%n_o**2)
!
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X218, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X218)
      call mem%alloc(X219, wf%n_v, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         LAxxx_vvv, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X219, &
         wf%n_v**2)
!
      call mem%alloc(X220, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(X219, X220, wf%n_v, wf%n_v, wf%n_v)
      call mem%dealloc(X219)
      call mem%alloc(X221, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X221, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X222, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X220, &
         wf%n_v**2, &
         X221, &
         wf%n_o**2, &
         zero, &
         X222, &
         wf%n_v**2)
!
      call mem%dealloc(X220)
      call mem%dealloc(X221)
      call add_1342_to_1234(one, X222, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X222)
      call mem%alloc(X223, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         two, &
         LAxxx_voo, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X223, &
         wf%n_o**2)
!
      call mem%alloc(X224, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X224, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X225, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X224, &
         wf%n_v*wf%n_o, &
         X223, &
         wf%n_o, &
         zero, &
         X225, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X223)
      call mem%dealloc(X224)
      call add_1423_to_1234(one, X225, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X225)
      call mem%alloc(X226, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         LAxxx_vvv, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X226, &
         wf%n_v**2)
!
      call mem%alloc(X227, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X226, X227, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X226)
      call mem%alloc(X228, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X228, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X229, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X227, &
         wf%n_v*wf%n_o, &
         X228, &
         wf%n_v*wf%n_o, &
         zero, &
         X229, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X227)
      call mem%dealloc(X228)
      call add_1432_to_1234(one, X229, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X229)
      call mem%alloc(X230, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         LAxxx_vvv, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X230, &
         wf%n_v**2)
!
      call mem%alloc(X231, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X230, X231, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X230)
      call mem%alloc(X232, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X232, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X233, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X231, &
         wf%n_v*wf%n_o, &
         X232, &
         wf%n_v*wf%n_o, &
         zero, &
         X233, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X231)
      call mem%dealloc(X232)
      call add_1432_to_1234(one, X233, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X233)
      call mem%alloc(X234, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         LAxxx_voo, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X234, &
         wf%n_o**2)
!
      call mem%alloc(X235, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(rxxxI_vov, X235, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X236, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X235, &
         wf%n_v**2, &
         X234, &
         wf%n_o, &
         zero, &
         X236, &
         wf%n_v**2)
!
      call mem%dealloc(X234)
      call mem%dealloc(X235)
      call add_1324_to_1234(one, X236, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X236)
      call mem%alloc(X237, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         LAxxx_voo, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X237, &
         wf%n_o**2)
!
      call mem%alloc(X238, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(rxxxI_vov, X238, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X239, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X238, &
         wf%n_v**2, &
         X237, &
         wf%n_o, &
         zero, &
         X239, &
         wf%n_v**2)
!
      call mem%dealloc(X237)
      call mem%dealloc(X238)
      call add_1324_to_1234(one, X239, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X239)
      call mem%alloc(X240, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**2, &
         -two, &
         LxIxx_ooo, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X240, 1)
!
      call mem%alloc(X241, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X240, &
         wf%n_o, &
         zero, &
         X241, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X240)
      call add_1432_to_1234(one, X241, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X241)
      call mem%alloc(X242, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**2, &
         four, &
         LxIxx_ooo, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X242, 1)
!
      call mem%alloc(X243, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(r_vovo, X243, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X244, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X243, &
         wf%n_v**2*wf%n_o, &
         X242, &
         wf%n_o, &
         zero, &
         X244, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X242)
      call mem%dealloc(X243)
      call add_1342_to_1234(one, X244, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X244)
      call mem%alloc(X245, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(LxIxx_vov, X245, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X246, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X245, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X246, &
         wf%n_v)
!
      call mem%dealloc(X245)
      call mem%alloc(X247, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X246, 1, &
         rAIAx_o, 1, &
         X247, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X246)
      call add_1342_to_1234(one, X247, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X247)
      call mem%alloc(X248, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**2, &
         two, &
         LxIxx_ooo, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X248, 1)
!
      call mem%alloc(X249, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X249, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X250, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X249, &
         wf%n_v**2*wf%n_o, &
         X248, &
         wf%n_o, &
         zero, &
         X250, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X248)
      call mem%dealloc(X249)
      call add_1342_to_1234(one, X250, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X250)
      call mem%alloc(X251, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_312(LxIxx_ooo, X251, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X252, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         two, &
         rAIxx_vo, &
         wf%n_v, &
         X251, &
         wf%n_o**2, &
         zero, &
         X252, &
         wf%n_v)
!
      call mem%dealloc(X251)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X252, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X252)
      call mem%alloc(X253, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         LxIxx_ooo, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X253, &
         wf%n_o**2)
!
      call mem%alloc(X254, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X254, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X255, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X254, &
         wf%n_v*wf%n_o, &
         X253, &
         wf%n_o, &
         zero, &
         X255, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X253)
      call mem%dealloc(X254)
      call add_1423_to_1234(one, X255, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X255)
      call mem%alloc(X256, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         LxIxx_ooo, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X256, &
         wf%n_o**2)
!
      call mem%alloc(X257, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X257, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X258, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X257, &
         wf%n_v*wf%n_o, &
         X256, &
         wf%n_o, &
         zero, &
         X258, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X256)
      call mem%dealloc(X257)
      call add_1423_to_1234(one, X258, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X258)
      call mem%alloc(X259, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         LxIxx_ooo, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X259, &
         wf%n_o**2)
!
      call mem%alloc(X260, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(rxxxI_vov, X260, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X261, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X260, &
         wf%n_v**2, &
         X259, &
         wf%n_o, &
         zero, &
         X261, &
         wf%n_v**2)
!
      call mem%dealloc(X259)
      call mem%dealloc(X260)
      call add_1324_to_1234(one, X261, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X261)
      call mem%alloc(X262, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         two, &
         LxxxI_vvo, &
         wf%n_v**2, &
         tAIAx_o, 1, &
         zero, &
         X262, 1)
!
      call mem%alloc(X263, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X262, &
         wf%n_v, &
         r_vovo, &
         wf%n_v, &
         zero, &
         X263, &
         wf%n_v)
!
      call mem%dealloc(X262)
      call add_1432_to_1234(one, X263, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X263)
      call mem%alloc(X264, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         -four, &
         LxxxI_vvo, &
         wf%n_v**2, &
         tAIAx_o, 1, &
         zero, &
         X264, 1)
!
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X264, &
         wf%n_v, &
         r_vovo, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X264)
      call mem%alloc(X265, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         -two, &
         LxxxI_vvo, &
         wf%n_v**2, &
         rAIAx_o, 1, &
         zero, &
         X265, 1)
!
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X265, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X265)
      call mem%alloc(X266, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(LxxxI_vvo, X266, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X267, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         X266, &
         wf%n_v*wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X267, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X266)
      call mem%alloc(X268, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X267, X268, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X267)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X268, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X268)
      call mem%alloc(X269, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(LxxxI_vvo, X269, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X270, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X270, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X271, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X269, &
         wf%n_v*wf%n_o, &
         X270, &
         wf%n_o**2, &
         zero, &
         X271, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X269)
      call mem%dealloc(X270)
      call mem%alloc(X272, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X271, X272, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X271)
      call mem%alloc(X273, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X272, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X273, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X272)
      call add_1423_to_1234(one, X273, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X273)
      call mem%alloc(X274, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(LxxxI_vvo, X274, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X275, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X275, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X276, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X274, &
         wf%n_v*wf%n_o, &
         X275, &
         wf%n_o**2, &
         zero, &
         X276, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X274)
      call mem%dealloc(X275)
      call mem%alloc(X277, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X276, X277, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X276)
      call mem%alloc(X278, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X277, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X278, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X277)
      call add_1423_to_1234(one, X278, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X278)
      call mem%alloc(X279, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         LxxxI_vvo, &
         wf%n_v**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X279, &
         wf%n_v**2)
!
      call mem%alloc(X280, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X279, X280, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X279)
      call mem%alloc(X281, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X281, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X282, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X280, &
         wf%n_v*wf%n_o, &
         X281, &
         wf%n_v*wf%n_o, &
         zero, &
         X282, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X280)
      call mem%dealloc(X281)
      call add_1432_to_1234(one, X282, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X282)
      call mem%alloc(X283, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(g_voov, X283, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X284, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two*rAIAI, &
         X283, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X284, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X283)
      call add_1432_to_1234(rAIAI, X284, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X284)
      call mem%alloc(X285, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1432(g_vvoo, X285, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X286, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(u_aibj, X286, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X287, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two*rAIAI, &
         X285, &
         wf%n_v*wf%n_o, &
         X286, &
         wf%n_v*wf%n_o, &
         zero, &
         X287, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X285)
      call mem%dealloc(X286)
      call add_1432_to_1234(rAIAI, X287, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X287)
      call mem%alloc(X288, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X288, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X289, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         g_voov, &
         wf%n_v*wf%n_o, &
         X288, &
         wf%n_v, &
         zero, &
         X289, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X288)
      call mem%alloc(X290, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X289, 1, &
         rAIAx_o, 1, &
         X290, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X289)
      call add_1432_to_1234(one, X290, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X290)
      call mem%alloc(X291, wf%n_v, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_1324(g_vvvv, X291, wf%n_v, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X292, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X291, &
         wf%n_v**2, &
         uxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X292, &
         wf%n_v**2)
!
      call mem%dealloc(X291)
      call mem%alloc(X293, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X292, 1, &
         rAIAx_o, 1, &
         X293, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X292)
      call add_1342_to_1234(one, X293, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X293)
      call mem%alloc(X294, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1423(g_vvoo, X294, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X295, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         X294, &
         wf%n_v**2*wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X295, 1)
!
      call mem%dealloc(X294)
      call mem%alloc(X296, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X296, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X297, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X295, &
         wf%n_v*wf%n_o, &
         X296, &
         wf%n_v*wf%n_o, &
         zero, &
         X297, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X295)
      call mem%dealloc(X296)
      call add_1432_to_1234(one, X297, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X297)
      call mem%alloc(X298, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**3, &
         -two, &
         g_oooo, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X298, 1)
!
      call mem%alloc(X299, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(X298, X299, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X298)
      call mem%alloc(X300, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X299, &
         wf%n_o**2, &
         zero, &
         X300, &
         wf%n_v**2)
!
      call mem%dealloc(X299)
      call add_1324_to_1234(one, X300, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X300)
      call mem%alloc(X301, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(g_voov, X301, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X302, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         two, &
         X301, &
         wf%n_v**2*wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X302, 1)
!
      call mem%dealloc(X301)
      call mem%alloc(X303, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X302, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X303, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X302)
      call add_1432_to_1234(one, X303, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X303)
      call mem%alloc(X304, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1432(g_vvoo, X304, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X305, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X304, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v, &
         zero, &
         X305, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X304)
      call mem%alloc(X306, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X305, 1, &
         rAIAx_o, 1, &
         X306, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X305)
      call add_1432_to_1234(one, X306, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X306)
      call mem%alloc(X307, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X307, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X308, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_voov, &
         wf%n_v*wf%n_o, &
         X307, &
         wf%n_o, &
         zero, &
         X308, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X307)
      call mem%alloc(X309, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X308, 1, &
         rAIxI_v, 1, &
         X309, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X308)
      call add_1423_to_1234(one, X309, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X309)
      call mem%alloc(X310, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         g_voov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X310, 1)
!
      call mem%alloc(X311, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X310, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X311, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X310)
      call add_1432_to_1234(one, X311, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X311)
      call mem%alloc(X312, wf%n_v, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**3, &
         wf%n_v, &
         -two, &
         g_vvvv, &
         wf%n_v**3, &
         rAIxI_v, 1, &
         zero, &
         X312, 1)
!
      call mem%alloc(X313, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(X312, X313, wf%n_v, wf%n_v, wf%n_v)
      call mem%dealloc(X312)
      call mem%alloc(X314, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X314, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X315, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X313, &
         wf%n_v**2, &
         X314, &
         wf%n_o**2, &
         zero, &
         X315, &
         wf%n_v**2)
!
      call mem%dealloc(X313)
      call mem%dealloc(X314)
      call add_3124_to_1234(one, X315, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X315)
      call mem%alloc(X316, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1432(g_vvoo, X316, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X317, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X316, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X317, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X316)
      call mem%alloc(X318, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X317, 1, &
         rAIxI_v, 1, &
         X318, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X317)
      call add_1423_to_1234(one, X318, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X318)
      call mem%alloc(X319, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1432(g_vvoo, X319, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X320, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         X319, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X320, 1)
!
      call mem%dealloc(X319)
      call mem%alloc(X321, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X320, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X321, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X320)
      call add_1423_to_1234(one, X321, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X321)
      call mem%alloc(X322, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1324(g_oooo, X322, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X323, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X323, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X324, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o**2, &
         -two, &
         X322, &
         wf%n_o**2, &
         X323, &
         wf%n_o**2, &
         zero, &
         X324, &
         wf%n_o**2)
!
      call mem%dealloc(X322)
      call mem%dealloc(X323)
      call mem%alloc(X325, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X324, X325, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X324)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X325, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X325)
      call mem%alloc(X326, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**3, &
         wf%n_o, &
         wf%n_v, &
         four, &
         g_vvvv, &
         wf%n_v**3, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X326, &
         wf%n_v**3)
!
      call mem%alloc(X327, wf%n_v, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1342(X326, X327, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X326)
      call mem%alloc(X328, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X327, &
         wf%n_v**2*wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X328, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X327)
      call add_1342_to_1234(one, X328, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X328)
      call mem%alloc(X329, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**3, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_vvvv, &
         wf%n_v**3, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X329, &
         wf%n_v**3)
!
      call mem%alloc(X330, wf%n_v, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1342(X329, X330, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X329)
      call mem%alloc(X331, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X330, &
         wf%n_v**2*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X331, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X330)
      call add_3142_to_1234(one, X331, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X331)
      call mem%alloc(X332, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         g_voov, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X332, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X333, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(X332, X333, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X332)
      call mem%alloc(X334, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X333, &
         wf%n_v**2*wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X334, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X333)
      call add_1432_to_1234(one, X334, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X334)
      call mem%alloc(X335, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(g_vvoo, X335, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X336, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         X335, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X336, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X335)
      call mem%alloc(X337, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1342(X336, X337, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X336)
      call mem%alloc(X338, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X337, &
         wf%n_v**2*wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X338, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X337)
      call add_1432_to_1234(one, X338, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X338)
      call mem%alloc(X339, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_voov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X339, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X340, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X339, X340, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X339)
      call mem%alloc(X341, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X340, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X341, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X340)
      call add_1423_to_1234(one, X341, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X341)
      call mem%alloc(X342, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_voov, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X342, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X343, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X342, X343, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X342)
      call mem%alloc(X344, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X343, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X344, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X343)
      call add_1423_to_1234(one, X344, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X344)
      call mem%alloc(X345, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**3, &
         wf%n_o, &
         wf%n_v, &
         two, &
         g_vvvv, &
         wf%n_v**3, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X345, &
         wf%n_v**3)
!
      call mem%alloc(X346, wf%n_v, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1432(X345, X346, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X345)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X346, &
         wf%n_v**2*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X346)
      call mem%alloc(X347, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1423(g_vvoo, X347, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X348, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X347, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X348, 1)
!
      call mem%dealloc(X347)
      call mem%alloc(X349, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X348, 1, &
         rAxxI_ov, 1, &
         X349, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X348)
      call add_1423_to_1234(one, X349, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X349)
      call mem%alloc(X350, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**3, &
         wf%n_v, &
         wf%n_o, &
         two, &
         g_oooo, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X350, &
         wf%n_o**3)
!
      call mem%alloc(X351, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1432(X350, X351, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X350)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X351, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X351)
      call mem%alloc(X352, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_voov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X352, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X353, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X352, X353, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X352)
      call mem%alloc(X354, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X353, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X354, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X353)
      call add_1423_to_1234(one, X354, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X354)
      call mem%alloc(X355, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_voov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X355, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X356, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X355, X356, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X355)
      call mem%alloc(X357, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X356, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X357, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X356)
      call add_1423_to_1234(one, X357, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X357)
      call mem%alloc(X358, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**3, &
         wf%n_o, &
         wf%n_v, &
         two, &
         g_vvvv, &
         wf%n_v**3, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X358, &
         wf%n_v**3)
!
      call mem%alloc(X359, wf%n_v, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1432(X358, X359, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X358)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X359, &
         wf%n_v**2*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X359)
      call mem%alloc(X360, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1432(g_vvoo, X360, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X361, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X360, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X361, 1)
!
      call mem%dealloc(X360)
      call mem%alloc(X362, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X361, 1, &
         rAxxI_ov, 1, &
         X362, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X361)
      call add_1423_to_1234(one, X362, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X362)
      call mem%alloc(X363, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**3, &
         wf%n_v, &
         wf%n_o, &
         two, &
         g_oooo, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X363, &
         wf%n_o**3)
!
      call mem%alloc(X364, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1432(X363, X364, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X363)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X364, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X364)
      call mem%alloc(X365, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X365, wf%n_v, wf%n_o)
      call mem%alloc(X366, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_voov, &
         wf%n_v*wf%n_o, &
         X365, 1, &
         zero, &
         X366, 1)
!
      call mem%dealloc(X365)
      call mem%alloc(X367, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X366, 1, &
         rAxxI_ov, 1, &
         X367, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X366)
      call add_1423_to_1234(one, X367, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X367)
      call mem%alloc(X368, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**3, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_vvvv, &
         wf%n_v**3, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X368, &
         wf%n_v**3)
!
      call mem%alloc(X369, wf%n_v, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1342(X368, X369, wf%n_v, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X368)
      call mem%alloc(X370, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X369, &
         wf%n_v**2*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X370, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X369)
      call add_1342_to_1234(one, X370, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X370)
      call mem%alloc(X371, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(g_vvoo, X371, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X372, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         X371, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X372, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X371)
      call mem%alloc(X373, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X372, X373, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X372)
      call mem%alloc(X374, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X373, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X374, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X373)
      call add_1423_to_1234(one, X374, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X374)
      call mem%alloc(X375, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(g_vvoo, X375, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X376, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         X375, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X376, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X375)
      call mem%alloc(X377, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X376, X377, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X376)
      call mem%alloc(X378, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X377, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X378, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X377)
      call add_1423_to_1234(one, X378, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X378)
      call mem%alloc(X379, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(g_oooo, X379, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X380, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o**3, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         X379, &
         wf%n_o**3, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X380, &
         wf%n_o**3)
!
      call mem%dealloc(X379)
      call mem%alloc(X381, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(X380, X381, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X380)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X381, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X381)
      call mem%alloc(X382, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         g_voov, &
         wf%n_v*wf%n_o**2, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X382, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X383, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(X382, X383, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X382)
      call mem%alloc(X384, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X383, &
         wf%n_v**2*wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X384, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X383)
      call add_1432_to_1234(one, X384, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X384)
      call mem%alloc(X385, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(g_vvoo, X385, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X386, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         X385, &
         wf%n_v*wf%n_o**2, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X386, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X385)
      call mem%alloc(X387, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1342(X386, X387, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X386)
      call mem%alloc(X388, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X387, &
         wf%n_v**2*wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X388, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X387)
      call add_1432_to_1234(one, X388, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X388)
      call mem%alloc(X389, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -four, &
         gAIxx_ov, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X389, &
         wf%n_o)
!
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X389, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X389)
      call mem%alloc(X390, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         -four, &
         gAIxx_ov, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X390, &
         wf%n_v)
!
      call mem%alloc(X391, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X391, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X392, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X391, &
         wf%n_v*wf%n_o**2, &
         X390, &
         wf%n_v, &
         zero, &
         X392, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X390)
      call mem%dealloc(X391)
      call add_1243_to_1234(one, X392, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X392)
      call mem%alloc(X393, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X393, &
         wf%n_o)
!
      call mem%alloc(X394, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X393, &
         wf%n_o, &
         zero, &
         X394, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X393)
      call add_1432_to_1234(one, X394, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X394)
      call mem%alloc(X395, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X395, &
         wf%n_v)
!
      call mem%alloc(X396, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X396, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X397, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X396, &
         wf%n_v*wf%n_o**2, &
         X395, &
         wf%n_v, &
         zero, &
         X397, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X395)
      call mem%dealloc(X396)
      call add_1423_to_1234(one, X397, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X397)
      call mem%alloc(X398, wf%n_v, wf%n_o)
      call sort_to_21(gAIxx_ov, X398, wf%n_o, wf%n_v)
      call mem%alloc(X399, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X398, 1, &
         zero, &
         X399, 1)
!
      call mem%dealloc(X398)
      call mem%alloc(X400, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X399, 1, &
         rAxxI_ov, 1, &
         X400, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X399)
      call add_1423_to_1234(one, X400, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X400)
      call mem%alloc(X401, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X401, &
         wf%n_o)
!
      call mem%alloc(X402, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X402, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X403, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X402, &
         wf%n_v**2*wf%n_o, &
         X401, &
         wf%n_o, &
         zero, &
         X403, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X401)
      call mem%dealloc(X402)
      call add_1342_to_1234(one, X403, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X403)
      call mem%alloc(X404, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X404, &
         wf%n_v)
!
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X404, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X404)
      call mem%alloc(X405, wf%n_v, wf%n_o)
      call sort_to_21(gAIxx_ov, X405, wf%n_o, wf%n_v)
      call mem%alloc(X406, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         uxIxx_vvo, &
         wf%n_v, &
         X405, 1, &
         zero, &
         X406, 1)
!
      call mem%dealloc(X405)
      call mem%alloc(X407, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X407, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X408, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X407, 1, &
         X406, 1, &
         X408, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X406)
      call mem%dealloc(X407)
      call add_1243_to_1234(one, X408, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X408)
      call mem%alloc(X409, wf%n_v, wf%n_o)
      call sort_to_21(gAIxx_ov, X409, wf%n_o, wf%n_v)
      call mem%alloc(X410, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -four, &
         uxIxx_vvo, &
         wf%n_v, &
         X409, 1, &
         zero, &
         X410, 1)
!
      call mem%dealloc(X409)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X410, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X410)
      call mem%alloc(X411, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X411, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X412, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         X411, &
         wf%n_v*wf%n_o, &
         zero, &
         X412, &
         wf%n_o)
!
      call mem%dealloc(X411)
      call mem%alloc(X413, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X412, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X413, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X412)
      call add_1423_to_1234(one, X413, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X413)
      call mem%alloc(X414, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X414, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X415, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         X414, &
         wf%n_o**2, &
         zero, &
         X415, &
         wf%n_o)
!
      call mem%dealloc(X414)
      call mem%alloc(X416, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X415, &
         wf%n_o, &
         zero, &
         X416, &
         wf%n_v**2)
!
      call mem%dealloc(X415)
      call add_1324_to_1234(one, X416, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X416)
      call mem%alloc(X417, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X417, &
         wf%n_o)
!
      call mem%alloc(X418, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X418, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X418, &
         wf%n_v*wf%n_o, &
         X417, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X417)
      call mem%dealloc(X418)
      call mem%alloc(X419, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -four, &
         gAIxx_ov, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X419, &
         wf%n_o)
!
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X419, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X419)
      call mem%alloc(X420, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X420, &
         wf%n_o)
!
      call mem%alloc(X421, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X420, &
         wf%n_o, &
         zero, &
         X421, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X420)
      call add_1432_to_1234(one, X421, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X421)
      call mem%alloc(X422, wf%n_v, wf%n_o)
      call sort_to_21(gAIxx_ov, X422, wf%n_o, wf%n_v)
      call mem%alloc(X423, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         uAxxx_ovo, &
         wf%n_o, &
         X422, 1, &
         zero, &
         X423, 1)
!
      call mem%dealloc(X422)
      call mem%alloc(X424, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X424, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X424, 1, &
         X423, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X423)
      call mem%dealloc(X424)
      call mem%alloc(X425, wf%n_v, wf%n_o)
      call sort_to_21(gAIxx_ov, X425, wf%n_o, wf%n_v)
      call mem%alloc(X426, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         uAxxx_ovo, &
         wf%n_o, &
         X425, 1, &
         zero, &
         X426, 1)
!
      call mem%dealloc(X425)
      call mem%alloc(X427, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X426, 1, &
         X427, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X426)
      call add_1342_to_1234(one, X427, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X427)
      call mem%alloc(X428, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X428, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X429, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         X428, &
         wf%n_o**2, &
         zero, &
         X429, &
         wf%n_o)
!
      call mem%dealloc(X428)
      call mem%alloc(X430, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X429, &
         wf%n_o, &
         zero, &
         X430, &
         wf%n_v**2)
!
      call mem%dealloc(X429)
      call add_1324_to_1234(one, X430, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X430)
      call mem%alloc(X431, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X431, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X432, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         X431, &
         wf%n_v*wf%n_o, &
         zero, &
         X432, &
         wf%n_o)
!
      call mem%dealloc(X431)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X432, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X432)
      call mem%alloc(X433, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X433, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X434, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         X433, &
         wf%n_v*wf%n_o, &
         zero, &
         X434, &
         wf%n_o)
!
      call mem%dealloc(X433)
      call mem%alloc(X435, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X434, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X435, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X434)
      call add_1423_to_1234(one, X435, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X435)
      call mem%alloc(X436, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -four, &
         gAIxx_ov, &
         wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X436, &
         wf%n_o)
!
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X436, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X436)
      call mem%alloc(X437, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAIxx_ov, &
         wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X437, &
         wf%n_o)
!
      call mem%alloc(X438, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X437, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X438, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X437)
      call add_1432_to_1234(one, X438, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X438)
      call mem%alloc(X439, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         -four, &
         gAxAx_vv, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X439, &
         wf%n_v)
!
      call mem%alloc(X440, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X440, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X441, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X440, &
         wf%n_v*wf%n_o**2, &
         X439, &
         wf%n_v, &
         zero, &
         X441, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X439)
      call mem%dealloc(X440)
      call add_1243_to_1234(one, X441, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X441)
      call mem%alloc(X442, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         two, &
         gAxAx_vv, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X442, &
         wf%n_v)
!
      call mem%alloc(X443, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X443, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X444, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X443, &
         wf%n_v*wf%n_o**2, &
         X442, &
         wf%n_v, &
         zero, &
         X444, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X442)
      call mem%dealloc(X443)
      call add_1423_to_1234(one, X444, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X444)
      call mem%alloc(X445, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         gAxAx_vv, &
         wf%n_v, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X445, &
         wf%n_v)
!
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X445, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X445)
      call mem%alloc(X446, wf%n_o)
!
      call dgemv('T', &
         wf%n_v**2, &
         wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v**2, &
         gAxAx_vv, 1, &
         zero, &
         X446, 1)
!
      call mem%alloc(X447, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X447, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X447, 1, &
         X446, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X446)
      call mem%dealloc(X447)
      call mem%alloc(X448, wf%n_o)
!
      call dgemv('T', &
         wf%n_v**2, &
         wf%n_o, &
         -four, &
         txIxx_vvo, &
         wf%n_v**2, &
         gAxAx_vv, 1, &
         zero, &
         X448, 1)
!
      call mem%alloc(X449, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X448, 1, &
         X449, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X448)
      call add_1342_to_1234(one, X449, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X449)
      call mem%alloc(X450, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X450, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X451, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxAx_vv, &
         wf%n_v, &
         X450, &
         wf%n_v*wf%n_o, &
         zero, &
         X451, &
         wf%n_v)
!
      call mem%dealloc(X450)
      call mem%alloc(X452, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X452, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X453, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X451, &
         wf%n_v, &
         X452, &
         wf%n_v*wf%n_o, &
         zero, &
         X453, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X451)
      call mem%dealloc(X452)
      call add_1432_to_1234(one, X453, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X453)
      call mem%alloc(X454, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X454, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X455, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxAx_vv, &
         wf%n_v, &
         X454, &
         wf%n_v*wf%n_o, &
         zero, &
         X455, &
         wf%n_v)
!
      call mem%dealloc(X454)
      call mem%alloc(X456, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X455, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X456, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X455)
      call add_1432_to_1234(one, X456, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X456)
      call mem%alloc(X457, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         gAxAx_vv, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X457, &
         wf%n_v)
!
      call mem%alloc(X458, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X458, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X458, &
         wf%n_v*wf%n_o, &
         X457, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X457)
      call mem%dealloc(X458)
      call mem%alloc(X459, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         four, &
         gAxAx_vv, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X459, &
         wf%n_v)
!
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X459, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X459)
      call mem%alloc(X460, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         gAxAx_vv, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X460, &
         wf%n_v)
!
      call mem%alloc(X461, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X460, &
         wf%n_v, &
         zero, &
         X461, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X460)
      call add_1432_to_1234(one, X461, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X461)
      call mem%alloc(X462, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         four, &
         gAxxI_vo, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X462, &
         wf%n_o)
!
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X462, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X462)
      call mem%alloc(X463, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         four, &
         gAxxI_vo, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X463, &
         wf%n_v)
!
      call mem%alloc(X464, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X464, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X465, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X464, &
         wf%n_v*wf%n_o**2, &
         X463, &
         wf%n_v, &
         zero, &
         X465, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X463)
      call mem%dealloc(X464)
      call add_1243_to_1234(one, X465, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X465)
      call mem%alloc(X466, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X466, &
         wf%n_o)
!
      call mem%alloc(X467, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X466, &
         wf%n_o, &
         zero, &
         X467, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X466)
      call add_1432_to_1234(one, X467, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X467)
      call mem%alloc(X468, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X468, &
         wf%n_v)
!
      call mem%alloc(X469, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X469, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X470, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X469, &
         wf%n_v*wf%n_o**2, &
         X468, &
         wf%n_v, &
         zero, &
         X470, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X468)
      call mem%dealloc(X469)
      call add_1423_to_1234(one, X470, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X470)
      call mem%alloc(X471, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         four, &
         gAxxI_vo, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X471, &
         wf%n_o)
!
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X471, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X471)
      call mem%alloc(X472, wf%n_v, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         four, &
         gAxxI_vo, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X472, &
         wf%n_v)
!
      call mem%alloc(X473, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X473, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X474, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X473, &
         wf%n_v*wf%n_o**2, &
         X472, &
         wf%n_v, &
         zero, &
         X474, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X472)
      call mem%dealloc(X473)
      call add_1243_to_1234(one, X474, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X474)
      call mem%alloc(X475, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X475, &
         wf%n_o)
!
      call mem%alloc(X476, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X475, &
         wf%n_o, &
         zero, &
         X476, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X475)
      call add_1432_to_1234(one, X476, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X476)
      call mem%alloc(X477, wf%n_v, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X477, &
         wf%n_v)
!
      call mem%alloc(X478, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X478, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X479, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X478, &
         wf%n_v*wf%n_o**2, &
         X477, &
         wf%n_v, &
         zero, &
         X479, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X477)
      call mem%dealloc(X478)
      call add_1423_to_1234(one, X479, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X479)
      call mem%alloc(X480, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         gAxxI_vo, 1, &
         zero, &
         X480, 1)
!
      call mem%alloc(X481, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X480, 1, &
         rAxxI_ov, 1, &
         X481, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X480)
      call add_1423_to_1234(one, X481, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X481)
      call mem%alloc(X482, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(t_aibj, X482, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X483, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X482, &
         wf%n_v*wf%n_o, &
         gAxxI_vo, 1, &
         zero, &
         X483, 1)
!
      call mem%dealloc(X482)
      call mem%alloc(X484, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X483, 1, &
         rAxxI_ov, 1, &
         X484, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X483)
      call add_1423_to_1234(one, X484, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X484)
      call mem%alloc(X485, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxI_vo, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X485, &
         wf%n_o)
!
      call mem%alloc(X486, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X486, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X487, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X486, &
         wf%n_v**2*wf%n_o, &
         X485, &
         wf%n_o, &
         zero, &
         X487, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X485)
      call mem%dealloc(X486)
      call add_1342_to_1234(one, X487, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X487)
      call mem%alloc(X488, wf%n_v, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         two, &
         gAxxI_vo, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X488, &
         wf%n_v)
!
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X488, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X488)
      call mem%alloc(X489, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         txIxx_vvo, &
         wf%n_v, &
         gAxxI_vo, 1, &
         zero, &
         X489, 1)
!
      call mem%alloc(X490, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X490, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X491, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X490, 1, &
         X489, 1, &
         X491, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X489)
      call mem%dealloc(X490)
      call add_1243_to_1234(one, X491, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X491)
      call mem%alloc(X492, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         four, &
         txIxx_vvo, &
         wf%n_v, &
         gAxxI_vo, 1, &
         zero, &
         X492, 1)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X492, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X492)
      call mem%alloc(X493, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X493, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X494, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         X493, &
         wf%n_v*wf%n_o, &
         zero, &
         X494, &
         wf%n_o)
!
      call mem%dealloc(X493)
      call mem%alloc(X495, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X494, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X495, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X494)
      call add_1423_to_1234(one, X495, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X495)
      call mem%alloc(X496, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X496, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X497, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         X496, &
         wf%n_o**2, &
         zero, &
         X497, &
         wf%n_o)
!
      call mem%dealloc(X496)
      call mem%alloc(X498, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X497, &
         wf%n_o, &
         zero, &
         X498, &
         wf%n_v**2)
!
      call mem%dealloc(X497)
      call add_1324_to_1234(one, X498, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X498)
      call mem%alloc(X499, wf%n_o, wf%n_v)
      call sort_to_21(gAxxI_vo, X499, wf%n_v, wf%n_o)
      call mem%alloc(X500, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         txxxI_vov, &
         wf%n_v, &
         X499, 1, &
         zero, &
         X500, 1)
!
      call mem%dealloc(X499)
      call mem%alloc(X501, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X501, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X502, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X501, 1, &
         X500, 1, &
         X502, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X500)
      call mem%dealloc(X501)
      call add_1243_to_1234(one, X502, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X502)
      call mem%alloc(X503, wf%n_o, wf%n_v)
      call sort_to_21(gAxxI_vo, X503, wf%n_v, wf%n_o)
      call mem%alloc(X504, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         four, &
         txxxI_vov, &
         wf%n_v, &
         X503, 1, &
         zero, &
         X504, 1)
!
      call mem%dealloc(X503)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X504, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X504)
      call mem%alloc(X505, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X505, &
         wf%n_o)
!
      call mem%alloc(X506, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X505, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X506, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X505)
      call add_1423_to_1234(one, X506, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X506)
      call mem%alloc(X507, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X507, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X508, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         X507, &
         wf%n_o**2, &
         zero, &
         X508, &
         wf%n_o)
!
      call mem%dealloc(X507)
      call mem%alloc(X509, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X509, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X510, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X509, &
         wf%n_v**2, &
         X508, &
         wf%n_o, &
         zero, &
         X510, &
         wf%n_v**2)
!
      call mem%dealloc(X508)
      call mem%dealloc(X509)
      call add_1324_to_1234(one, X510, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X510)
      call mem%alloc(X511, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxxI_vo, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X511, &
         wf%n_o)
!
      call mem%alloc(X512, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X512, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X512, &
         wf%n_v*wf%n_o, &
         X511, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X511)
      call mem%dealloc(X512)
      call mem%alloc(X513, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -four, &
         gAxxI_vo, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X513, &
         wf%n_o)
!
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X513, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X513)
      call mem%alloc(X514, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxxI_vo, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X514, &
         wf%n_o)
!
      call mem%alloc(X515, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X514, &
         wf%n_o, &
         zero, &
         X515, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X514)
      call add_1432_to_1234(one, X515, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X515)
      call mem%alloc(X516, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_o, &
         gAxxI_vo, 1, &
         zero, &
         X516, 1)
!
      call mem%alloc(X517, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X517, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X517, 1, &
         X516, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X516)
      call mem%dealloc(X517)
      call mem%alloc(X518, wf%n_o, wf%n_v)
      call sort_to_21(gAxxI_vo, X518, wf%n_v, wf%n_o)
      call mem%alloc(X519, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X518, 1, &
         zero, &
         X519, 1)
!
      call mem%dealloc(X518)
      call mem%alloc(X520, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X520, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X520, 1, &
         X519, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X519)
      call mem%dealloc(X520)
      call mem%alloc(X521, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         tAxxx_ovo, &
         wf%n_o, &
         gAxxI_vo, 1, &
         zero, &
         X521, 1)
!
      call mem%alloc(X522, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X521, 1, &
         X522, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X521)
      call add_1342_to_1234(one, X522, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X522)
      call mem%alloc(X523, wf%n_o, wf%n_v)
      call sort_to_21(gAxxI_vo, X523, wf%n_v, wf%n_o)
      call mem%alloc(X524, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         four, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X523, 1, &
         zero, &
         X524, 1)
!
      call mem%dealloc(X523)
      call mem%alloc(X525, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X524, 1, &
         X525, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X524)
      call add_1342_to_1234(one, X525, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X525)
      call mem%alloc(X526, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X526, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X527, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         X526, &
         wf%n_o**2, &
         zero, &
         X527, &
         wf%n_o)
!
      call mem%dealloc(X526)
      call mem%alloc(X528, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X527, &
         wf%n_o, &
         zero, &
         X528, &
         wf%n_v**2)
!
      call mem%dealloc(X527)
      call add_1324_to_1234(one, X528, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X528)
      call mem%alloc(X529, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X529, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X530, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         X529, &
         wf%n_o**2, &
         zero, &
         X530, &
         wf%n_o)
!
      call mem%dealloc(X529)
      call mem%alloc(X531, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X530, &
         wf%n_o, &
         zero, &
         X531, &
         wf%n_v**2)
!
      call mem%dealloc(X530)
      call add_1342_to_1234(one, X531, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X531)
      call mem%alloc(X532, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X532, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X533, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         X532, &
         wf%n_v*wf%n_o, &
         zero, &
         X533, &
         wf%n_o)
!
      call mem%dealloc(X532)
      call mem%alloc(X534, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X533, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X534, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X533)
      call add_1423_to_1234(one, X534, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X534)
      call mem%alloc(X535, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X535, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X536, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxI_vo, &
         wf%n_v, &
         X535, &
         wf%n_v*wf%n_o, &
         zero, &
         X536, &
         wf%n_o)
!
      call mem%dealloc(X535)
      call mem%alloc(X537, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X536, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X537, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X536)
      call add_1432_to_1234(one, X537, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X537)
      call mem%alloc(X538, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X538, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X539, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxxI_vo, &
         wf%n_v, &
         X538, &
         wf%n_v*wf%n_o, &
         zero, &
         X539, &
         wf%n_o)
!
      call mem%dealloc(X538)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X539, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X539)
      call mem%alloc(X540, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -four, &
         gAxxI_vo, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X540, &
         wf%n_o)
!
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X540, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X540)
      call mem%alloc(X541, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxxI_vo, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X541, &
         wf%n_o)
!
      call mem%alloc(X542, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X541, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X542, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X541)
      call add_1432_to_1234(one, X542, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X542)
      call mem%alloc(X543, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(gAxxx_oov, X543, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X544, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X543, &
         wf%n_o, &
         zero, &
         X544, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X543)
      call mem%alloc(X545, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X544, 1, &
         rAIxI_v, 1, &
         X545, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X544)
      call add_1423_to_1234(one, X545, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X545)
      call mem%alloc(X546, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X546, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X547, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(u_aibj, X547, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X548, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X546, &
         wf%n_v**2, &
         X547, &
         wf%n_v**2, &
         zero, &
         X548, &
         wf%n_v)
!
      call mem%dealloc(X546)
      call mem%dealloc(X547)
      call mem%alloc(X549, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X548, 1, &
         rAIxI_v, 1, &
         X549, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X548)
      call add_1423_to_1234(one, X549, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X549)
      call mem%alloc(X550, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X550, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X551, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X550, &
         wf%n_v*wf%n_o, &
         gAxxx_voo, &
         wf%n_v*wf%n_o, &
         zero, &
         X551, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X550)
      call mem%alloc(X552, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X551, 1, &
         rAIxI_v, 1, &
         X552, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X551)
      call add_1423_to_1234(one, X552, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X552)
      call mem%alloc(X553, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(gAxxx_oov, X553, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X554, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X553, &
         wf%n_o, &
         uxIxx_vvo, &
         wf%n_v, &
         zero, &
         X554, &
         wf%n_o)
!
      call mem%dealloc(X553)
      call mem%alloc(X555, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X554, 1, &
         X555, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X554)
      call add_1423_to_1234(one, X555, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X555)
      call mem%alloc(X556, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(gAxxx_oov, X556, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X557, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         uxIxx_vvo, &
         wf%n_v, &
         X556, &
         wf%n_o, &
         zero, &
         X557, &
         wf%n_v)
!
      call mem%dealloc(X556)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X557, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X557)
      call mem%alloc(X558, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X558, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X559, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X558, &
         wf%n_v*wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X559, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X558)
      call mem%alloc(X560, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X559, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X560, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X559)
      call add_1423_to_1234(one, X560, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X560)
      call mem%alloc(X561, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         rAIxx_vo, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X561, &
         wf%n_o)
!
      call mem%alloc(X562, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X561, &
         wf%n_o**2, &
         zero, &
         X562, &
         wf%n_v**2)
!
      call mem%dealloc(X561)
      call add_1342_to_1234(one, X562, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X562)
      call mem%alloc(X563, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X563, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X564, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X563, &
         wf%n_v**2, &
         uxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X564, &
         wf%n_v)
!
      call mem%dealloc(X563)
      call mem%alloc(X565, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X564, 1, &
         rAIxx_vo, 1, &
         X565, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X564)
      call add_1432_to_1234(one, X565, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X565)
      call mem%alloc(X566, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X566, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X567, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v**2, &
         four, &
         X566, &
         wf%n_v**2, &
         uxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X567, &
         wf%n_v)
!
      call mem%dealloc(X566)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X567, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X567)
      call mem%alloc(X568, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X568, &
         wf%n_v**2)
!
      call mem%alloc(X569, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X568, X569, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X568)
      call mem%alloc(X570, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X570, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X571, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X569, &
         wf%n_v*wf%n_o, &
         X570, &
         wf%n_v*wf%n_o, &
         zero, &
         X571, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X569)
      call mem%dealloc(X570)
      call add_1432_to_1234(one, X571, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X571)
      call mem%alloc(X572, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X572, &
         wf%n_v**2)
!
      call mem%alloc(X573, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X572, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X573, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X572)
      call add_1432_to_1234(one, X573, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X573)
      call mem%alloc(X574, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_213(gAxxx_voo, X574, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X575, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X574, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v, &
         zero, &
         X575, &
         wf%n_o)
!
      call mem%dealloc(X574)
      call mem%alloc(X576, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X575, 1, &
         X576, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X575)
      call add_1423_to_1234(one, X576, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X576)
      call mem%alloc(X577, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_213(gAxxx_voo, X577, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X578, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         uxxxI_vov, &
         wf%n_v, &
         X577, &
         wf%n_v*wf%n_o, &
         zero, &
         X578, &
         wf%n_v)
!
      call mem%dealloc(X577)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X578, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X578)
      call mem%alloc(X579, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(gAxxx_voo, X579, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X580, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         X579, &
         wf%n_v, &
         zero, &
         X580, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X579)
      call mem%alloc(X581, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X580, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X581, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X580)
      call add_1423_to_1234(one, X581, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X581)
      call mem%alloc(X582, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_voo, &
         wf%n_v, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X582, &
         wf%n_o**2)
!
      call mem%alloc(X583, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X583, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X584, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X583, &
         wf%n_v**2, &
         X582, &
         wf%n_o, &
         zero, &
         X584, &
         wf%n_v**2)
!
      call mem%dealloc(X582)
      call mem%dealloc(X583)
      call add_1324_to_1234(one, X584, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X584)
      call mem%alloc(X585, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X585, &
         wf%n_o)
!
      call mem%alloc(X586, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X585, &
         wf%n_o**2, &
         zero, &
         X586, &
         wf%n_v**2)
!
      call mem%dealloc(X585)
      call add_1342_to_1234(one, X586, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X586)
      call mem%alloc(X587, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X587, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X588, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         X587, &
         wf%n_v*wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X588, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X587)
      call mem%alloc(X589, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X588, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X589, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X588)
      call add_1423_to_1234(one, X589, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X589)
      call mem%alloc(X590, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X590, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X591, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X590, &
         wf%n_v**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X591, &
         wf%n_v)
!
      call mem%dealloc(X590)
      call mem%alloc(X592, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X591, 1, &
         rAxxI_ov, 1, &
         X592, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X591)
      call add_1423_to_1234(one, X592, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X592)
      call mem%alloc(X593, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X593, &
         wf%n_v**2)
!
      call mem%alloc(X594, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X594, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X595, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X593, &
         wf%n_v, &
         X594, &
         wf%n_v*wf%n_o, &
         zero, &
         X595, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X593)
      call mem%dealloc(X594)
      call add_1432_to_1234(one, X595, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X595)
      call mem%alloc(X596, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         gAxxx_voo, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X596, &
         wf%n_o)
!
      call mem%alloc(X597, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X597, wf%n_o, wf%n_v)
      call mem%alloc(X598, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X597, 1, &
         X596, 1, &
         X598, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X596)
      call mem%dealloc(X597)
      call add_1423_to_1234(one, X598, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X598)
      call mem%alloc(X599, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(gAxxx_voo, X599, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X600, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X600, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X601, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         X600, &
         wf%n_v*wf%n_o, &
         X599, &
         wf%n_v, &
         zero, &
         X601, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X599)
      call mem%dealloc(X600)
      call mem%alloc(X602, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X601, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X602, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X601)
      call add_1423_to_1234(one, X602, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X602)
      call mem%alloc(X603, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X603, &
         wf%n_o)
!
      call mem%alloc(X604, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X604, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X605, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X604, &
         wf%n_v**2, &
         X603, &
         wf%n_o**2, &
         zero, &
         X605, &
         wf%n_v**2)
!
      call mem%dealloc(X603)
      call mem%dealloc(X604)
      call add_1342_to_1234(one, X605, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X605)
      call mem%alloc(X606, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X606, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X607, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X606, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X607, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X606)
      call add_1423_to_1234(one, X607, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X607)
      call mem%alloc(X608, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X608, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X609, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X609, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X610, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X608, &
         wf%n_v**2, &
         X609, &
         wf%n_v**2, &
         zero, &
         X610, &
         wf%n_v)
!
      call mem%dealloc(X608)
      call mem%dealloc(X609)
      call mem%alloc(X611, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X610, 1, &
         rAxxI_ov, 1, &
         X611, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X610)
      call add_1423_to_1234(one, X611, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X611)
      call mem%alloc(X612, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X612, &
         wf%n_v**2)
!
      call mem%alloc(X613, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X612, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X613, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X612)
      call add_1432_to_1234(one, X613, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X613)
      call mem%alloc(X614, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_213(gAxxx_voo, X614, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X615, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X614, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X615, &
         wf%n_o)
!
      call mem%dealloc(X614)
      call mem%alloc(X616, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X616, wf%n_o, wf%n_v)
      call mem%alloc(X617, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X616, 1, &
         X615, 1, &
         X617, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X615)
      call mem%dealloc(X616)
      call add_1423_to_1234(one, X617, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X617)
      call mem%alloc(X618, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(gAxxx_voo, X618, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X619, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X618, &
         wf%n_v, &
         zero, &
         X619, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X618)
      call mem%alloc(X620, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X619, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X620, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X619)
      call add_1423_to_1234(one, X620, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X620)
      call mem%alloc(X621, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(gAxxx_oov, X621, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X622, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X621, &
         wf%n_o, &
         uxIxx_vvo, &
         wf%n_v, &
         zero, &
         X622, &
         wf%n_o)
!
      call mem%dealloc(X621)
      call mem%alloc(X623, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X623, wf%n_o, wf%n_v)
      call mem%alloc(X624, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X623, 1, &
         X622, 1, &
         X624, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X622)
      call mem%dealloc(X623)
      call add_1423_to_1234(one, X624, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X624)
      call mem%alloc(X625, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(gAxxx_oov, X625, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X626, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         uxIxx_vvo, &
         wf%n_v, &
         X625, &
         wf%n_o, &
         zero, &
         X626, &
         wf%n_v)
!
      call mem%dealloc(X625)
      call mem%alloc(X627, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X627, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X626, 1, &
         X627, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X626)
      call mem%dealloc(X627)
      call mem%alloc(X628, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X628, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X629, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X628, &
         wf%n_v**2, &
         uxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X629, &
         wf%n_v)
!
      call mem%dealloc(X628)
      call mem%alloc(X630, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X630, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X629, 1, &
         X630, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X629)
      call mem%dealloc(X630)
      call mem%alloc(X631, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X631, &
         wf%n_v**2)
!
      call mem%alloc(X632, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X631, X632, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X631)
      call mem%alloc(X633, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X633, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X634, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X632, &
         wf%n_v*wf%n_o, &
         X633, &
         wf%n_v*wf%n_o, &
         zero, &
         X634, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X632)
      call mem%dealloc(X633)
      call add_1432_to_1234(one, X634, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X634)
      call mem%alloc(X635, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_213(gAxxx_oov, X635, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X636, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         X635, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X636, &
         wf%n_o**2)
!
      call mem%dealloc(X635)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X636, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X636)
      call mem%alloc(X637, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X637, &
         wf%n_v**2)
!
      call mem%alloc(X638, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X637, X638, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X637)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X638, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X638)
      call mem%alloc(X639, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X639, &
         wf%n_v**2)
!
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X639, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X639)
      call mem%alloc(X640, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_213(gAxxx_voo, X640, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X641, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         uxxxI_vov, &
         wf%n_v, &
         X640, &
         wf%n_v*wf%n_o, &
         zero, &
         X641, &
         wf%n_v)
!
      call mem%dealloc(X640)
      call mem%alloc(X642, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X642, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X641, 1, &
         X642, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X641)
      call mem%dealloc(X642)
      call mem%alloc(X643, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_voo, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X643, &
         wf%n_o**2)
!
      call mem%alloc(X644, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X644, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X645, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X644, &
         wf%n_v**2, &
         X643, &
         wf%n_o, &
         zero, &
         X645, &
         wf%n_v**2)
!
      call mem%dealloc(X643)
      call mem%dealloc(X644)
      call add_1324_to_1234(one, X645, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X645)
      call mem%alloc(X646, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_voo, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X646, &
         wf%n_o**2)
!
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X646, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X646)
      call mem%alloc(X647, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         txIxI_vv, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X647, &
         wf%n_v)
!
      call mem%alloc(X648, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X648, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X647, &
         wf%n_v*wf%n_o, &
         X648, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X647)
      call mem%dealloc(X648)
      call mem%alloc(X649, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         txIxI_vv, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X649, &
         wf%n_v)
!
      call mem%alloc(X650, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X649, &
         wf%n_v*wf%n_o, &
         zero, &
         X650, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X649)
      call add_1432_to_1234(one, X650, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X650)
      call mem%alloc(X651, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         four, &
         txIxI_vv, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X651, &
         wf%n_v)
!
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X651, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X651)
      call mem%alloc(X652, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X652, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X653, wf%n_v)
!
      call dgemv('T', &
         wf%n_v**2, &
         wf%n_v, &
         -four, &
         X652, &
         wf%n_v**2, &
         txIxI_vv, 1, &
         zero, &
         X653, 1)
!
      call mem%dealloc(X652)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X653, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X653)
      call mem%alloc(X654, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X654, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X655, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v, &
         X654, &
         wf%n_o**2, &
         zero, &
         X655, &
         wf%n_v**2)
!
      call mem%dealloc(X654)
      call mem%alloc(X656, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(X655, X656, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X655)
      call mem%alloc(X657, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X656, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X657, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X656)
      call add_1243_to_1234(one, X657, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X657)
      call mem%alloc(X658, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X658, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X659, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v**2, &
         X658, &
         wf%n_o**2, &
         zero, &
         X659, &
         wf%n_v**2)
!
      call mem%dealloc(X658)
      call mem%alloc(X660, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X659, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X660, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X659)
      call add_1243_to_1234(one, X660, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X660)
      call mem%alloc(X661, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(gAxxx_vvv, X661, wf%n_v, wf%n_v, wf%n_v)
      call mem%alloc(X662, wf%n_v)
!
      call dgemv('T', &
         wf%n_v**2, &
         wf%n_v, &
         two, &
         X661, &
         wf%n_v**2, &
         txIxI_vv, 1, &
         zero, &
         X662, 1)
!
      call mem%dealloc(X661)
      call mem%alloc(X663, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(rAxxx_ovo, X663, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X662, 1, &
         X663, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X662)
      call mem%dealloc(X663)
      call mem%alloc(X664, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         txIxI_vv, &
         wf%n_v, &
         gAxxx_voo, &
         wf%n_v, &
         zero, &
         X664, &
         wf%n_v)
!
      call mem%alloc(X665, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X664, X665, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X664)
      call mem%alloc(X666, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X666, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X665, &
         wf%n_v*wf%n_o, &
         X666, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X665)
      call mem%dealloc(X666)
      call mem%alloc(X667, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         gAxxx_voo, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X667, &
         wf%n_o**2)
!
      call mem%alloc(X668, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X667, &
         wf%n_o, &
         zero, &
         X668, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X667)
      call add_1423_to_1234(one, X668, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X668)
      call mem%alloc(X669, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         four, &
         txIxI_vv, &
         wf%n_v, &
         gAxxx_voo, &
         wf%n_v, &
         zero, &
         X669, &
         wf%n_v)
!
      call mem%alloc(X670, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X669, X670, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X669)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X670, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X670)
      call mem%alloc(X671, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         rxIxI_vv, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X671, &
         wf%n_v)
!
      call mem%alloc(X672, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X672, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X673, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X672, &
         wf%n_v*wf%n_o, &
         X671, &
         wf%n_v*wf%n_o, &
         zero, &
         X673, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X671)
      call mem%dealloc(X672)
      call add_1432_to_1234(one, X673, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X673)
      call mem%alloc(X674, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         rxIxI_vv, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X674, &
         wf%n_v)
!
      call mem%alloc(X675, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X674, &
         wf%n_v*wf%n_o, &
         zero, &
         X675, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X674)
      call add_1432_to_1234(one, X675, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X675)
      call mem%alloc(X676, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X676, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X677, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v, &
         X676, &
         wf%n_o**2, &
         zero, &
         X677, &
         wf%n_v**2)
!
      call mem%dealloc(X676)
      call mem%alloc(X678, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(X677, X678, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X677)
      call mem%alloc(X679, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X678, &
         wf%n_v*wf%n_o**2, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X679, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X678)
      call add_1243_to_1234(one, X679, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X679)
      call mem%alloc(X680, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X680, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X681, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v, &
         X680, &
         wf%n_o**2, &
         zero, &
         X681, &
         wf%n_v**2)
!
      call mem%dealloc(X680)
      call mem%alloc(X682, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(X681, X682, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X681)
      call mem%alloc(X683, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X682, &
         wf%n_v*wf%n_o**2, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X683, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X682)
      call add_1423_to_1234(one, X683, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X683)
      call mem%alloc(X684, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         gAxxx_voo, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X684, &
         wf%n_o)
!
      call mem%alloc(X685, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X684, 1, &
         X685, &
         wf%n_v**2)
!
      call mem%dealloc(X684)
      call add_1324_to_1234(one, X685, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X685)
      call mem%alloc(X686, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_213(gAxxx_voo, X686, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X687, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X686, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X687, &
         wf%n_o)
!
      call mem%dealloc(X686)
      call mem%alloc(X688, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X687, 1, &
         X688, &
         wf%n_v**2)
!
      call mem%dealloc(X687)
      call add_1324_to_1234(one, X688, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X688)
      call mem%alloc(X689, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(gAxxx_oov, X689, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X690, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X689, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X690, &
         wf%n_o)
!
      call mem%dealloc(X689)
      call mem%alloc(X691, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X690, 1, &
         X691, &
         wf%n_v**2)
!
      call mem%dealloc(X690)
      call add_1324_to_1234(one, X691, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X691)
      call mem%alloc(X692, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         rxIxI_vv, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X692, &
         wf%n_v)
!
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X692, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X692)
      call mem%alloc(X693, wf%n_v, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X693, &
         wf%n_v**2)
!
      call mem%alloc(X694, wf%n_v, wf%n_v, wf%n_v)
      call sort_to_132(X693, X694, wf%n_v, wf%n_v, wf%n_v)
      call mem%dealloc(X693)
      call mem%alloc(X695, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X695, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X696, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X694, &
         wf%n_v**2, &
         X695, &
         wf%n_o**2, &
         zero, &
         X696, &
         wf%n_v**2)
!
      call mem%dealloc(X694)
      call mem%dealloc(X695)
      call add_1342_to_1234(one, X696, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X696)
      call mem%alloc(X697, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         rxIxI_vv, &
         wf%n_v, &
         gAxxx_voo, &
         wf%n_v, &
         zero, &
         X697, &
         wf%n_v)
!
      call mem%alloc(X698, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X697, X698, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X697)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X698, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X698)
      call mem%alloc(X699, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         two, &
         gAxxx_voo, &
         wf%n_v, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X699, &
         wf%n_o**2)
!
      call mem%alloc(X700, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X700, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X701, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X700, &
         wf%n_v*wf%n_o, &
         X699, &
         wf%n_o, &
         zero, &
         X701, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X699)
      call mem%dealloc(X700)
      call add_1423_to_1234(one, X701, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X701)
      call mem%alloc(X702, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_213(gAxxx_oov, X702, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X703, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X703, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X704, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         X702, &
         wf%n_o**2, &
         X703, &
         wf%n_v*wf%n_o, &
         zero, &
         X704, &
         wf%n_o**2)
!
      call mem%dealloc(X702)
      call mem%dealloc(X703)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X704, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X704)
      call mem%alloc(X705, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X705, &
         wf%n_v**2)
!
      call mem%alloc(X706, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X705, X706, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X705)
      call mem%alloc(X707, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X707, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X706, &
         wf%n_v*wf%n_o, &
         X707, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X706)
      call mem%dealloc(X707)
      call mem%alloc(X708, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         four, &
         gAxxx_voo, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X708, 1)
!
      call mem%alloc(X709, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X708, 1, &
         X709, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X708)
      call add_1342_to_1234(one, X709, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X709)
      call mem%alloc(X710, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_voo, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X710, &
         wf%n_o**2)
!
      call mem%alloc(X711, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X710, &
         wf%n_o, &
         zero, &
         X711, &
         wf%n_v**2)
!
      call mem%dealloc(X710)
      call add_1324_to_1234(one, X711, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X711)
      call mem%alloc(X712, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(gAxxx_voo, X712, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X713, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X713, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X714, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         X713, &
         wf%n_v*wf%n_o, &
         X712, &
         wf%n_v, &
         zero, &
         X714, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X712)
      call mem%dealloc(X713)
      call mem%alloc(X715, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X714, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X715, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X714)
      call add_1423_to_1234(one, X715, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X715)
      call mem%alloc(X716, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_213(gAxxx_oov, X716, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X717, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X717, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X718, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -two, &
         X716, &
         wf%n_o**2, &
         X717, &
         wf%n_v*wf%n_o, &
         zero, &
         X718, &
         wf%n_o**2)
!
      call mem%dealloc(X716)
      call mem%dealloc(X717)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X718, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X718)
      call mem%alloc(X719, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X719, &
         wf%n_v**2)
!
      call mem%alloc(X720, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X719, X720, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X719)
      call mem%alloc(X721, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X721, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X720, &
         wf%n_v*wf%n_o, &
         X721, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X720)
      call mem%dealloc(X721)
      call mem%alloc(X722, wf%n_v, wf%n_o)
      call sort_to_21(tAxxI_ov, X722, wf%n_o, wf%n_v)
      call mem%alloc(X723, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         four, &
         gAxxx_voo, &
         wf%n_v*wf%n_o, &
         X722, 1, &
         zero, &
         X723, 1)
!
      call mem%dealloc(X722)
      call mem%alloc(X724, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X723, 1, &
         X724, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X723)
      call add_1342_to_1234(one, X724, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X724)
      call mem%alloc(X725, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_voo, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X725, &
         wf%n_o**2)
!
      call mem%alloc(X726, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X725, &
         wf%n_o, &
         zero, &
         X726, &
         wf%n_v**2)
!
      call mem%dealloc(X725)
      call add_1324_to_1234(one, X726, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X726)
      call mem%alloc(X727, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(gAxxx_voo, X727, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X728, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X728, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X729, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         X728, &
         wf%n_v*wf%n_o, &
         X727, &
         wf%n_v, &
         zero, &
         X729, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X727)
      call mem%dealloc(X728)
      call mem%alloc(X730, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X729, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X730, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X729)
      call add_1423_to_1234(one, X730, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X730)
      call mem%alloc(X731, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X731, wf%n_v, wf%n_o)
      call mem%alloc(X732, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         gAxxx_oov, &
         wf%n_o, &
         X731, 1, &
         zero, &
         X732, 1)
!
      call mem%dealloc(X731)
      call mem%alloc(X733, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X732, 1, &
         X733, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X732)
      call add_1342_to_1234(one, X733, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X733)
      call mem%alloc(X734, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         uAIxx_vo, &
         wf%n_v, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X734, &
         wf%n_o)
!
      call mem%alloc(X735, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X734, &
         wf%n_o**2, &
         zero, &
         X735, &
         wf%n_v**2)
!
      call mem%dealloc(X734)
      call add_1342_to_1234(one, X735, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X735)
      call mem%alloc(X736, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X736, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X737, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X736, &
         wf%n_v*wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X737, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X736)
      call mem%alloc(X738, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X737, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X738, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X737)
      call add_1423_to_1234(one, X738, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X738)
      call mem%alloc(X739, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X739, &
         wf%n_v**2)
!
      call mem%alloc(X740, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X740, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X739, &
         wf%n_v, &
         X740, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X739)
      call mem%dealloc(X740)
      call mem%alloc(X741, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X741, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X742, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_voo, &
         wf%n_v, &
         X741, &
         wf%n_v*wf%n_o, &
         zero, &
         X742, &
         wf%n_o**2)
!
      call mem%dealloc(X741)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X742, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X742)
      call mem%alloc(X743, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X743, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X744, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X743, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X744, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X743)
      call add_1423_to_1234(one, X744, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X744)
      call mem%alloc(X745, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_213(gAxxx_oov, X745, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X746, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         four, &
         X745, &
         wf%n_o**2, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X746, &
         wf%n_o**2)
!
      call mem%dealloc(X745)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X746, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X746)
      call mem%alloc(X747, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X747, &
         wf%n_v**2)
!
      call mem%alloc(X748, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X747, X748, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X747)
      call mem%alloc(X749, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X748, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X749, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X748)
      call add_1432_to_1234(one, X749, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X749)
      call mem%alloc(X750, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -four, &
         gAxxx_vvv, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X750, &
         wf%n_v**2)
!
      call mem%alloc(X751, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X750, X751, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X750)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X751, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X751)
      call mem%alloc(X752, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         -two, &
         gAxxx_voo, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X752, 1)
!
      call mem%alloc(X753, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxxxI_vov, 1, &
         X752, 1, &
         X753, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X752)
      call add_1432_to_1234(one, X753, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X753)
      call mem%alloc(X754, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         gAxxx_oov, &
         wf%n_o**2, &
         zero, &
         X754, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X755, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X754, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X755, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X754)
      call add_1423_to_1234(one, X755, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X755)
      call mem%alloc(X756, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_213(gAxxx_oov, X756, wf%n_o, wf%n_o, wf%n_v)
      call mem%alloc(X757, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         four, &
         X756, &
         wf%n_o**2, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X757, &
         wf%n_o**2)
!
      call mem%dealloc(X756)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X757, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X757)
      call mem%alloc(X758, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gAxxx_vvv, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X758, &
         wf%n_v**2)
!
      call mem%alloc(X759, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X758, X759, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X758)
      call mem%alloc(X760, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X759, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X760, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X759)
      call add_1432_to_1234(one, X760, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X760)
      call mem%alloc(X761, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -four, &
         gAxxx_vvv, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X761, &
         wf%n_v**2)
!
      call mem%alloc(X762, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X761, X762, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X761)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X762, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X762)
      call mem%alloc(X763, wf%n_v, wf%n_o)
      call sort_to_21(tAxxI_ov, X763, wf%n_o, wf%n_v)
      call mem%alloc(X764, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         -two, &
         gAxxx_voo, &
         wf%n_v*wf%n_o, &
         X763, 1, &
         zero, &
         X764, 1)
!
      call mem%dealloc(X763)
      call mem%alloc(X765, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxxxI_vov, 1, &
         X764, 1, &
         X765, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X764)
      call add_1432_to_1234(one, X765, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X765)
      call mem%alloc(X766, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X766, wf%n_v, wf%n_o)
      call mem%alloc(X767, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gAxxx_oov, &
         wf%n_o, &
         X766, 1, &
         zero, &
         X767, 1)
!
      call mem%dealloc(X766)
      call mem%alloc(X768, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxxxI_vov, 1, &
         X767, 1, &
         X768, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X767)
      call add_1432_to_1234(one, X768, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X768)
      call mem%alloc(X769, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gAxxx_vvv, &
         wf%n_v**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X769, &
         wf%n_v**2)
!
      call mem%alloc(X770, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X769, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X770, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X769)
      call add_1432_to_1234(one, X770, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X770)
      call mem%alloc(X771, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_v, &
         four, &
         gAxxx_vvv, &
         wf%n_v**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X771, &
         wf%n_v**2)
!
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X771, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X771)
      call mem%alloc(X772, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(gAxxx_voo, X772, wf%n_v, wf%n_o, wf%n_o)
      call mem%alloc(X773, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X772, &
         wf%n_v, &
         zero, &
         X773, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X772)
      call mem%alloc(X774, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X773, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X774, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X773)
      call add_1423_to_1234(one, X774, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X774)
      call mem%alloc(X775, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         -four, &
         gAxxx_voo, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X775, &
         wf%n_o**2)
!
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X775, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X775)
      call mem%alloc(X776, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         -four, &
         gxIxI_oo, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X776, &
         wf%n_o)
!
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X776, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X776)
      call mem%alloc(X777, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         two, &
         gxIxI_oo, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X777, &
         wf%n_o)
!
      call mem%alloc(X778, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X777, &
         wf%n_o, &
         zero, &
         X778, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X777)
      call add_1432_to_1234(one, X778, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X778)
      call mem%alloc(X779, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         gxIxI_oo, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X779, &
         wf%n_o)
!
      call mem%alloc(X780, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X780, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X781, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X780, &
         wf%n_v**2*wf%n_o, &
         X779, &
         wf%n_o, &
         zero, &
         X781, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X779)
      call mem%dealloc(X780)
      call add_1342_to_1234(one, X781, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X781)
      call mem%alloc(X782, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X782, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X783, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X782, &
         wf%n_o**2, &
         gxIxI_oo, 1, &
         zero, &
         X783, 1)
!
      call mem%dealloc(X782)
      call mem%alloc(X784, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X784, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X785, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X784, 1, &
         X783, 1, &
         X785, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X783)
      call mem%dealloc(X784)
      call add_1243_to_1234(one, X785, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X785)
      call mem%alloc(X786, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X786, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X787, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v, &
         -four, &
         X786, &
         wf%n_o**2, &
         gxIxI_oo, 1, &
         zero, &
         X787, 1)
!
      call mem%dealloc(X786)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X787, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X787)
      call mem%alloc(X788, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         two, &
         gxIxI_oo, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X788, &
         wf%n_o)
!
      call mem%alloc(X789, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X789, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X790, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X789, &
         wf%n_v*wf%n_o, &
         X788, &
         wf%n_o, &
         zero, &
         X790, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X788)
      call mem%dealloc(X789)
      call add_1423_to_1234(one, X790, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X790)
      call mem%alloc(X791, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         two, &
         gxIxI_oo, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X791, &
         wf%n_o)
!
      call mem%alloc(X792, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X791, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X792, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X791)
      call add_1423_to_1234(one, X792, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X792)
      call mem%alloc(X793, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         -two, &
         gxIxI_oo, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X793, &
         wf%n_o)
!
      call mem%alloc(X794, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X794, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X794, &
         wf%n_v*wf%n_o, &
         X793, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X793)
      call mem%dealloc(X794)
      call mem%alloc(X795, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         four, &
         gxIxI_oo, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         zero, &
         X795, &
         wf%n_o)
!
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X795, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X795)
      call mem%alloc(X796, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         -two, &
         gxIxI_oo, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         zero, &
         X796, &
         wf%n_o)
!
      call mem%alloc(X797, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X796, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X797, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X796)
      call add_1432_to_1234(one, X797, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X797)
      call mem%alloc(X798, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X798, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X799, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X798, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X799, &
         wf%n_v)
!
      call mem%dealloc(X798)
      call mem%alloc(X800, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X799, X800, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X799)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X800, 1, &
         rAIAx_o, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X800)
      call mem%alloc(X801, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X801, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X802, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o**2, &
         -two, &
         X801, &
         wf%n_v**2, &
         gxIxx_ooo, &
         wf%n_o**2, &
         zero, &
         X802, &
         wf%n_v**2)
!
      call mem%dealloc(X801)
      call mem%alloc(X803, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X802, X803, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X802)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X803, 1, &
         rAIAx_o, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X803)
      call mem%alloc(X804, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X804, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X805, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gxIxx_vov, &
         wf%n_v, &
         X804, &
         wf%n_o, &
         zero, &
         X805, &
         wf%n_v)
!
      call mem%dealloc(X804)
      call mem%alloc(X806, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X805, 1, &
         rAIxx_vo, 1, &
         X806, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X805)
      call add_1432_to_1234(one, X806, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X806)
      call mem%alloc(X807, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X807, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X808, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         gxIxx_vov, &
         wf%n_v, &
         X807, &
         wf%n_o, &
         zero, &
         X808, &
         wf%n_v)
!
      call mem%dealloc(X807)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X808, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X808)
      call mem%alloc(X809, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X809, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X810, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         X809, &
         wf%n_o**2, &
         zero, &
         X810, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X809)
      call mem%alloc(X811, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X810, X811, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X810)
      call mem%alloc(X812, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X811, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X812, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X811)
      call add_1243_to_1234(one, X812, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X812)
      call mem%alloc(X813, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X813, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X814, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X813, X814, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X813)
      call mem%alloc(X815, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X814, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X815, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X814)
      call add_1423_to_1234(one, X815, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X815)
      call mem%alloc(X816, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X816, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X817, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o**2, &
         -two, &
         gxIxx_ooo, &
         wf%n_o**2, &
         X816, &
         wf%n_o**2, &
         zero, &
         X817, &
         wf%n_o)
!
      call mem%dealloc(X816)
      call mem%alloc(X818, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X817, 1, &
         X818, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X817)
      call add_1423_to_1234(one, X818, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X818)
      call mem%alloc(X819, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X819, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X820, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o**2, &
         four, &
         X819, &
         wf%n_o**2, &
         gxIxx_ooo, &
         wf%n_o**2, &
         zero, &
         X820, &
         wf%n_v)
!
      call mem%dealloc(X819)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X820, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X820)
      call mem%alloc(X821, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         gxIxx_ooo, &
         wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X821, &
         wf%n_o**2)
!
      call mem%alloc(X822, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X822, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X823, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X822, &
         wf%n_v*wf%n_o, &
         X821, &
         wf%n_o, &
         zero, &
         X823, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X821)
      call mem%dealloc(X822)
      call add_1423_to_1234(one, X823, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X823)
      call mem%alloc(X824, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X824, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X825, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         X824, &
         wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X825, &
         wf%n_o**2)
!
      call mem%dealloc(X824)
      call mem%alloc(X826, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X825, &
         wf%n_o, &
         zero, &
         X826, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X825)
      call add_1423_to_1234(one, X826, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X826)
      call mem%alloc(X827, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X827, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X828, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         X827, &
         wf%n_v**2, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X828, &
         wf%n_v**2)
!
      call mem%dealloc(X827)
      call mem%alloc(X829, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X828, X829, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X828)
      call mem%alloc(X830, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X830, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X831, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X829, &
         wf%n_v*wf%n_o, &
         X830, &
         wf%n_v*wf%n_o, &
         zero, &
         X831, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X829)
      call mem%dealloc(X830)
      call add_1432_to_1234(one, X831, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X831)
      call mem%alloc(X832, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X832, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X833, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         X832, &
         wf%n_o**2, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X833, &
         wf%n_o**2)
!
      call mem%dealloc(X832)
      call mem%alloc(X834, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X833, &
         wf%n_o, &
         zero, &
         X834, &
         wf%n_v**2)
!
      call mem%dealloc(X833)
      call add_1324_to_1234(one, X834, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X834)
      call mem%alloc(X835, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X835, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X836, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         X835, &
         wf%n_v**2, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X836, &
         wf%n_v**2)
!
      call mem%dealloc(X835)
      call mem%alloc(X837, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X836, X837, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X836)
      call mem%alloc(X838, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X837, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X838, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X837)
      call add_1432_to_1234(one, X838, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X838)
      call mem%alloc(X839, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X839, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X840, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         X839, &
         wf%n_o**2, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X840, &
         wf%n_o**2)
!
      call mem%dealloc(X839)
      call mem%alloc(X841, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X841, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X842, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X841, &
         wf%n_v**2, &
         X840, &
         wf%n_o, &
         zero, &
         X842, &
         wf%n_v**2)
!
      call mem%dealloc(X840)
      call mem%dealloc(X841)
      call add_1324_to_1234(one, X842, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X842)
      call mem%alloc(X843, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X843, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X844, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X843, &
         wf%n_v, &
         uxIxx_vvo, &
         wf%n_v, &
         zero, &
         X844, &
         wf%n_v)
!
      call mem%dealloc(X843)
      call mem%alloc(X845, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X844, 1, &
         rAxAx_oo, 1, &
         X845, &
         wf%n_v**2)
!
      call mem%dealloc(X844)
      call add_1324_to_1234(one, X845, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X845)
      call mem%alloc(X846, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X846, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X847, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         X846, &
         wf%n_v**2, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X847, &
         wf%n_v**2)
!
      call mem%dealloc(X846)
      call mem%alloc(X848, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X847, X848, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X847)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X848, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X848)
      call mem%alloc(X849, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         gxIxx_ooo, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X849, &
         wf%n_o**2)
!
      call mem%alloc(X850, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X850, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X851, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X850, &
         wf%n_v**2, &
         X849, &
         wf%n_o, &
         zero, &
         X851, &
         wf%n_v**2)
!
      call mem%dealloc(X849)
      call mem%dealloc(X850)
      call add_1324_to_1234(one, X851, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X851)
      call mem%alloc(X852, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X852, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X853, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X852, X853, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X852)
      call mem%alloc(X854, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X853, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X854, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X853)
      call add_1423_to_1234(one, X854, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X854)
      call mem%alloc(X855, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X855, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X856, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X855, X856, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X855)
      call mem%alloc(X857, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X856, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X857, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X856)
      call add_1432_to_1234(one, X857, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X857)
      call mem%alloc(X858, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X858, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X859, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         X858, &
         wf%n_o**2, &
         zero, &
         X859, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X858)
      call mem%alloc(X860, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X859, X860, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X859)
      call mem%alloc(X861, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X860, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X861, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X860)
      call add_1243_to_1234(one, X861, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X861)
      call mem%alloc(X862, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X862, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X863, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         X862, &
         wf%n_o**2, &
         zero, &
         X863, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X862)
      call mem%alloc(X864, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X863, X864, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X863)
      call mem%alloc(X865, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X864, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X865, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X864)
      call add_1423_to_1234(one, X865, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X865)
      call mem%alloc(X866, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X866, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X867, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o**2, &
         two, &
         gxIxx_ooo, &
         wf%n_o**2, &
         X866, &
         wf%n_o**2, &
         zero, &
         X867, &
         wf%n_o)
!
      call mem%dealloc(X866)
      call mem%alloc(X868, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X868, wf%n_o, wf%n_v)
      call mem%alloc(X869, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X868, 1, &
         X867, 1, &
         X869, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X867)
      call mem%dealloc(X868)
      call add_1423_to_1234(one, X869, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X869)
      call mem%alloc(X870, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_213(gxIxx_ooo, X870, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X871, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X871, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X872, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o**2, &
         two, &
         X870, &
         wf%n_o**2, &
         X871, &
         wf%n_o**2, &
         zero, &
         X872, &
         wf%n_o)
!
      call mem%dealloc(X870)
      call mem%dealloc(X871)
      call mem%alloc(X873, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X873, wf%n_o, wf%n_v)
      call mem%alloc(X874, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X873, 1, &
         X872, 1, &
         X874, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X872)
      call mem%dealloc(X873)
      call add_1423_to_1234(one, X874, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X874)
      call mem%alloc(X875, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X875, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X876, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         two, &
         X875, &
         wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X876, &
         wf%n_o**2)
!
      call mem%dealloc(X875)
      call mem%alloc(X877, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X877, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X878, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X877, &
         wf%n_v*wf%n_o, &
         X876, &
         wf%n_o, &
         zero, &
         X878, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X876)
      call mem%dealloc(X877)
      call add_1423_to_1234(one, X878, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X878)
      call mem%alloc(X879, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X879, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X880, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         two, &
         X879, &
         wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X880, &
         wf%n_o**2)
!
      call mem%dealloc(X879)
      call mem%alloc(X881, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X880, &
         wf%n_o, &
         zero, &
         X881, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X880)
      call add_1423_to_1234(one, X881, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X881)
      call mem%alloc(X882, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X882, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X883, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gxIxx_vov, &
         wf%n_v, &
         X882, &
         wf%n_o, &
         zero, &
         X883, &
         wf%n_v)
!
      call mem%dealloc(X882)
      call mem%alloc(X884, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X883, 1, &
         rAxxI_ov, 1, &
         X884, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X883)
      call add_1423_to_1234(one, X884, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X884)
      call mem%alloc(X885, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X885, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X886, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X885, X886, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X885)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X886, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X886)
      call mem%alloc(X887, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X887, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X888, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gxIxx_vov, &
         wf%n_v, &
         X887, &
         wf%n_o, &
         zero, &
         X888, &
         wf%n_v)
!
      call mem%dealloc(X887)
      call mem%alloc(X889, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X889, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X888, 1, &
         X889, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X888)
      call mem%dealloc(X889)
      call mem%alloc(X890, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X890, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X891, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o**2, &
         -two, &
         X890, &
         wf%n_o**2, &
         gxIxx_ooo, &
         wf%n_o**2, &
         zero, &
         X891, &
         wf%n_v)
!
      call mem%dealloc(X890)
      call mem%alloc(X892, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X892, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X891, 1, &
         X892, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X891)
      call mem%dealloc(X892)
      call mem%alloc(X893, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X893, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X894, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         X893, &
         wf%n_o, &
         zero, &
         X894, &
         wf%n_v)
!
      call mem%dealloc(X893)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X894, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X894)
      call mem%alloc(X895, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         gxIxx_ooo, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X895, &
         wf%n_o**2)
!
      call mem%alloc(X896, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X896, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X897, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X896, &
         wf%n_v*wf%n_o, &
         X895, &
         wf%n_o, &
         zero, &
         X897, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X895)
      call mem%dealloc(X896)
      call add_1423_to_1234(one, X897, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X897)
      call mem%alloc(X898, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_312(gxIxx_ooo, X898, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X899, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         X898, &
         wf%n_o**2, &
         zero, &
         X899, &
         wf%n_v)
!
      call mem%dealloc(X898)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X899, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X899)
      call mem%alloc(X900, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X900, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X901, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X900, X901, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X900)
      call mem%alloc(X902, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X902, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X901, &
         wf%n_v*wf%n_o, &
         X902, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X901)
      call mem%dealloc(X902)
      call mem%alloc(X903, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X903, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X904, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X903, X904, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X903)
      call mem%alloc(X905, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X904, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         zero, &
         X905, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X904)
      call add_1432_to_1234(one, X905, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X905)
      call mem%alloc(X906, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         four, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X906, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X907, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X906, X907, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X906)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X907, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X907)
      call mem%alloc(X908, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X908, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X909, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         X908, &
         wf%n_o, &
         zero, &
         X909, &
         wf%n_v)
!
      call mem%dealloc(X908)
      call mem%alloc(X910, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X910, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X909, &
         wf%n_v*wf%n_o, &
         X910, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X909)
      call mem%dealloc(X910)
      call mem%alloc(X911, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         two, &
         gxIxx_ooo, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X911, &
         wf%n_o**2)
!
      call mem%alloc(X912, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X911, &
         wf%n_o, &
         zero, &
         X912, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X911)
      call add_1423_to_1234(one, X912, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X912)
      call mem%alloc(X913, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X913, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X914, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         -four, &
         tAIxx_vo, &
         wf%n_v, &
         X913, &
         wf%n_o, &
         zero, &
         X914, &
         wf%n_v)
!
      call mem%dealloc(X913)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X914, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X914)
      call mem%alloc(X915, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X915, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X916, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X915, X916, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X915)
      call mem%alloc(X917, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X917, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X916, &
         wf%n_v*wf%n_o, &
         X917, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X916)
      call mem%dealloc(X917)
      call mem%alloc(X918, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X918, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X919, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X918, X919, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X918)
      call mem%alloc(X920, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X919, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         zero, &
         X920, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X919)
      call add_1432_to_1234(one, X920, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X920)
      call mem%alloc(X921, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         four, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X921, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X922, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X921, X922, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X921)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X922, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X922)
      call mem%alloc(X923, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X923, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X924, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         two, &
         tAxxI_ov, &
         wf%n_o, &
         X923, &
         wf%n_o, &
         zero, &
         X924, &
         wf%n_v)
!
      call mem%dealloc(X923)
      call mem%alloc(X925, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X925, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X924, &
         wf%n_v*wf%n_o, &
         X925, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X924)
      call mem%dealloc(X925)
      call mem%alloc(X926, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         two, &
         gxIxx_ooo, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X926, &
         wf%n_o**2)
!
      call mem%alloc(X927, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X926, &
         wf%n_o, &
         zero, &
         X927, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X926)
      call add_1423_to_1234(one, X927, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X927)
      call mem%alloc(X928, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X928, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X929, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         -four, &
         tAxxI_ov, &
         wf%n_o, &
         X928, &
         wf%n_o, &
         zero, &
         X929, &
         wf%n_v)
!
      call mem%dealloc(X928)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X929, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X929)
      call mem%alloc(X930, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X930, wf%n_v, wf%n_o)
      call mem%alloc(X931, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -four, &
         gxIxx_vov, &
         wf%n_v, &
         X930, 1, &
         zero, &
         X931, 1)
!
      call mem%dealloc(X930)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X931, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X931)
      call mem%alloc(X932, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X932, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X933, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X932, X933, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X932)
      call mem%alloc(X934, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X933, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X934, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X933)
      call add_1423_to_1234(one, X934, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X934)
      call mem%alloc(X935, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X935, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X936, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         gxIxx_vov, &
         wf%n_v*wf%n_o, &
         X935, &
         wf%n_o**2, &
         zero, &
         X936, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X935)
      call mem%alloc(X937, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X936, X937, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X936)
      call mem%alloc(X938, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X937, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X938, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X937)
      call add_1243_to_1234(one, X938, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X938)
      call mem%alloc(X939, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X939, wf%n_v, wf%n_o)
      call mem%alloc(X940, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         gxIxx_vov, &
         wf%n_v, &
         X939, 1, &
         zero, &
         X940, 1)
!
      call mem%dealloc(X939)
      call mem%alloc(X941, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(rAxxx_ovo, X941, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X940, 1, &
         X941, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X940)
      call mem%dealloc(X941)
      call mem%alloc(X942, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_312(gxIxx_ooo, X942, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X943, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         -two, &
         uAIxx_vo, &
         wf%n_v, &
         X942, &
         wf%n_o**2, &
         zero, &
         X943, &
         wf%n_v)
!
      call mem%dealloc(X942)
      call mem%alloc(X944, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X944, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X943, &
         wf%n_v*wf%n_o, &
         X944, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X943)
      call mem%dealloc(X944)
      call mem%alloc(X945, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X945, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X946, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         -two, &
         X945, &
         wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X946, &
         wf%n_o**2)
!
      call mem%dealloc(X945)
      call mem%alloc(X947, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X946, &
         wf%n_o, &
         zero, &
         X947, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X946)
      call add_1423_to_1234(one, X947, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X947)
      call mem%alloc(X948, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_312(gxIxx_ooo, X948, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X949, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         four, &
         uAIxx_vo, &
         wf%n_v, &
         X948, &
         wf%n_o**2, &
         zero, &
         X949, &
         wf%n_v)
!
      call mem%dealloc(X948)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X949, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X949)
      call mem%alloc(X950, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X950, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X951, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         X950, &
         wf%n_v**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X951, &
         wf%n_v**2)
!
      call mem%dealloc(X950)
      call mem%alloc(X952, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X951, X952, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X951)
      call mem%alloc(X953, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X953, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X952, &
         wf%n_v*wf%n_o, &
         X953, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X952)
      call mem%dealloc(X953)
      call mem%alloc(X954, wf%n_o)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_o, &
         -four, &
         gxIxx_ooo, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X954, 1)
!
      call mem%alloc(X955, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X954, 1, &
         X955, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X954)
      call add_1342_to_1234(one, X955, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X955)
      call mem%alloc(X956, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_132(gxIxx_ooo, X956, wf%n_o, wf%n_o, wf%n_o)
      call mem%alloc(X957, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         X956, &
         wf%n_o**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X957, &
         wf%n_o**2)
!
      call mem%dealloc(X956)
      call mem%alloc(X958, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X957, &
         wf%n_o, &
         zero, &
         X958, &
         wf%n_v**2)
!
      call mem%dealloc(X957)
      call add_1324_to_1234(one, X958, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X958)
      call mem%alloc(X959, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         gxIxx_ooo, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X959, &
         wf%n_o**2)
!
      call mem%alloc(X960, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X959, &
         wf%n_o, &
         zero, &
         X960, &
         wf%n_v**2)
!
      call mem%dealloc(X959)
      call add_1324_to_1234(one, X960, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X960)
      call mem%alloc(X961, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X961, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X962, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         X961, &
         wf%n_v**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X962, &
         wf%n_v**2)
!
      call mem%dealloc(X961)
      call mem%alloc(X963, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X962, X963, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X962)
      call mem%alloc(X964, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X963, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X964, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X963)
      call add_1432_to_1234(one, X964, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X964)
      call mem%alloc(X965, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(gxIxx_vov, X965, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X966, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         four, &
         X965, &
         wf%n_v**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X966, &
         wf%n_v**2)
!
      call mem%dealloc(X965)
      call mem%alloc(X967, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X966, X967, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X966)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X967, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X967)
      call mem%alloc(X968, wf%n_o)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_o, &
         two, &
         gxIxx_ooo, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X968, 1)
!
      call mem%alloc(X969, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxxxI_vov, 1, &
         X968, 1, &
         X969, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X968)
      call add_1432_to_1234(one, X969, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X969)
      call mem%alloc(X970, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(u_aibj, X970, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X971, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gxxxI_vvo, &
         wf%n_v, &
         X970, &
         wf%n_v*wf%n_o, &
         zero, &
         X971, &
         wf%n_v)
!
      call mem%dealloc(X970)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X971, 1, &
         rAIAx_o, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X971)
      call mem%alloc(X972, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X972, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X973, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gxxxI_vvo, &
         wf%n_v, &
         X972, &
         wf%n_v*wf%n_o, &
         zero, &
         X973, &
         wf%n_v)
!
      call mem%dealloc(X972)
      call mem%alloc(X974, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X973, 1, &
         rAIxx_vo, 1, &
         X974, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X973)
      call add_1432_to_1234(one, X974, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X974)
      call mem%alloc(X975, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X975, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X976, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         gxxxI_vvo, &
         wf%n_v, &
         X975, &
         wf%n_v*wf%n_o, &
         zero, &
         X976, &
         wf%n_v)
!
      call mem%dealloc(X975)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X976, 1, &
         rAIxx_vo, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X976)
      call mem%alloc(X977, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X977, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X978, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X978, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X979, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X977, &
         wf%n_v*wf%n_o, &
         X978, &
         wf%n_o**2, &
         zero, &
         X979, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X977)
      call mem%dealloc(X978)
      call mem%alloc(X980, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X979, X980, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X979)
      call mem%alloc(X981, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X980, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X981, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X980)
      call add_1423_to_1234(one, X981, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X981)
      call mem%alloc(X982, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X982, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X983, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         X982, &
         wf%n_v*wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X983, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X982)
      call mem%alloc(X984, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X983, X984, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X983)
      call mem%alloc(X985, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X984, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X985, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X984)
      call add_1432_to_1234(one, X985, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X985)
      call mem%alloc(X986, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         gxxxI_vvo, &
         wf%n_v, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X986, &
         wf%n_v)
!
      call mem%alloc(X987, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X986, 1, &
         rAxAx_oo, 1, &
         X987, &
         wf%n_v**2)
!
      call mem%dealloc(X986)
      call add_1324_to_1234(one, X987, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X987)
      call mem%alloc(X988, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X988, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X989, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X988, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X989, &
         wf%n_v)
!
      call mem%dealloc(X988)
      call mem%alloc(X990, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X989, 1, &
         rAxAx_oo, 1, &
         X990, &
         wf%n_v**2)
!
      call mem%dealloc(X989)
      call add_1324_to_1234(one, X990, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X990)
      call mem%alloc(X991, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         gxxxI_vvo, &
         wf%n_v**2, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X991, &
         wf%n_v**2)
!
      call mem%alloc(X992, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X991, X992, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X991)
      call mem%alloc(X993, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X993, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X994, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X992, &
         wf%n_v*wf%n_o, &
         X993, &
         wf%n_v*wf%n_o, &
         zero, &
         X994, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X992)
      call mem%dealloc(X993)
      call add_1432_to_1234(one, X994, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X994)
      call mem%alloc(X995, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         two, &
         gxxxI_vvo, &
         wf%n_v**2, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X995, &
         wf%n_v**2)
!
      call mem%alloc(X996, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X995, X996, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X995)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X996, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X996)
      call mem%alloc(X997, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         gxxxI_vvo, &
         wf%n_v, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X997, &
         wf%n_v)
!
      call mem%alloc(X998, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X997, 1, &
         rAxxI_ov, 1, &
         X998, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X997)
      call add_1423_to_1234(one, X998, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X998)
      call mem%alloc(X999, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X999, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1000, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         gxxxI_vvo, &
         wf%n_v, &
         X999, &
         wf%n_v*wf%n_o, &
         zero, &
         X1000, &
         wf%n_v)
!
      call mem%dealloc(X999)
      call mem%alloc(X1001, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1000, 1, &
         rAxxI_ov, 1, &
         X1001, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1000)
      call add_1423_to_1234(one, X1001, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1001)
      call mem%alloc(X1002, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1002, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1003, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         X1002, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X1003, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1002)
      call mem%alloc(X1004, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1003, X1004, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1003)
      call mem%alloc(X1005, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1004, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1005, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1004)
      call add_1423_to_1234(one, X1005, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1005)
      call mem%alloc(X1006, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1006, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1007, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         X1006, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X1007, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1006)
      call mem%alloc(X1008, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1007, X1008, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1007)
      call mem%alloc(X1009, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1008, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1009, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1008)
      call add_1432_to_1234(one, X1009, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1009)
      call mem%alloc(X1010, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1010, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1011, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         X1010, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X1011, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1010)
      call mem%alloc(X1012, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1011, X1012, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1011)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1012, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1012)
      call mem%alloc(X1013, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X1013, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1014, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         gxxxI_vvo, &
         wf%n_v, &
         X1013, &
         wf%n_v*wf%n_o, &
         zero, &
         X1014, &
         wf%n_v)
!
      call mem%dealloc(X1013)
      call mem%alloc(X1015, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X1015, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1014, 1, &
         X1015, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1014)
      call mem%dealloc(X1015)
      call mem%alloc(X1016, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1016, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1017, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1017, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1018, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         two, &
         X1016, &
         wf%n_v*wf%n_o, &
         X1017, &
         wf%n_o**2, &
         zero, &
         X1018, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1016)
      call mem%dealloc(X1017)
      call mem%alloc(X1019, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X1018, X1019, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1018)
      call mem%alloc(X1020, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1019, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X1020, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1019)
      call add_1423_to_1234(one, X1020, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1020)
      call mem%alloc(X1021, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         four, &
         gxxxI_vvo, &
         wf%n_v, &
         tAIxx_vo, 1, &
         zero, &
         X1021, 1)
!
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X1021, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1021)
      call mem%alloc(X1022, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1022, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1023, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         X1022, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1023, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1022)
      call mem%alloc(X1024, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1023, X1024, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1023)
      call mem%alloc(X1025, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1024, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1025, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1024)
      call add_1423_to_1234(one, X1025, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1025)
      call mem%alloc(X1026, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1026, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1027, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1027, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1028, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         X1026, &
         wf%n_v*wf%n_o, &
         X1027, &
         wf%n_o**2, &
         zero, &
         X1028, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1026)
      call mem%dealloc(X1027)
      call mem%alloc(X1029, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X1028, X1029, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1028)
      call mem%alloc(X1030, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1029, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1030, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1029)
      call add_1243_to_1234(one, X1030, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1030)
      call mem%alloc(X1031, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         gxxxI_vvo, &
         wf%n_v, &
         tAIxx_vo, 1, &
         zero, &
         X1031, 1)
!
      call mem%alloc(X1032, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(rAxxx_ovo, X1032, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X1031, 1, &
         X1032, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1031)
      call mem%dealloc(X1032)
      call mem%alloc(X1033, wf%n_v, wf%n_o)
      call sort_to_21(tAxxI_ov, X1033, wf%n_o, wf%n_v)
      call mem%alloc(X1034, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         four, &
         gxxxI_vvo, &
         wf%n_v, &
         X1033, 1, &
         zero, &
         X1034, 1)
!
      call mem%dealloc(X1033)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X1034, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1034)
      call mem%alloc(X1035, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1035, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1036, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         X1035, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1036, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1035)
      call mem%alloc(X1037, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1036, X1037, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1036)
      call mem%alloc(X1038, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1037, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1038, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1037)
      call add_1423_to_1234(one, X1038, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1038)
      call mem%alloc(X1039, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1039, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1040, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1040, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1041, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         X1039, &
         wf%n_v*wf%n_o, &
         X1040, &
         wf%n_o**2, &
         zero, &
         X1041, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1039)
      call mem%dealloc(X1040)
      call mem%alloc(X1042, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1342(X1041, X1042, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1041)
      call mem%alloc(X1043, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1042, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1043, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1042)
      call add_1243_to_1234(one, X1043, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1043)
      call mem%alloc(X1044, wf%n_v, wf%n_o)
      call sort_to_21(tAxxI_ov, X1044, wf%n_o, wf%n_v)
      call mem%alloc(X1045, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         gxxxI_vvo, &
         wf%n_v, &
         X1044, 1, &
         zero, &
         X1045, 1)
!
      call mem%dealloc(X1044)
      call mem%alloc(X1046, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(rAxxx_ovo, X1046, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X1045, 1, &
         X1046, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1045)
      call mem%dealloc(X1046)
      call mem%alloc(X1047, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1047, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1048, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         X1047, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1048, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1047)
      call mem%alloc(X1049, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1048, X1049, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1048)
      call mem%alloc(X1050, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X1050, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1049, &
         wf%n_v*wf%n_o, &
         X1050, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1049)
      call mem%dealloc(X1050)
      call mem%alloc(X1051, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1051, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1052, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         two, &
         X1051, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1052, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1051)
      call mem%alloc(X1053, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1052, X1053, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1052)
      call mem%alloc(X1054, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1053, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1054, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1053)
      call add_1432_to_1234(one, X1054, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1054)
      call mem%alloc(X1055, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(gxxxI_vvo, X1055, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1056, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         -four, &
         X1055, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1056, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1055)
      call mem%alloc(X1057, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1056, X1057, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1056)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1057, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1057)
      call mem%alloc(X1058, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         gxxxI_vvo, &
         wf%n_v**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1058, &
         wf%n_v**2)
!
      call mem%alloc(X1059, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X1058, X1059, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X1058)
      call mem%alloc(X1060, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1060, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1059, &
         wf%n_v*wf%n_o, &
         X1060, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1059)
      call mem%dealloc(X1060)
      call mem%alloc(X1061, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         -two, &
         gxxxI_vvo, &
         wf%n_v**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1061, &
         wf%n_v**2)
!
      call mem%alloc(X1062, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X1061, X1062, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X1061)
      call mem%alloc(X1063, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1062, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1063, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1062)
      call add_1432_to_1234(one, X1063, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1063)
      call mem%alloc(X1064, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         four, &
         gxxxI_vvo, &
         wf%n_v**2, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1064, &
         wf%n_v**2)
!
      call mem%alloc(X1065, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(X1064, X1065, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X1064)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1065, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1065)
      call mem%alloc(X1066, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         L_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1066, 1)
!
      call mem%alloc(X1067, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1066, X1067, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1066)
      call mem%alloc(X1068, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1067, &
         wf%n_v, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1068, &
         wf%n_v)
!
      call mem%dealloc(X1067)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1068, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1068)
      call mem%alloc(X1069, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1069, 1)
!
      call mem%alloc(X1070, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1069, X1070, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1069)
      call mem%alloc(X1071, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1070, &
         wf%n_v, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1071, &
         wf%n_v)
!
      call mem%dealloc(X1070)
      call mem%alloc(X1072, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1071, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1072, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1071)
      call add_1432_to_1234(one, X1072, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1072)
      call mem%alloc(X1073, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1073, 1)
!
      call mem%alloc(X1074, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1074, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1075, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1073, &
         wf%n_v, &
         X1074, &
         wf%n_v*wf%n_o, &
         zero, &
         X1075, &
         wf%n_v)
!
      call mem%dealloc(X1073)
      call mem%dealloc(X1074)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1075, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1075)
      call mem%alloc(X1076, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -four, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1076, 1)
!
      call mem%alloc(X1077, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1076, X1077, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1076)
      call mem%alloc(X1078, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1077, &
         wf%n_v*wf%n_o, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1078, &
         wf%n_o)
!
      call mem%dealloc(X1077)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1078, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1078)
      call mem%alloc(X1079, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1079, 1)
!
      call mem%alloc(X1080, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1079, X1080, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1079)
      call mem%alloc(X1081, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1080, &
         wf%n_v*wf%n_o, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1081, &
         wf%n_o)
!
      call mem%dealloc(X1080)
      call mem%alloc(X1082, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1081, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1082, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1081)
      call add_1432_to_1234(one, X1082, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1082)
      call mem%alloc(X1083, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1083, 1)
!
      call mem%alloc(X1084, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1084, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1085, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1083, &
         wf%n_v*wf%n_o, &
         X1084, &
         wf%n_v*wf%n_o, &
         zero, &
         X1085, &
         wf%n_o)
!
      call mem%dealloc(X1083)
      call mem%dealloc(X1084)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1085, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1085)
      call mem%alloc(X1086, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         four, &
         tAxxI_ov, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1086, &
         wf%n_o)
!
      call mem%alloc(X1087, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1086, X1087, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1086)
      call mem%alloc(X1088, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         X1087, &
         wf%n_o**2, &
         zero, &
         X1088, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1087)
      call mem%alloc(X1089, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1088, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1089, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1088)
      call add_1243_to_1234(one, X1089, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1089)
      call mem%alloc(X1090, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAxxI_ov, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1090, &
         wf%n_o)
!
      call mem%alloc(X1091, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1090, X1091, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1090)
      call mem%alloc(X1092, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         X1091, &
         wf%n_o**2, &
         zero, &
         X1092, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1091)
      call mem%alloc(X1093, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1092, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1093, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1092)
      call add_1423_to_1234(one, X1093, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1093)
      call mem%alloc(X1094, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1094, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1095, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1095, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1096, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1095, &
         wf%n_v*wf%n_o, &
         X1094, &
         wf%n_v*wf%n_o, &
         zero, &
         X1096, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1094)
      call mem%dealloc(X1095)
      call mem%alloc(X1097, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1096, X1097, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1096)
      call mem%alloc(X1098, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1097, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1098, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1097)
      call add_1243_to_1234(one, X1098, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1098)
      call mem%alloc(X1099, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(L_ovov, X1099, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1100, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(r_vovo, X1100, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1101, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1100, &
         wf%n_v**2, &
         X1099, &
         wf%n_o**2, &
         zero, &
         X1101, &
         wf%n_o**2)
!
      call mem%dealloc(X1099)
      call mem%dealloc(X1100)
      call mem%alloc(X1102, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**3, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X1101, &
         wf%n_o**3, &
         zero, &
         X1102, &
         wf%n_v)
!
      call mem%dealloc(X1101)
      call mem%alloc(X1103, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1102, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1103, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1102)
      call add_1243_to_1234(one, X1103, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1103)
      call mem%alloc(X1104, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -four, &
         tAIxx_vo, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1104, &
         wf%n_o)
!
      call mem%alloc(X1105, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1104, X1105, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1104)
      call mem%alloc(X1106, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         X1105, &
         wf%n_o**2, &
         zero, &
         X1106, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1105)
      call mem%alloc(X1107, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1106, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1107, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1106)
      call add_1243_to_1234(one, X1107, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1107)
      call mem%alloc(X1108, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1108, &
         wf%n_o)
!
      call mem%alloc(X1109, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1108, X1109, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1108)
      call mem%alloc(X1110, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         X1109, &
         wf%n_o**2, &
         zero, &
         X1110, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1109)
      call mem%alloc(X1111, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1110, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1111, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1110)
      call add_1423_to_1234(one, X1111, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1111)
      call mem%alloc(X1112, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1112, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1113, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1113, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1114, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1113, &
         wf%n_v*wf%n_o, &
         X1112, &
         wf%n_v*wf%n_o, &
         zero, &
         X1114, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1112)
      call mem%dealloc(X1113)
      call mem%alloc(X1115, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1114, X1115, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1114)
      call mem%alloc(X1116, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1115, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1116, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1115)
      call add_1243_to_1234(one, X1116, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1116)
      call mem%alloc(X1117, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1117, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1118, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1117, &
         wf%n_v*wf%n_o, &
         zero, &
         X1118, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1117)
      call mem%alloc(X1119, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1118, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1119, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1118)
      call mem%alloc(X1120, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1119, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1120, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1119)
      call add_1243_to_1234(one, X1120, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1120)
      call mem%alloc(X1121, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         txIxI_vv, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1121, &
         wf%n_v)
!
      call mem%alloc(X1122, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1121, X1122, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1121)
      call mem%alloc(X1123, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         X1122, &
         wf%n_v*wf%n_o, &
         zero, &
         X1123, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1122)
      call mem%alloc(X1124, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1123, &
         wf%n_v**2*wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1124, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1123)
      call add_1432_to_1234(one, X1124, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1124)
      call mem%alloc(X1125, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1125, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1126, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1125, &
         wf%n_v*wf%n_o, &
         zero, &
         X1126, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1125)
      call mem%alloc(X1127, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1342(X1126, X1127, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X1126)
      call mem%alloc(X1128, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1127, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1128, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1127)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1128, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1128)
      call mem%alloc(X1129, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         four, &
         tAxxI_ov, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1129, &
         wf%n_o)
!
      call mem%alloc(X1130, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1129, X1130, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1129)
      call mem%alloc(X1131, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         X1130, &
         wf%n_o**2, &
         zero, &
         X1131, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1130)
      call mem%alloc(X1132, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1131, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1132, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1131)
      call add_1243_to_1234(one, X1132, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1132)
      call mem%alloc(X1133, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAxxI_ov, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1133, &
         wf%n_o)
!
      call mem%alloc(X1134, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1133, X1134, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1133)
      call mem%alloc(X1135, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v*wf%n_o, &
         X1134, &
         wf%n_o**2, &
         zero, &
         X1135, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1134)
      call mem%alloc(X1136, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1135, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1136, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1135)
      call add_1423_to_1234(one, X1136, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1136)
      call mem%alloc(X1137, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1137, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1138, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1138, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1139, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1138, &
         wf%n_v*wf%n_o, &
         X1137, &
         wf%n_v*wf%n_o, &
         zero, &
         X1139, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1137)
      call mem%dealloc(X1138)
      call mem%alloc(X1140, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1139, X1140, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1139)
      call mem%alloc(X1141, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1140, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1141, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1140)
      call add_1243_to_1234(one, X1141, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1141)
      call mem%alloc(X1142, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X1142, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1143, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X1142, &
         wf%n_v*wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1143, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1142)
      call mem%alloc(X1144, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1243(X1143, X1144, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1143)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         rAIAI, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X1144, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1144)
      call mem%alloc(X1145, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(t_aibj, X1145, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1146, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1145, &
         wf%n_v*wf%n_o, &
         zero, &
         X1146, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1145)
      call mem%alloc(X1147, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X1147, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1148, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         rAIAI, &
         X1146, &
         wf%n_v*wf%n_o, &
         X1147, &
         wf%n_v*wf%n_o, &
         zero, &
         X1148, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1146)
      call mem%dealloc(X1147)
      call add_1432_to_1234(rAIAI, X1148, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1148)
      call mem%alloc(X1149, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1149, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1150, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1149, &
         wf%n_v, &
         zero, &
         X1150, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1149)
      call mem%alloc(X1151, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2, &
         one, &
         X1150, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1151, 1)
!
      call mem%dealloc(X1150)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1151, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1151)
      call mem%alloc(X1152, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(L_ovov, X1152, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1153, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X1152, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X1153, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1152)
      call mem%alloc(X1154, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2, &
         one, &
         X1153, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1154, 1)
!
      call mem%dealloc(X1153)
      call mem%alloc(X1155, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(u_aibj, X1155, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1156, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1155, &
         wf%n_v*wf%n_o**2, &
         X1154, &
         wf%n_v, &
         zero, &
         X1156, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1154)
      call mem%dealloc(X1155)
      call add_1243_to_1234(one, X1156, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1156)
      call mem%alloc(X1157, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1157, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1158, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1157, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1158, &
         wf%n_v)
!
      call mem%dealloc(X1157)
      call mem%alloc(X1159, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1158, X1159, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1158)
      call mem%alloc(X1160, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1159, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1160, &
         wf%n_v)
!
      call mem%dealloc(X1159)
      call mem%alloc(X1161, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1160, 1, &
         rAIAx_o, 1, &
         X1161, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1160)
      call add_1342_to_1234(one, X1161, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1161)
      call mem%alloc(X1162, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X1162, 1)
!
      call mem%alloc(X1163, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1162, X1163, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1162)
      call mem%alloc(X1164, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1163, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1164, &
         wf%n_o)
!
      call mem%dealloc(X1163)
      call mem%alloc(X1165, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X1164, &
         wf%n_o, &
         zero, &
         X1165, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1164)
      call add_1432_to_1234(one, X1165, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1165)
      call mem%alloc(X1166, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1166, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1167, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1166, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1167, &
         wf%n_o)
!
      call mem%dealloc(X1166)
      call mem%alloc(X1168, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X1167, X1168, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1167)
      call mem%alloc(X1169, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1168, &
         wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1169, &
         wf%n_o)
!
      call mem%dealloc(X1168)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1169, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1169)
      call mem%alloc(X1170, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X1170, 1)
!
      call mem%alloc(X1171, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1170, X1171, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1170)
      call mem%alloc(X1172, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1171, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1172, &
         wf%n_o)
!
      call mem%dealloc(X1171)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X1172, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1172)
      call mem%alloc(X1173, wf%n_o, wf%n_v)
      call sort_to_21(rAIxx_vo, X1173, wf%n_v, wf%n_o)
      call mem%alloc(X1174, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1173, 1, &
         zero, &
         X1174, 1)
!
      call mem%dealloc(X1173)
      call mem%alloc(X1175, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1175, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1176, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1174, &
         wf%n_o, &
         X1175, &
         wf%n_v*wf%n_o, &
         zero, &
         X1176, &
         wf%n_o)
!
      call mem%dealloc(X1174)
      call mem%dealloc(X1175)
      call mem%alloc(X1177, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1176, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1177, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1176)
      call add_1423_to_1234(one, X1177, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1177)
      call mem%alloc(X1178, wf%n_o, wf%n_v)
      call sort_to_21(rAIxx_vo, X1178, wf%n_v, wf%n_o)
      call mem%alloc(X1179, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1178, 1, &
         zero, &
         X1179, 1)
!
      call mem%dealloc(X1178)
      call mem%alloc(X1180, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X1180, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1181, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1179, &
         wf%n_o, &
         X1180, &
         wf%n_o**2, &
         zero, &
         X1181, &
         wf%n_o)
!
      call mem%dealloc(X1179)
      call mem%dealloc(X1180)
      call mem%alloc(X1182, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X1181, &
         wf%n_o, &
         zero, &
         X1182, &
         wf%n_v**2)
!
      call mem%dealloc(X1181)
      call add_1324_to_1234(one, X1182, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1182)
      call mem%alloc(X1183, wf%n_o, wf%n_v)
      call sort_to_21(rAIxx_vo, X1183, wf%n_v, wf%n_o)
      call mem%alloc(X1184, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1183, 1, &
         zero, &
         X1184, 1)
!
      call mem%dealloc(X1183)
      call mem%alloc(X1185, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1184, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1185, &
         wf%n_o)
!
      call mem%dealloc(X1184)
      call mem%alloc(X1186, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X1185, &
         wf%n_o, &
         zero, &
         X1186, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1185)
      call add_1432_to_1234(one, X1186, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1186)
      call mem%alloc(X1187, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1187, wf%n_v, wf%n_o)
      call mem%alloc(X1188, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1187, 1, &
         zero, &
         X1188, 1)
!
      call mem%dealloc(X1187)
      call mem%alloc(X1189, wf%n_v, wf%n_o)
      call sort_to_21(X1188, X1189, wf%n_o, wf%n_v)
      call mem%dealloc(X1188)
      call mem%alloc(X1190, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1189, 1, &
         zero, &
         X1190, 1)
!
      call mem%dealloc(X1189)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1190, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1190)
      call mem%alloc(X1191, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1191, wf%n_v, wf%n_o)
      call mem%alloc(X1192, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1191, 1, &
         zero, &
         X1192, 1)
!
      call mem%dealloc(X1191)
      call mem%alloc(X1193, wf%n_v, wf%n_o)
      call sort_to_21(X1192, X1193, wf%n_o, wf%n_v)
      call mem%dealloc(X1192)
      call mem%alloc(X1194, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1193, 1, &
         zero, &
         X1194, 1)
!
      call mem%dealloc(X1193)
      call mem%alloc(X1195, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1194, 1, &
         X1195, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1194)
      call add_1432_to_1234(one, X1195, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1195)
      call mem%alloc(X1196, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1196, wf%n_v, wf%n_o)
      call mem%alloc(X1197, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1196, 1, &
         zero, &
         X1197, 1)
!
      call mem%dealloc(X1196)
      call mem%alloc(X1198, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1197, &
         wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1198, &
         wf%n_v)
!
      call mem%dealloc(X1197)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1198, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1198)
      call mem%alloc(X1199, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1199, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1200, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_2134(X1199, X1200, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1199)
      call mem%alloc(X1201, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1200, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1201, &
         wf%n_o**2)
!
      call mem%dealloc(X1200)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1201, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1201)
      call mem%alloc(X1202, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1202, wf%n_v, wf%n_o)
      call mem%alloc(X1203, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1202, 1, &
         zero, &
         X1203, 1)
!
      call mem%dealloc(X1202)
      call mem%alloc(X1204, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1203, &
         wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1204, &
         wf%n_o)
!
      call mem%dealloc(X1203)
      call mem%alloc(X1205, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1205, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1206, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1205, &
         wf%n_v**2*wf%n_o, &
         X1204, &
         wf%n_o, &
         zero, &
         X1206, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1204)
      call mem%dealloc(X1205)
      call add_1342_to_1234(one, X1206, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1206)
      call mem%alloc(X1207, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1207, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1208, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_2134(X1207, X1208, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1207)
      call mem%alloc(X1209, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1208, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1209, &
         wf%n_o**2)
!
      call mem%dealloc(X1208)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X1209, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1209)
      call mem%alloc(X1210, wf%n_o, wf%n_v)
      call sort_to_21(rAIxx_vo, X1210, wf%n_v, wf%n_o)
      call mem%alloc(X1211, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1210, 1, &
         zero, &
         X1211, 1)
!
      call mem%dealloc(X1210)
      call mem%alloc(X1212, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1211, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1212, &
         wf%n_o)
!
      call mem%dealloc(X1211)
      call mem%alloc(X1213, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1213, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1214, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1213, &
         wf%n_v**2*wf%n_o, &
         X1212, &
         wf%n_o, &
         zero, &
         X1214, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1212)
      call mem%dealloc(X1213)
      call add_1342_to_1234(one, X1214, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1214)
      call mem%alloc(X1215, wf%n_o, wf%n_v)
      call sort_to_21(rAIxx_vo, X1215, wf%n_v, wf%n_o)
      call mem%alloc(X1216, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1215, 1, &
         zero, &
         X1216, 1)
!
      call mem%dealloc(X1215)
      call mem%alloc(X1217, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1216, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1217, &
         wf%n_v)
!
      call mem%dealloc(X1216)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1217, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1217)
      call mem%alloc(X1218, wf%n_o, wf%n_v)
      call sort_to_21(rAIxx_vo, X1218, wf%n_v, wf%n_o)
      call mem%alloc(X1219, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1218, 1, &
         zero, &
         X1219, 1)
!
      call mem%dealloc(X1218)
      call mem%alloc(X1220, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1219, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1220, &
         wf%n_o)
!
      call mem%dealloc(X1219)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X1220, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1220)
      call mem%alloc(X1221, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1243(L_ovov, X1221, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1222, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1221, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1222, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1221)
      call mem%alloc(X1223, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1222, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1223, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1222)
      call mem%alloc(X1224, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X1223, &
         wf%n_v, &
         zero, &
         X1224, &
         wf%n_v)
!
      call mem%dealloc(X1223)
      call add_1342_to_1234(one, X1224, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1224)
      call mem%alloc(X1225, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txxxI_vov, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1225, &
         wf%n_v)
!
      call mem%alloc(X1226, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1225, X1226, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1225)
      call mem%alloc(X1227, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v, &
         X1226, &
         wf%n_v, &
         zero, &
         X1227, &
         wf%n_v)
!
      call mem%dealloc(X1226)
      call mem%alloc(X1228, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X1227, 1, &
         rAxAx_oo, 1, &
         X1228, &
         wf%n_v**2)
!
      call mem%dealloc(X1227)
      call add_1324_to_1234(one, X1228, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1228)
      call mem%alloc(X1229, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X1229, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1230, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_2134(X1229, X1230, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1229)
      call mem%alloc(X1231, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1230, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1231, &
         wf%n_o**2)
!
      call mem%dealloc(X1230)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X1231, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1231)
      call mem%alloc(X1232, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1232, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1233, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_2134(X1232, X1233, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1232)
      call mem%alloc(X1234, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1233, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1234, &
         wf%n_o**2)
!
      call mem%dealloc(X1233)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X1234, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1234)
      call mem%alloc(X1235, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X1235, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1236, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_2134(X1235, X1236, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1235)
      call mem%alloc(X1237, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1236, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1237, &
         wf%n_o**2)
!
      call mem%dealloc(X1236)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X1237, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1237)
      call mem%alloc(X1238, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1238, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1239, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_2134(X1238, X1239, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1238)
      call mem%alloc(X1240, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1239, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1240, &
         wf%n_o**2)
!
      call mem%dealloc(X1239)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X1240, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1240)
      call mem%alloc(X1241, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1241, wf%n_v, wf%n_o)
      call mem%alloc(X1242, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1241, 1, &
         zero, &
         X1242, 1)
!
      call mem%dealloc(X1241)
      call mem%alloc(X1243, wf%n_v, wf%n_o)
      call sort_to_21(X1242, X1243, wf%n_o, wf%n_v)
      call mem%dealloc(X1242)
      call mem%alloc(X1244, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1243, 1, &
         zero, &
         X1244, 1)
!
      call mem%dealloc(X1243)
      call mem%alloc(X1245, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X1245, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1245, 1, &
         X1244, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1244)
      call mem%dealloc(X1245)
      call mem%alloc(X1246, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1246, 1)
!
      call mem%alloc(X1247, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1246, X1247, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1246)
      call mem%alloc(X1248, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1247, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1248, &
         wf%n_o)
!
      call mem%dealloc(X1247)
      call mem%alloc(X1249, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X1249, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1249, &
         wf%n_v*wf%n_o, &
         X1248, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1248)
      call mem%dealloc(X1249)
      call mem%alloc(X1250, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1250, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1251, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1250, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1251, &
         wf%n_o)
!
      call mem%dealloc(X1250)
      call mem%alloc(X1252, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1251, &
         wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1252, 1)
!
      call mem%dealloc(X1251)
      call mem%alloc(X1253, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1253, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1254, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1253, &
         wf%n_v**2*wf%n_o, &
         X1252, &
         wf%n_o, &
         zero, &
         X1254, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1252)
      call mem%dealloc(X1253)
      call add_1342_to_1234(one, X1254, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1254)
      call mem%alloc(X1255, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -four, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1255, 1)
!
      call mem%alloc(X1256, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1255, X1256, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1255)
      call mem%alloc(X1257, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1256, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1257, &
         wf%n_o)
!
      call mem%dealloc(X1256)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X1257, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1257)
      call mem%alloc(X1258, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1258, 1)
!
      call mem%alloc(X1259, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1258, X1259, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1258)
      call mem%alloc(X1260, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1259, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1260, &
         wf%n_o)
!
      call mem%dealloc(X1259)
      call mem%alloc(X1261, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X1260, &
         wf%n_o, &
         zero, &
         X1261, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1260)
      call add_1432_to_1234(one, X1261, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1261)
      call mem%alloc(X1262, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1262, 1)
!
      call mem%alloc(X1263, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(X1262, X1263, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1262)
      call mem%alloc(X1264, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1264, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1265, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1263, &
         wf%n_o**2, &
         X1264, &
         wf%n_o**2, &
         zero, &
         X1265, &
         wf%n_v)
!
      call mem%dealloc(X1263)
      call mem%dealloc(X1264)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1265, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1265)
      call mem%alloc(X1266, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(L_ovov, X1266, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1267, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1266, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1267, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1266)
      call mem%alloc(X1268, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1267, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X1268, 1)
!
      call mem%dealloc(X1267)
      call mem%alloc(X1269, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1269, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1270, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1269, &
         wf%n_v**2*wf%n_o, &
         X1268, &
         wf%n_o, &
         zero, &
         X1270, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1268)
      call mem%dealloc(X1269)
      call add_1342_to_1234(one, X1270, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1270)
      call mem%alloc(X1271, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1271, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1272, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1271, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1272, &
         wf%n_o)
!
      call mem%dealloc(X1271)
      call mem%alloc(X1273, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X1272, &
         wf%n_o**2, &
         zero, &
         X1273, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1272)
      call mem%alloc(X1274, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1273, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1274, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1273)
      call add_1423_to_1234(one, X1274, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1274)
      call mem%alloc(X1275, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1275, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1276, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1275, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1276, &
         wf%n_o)
!
      call mem%dealloc(X1275)
      call mem%alloc(X1277, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X1276, &
         wf%n_o**2, &
         zero, &
         X1277, &
         wf%n_o)
!
      call mem%dealloc(X1276)
      call mem%alloc(X1278, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X1278, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1279, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X1278, &
         wf%n_v**2, &
         X1277, &
         wf%n_o**2, &
         zero, &
         X1279, &
         wf%n_v**2)
!
      call mem%dealloc(X1277)
      call mem%dealloc(X1278)
      call add_1342_to_1234(one, X1279, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1279)
      call mem%alloc(X1280, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1280, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1281, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1280, &
         wf%n_o, &
         zero, &
         X1281, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1280)
      call mem%alloc(X1282, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X1281, X1282, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1281)
      call mem%alloc(X1283, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1282, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1283, &
         wf%n_o**2)
!
      call mem%dealloc(X1282)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X1283, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1283)
      call mem%alloc(X1284, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1284, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1285, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1284, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1285, &
         wf%n_o)
!
      call mem%dealloc(X1284)
      call mem%alloc(X1286, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X1285, &
         wf%n_o**2, &
         zero, &
         X1286, &
         wf%n_o)
!
      call mem%dealloc(X1285)
      call mem%alloc(X1287, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X1287, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1288, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X1287, &
         wf%n_v**2, &
         X1286, &
         wf%n_o**2, &
         zero, &
         X1288, &
         wf%n_v**2)
!
      call mem%dealloc(X1286)
      call mem%dealloc(X1287)
      call add_1342_to_1234(one, X1288, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1288)
      call mem%alloc(X1289, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1289, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1290, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1289, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1290, &
         wf%n_o)
!
      call mem%dealloc(X1289)
      call mem%alloc(X1291, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X1290, &
         wf%n_o**2, &
         zero, &
         X1291, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1290)
      call mem%alloc(X1292, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1291, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1292, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1291)
      call add_1423_to_1234(one, X1292, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1292)
      call mem%alloc(X1293, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1293, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1294, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1293, &
         wf%n_o, &
         zero, &
         X1294, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1293)
      call mem%alloc(X1295, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X1294, X1295, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1294)
      call mem%alloc(X1296, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1295, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1296, &
         wf%n_o**2)
!
      call mem%dealloc(X1295)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X1296, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1296)
      call mem%alloc(X1297, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1297, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1298, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1297, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1298, &
         wf%n_o)
!
      call mem%dealloc(X1297)
      call mem%alloc(X1299, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X1298, &
         wf%n_o**2, &
         zero, &
         X1299, &
         wf%n_v)
!
      call mem%dealloc(X1298)
      call mem%alloc(X1300, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X1300, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1301, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1300, &
         wf%n_v*wf%n_o, &
         X1299, &
         wf%n_v*wf%n_o, &
         zero, &
         X1301, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1299)
      call mem%dealloc(X1300)
      call add_1432_to_1234(one, X1301, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1301)
      call mem%alloc(X1302, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1302, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1303, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1302, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1303, &
         wf%n_o)
!
      call mem%dealloc(X1302)
      call mem%alloc(X1304, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X1303, &
         wf%n_o**2, &
         zero, &
         X1304, &
         wf%n_v)
!
      call mem%dealloc(X1303)
      call mem%alloc(X1305, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X1304, &
         wf%n_v*wf%n_o, &
         zero, &
         X1305, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1304)
      call add_1432_to_1234(one, X1305, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1305)
      call mem%alloc(X1306, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1306, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1307, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1306, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1307, &
         wf%n_o)
!
      call mem%dealloc(X1306)
      call mem%alloc(X1308, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X1307, &
         wf%n_o**2, &
         zero, &
         X1308, &
         wf%n_v)
!
      call mem%dealloc(X1307)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1308, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1308)
      call mem%alloc(X1309, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1309, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1310, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1309, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1310, &
         wf%n_o)
!
      call mem%dealloc(X1309)
      call mem%alloc(X1311, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X1310, &
         wf%n_o**2, &
         zero, &
         X1311, &
         wf%n_o)
!
      call mem%dealloc(X1310)
      call mem%alloc(X1312, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X1311, &
         wf%n_o**2, &
         zero, &
         X1312, &
         wf%n_v**2)
!
      call mem%dealloc(X1311)
      call add_1342_to_1234(one, X1312, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1312)
      call mem%alloc(X1313, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X1313, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1314, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1313, &
         wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1314, &
         wf%n_o)
!
      call mem%dealloc(X1313)
      call mem%alloc(X1315, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1315, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1316, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1315, &
         wf%n_v*wf%n_o, &
         X1314, &
         wf%n_o**2, &
         zero, &
         X1316, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1314)
      call mem%dealloc(X1315)
      call mem%alloc(X1317, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1316, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1317, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1316)
      call add_1423_to_1234(one, X1317, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1317)
      call mem%alloc(X1318, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1243(L_ovov, X1318, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1319, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1318, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1319, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1318)
      call mem%alloc(X1320, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1319, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1320, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1319)
      call mem%alloc(X1321, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X1320, &
         wf%n_v, &
         zero, &
         X1321, &
         wf%n_v)
!
      call mem%dealloc(X1320)
      call add_1342_to_1234(one, X1321, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1321)
      call mem%alloc(X1322, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1322, &
         wf%n_o)
!
      call mem%alloc(X1323, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X1322, X1323, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1322)
      call mem%alloc(X1324, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1323, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1324, &
         wf%n_o)
!
      call mem%dealloc(X1323)
      call mem%alloc(X1325, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X1324, 1, &
         X1325, &
         wf%n_v**2)
!
      call mem%dealloc(X1324)
      call add_1342_to_1234(one, X1325, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1325)
      call mem%alloc(X1326, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1326, 1)
!
      call mem%alloc(X1327, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1326, X1327, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1326)
      call mem%alloc(X1328, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1327, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1328, &
         wf%n_v)
!
      call mem%dealloc(X1327)
      call mem%alloc(X1329, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1329, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1329, &
         wf%n_v*wf%n_o, &
         X1328, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1328)
      call mem%dealloc(X1329)
      call mem%alloc(X1330, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1330, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1331, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1330, &
         wf%n_v, &
         zero, &
         X1331, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1330)
      call mem%alloc(X1332, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2, &
         one, &
         X1331, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1332, 1)
!
      call mem%dealloc(X1331)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1332, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1332)
      call mem%alloc(X1333, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(L_ovov, X1333, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1334, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X1333, &
         wf%n_o**2, &
         rxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X1334, &
         wf%n_o**2)
!
      call mem%dealloc(X1333)
      call mem%alloc(X1335, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X1334, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1335, 1)
!
      call mem%dealloc(X1334)
      call mem%alloc(X1336, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1336, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1337, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1336, &
         wf%n_v**2*wf%n_o, &
         X1335, &
         wf%n_o, &
         zero, &
         X1337, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1335)
      call mem%dealloc(X1336)
      call add_1342_to_1234(one, X1337, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1337)
      call mem%alloc(X1338, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1338, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1339, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1338, &
         wf%n_v, &
         zero, &
         X1339, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1338)
      call mem%alloc(X1340, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_132(X1339, X1340, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X1339)
      call mem%alloc(X1341, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X1341, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1342, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1340, &
         wf%n_v*wf%n_o, &
         X1341, &
         wf%n_o**2, &
         zero, &
         X1342, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1340)
      call mem%dealloc(X1341)
      call mem%alloc(X1343, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1342, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1343, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1342)
      call add_1423_to_1234(one, X1343, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1343)
      call mem%alloc(X1344, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1344, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1345, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1344, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1345, &
         wf%n_v)
!
      call mem%dealloc(X1344)
      call mem%alloc(X1346, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1345, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1346, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1345)
      call mem%alloc(X1347, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1346, X1347, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1346)
      call mem%alloc(X1348, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1347, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1348, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1347)
      call add_1432_to_1234(one, X1348, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1348)
      call mem%alloc(X1349, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1349, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1350, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1349, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1350, &
         wf%n_v)
!
      call mem%dealloc(X1349)
      call mem%alloc(X1351, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1350, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1351, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1350)
      call mem%alloc(X1352, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1351, X1352, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1351)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1352, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1352)
      call mem%alloc(X1353, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1353, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1354, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1353, &
         wf%n_v, &
         zero, &
         X1354, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1353)
      call mem%alloc(X1355, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1354, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1355, &
         wf%n_v**2)
!
      call mem%dealloc(X1354)
      call mem%alloc(X1356, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1356, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1357, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1355, &
         wf%n_v, &
         X1356, &
         wf%n_v*wf%n_o, &
         zero, &
         X1357, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1355)
      call mem%dealloc(X1356)
      call add_1432_to_1234(one, X1357, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1357)
      call mem%alloc(X1358, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1358, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1359, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1358, &
         wf%n_v, &
         zero, &
         X1359, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1358)
      call mem%alloc(X1360, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1359, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1360, &
         wf%n_v**2)
!
      call mem%dealloc(X1359)
      call mem%alloc(X1361, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1360, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1361, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1360)
      call add_1432_to_1234(one, X1361, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1361)
      call mem%alloc(X1362, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1362, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1363, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1362, &
         wf%n_v, &
         zero, &
         X1363, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1362)
      call mem%alloc(X1364, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1363, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1364, &
         wf%n_v**2)
!
      call mem%dealloc(X1363)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1364, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1364)
      call mem%alloc(X1365, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1365, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1366, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1365, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1366, &
         wf%n_v)
!
      call mem%dealloc(X1365)
      call mem%alloc(X1367, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1366, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1367, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1366)
      call mem%alloc(X1368, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1367, X1368, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1367)
      call mem%alloc(X1369, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1368, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1369, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1368)
      call add_1432_to_1234(one, X1369, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1369)
      call mem%alloc(X1370, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1370, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1371, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1370, &
         wf%n_v, &
         zero, &
         X1371, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1370)
      call mem%alloc(X1372, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_132(X1371, X1372, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X1371)
      call mem%alloc(X1373, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X1373, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1374, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1372, &
         wf%n_v*wf%n_o, &
         X1373, &
         wf%n_o**2, &
         zero, &
         X1374, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1372)
      call mem%dealloc(X1373)
      call mem%alloc(X1375, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1374, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1375, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1374)
      call add_1423_to_1234(one, X1375, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1375)
      call mem%alloc(X1376, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1376, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1377, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1376, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1377, &
         wf%n_v)
!
      call mem%dealloc(X1376)
      call mem%alloc(X1378, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1377, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1378, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1377)
      call mem%alloc(X1379, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1378, X1379, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1378)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1379, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1379)
      call mem%alloc(X1380, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1380, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1381, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1380, &
         wf%n_v, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1381, &
         wf%n_v)
!
      call mem%dealloc(X1380)
      call mem%alloc(X1382, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1381, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1382, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1381)
      call mem%alloc(X1383, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1382, X1383, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1382)
      call mem%alloc(X1384, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1383, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1384, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1383)
      call add_1423_to_1234(one, X1384, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1384)
      call mem%alloc(X1385, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X1385, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1386, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_v*wf%n_o, &
         X1385, &
         wf%n_v, &
         zero, &
         X1386, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1385)
      call mem%alloc(X1387, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_132(X1386, X1387, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X1386)
      call mem%alloc(X1388, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X1388, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1389, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1387, &
         wf%n_v*wf%n_o, &
         X1388, &
         wf%n_o**2, &
         zero, &
         X1389, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1387)
      call mem%dealloc(X1388)
      call mem%alloc(X1390, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1389, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1390, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1389)
      call add_1243_to_1234(one, X1390, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1390)
      call mem%alloc(X1391, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         L_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1391, 1)
!
      call mem%alloc(X1392, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1391, X1392, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1391)
      call mem%alloc(X1393, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1392, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1393, &
         wf%n_v)
!
      call mem%dealloc(X1392)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X1393, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1393)
      call mem%alloc(X1394, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         L_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1394, 1)
!
      call mem%alloc(X1395, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1394, X1395, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1394)
      call mem%alloc(X1396, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1395, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1396, &
         wf%n_v)
!
      call mem%dealloc(X1395)
      call mem%alloc(X1397, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X1396, &
         wf%n_v, &
         zero, &
         X1397, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1396)
      call add_1432_to_1234(one, X1397, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1397)
      call mem%alloc(X1398, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(L_ovov, X1398, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1399, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rxxxI_vov, &
         wf%n_v, &
         X1398, &
         wf%n_v*wf%n_o, &
         zero, &
         X1399, &
         wf%n_v)
!
      call mem%dealloc(X1398)
      call mem%alloc(X1400, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         one, &
         X1399, &
         wf%n_v**2, &
         tAIAx_o, 1, &
         zero, &
         X1400, 1)
!
      call mem%dealloc(X1399)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1400, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1400)
      call mem%alloc(X1401, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1401, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1402, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1401, &
         wf%n_v, &
         zero, &
         X1402, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1401)
      call mem%alloc(X1403, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2, &
         one, &
         X1402, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1403, 1)
!
      call mem%dealloc(X1402)
      call mem%alloc(X1404, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1404, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1405, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1404, &
         wf%n_v*wf%n_o**2, &
         X1403, &
         wf%n_v, &
         zero, &
         X1405, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1403)
      call mem%dealloc(X1404)
      call add_1243_to_1234(one, X1405, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1405)
      call mem%alloc(X1406, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1406, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1407, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1406, &
         wf%n_v, &
         zero, &
         X1407, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1406)
      call mem%alloc(X1408, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2, &
         one, &
         X1407, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1408, 1)
!
      call mem%dealloc(X1407)
      call mem%alloc(X1409, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1409, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1410, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1409, &
         wf%n_v*wf%n_o**2, &
         X1408, &
         wf%n_v, &
         zero, &
         X1410, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1408)
      call mem%dealloc(X1409)
      call add_1423_to_1234(one, X1410, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1410)
      call mem%alloc(X1411, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1411, 1)
!
      call mem%alloc(X1412, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(r_vovo, X1412, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1413, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1411, &
         wf%n_v*wf%n_o, &
         X1412, &
         wf%n_v*wf%n_o, &
         zero, &
         X1413, &
         wf%n_v)
!
      call mem%dealloc(X1411)
      call mem%dealloc(X1412)
      call mem%alloc(X1414, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1414, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1415, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1413, &
         wf%n_v, &
         X1414, &
         wf%n_v*wf%n_o, &
         zero, &
         X1415, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1413)
      call mem%dealloc(X1414)
      call add_1432_to_1234(one, X1415, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1415)
      call mem%alloc(X1416, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1416, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1417, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(r_vovo, X1417, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1418, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1416, &
         wf%n_o**2, &
         X1417, &
         wf%n_v**2, &
         zero, &
         X1418, &
         wf%n_o**2)
!
      call mem%dealloc(X1416)
      call mem%dealloc(X1417)
      call mem%alloc(X1419, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**3, &
         one, &
         X1418, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1419, 1)
!
      call mem%dealloc(X1418)
      call mem%alloc(X1420, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X1419, &
         wf%n_o, &
         zero, &
         X1420, &
         wf%n_v**2)
!
      call mem%dealloc(X1419)
      call add_1324_to_1234(one, X1420, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1420)
      call mem%alloc(X1421, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1421, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1422, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X1422, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1423, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         four, &
         X1422, &
         wf%n_v**2, &
         X1421, &
         wf%n_o**2, &
         zero, &
         X1423, &
         wf%n_o)
!
      call mem%dealloc(X1421)
      call mem%dealloc(X1422)
      call mem%alloc(X1424, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X1423, &
         wf%n_o**2, &
         tAIAx_o, 1, &
         zero, &
         X1424, 1)
!
      call mem%dealloc(X1423)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1424, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1424)
      call mem%alloc(X1425, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1425, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1426, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         uxxxI_vov, &
         wf%n_v, &
         X1425, &
         wf%n_v*wf%n_o, &
         zero, &
         X1426, &
         wf%n_v)
!
      call mem%dealloc(X1425)
      call mem%alloc(X1427, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         one, &
         X1426, &
         wf%n_v**2, &
         tAIAx_o, 1, &
         zero, &
         X1427, 1)
!
      call mem%dealloc(X1426)
      call mem%alloc(X1428, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1428, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1429, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1428, &
         wf%n_v*wf%n_o**2, &
         X1427, &
         wf%n_v, &
         zero, &
         X1429, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1427)
      call mem%dealloc(X1428)
      call add_1243_to_1234(one, X1429, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1429)
      call mem%alloc(X1430, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1430, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1431, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X1431, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1432, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1431, &
         wf%n_v**2, &
         X1430, &
         wf%n_o**2, &
         zero, &
         X1432, &
         wf%n_o)
!
      call mem%dealloc(X1430)
      call mem%dealloc(X1431)
      call mem%alloc(X1433, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X1432, &
         wf%n_o**2, &
         tAIAx_o, 1, &
         zero, &
         X1433, 1)
!
      call mem%dealloc(X1432)
      call mem%alloc(X1434, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1433, &
         wf%n_o, &
         zero, &
         X1434, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1433)
      call add_1432_to_1234(one, X1434, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1434)
      call mem%alloc(X1435, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1435, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1436, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         uxxxI_vov, &
         wf%n_v, &
         X1435, &
         wf%n_v*wf%n_o, &
         zero, &
         X1436, &
         wf%n_v)
!
      call mem%dealloc(X1435)
      call mem%alloc(X1437, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         one, &
         X1436, &
         wf%n_v**2, &
         tAIAx_o, 1, &
         zero, &
         X1437, 1)
!
      call mem%dealloc(X1436)
      call mem%alloc(X1438, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1438, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1439, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1438, &
         wf%n_v*wf%n_o**2, &
         X1437, &
         wf%n_v, &
         zero, &
         X1439, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1437)
      call mem%dealloc(X1438)
      call add_1423_to_1234(one, X1439, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1439)
      call mem%alloc(X1440, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X1440, 1)
!
      call mem%alloc(X1441, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1441, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1442, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1440, &
         wf%n_v, &
         X1441, &
         wf%n_v*wf%n_o, &
         zero, &
         X1442, &
         wf%n_v)
!
      call mem%dealloc(X1440)
      call mem%dealloc(X1441)
      call mem%alloc(X1443, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1442, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1443, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1442)
      call add_1432_to_1234(one, X1443, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1443)
      call mem%alloc(X1444, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1444, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1445, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X1444, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1445, &
         wf%n_o)
!
      call mem%dealloc(X1444)
      call mem%alloc(X1446, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1445, &
         wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1446, 1)
!
      call mem%dealloc(X1445)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1446, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1446)
      call mem%alloc(X1447, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1447, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1448, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X1447, &
         wf%n_v*wf%n_o, &
         zero, &
         X1448, &
         wf%n_o)
!
      call mem%dealloc(X1447)
      call mem%alloc(X1449, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1448, &
         wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1449, 1)
!
      call mem%dealloc(X1448)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1449, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1449)
      call mem%alloc(X1450, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         four, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1450, 1)
!
      call mem%alloc(X1451, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(X1450, X1451, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1450)
      call mem%alloc(X1452, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1452, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1453, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1451, &
         wf%n_o**2, &
         X1452, &
         wf%n_o**2, &
         zero, &
         X1453, &
         wf%n_v)
!
      call mem%dealloc(X1451)
      call mem%dealloc(X1452)
      call mem%alloc(X1454, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1454, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1455, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1454, &
         wf%n_v*wf%n_o**2, &
         X1453, &
         wf%n_v, &
         zero, &
         X1455, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1453)
      call mem%dealloc(X1454)
      call add_1243_to_1234(one, X1455, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1455)
      call mem%alloc(X1456, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1456, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1457, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1456, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1457, &
         wf%n_o)
!
      call mem%dealloc(X1456)
      call mem%alloc(X1458, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1457, &
         wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1458, 1)
!
      call mem%dealloc(X1457)
      call mem%alloc(X1459, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1458, &
         wf%n_o, &
         zero, &
         X1459, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1458)
      call add_1432_to_1234(one, X1459, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1459)
      call mem%alloc(X1460, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1460, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1461, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X1460, &
         wf%n_v*wf%n_o, &
         zero, &
         X1461, &
         wf%n_o)
!
      call mem%dealloc(X1460)
      call mem%alloc(X1462, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1461, &
         wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1462, 1)
!
      call mem%dealloc(X1461)
      call mem%alloc(X1463, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1462, &
         wf%n_o, &
         zero, &
         X1463, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1462)
      call add_1432_to_1234(one, X1463, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1463)
      call mem%alloc(X1464, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1464, 1)
!
      call mem%alloc(X1465, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(X1464, X1465, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1464)
      call mem%alloc(X1466, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1466, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1467, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1465, &
         wf%n_o**2, &
         X1466, &
         wf%n_o**2, &
         zero, &
         X1467, &
         wf%n_v)
!
      call mem%dealloc(X1465)
      call mem%dealloc(X1466)
      call mem%alloc(X1468, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1468, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1469, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1468, &
         wf%n_v*wf%n_o**2, &
         X1467, &
         wf%n_v, &
         zero, &
         X1469, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1467)
      call mem%dealloc(X1468)
      call add_1423_to_1234(one, X1469, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1469)
      call mem%alloc(X1470, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1470, 1)
!
      call mem%alloc(X1471, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X1470, X1471, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1470)
      call mem%alloc(X1472, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1472, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1473, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1472, &
         wf%n_o**2, &
         X1471, &
         wf%n_o**2, &
         zero, &
         X1473, &
         wf%n_o**2)
!
      call mem%dealloc(X1471)
      call mem%dealloc(X1472)
      call mem%alloc(X1474, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1473, X1474, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1473)
      call mem%alloc(X1475, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(r_vovo, X1475, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1476, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X1475, &
         wf%n_v**2, &
         X1474, &
         wf%n_o**2, &
         zero, &
         X1476, &
         wf%n_v**2)
!
      call mem%dealloc(X1474)
      call mem%dealloc(X1475)
      call add_1324_to_1234(one, X1476, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1476)
      call mem%alloc(X1477, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1477, 1)
!
      call mem%alloc(X1478, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1478, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1479, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1477, &
         wf%n_v*wf%n_o, &
         X1478, &
         wf%n_v*wf%n_o, &
         zero, &
         X1479, &
         wf%n_o)
!
      call mem%dealloc(X1477)
      call mem%dealloc(X1478)
      call mem%alloc(X1480, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1479, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1480, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1479)
      call add_1432_to_1234(one, X1480, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1480)
      call mem%alloc(X1481, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X1481, 1)
!
      call mem%alloc(X1482, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(r_vovo, X1482, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1483, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1481, &
         wf%n_o, &
         X1482, &
         wf%n_v*wf%n_o, &
         zero, &
         X1483, &
         wf%n_o)
!
      call mem%dealloc(X1481)
      call mem%dealloc(X1482)
      call mem%alloc(X1484, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1483, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1484, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1483)
      call add_1423_to_1234(one, X1484, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1484)
      call mem%alloc(X1485, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1485, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1486, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X1485, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X1486, 1)
!
      call mem%dealloc(X1485)
      call mem%alloc(X1487, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1486, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1487, &
         wf%n_o)
!
      call mem%dealloc(X1486)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1487, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1487)
      call mem%alloc(X1488, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1488, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1489, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X1488, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X1489, 1)
!
      call mem%dealloc(X1488)
      call mem%alloc(X1490, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1489, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1490, &
         wf%n_v)
!
      call mem%dealloc(X1489)
      call mem%alloc(X1491, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1491, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1492, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1491, &
         wf%n_v*wf%n_o**2, &
         X1490, &
         wf%n_v, &
         zero, &
         X1492, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1490)
      call mem%dealloc(X1491)
      call add_1243_to_1234(one, X1492, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1492)
      call mem%alloc(X1493, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1493, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1494, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1493, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X1494, 1)
!
      call mem%dealloc(X1493)
      call mem%alloc(X1495, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1494, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1495, &
         wf%n_o)
!
      call mem%dealloc(X1494)
      call mem%alloc(X1496, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1495, &
         wf%n_o, &
         zero, &
         X1496, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1495)
      call add_1432_to_1234(one, X1496, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1496)
      call mem%alloc(X1497, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1497, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1498, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1497, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X1498, 1)
!
      call mem%dealloc(X1497)
      call mem%alloc(X1499, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1498, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1499, &
         wf%n_v)
!
      call mem%dealloc(X1498)
      call mem%alloc(X1500, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1500, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1501, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1500, &
         wf%n_v*wf%n_o**2, &
         X1499, &
         wf%n_v, &
         zero, &
         X1501, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1499)
      call mem%dealloc(X1500)
      call add_1423_to_1234(one, X1501, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1501)
      call mem%alloc(X1502, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1502, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1503, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(X1502, X1503, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1502)
      call mem%alloc(X1504, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**3, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1503, &
         wf%n_o**3, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1504, &
         wf%n_o**3)
!
      call mem%dealloc(X1503)
      call mem%alloc(X1505, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(r_vovo, X1505, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1506, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X1505, &
         wf%n_v**2, &
         X1504, &
         wf%n_o**2, &
         zero, &
         X1506, &
         wf%n_v**2)
!
      call mem%dealloc(X1504)
      call mem%dealloc(X1505)
      call add_1342_to_1234(one, X1506, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1506)
      call mem%alloc(X1507, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1507, &
         wf%n_o)
!
      call mem%alloc(X1508, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(X1507, X1508, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1507)
      call mem%alloc(X1509, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**3, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X1508, &
         wf%n_o**3, &
         zero, &
         X1509, &
         wf%n_o)
!
      call mem%dealloc(X1508)
      call mem%alloc(X1510, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(r_vovo, X1510, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1511, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X1510, &
         wf%n_v**2, &
         X1509, &
         wf%n_o**2, &
         zero, &
         X1511, &
         wf%n_v**2)
!
      call mem%dealloc(X1509)
      call mem%dealloc(X1510)
      call add_1324_to_1234(one, X1511, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1511)
      call mem%alloc(X1512, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1512, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1513, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1513, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1514, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1513, &
         wf%n_v*wf%n_o, &
         X1512, &
         wf%n_v*wf%n_o, &
         zero, &
         X1514, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1512)
      call mem%dealloc(X1513)
      call mem%alloc(X1515, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1514, X1515, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1514)
      call mem%alloc(X1516, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1515, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1516, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1515)
      call add_1423_to_1234(one, X1516, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1516)
      call mem%alloc(X1517, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1517, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1518, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X1517, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, 1, &
         zero, &
         X1518, 1)
!
      call mem%dealloc(X1517)
      call mem%alloc(X1519, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1518, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1519, &
         wf%n_o)
!
      call mem%dealloc(X1518)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1519, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1519)
      call mem%alloc(X1520, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1520, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1521, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X1520, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X1521, 1)
!
      call mem%dealloc(X1520)
      call mem%alloc(X1522, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1521, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1522, &
         wf%n_v)
!
      call mem%dealloc(X1521)
      call mem%alloc(X1523, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1523, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1524, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1523, &
         wf%n_v*wf%n_o**2, &
         X1522, &
         wf%n_v, &
         zero, &
         X1524, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1522)
      call mem%dealloc(X1523)
      call add_1243_to_1234(one, X1524, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1524)
      call mem%alloc(X1525, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1525, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1526, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1525, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, 1, &
         zero, &
         X1526, 1)
!
      call mem%dealloc(X1525)
      call mem%alloc(X1527, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1526, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1527, &
         wf%n_o)
!
      call mem%dealloc(X1526)
      call mem%alloc(X1528, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1527, &
         wf%n_o, &
         zero, &
         X1528, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1527)
      call add_1432_to_1234(one, X1528, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1528)
      call mem%alloc(X1529, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1529, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1530, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1529, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X1530, 1)
!
      call mem%dealloc(X1529)
      call mem%alloc(X1531, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1530, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1531, &
         wf%n_v)
!
      call mem%dealloc(X1530)
      call mem%alloc(X1532, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1532, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1533, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1532, &
         wf%n_v*wf%n_o**2, &
         X1531, &
         wf%n_v, &
         zero, &
         X1533, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1531)
      call mem%dealloc(X1532)
      call add_1423_to_1234(one, X1533, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1533)
      call mem%alloc(X1534, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X1534, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1535, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1535, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1536, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1535, &
         wf%n_v*wf%n_o, &
         X1534, &
         wf%n_v*wf%n_o, &
         zero, &
         X1536, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1534)
      call mem%dealloc(X1535)
      call mem%alloc(X1537, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1536, X1537, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1536)
      call mem%alloc(X1538, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1537, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1538, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1537)
      call add_1423_to_1234(one, X1538, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1538)
      call mem%alloc(X1539, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1539, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1540, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         -four, &
         X1539, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X1540, 1)
!
      call mem%dealloc(X1539)
      call mem%alloc(X1541, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1540, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1541, &
         wf%n_o)
!
      call mem%dealloc(X1540)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1541, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1541)
      call mem%alloc(X1542, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1542, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1543, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         -four, &
         X1542, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X1543, 1)
!
      call mem%dealloc(X1542)
      call mem%alloc(X1544, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1543, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1544, &
         wf%n_v)
!
      call mem%dealloc(X1543)
      call mem%alloc(X1545, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1545, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1546, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1545, &
         wf%n_v*wf%n_o**2, &
         X1544, &
         wf%n_v, &
         zero, &
         X1546, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1544)
      call mem%dealloc(X1545)
      call add_1243_to_1234(one, X1546, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1546)
      call mem%alloc(X1547, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1547, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1548, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X1547, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X1548, 1)
!
      call mem%dealloc(X1547)
      call mem%alloc(X1549, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1548, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1549, &
         wf%n_o)
!
      call mem%dealloc(X1548)
      call mem%alloc(X1550, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1549, &
         wf%n_o, &
         zero, &
         X1550, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1549)
      call add_1432_to_1234(one, X1550, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1550)
      call mem%alloc(X1551, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1551, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1552, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X1551, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X1552, 1)
!
      call mem%dealloc(X1551)
      call mem%alloc(X1553, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1552, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1553, &
         wf%n_v)
!
      call mem%dealloc(X1552)
      call mem%alloc(X1554, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1554, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1555, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1554, &
         wf%n_v*wf%n_o**2, &
         X1553, &
         wf%n_v, &
         zero, &
         X1555, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1553)
      call mem%dealloc(X1554)
      call add_1423_to_1234(one, X1555, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1555)
      call mem%alloc(X1556, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1556, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1557, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1556, &
         wf%n_v*wf%n_o, &
         zero, &
         X1557, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1556)
      call mem%alloc(X1558, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1342(X1557, X1558, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X1557)
      call mem%alloc(X1559, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1558, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1559, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1558)
      call mem%alloc(X1560, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1559, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1560, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1559)
      call add_1432_to_1234(one, X1560, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1560)
      call mem%alloc(X1561, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1561, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1562, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1562, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1563, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1561, &
         wf%n_v*wf%n_o, &
         X1562, &
         wf%n_v*wf%n_o, &
         zero, &
         X1563, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1561)
      call mem%dealloc(X1562)
      call mem%alloc(X1564, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1563, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X1564, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1563)
      call mem%alloc(X1565, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1564, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1565, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1564)
      call add_1423_to_1234(one, X1565, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1565)
      call mem%alloc(X1566, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1566, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1567, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X1566, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X1567, 1)
!
      call mem%dealloc(X1566)
      call mem%alloc(X1568, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1567, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1568, &
         wf%n_o)
!
      call mem%dealloc(X1567)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1568, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1568)
      call mem%alloc(X1569, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1569, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1570, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X1569, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X1570, 1)
!
      call mem%dealloc(X1569)
      call mem%alloc(X1571, wf%n_v, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1570, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1571, &
         wf%n_v)
!
      call mem%dealloc(X1570)
      call mem%alloc(X1572, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1572, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1573, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1572, &
         wf%n_v*wf%n_o**2, &
         X1571, &
         wf%n_v, &
         zero, &
         X1573, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1571)
      call mem%dealloc(X1572)
      call add_1243_to_1234(one, X1573, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1573)
      call mem%alloc(X1574, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1574, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1575, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1574, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X1575, 1)
!
      call mem%dealloc(X1574)
      call mem%alloc(X1576, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1575, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1576, &
         wf%n_o)
!
      call mem%dealloc(X1575)
      call mem%alloc(X1577, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1576, &
         wf%n_o, &
         zero, &
         X1577, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1576)
      call add_1432_to_1234(one, X1577, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1577)
      call mem%alloc(X1578, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1578, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1579, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1578, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X1579, 1)
!
      call mem%dealloc(X1578)
      call mem%alloc(X1580, wf%n_v, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1579, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1580, &
         wf%n_v)
!
      call mem%dealloc(X1579)
      call mem%alloc(X1581, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1581, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1582, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1581, &
         wf%n_v*wf%n_o**2, &
         X1580, &
         wf%n_v, &
         zero, &
         X1582, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1580)
      call mem%dealloc(X1581)
      call add_1423_to_1234(one, X1582, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1582)
      call mem%alloc(X1583, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1583, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1584, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(r_vovo, X1584, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1585, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1584, &
         wf%n_v*wf%n_o, &
         X1583, &
         wf%n_v*wf%n_o, &
         zero, &
         X1585, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1583)
      call mem%dealloc(X1584)
      call mem%alloc(X1586, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1585, X1586, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1585)
      call mem%alloc(X1587, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1586, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X1587, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1586)
      call add_1423_to_1234(one, X1587, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1587)
      call mem%alloc(X1588, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1588, wf%n_v, wf%n_o)
      call mem%alloc(X1589, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1588, 1, &
         zero, &
         X1589, 1)
!
      call mem%dealloc(X1588)
      call mem%alloc(X1590, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1589, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1590, &
         wf%n_o)
!
      call mem%dealloc(X1589)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1590, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1590)
      call mem%alloc(X1591, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1591, wf%n_v, wf%n_o)
      call mem%alloc(X1592, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1591, 1, &
         zero, &
         X1592, 1)
!
      call mem%dealloc(X1591)
      call mem%alloc(X1593, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1592, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1593, &
         wf%n_v)
!
      call mem%dealloc(X1592)
      call mem%alloc(X1594, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1594, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1595, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1594, &
         wf%n_v*wf%n_o**2, &
         X1593, &
         wf%n_v, &
         zero, &
         X1595, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1593)
      call mem%dealloc(X1594)
      call add_1243_to_1234(one, X1595, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1595)
      call mem%alloc(X1596, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1596, wf%n_v, wf%n_o)
      call mem%alloc(X1597, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1596, 1, &
         zero, &
         X1597, 1)
!
      call mem%dealloc(X1596)
      call mem%alloc(X1598, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1597, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1598, &
         wf%n_o)
!
      call mem%dealloc(X1597)
      call mem%alloc(X1599, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         r_vovo, &
         wf%n_v**2*wf%n_o, &
         X1598, &
         wf%n_o, &
         zero, &
         X1599, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1598)
      call add_1432_to_1234(one, X1599, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1599)
      call mem%alloc(X1600, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X1600, wf%n_v, wf%n_o)
      call mem%alloc(X1601, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1600, 1, &
         zero, &
         X1601, 1)
!
      call mem%dealloc(X1600)
      call mem%alloc(X1602, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1601, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1602, &
         wf%n_v)
!
      call mem%dealloc(X1601)
      call mem%alloc(X1603, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(r_vovo, X1603, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1604, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1603, &
         wf%n_v*wf%n_o**2, &
         X1602, &
         wf%n_v, &
         zero, &
         X1604, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1602)
      call mem%dealloc(X1603)
      call add_1423_to_1234(one, X1604, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1604)
      call mem%alloc(X1605, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1605, &
         wf%n_o)
!
      call mem%alloc(X1606, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(r_vovo, X1606, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1607, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1606, &
         wf%n_v*wf%n_o, &
         X1605, &
         wf%n_o**2, &
         zero, &
         X1607, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1605)
      call mem%dealloc(X1606)
      call mem%alloc(X1608, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1607, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1608, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1607)
      call add_1423_to_1234(one, X1608, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1608)
      call mem%alloc(X1609, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1609, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1610, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_o, &
         X1609, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X1610, &
         wf%n_o)
!
      call mem%dealloc(X1609)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         rAIAI, &
         t_aibj, &
         wf%n_v**2*wf%n_o, &
         X1610, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1610)
      call mem%alloc(X1611, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1611, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1612, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X1611, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X1612, &
         wf%n_o)
!
      call mem%dealloc(X1611)
      call mem%alloc(X1613, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         rAIAI, &
         t_aibj, &
         wf%n_v**2*wf%n_o, &
         X1612, &
         wf%n_o, &
         zero, &
         X1613, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1612)
      call add_1432_to_1234(rAIAI, X1613, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1613)
      call mem%alloc(X1614, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1614, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1615, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -two, &
         X1614, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X1615, &
         wf%n_v)
!
      call mem%dealloc(X1614)
      call mem%alloc(X1616, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1243(u_aibj, X1616, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1617, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         rAIAI, &
         X1616, &
         wf%n_v*wf%n_o**2, &
         X1615, &
         wf%n_v, &
         zero, &
         X1617, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1615)
      call mem%dealloc(X1616)
      call add_1243_to_1234(rAIAI, X1617, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1617)
      call mem%alloc(X1618, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1618, 1)
!
      call mem%alloc(X1619, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1618, &
         wf%n_v*wf%n_o, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1619, &
         wf%n_v)
!
      call mem%dealloc(X1618)
      call mem%alloc(X1620, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1620, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1621, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1620, &
         wf%n_v*wf%n_o, &
         X1619, &
         wf%n_v, &
         zero, &
         X1621, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1619)
      call mem%dealloc(X1620)
      call add_1432_to_1234(one, X1621, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1621)
      call mem%alloc(X1622, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         eight, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1622, 1)
!
      call mem%alloc(X1623, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1622, &
         wf%n_v*wf%n_o, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1623, &
         wf%n_v)
!
      call mem%dealloc(X1622)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1623, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1623)
      call mem%alloc(X1624, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1624, 1)
!
      call mem%alloc(X1625, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1624, &
         wf%n_v*wf%n_o, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1625, &
         wf%n_v)
!
      call mem%dealloc(X1624)
      call mem%alloc(X1626, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1625, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1626, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1625)
      call add_1432_to_1234(one, X1626, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1626)
      call mem%alloc(X1627, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1627, 1)
!
      call mem%alloc(X1628, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(t_aibj, X1628, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1629, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1627, &
         wf%n_v*wf%n_o, &
         X1628, &
         wf%n_v*wf%n_o, &
         zero, &
         X1629, &
         wf%n_v)
!
      call mem%dealloc(X1627)
      call mem%dealloc(X1628)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X1629, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1629)
      call mem%alloc(X1630, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1630, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1631, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         four, &
         X1630, &
         wf%n_o**2, &
         uxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X1631, &
         wf%n_o**2)
!
      call mem%dealloc(X1630)
      call mem%alloc(X1632, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X1631, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1632, 1)
!
      call mem%dealloc(X1631)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v**2*wf%n_o, &
         X1632, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1632)
      call mem%alloc(X1633, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1633, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1634, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X1633, &
         wf%n_o**2, &
         uxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X1634, &
         wf%n_o**2)
!
      call mem%dealloc(X1633)
      call mem%alloc(X1635, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X1634, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1635, 1)
!
      call mem%dealloc(X1634)
      call mem%alloc(X1636, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v**2*wf%n_o, &
         X1635, &
         wf%n_o, &
         zero, &
         X1636, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1635)
      call add_1432_to_1234(one, X1636, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1636)
      call mem%alloc(X1637, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1637, 1)
!
      call mem%alloc(X1638, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(t_aibj, X1638, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1639, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1637, &
         wf%n_v*wf%n_o, &
         X1638, &
         wf%n_v*wf%n_o, &
         zero, &
         X1639, &
         wf%n_v)
!
      call mem%dealloc(X1637)
      call mem%dealloc(X1638)
      call mem%alloc(X1640, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1640, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1641, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1640, &
         wf%n_v*wf%n_o, &
         X1639, &
         wf%n_v, &
         zero, &
         X1641, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1639)
      call mem%dealloc(X1640)
      call add_1432_to_1234(one, X1641, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1641)
      call mem%alloc(X1642, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1642, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1643, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txIxx_vvo, &
         wf%n_v, &
         X1642, &
         wf%n_v*wf%n_o, &
         zero, &
         X1643, &
         wf%n_v)
!
      call mem%dealloc(X1642)
      call mem%alloc(X1644, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1643, X1644, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1643)
      call mem%alloc(X1645, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1644, &
         wf%n_v, &
         zero, &
         X1645, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1644)
      call mem%alloc(X1646, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1645, 1, &
         rAIAx_o, 1, &
         X1646, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1645)
      call add_1432_to_1234(one, X1646, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1646)
      call mem%alloc(X1647, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1647, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1648, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X1647, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X1648, &
         wf%n_o**2)
!
      call mem%dealloc(X1647)
      call mem%alloc(X1649, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(u_aibj, X1649, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1650, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X1649, &
         wf%n_v**2, &
         X1648, &
         wf%n_o**2, &
         zero, &
         X1650, &
         wf%n_v**2)
!
      call mem%dealloc(X1648)
      call mem%dealloc(X1649)
      call mem%alloc(X1651, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1650, 1, &
         rAIAx_o, 1, &
         X1651, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1650)
      call add_1342_to_1234(one, X1651, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1651)
      call mem%alloc(X1652, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1652, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1653, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(u_aibj, X1653, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1654, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1652, &
         wf%n_o**2, &
         X1653, &
         wf%n_v**2, &
         zero, &
         X1654, &
         wf%n_o**2)
!
      call mem%dealloc(X1652)
      call mem%dealloc(X1653)
      call mem%alloc(X1655, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o**3, &
         one, &
         X1654, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1655, 1)
!
      call mem%dealloc(X1654)
      call mem%alloc(X1656, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X1655, &
         wf%n_o, &
         zero, &
         X1656, &
         wf%n_v**2)
!
      call mem%dealloc(X1655)
      call add_1324_to_1234(one, X1656, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1656)
      call mem%alloc(X1657, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1657, 1)
!
      call mem%alloc(X1658, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1657, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1658, &
         wf%n_v)
!
      call mem%dealloc(X1657)
      call mem%alloc(X1659, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1659, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1659, &
         wf%n_v*wf%n_o, &
         X1658, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1658)
      call mem%dealloc(X1659)
      call mem%alloc(X1660, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1660, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1661, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X1660, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X1661, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1660)
      call mem%alloc(X1662, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(u_aibj, X1662, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1663, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         X1662, &
         wf%n_v*wf%n_o, &
         X1661, &
         wf%n_v*wf%n_o, &
         zero, &
         X1663, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1661)
      call mem%dealloc(X1662)
      call mem%alloc(X1664, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1663, 1, &
         rAIAx_o, 1, &
         X1664, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1663)
      call add_1432_to_1234(one, X1664, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1664)
      call mem%alloc(X1665, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1665, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1666, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1665, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1666, &
         wf%n_v)
!
      call mem%dealloc(X1665)
      call mem%alloc(X1667, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1666, X1667, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1666)
      call mem%alloc(X1668, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1667, &
         wf%n_v, &
         zero, &
         X1668, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1667)
      call mem%alloc(X1669, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1668, 1, &
         rAIAx_o, 1, &
         X1669, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1668)
      call add_1432_to_1234(one, X1669, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1669)
      call mem%alloc(X1670, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1670, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1671, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X1670, 1, &
         zero, &
         X1671, 1)
!
      call mem%dealloc(X1670)
      call mem%alloc(X1672, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v**2*wf%n_o, &
         X1671, 1, &
         zero, &
         X1672, 1)
!
      call mem%dealloc(X1671)
      call mem%alloc(X1673, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_312(X1672, X1673, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1672)
      call mem%alloc(X1674, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1673, 1, &
         rAIAx_o, 1, &
         X1674, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1673)
      call add_1342_to_1234(one, X1674, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1674)
      call mem%alloc(X1675, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1675, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1676, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         two, &
         X1675, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X1676, &
         wf%n_v)
!
      call mem%dealloc(X1675)
      call mem%alloc(X1677, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1677, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1678, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1677, &
         wf%n_v*wf%n_o, &
         X1676, &
         wf%n_v, &
         zero, &
         X1678, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1676)
      call mem%dealloc(X1677)
      call mem%alloc(X1679, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1678, 1, &
         rAIAx_o, 1, &
         X1679, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1678)
      call add_1432_to_1234(one, X1679, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1679)
      call mem%alloc(X1680, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1680, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1681, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X1680, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X1681, &
         wf%n_o)
!
      call mem%dealloc(X1680)
      call mem%alloc(X1682, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X1681, &
         wf%n_o, &
         zero, &
         X1682, &
         wf%n_v**2)
!
      call mem%dealloc(X1681)
      call mem%alloc(X1683, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1682, 1, &
         rAIAx_o, 1, &
         X1683, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1682)
      call add_1342_to_1234(one, X1683, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1683)
      call mem%alloc(X1684, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1684, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1685, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         two, &
         X1684, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X1685, &
         wf%n_v)
!
      call mem%dealloc(X1684)
      call mem%alloc(X1686, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1685, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1686, &
         wf%n_v)
!
      call mem%dealloc(X1685)
      call mem%alloc(X1687, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X1686, 1, &
         rAIAx_o, 1, &
         X1687, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1686)
      call add_1342_to_1234(one, X1687, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1687)
      call mem%alloc(X1688, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1688, 1)
!
      call mem%alloc(X1689, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1688, X1689, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1688)
      call mem%alloc(X1690, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1689, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1690, &
         wf%n_v)
!
      call mem%dealloc(X1689)
      call mem%alloc(X1691, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         X1690, &
         wf%n_v, &
         zero, &
         X1691, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1690)
      call add_1432_to_1234(one, X1691, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1691)
      call mem%alloc(X1692, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_o, &
         rAIAx_o, 1, &
         zero, &
         X1692, 1)
!
      call mem%alloc(X1693, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X1692, X1693, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X1692)
      call mem%alloc(X1694, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1693, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1694, &
         wf%n_v)
!
      call mem%dealloc(X1693)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         X1694, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1694)
      call mem%alloc(X1695, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1695, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1696, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1696, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1697, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1695, &
         wf%n_v*wf%n_o, &
         X1696, &
         wf%n_o, &
         zero, &
         X1697, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1695)
      call mem%dealloc(X1696)
      call mem%alloc(X1698, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X1697, &
         wf%n_v*wf%n_o, &
         zero, &
         X1698, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1697)
      call mem%alloc(X1699, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_213(X1698, X1699, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1698)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1699, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1699)
      call mem%alloc(X1700, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1700, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1701, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1700, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1701, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1700)
      call mem%alloc(X1702, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X1702, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1703, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1702, &
         wf%n_v*wf%n_o, &
         X1701, &
         wf%n_v*wf%n_o, &
         zero, &
         X1703, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1701)
      call mem%dealloc(X1702)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1703, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1703)
      call mem%alloc(X1704, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1704, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1705, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(t_aibj, X1705, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1706, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1704, &
         wf%n_o**2, &
         X1705, &
         wf%n_v**2, &
         zero, &
         X1706, &
         wf%n_o**2)
!
      call mem%dealloc(X1704)
      call mem%dealloc(X1705)
      call mem%alloc(X1707, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1707, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1708, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1706, &
         wf%n_o**2, &
         X1707, &
         wf%n_o**2, &
         zero, &
         X1708, &
         wf%n_o**2)
!
      call mem%dealloc(X1706)
      call mem%dealloc(X1707)
      call mem%alloc(X1709, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X1708, X1709, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1708)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1709, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1709)
      call mem%alloc(X1710, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X1710, 1)
!
      call mem%alloc(X1711, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X1710, X1711, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1710)
      call mem%alloc(X1712, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1711, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1712, &
         wf%n_o)
!
      call mem%dealloc(X1711)
      call mem%alloc(X1713, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1712, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1713, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1712)
      call add_1423_to_1234(one, X1713, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1713)
      call mem%alloc(X1714, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X1714, 1)
!
      call mem%alloc(X1715, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1715, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1716, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X1714, &
         wf%n_o, &
         X1715, &
         wf%n_v*wf%n_o, &
         zero, &
         X1716, &
         wf%n_o)
!
      call mem%dealloc(X1714)
      call mem%dealloc(X1715)
      call mem%alloc(X1717, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1716, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1717, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1716)
      call add_1423_to_1234(one, X1717, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1717)
      call mem%alloc(X1718, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X1718, 1)
!
      call mem%alloc(X1719, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X1718, X1719, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1718)
      call mem%alloc(X1720, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X1720, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1721, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1720, &
         wf%n_o**2, &
         X1719, &
         wf%n_o**2, &
         zero, &
         X1721, &
         wf%n_o**2)
!
      call mem%dealloc(X1719)
      call mem%dealloc(X1720)
      call mem%alloc(X1722, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call sort_to_1243(X1721, X1722, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1721)
      call mem%alloc(X1723, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(u_aibj, X1723, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1724, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X1723, &
         wf%n_v**2, &
         X1722, &
         wf%n_o**2, &
         zero, &
         X1724, &
         wf%n_v**2)
!
      call mem%dealloc(X1722)
      call mem%dealloc(X1723)
      call add_1324_to_1234(one, X1724, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1724)
      call mem%alloc(X1725, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1725, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1726, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1725, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1726, &
         wf%n_o)
!
      call mem%dealloc(X1725)
      call mem%alloc(X1727, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X1726, X1727, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1726)
      call mem%alloc(X1728, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1727, &
         wf%n_o, &
         zero, &
         X1728, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1727)
      call mem%alloc(X1729, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_213(X1728, X1729, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1728)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1729, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1729)
      call mem%alloc(X1730, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X1730, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1731, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X1730, 1, &
         zero, &
         X1731, 1)
!
      call mem%dealloc(X1730)
      call mem%alloc(X1732, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         u_aibj, &
         wf%n_v, &
         X1731, 1, &
         zero, &
         X1732, 1)
!
      call mem%dealloc(X1731)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1732, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1732)
      call mem%alloc(X1733, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1733, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1734, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         two, &
         X1733, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X1734, &
         wf%n_v)
!
      call mem%dealloc(X1733)
      call mem%alloc(X1735, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1735, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1736, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1735, &
         wf%n_o**2, &
         X1734, &
         wf%n_v, &
         zero, &
         X1736, &
         wf%n_o**2)
!
      call mem%dealloc(X1734)
      call mem%dealloc(X1735)
      call mem%alloc(X1737, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X1736, X1737, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1736)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1737, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1737)
      call mem%alloc(X1738, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1738, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1739, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X1738, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X1739, &
         wf%n_o)
!
      call mem%dealloc(X1738)
      call mem%alloc(X1740, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1739, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1740, &
         wf%n_o)
!
      call mem%dealloc(X1739)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1740, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1740)
      call mem%alloc(X1741, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1741, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1742, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X1741, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X1742, &
         wf%n_o)
!
      call mem%dealloc(X1741)
      call mem%alloc(X1743, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X1742, &
         wf%n_o, &
         zero, &
         X1743, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1742)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         rAIxI_v, 1, &
         X1743, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1743)
      call mem%alloc(X1744, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1744, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1745, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1744, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1745, &
         wf%n_o)
!
      call mem%dealloc(X1744)
      call mem%alloc(X1746, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1745, &
         wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X1746, 1)
!
      call mem%dealloc(X1745)
      call mem%alloc(X1747, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1747, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1748, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1747, &
         wf%n_v**2*wf%n_o, &
         X1746, &
         wf%n_o, &
         zero, &
         X1748, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1746)
      call mem%dealloc(X1747)
      call add_1342_to_1234(one, X1748, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1748)
      call mem%alloc(X1749, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1749, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1750, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1749, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1750, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1749)
      call mem%alloc(X1751, wf%n_o, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1750, &
         wf%n_v, &
         rAIxI_v, 1, &
         zero, &
         X1751, 1)
!
      call mem%dealloc(X1750)
      call mem%alloc(X1752, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1752, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1753, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1752, &
         wf%n_v**2*wf%n_o, &
         X1751, &
         wf%n_o, &
         zero, &
         X1753, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1751)
      call mem%dealloc(X1752)
      call add_1342_to_1234(one, X1753, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1753)
      call mem%alloc(X1754, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxI_v, 1, &
         zero, &
         X1754, 1)
!
      call mem%alloc(X1755, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(X1754, X1755, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1754)
      call mem%alloc(X1756, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1756, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1757, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1755, &
         wf%n_o**2, &
         X1756, &
         wf%n_o**2, &
         zero, &
         X1757, &
         wf%n_v)
!
      call mem%dealloc(X1755)
      call mem%dealloc(X1756)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1757, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1757)
      call mem%alloc(X1758, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1758, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1759, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1759, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1760, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X1758, &
         wf%n_v*wf%n_o, &
         X1759, &
         wf%n_o, &
         zero, &
         X1760, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1758)
      call mem%dealloc(X1759)
      call mem%alloc(X1761, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v, &
         X1760, &
         wf%n_v*wf%n_o, &
         zero, &
         X1761, &
         wf%n_v)
!
      call mem%dealloc(X1760)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1761, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1761)
      call mem%alloc(X1762, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1762, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1763, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         four, &
         X1762, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X1763, &
         wf%n_o**2)
!
      call mem%dealloc(X1762)
      call mem%alloc(X1764, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1764, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1765, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X1764, &
         wf%n_o**2, &
         X1763, &
         wf%n_o**2, &
         zero, &
         X1765, &
         wf%n_v)
!
      call mem%dealloc(X1763)
      call mem%dealloc(X1764)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1765, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1765)
      call mem%alloc(X1766, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1766, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1767, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1767, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1768, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1766, &
         wf%n_v*wf%n_o, &
         X1767, &
         wf%n_o, &
         zero, &
         X1768, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1766)
      call mem%dealloc(X1767)
      call mem%alloc(X1769, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         X1768, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X1769, &
         wf%n_o)
!
      call mem%dealloc(X1768)
      call mem%alloc(X1770, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1769, 1, &
         X1770, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1769)
      call add_1423_to_1234(one, X1770, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1770)
      call mem%alloc(X1771, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1771, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1772, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X1771, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X1772, &
         wf%n_o**2)
!
      call mem%dealloc(X1771)
      call mem%alloc(X1773, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1773, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1774, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1772, &
         wf%n_o**2, &
         X1773, &
         wf%n_o**2, &
         zero, &
         X1774, &
         wf%n_o)
!
      call mem%dealloc(X1772)
      call mem%dealloc(X1773)
      call mem%alloc(X1775, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1774, 1, &
         X1775, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1774)
      call add_1423_to_1234(one, X1775, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1775)
      call mem%alloc(X1776, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1776, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1777, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txIxx_vvo, &
         wf%n_v, &
         X1776, &
         wf%n_v*wf%n_o, &
         zero, &
         X1777, &
         wf%n_v)
!
      call mem%dealloc(X1776)
      call mem%alloc(X1778, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(uAxxx_ovo, X1778, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1779, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1778, &
         wf%n_o**2, &
         X1777, &
         wf%n_v*wf%n_o, &
         zero, &
         X1779, &
         wf%n_o**2)
!
      call mem%dealloc(X1777)
      call mem%dealloc(X1778)
      call mem%alloc(X1780, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X1779, X1780, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1779)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1780, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1780)
      call mem%alloc(X1781, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1781, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1782, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         uAxxx_ovo, &
         wf%n_o, &
         X1781, &
         wf%n_v*wf%n_o, &
         zero, &
         X1782, &
         wf%n_o)
!
      call mem%dealloc(X1781)
      call mem%alloc(X1783, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_312(txIxx_vvo, X1783, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1784, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1783, &
         wf%n_v*wf%n_o, &
         X1782, &
         wf%n_o**2, &
         zero, &
         X1784, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1782)
      call mem%dealloc(X1783)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1784, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1784)
      call mem%alloc(X1785, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X1785, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1786, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         txIxx_vvo, &
         wf%n_v**2, &
         X1785, &
         wf%n_o**2, &
         zero, &
         X1786, &
         wf%n_o)
!
      call mem%dealloc(X1785)
      call mem%alloc(X1787, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1786, &
         wf%n_o**2, &
         zero, &
         X1787, &
         wf%n_v)
!
      call mem%dealloc(X1786)
      call mem%alloc(X1788, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1787, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1788, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1787)
      call add_1423_to_1234(one, X1788, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1788)
      call mem%alloc(X1789, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1789, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1790, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1789, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1790, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1789)
      call mem%alloc(X1791, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1790, &
         wf%n_v, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1791, &
         wf%n_o**2)
!
      call mem%dealloc(X1790)
      call mem%alloc(X1792, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X1791, &
         wf%n_o, &
         zero, &
         X1792, &
         wf%n_v**2)
!
      call mem%dealloc(X1791)
      call add_1342_to_1234(one, X1792, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1792)
      call mem%alloc(X1793, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1793, &
         wf%n_o)
!
      call mem%alloc(X1794, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X1793, X1794, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1793)
      call mem%alloc(X1795, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1795, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1796, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X1795, &
         wf%n_o**2, &
         X1794, &
         wf%n_v*wf%n_o, &
         zero, &
         X1796, &
         wf%n_v)
!
      call mem%dealloc(X1794)
      call mem%dealloc(X1795)
      call mem%alloc(X1797, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1797, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1798, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1797, &
         wf%n_v*wf%n_o, &
         X1796, &
         wf%n_v*wf%n_o, &
         zero, &
         X1798, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1796)
      call mem%dealloc(X1797)
      call add_1432_to_1234(one, X1798, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1798)
      call mem%alloc(X1799, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1799, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1800, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txIxx_vvo, &
         wf%n_v, &
         X1799, &
         wf%n_v*wf%n_o, &
         zero, &
         X1800, &
         wf%n_v)
!
      call mem%dealloc(X1799)
      call mem%alloc(X1801, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1800, &
         wf%n_v*wf%n_o, &
         zero, &
         X1801, &
         wf%n_o)
!
      call mem%dealloc(X1800)
      call mem%alloc(X1802, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X1802, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1803, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1802, &
         wf%n_v*wf%n_o, &
         X1801, &
         wf%n_v*wf%n_o, &
         zero, &
         X1803, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1801)
      call mem%dealloc(X1802)
      call add_1423_to_1234(one, X1803, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1803)
      call mem%alloc(X1804, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1804, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1805, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X1804, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1805, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1804)
      call mem%alloc(X1806, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X1805, &
         wf%n_v*wf%n_o, &
         zero, &
         X1806, &
         wf%n_v)
!
      call mem%dealloc(X1805)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1806, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1806)
      call mem%alloc(X1807, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1807, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1808, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1807, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1808, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1807)
      call mem%alloc(X1809, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         X1808, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X1809, &
         wf%n_o)
!
      call mem%dealloc(X1808)
      call mem%alloc(X1810, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1809, 1, &
         X1810, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1809)
      call add_1423_to_1234(one, X1810, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1810)
      call mem%alloc(X1811, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1811, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1812, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1811, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1812, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1811)
      call mem%alloc(X1813, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1812, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1813, &
         wf%n_o**2)
!
      call mem%dealloc(X1812)
      call mem%alloc(X1814, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1813, X1814, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1813)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1814, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1814)
      call mem%alloc(X1815, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1815, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1816, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txxxI_vov, &
         wf%n_v, &
         X1815, &
         wf%n_v*wf%n_o, &
         zero, &
         X1816, &
         wf%n_v)
!
      call mem%dealloc(X1815)
      call mem%alloc(X1817, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1817, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1818, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1817, &
         wf%n_o**2, &
         X1816, &
         wf%n_v*wf%n_o, &
         zero, &
         X1818, &
         wf%n_o**2)
!
      call mem%dealloc(X1816)
      call mem%dealloc(X1817)
      call mem%alloc(X1819, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X1818, X1819, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1818)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1819, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1819)
      call mem%alloc(X1820, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X1820, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1821, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X1821, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1822, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1821, &
         wf%n_v**2, &
         X1820, &
         wf%n_o**2, &
         zero, &
         X1822, &
         wf%n_o)
!
      call mem%dealloc(X1820)
      call mem%dealloc(X1821)
      call mem%alloc(X1823, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1822, &
         wf%n_o**2, &
         zero, &
         X1823, &
         wf%n_v)
!
      call mem%dealloc(X1822)
      call mem%alloc(X1824, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1823, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X1824, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1823)
      call add_1432_to_1234(one, X1824, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1824)
      call mem%alloc(X1825, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1825, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1826, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1324(X1825, X1826, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1825)
      call mem%alloc(X1827, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1827, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1828, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X1826, &
         wf%n_o**2, &
         X1827, &
         wf%n_o**2, &
         zero, &
         X1828, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1826)
      call mem%dealloc(X1827)
      call mem%alloc(X1829, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X1828, &
         wf%n_v, &
         zero, &
         X1829, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1828)
      call add_1423_to_1234(one, X1829, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1829)
      call mem%alloc(X1830, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1830, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1831, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         uAxxx_ovo, &
         wf%n_o, &
         X1830, &
         wf%n_v*wf%n_o, &
         zero, &
         X1831, &
         wf%n_o)
!
      call mem%dealloc(X1830)
      call mem%alloc(X1832, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1831, &
         wf%n_o**2, &
         zero, &
         X1832, &
         wf%n_o)
!
      call mem%dealloc(X1831)
      call mem%alloc(X1833, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X1833, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1834, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X1833, &
         wf%n_v**2, &
         X1832, &
         wf%n_o**2, &
         zero, &
         X1834, &
         wf%n_v**2)
!
      call mem%dealloc(X1832)
      call mem%dealloc(X1833)
      call add_1324_to_1234(one, X1834, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1834)
      call mem%alloc(X1835, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1835, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1836, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X1835, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X1836, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1835)
      call mem%alloc(X1837, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1836, &
         wf%n_v, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1837, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1836)
      call mem%alloc(X1838, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X1837, &
         wf%n_o, &
         zero, &
         X1838, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1837)
      call add_1432_to_1234(one, X1838, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1838)
      call mem%alloc(X1839, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1839, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1840, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -four, &
         X1839, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X1840, &
         wf%n_v)
!
      call mem%dealloc(X1839)
      call mem%alloc(X1841, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1840, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1841, &
         wf%n_v)
!
      call mem%dealloc(X1840)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1841, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1841)
      call mem%alloc(X1842, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1842, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1843, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_o, &
         X1842, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X1843, &
         wf%n_o)
!
      call mem%dealloc(X1842)
      call mem%alloc(X1844, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X1843, &
         wf%n_o, &
         zero, &
         X1844, &
         wf%n_v)
!
      call mem%dealloc(X1843)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1844, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1844)
      call mem%alloc(X1845, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1845, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1846, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         two, &
         X1845, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X1846, &
         wf%n_v)
!
      call mem%dealloc(X1845)
      call mem%alloc(X1847, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1846, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1847, &
         wf%n_v)
!
      call mem%dealloc(X1846)
      call mem%alloc(X1848, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1847, 1, &
         X1848, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1847)
      call add_1432_to_1234(one, X1848, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1848)
      call mem%alloc(X1849, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1849, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1850, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X1849, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X1850, &
         wf%n_o)
!
      call mem%dealloc(X1849)
      call mem%alloc(X1851, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1850, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1851, &
         wf%n_o)
!
      call mem%dealloc(X1850)
      call mem%alloc(X1852, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1851, 1, &
         X1852, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1851)
      call add_1423_to_1234(one, X1852, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1852)
      call mem%alloc(X1853, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1853, &
         wf%n_o)
!
      call mem%alloc(X1854, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1853, X1854, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1853)
      call mem%alloc(X1855, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1854, &
         wf%n_o**2, &
         zero, &
         X1855, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1854)
      call mem%alloc(X1856, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_2134(X1855, X1856, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X1855)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1856, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1856)
      call mem%alloc(X1857, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1857, &
         wf%n_o)
!
      call mem%alloc(X1858, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(u_aibj, X1858, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1859, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1858, &
         wf%n_v*wf%n_o, &
         X1857, &
         wf%n_o**2, &
         zero, &
         X1859, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1857)
      call mem%dealloc(X1858)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1859, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1859)
      call mem%alloc(X1860, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1860, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1861, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(u_aibj, X1861, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1862, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X1861, &
         wf%n_v**2, &
         X1860, &
         wf%n_o**2, &
         zero, &
         X1862, &
         wf%n_o**2)
!
      call mem%dealloc(X1860)
      call mem%dealloc(X1861)
      call mem%alloc(X1863, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o**3, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1862, &
         wf%n_o**3, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1863, &
         wf%n_o**3)
!
      call mem%dealloc(X1862)
      call mem%alloc(X1864, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1423(X1863, X1864, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1863)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1864, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1864)
      call mem%alloc(X1865, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         rAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1865, &
         wf%n_o)
!
      call mem%alloc(X1866, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X1865, X1866, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1865)
      call mem%alloc(X1867, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X1866, &
         wf%n_o**2, &
         zero, &
         X1867, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1866)
      call mem%alloc(X1868, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1867, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1868, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1867)
      call add_1423_to_1234(one, X1868, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1868)
      call mem%alloc(X1869, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1869, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X1870, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(X1869, X1870, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1869)
      call mem%alloc(X1871, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**3, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1870, &
         wf%n_o**3, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1871, &
         wf%n_o**3)
!
      call mem%dealloc(X1870)
      call mem%alloc(X1872, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(u_aibj, X1872, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1873, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X1872, &
         wf%n_v**2, &
         X1871, &
         wf%n_o**2, &
         zero, &
         X1873, &
         wf%n_v**2)
!
      call mem%dealloc(X1871)
      call mem%dealloc(X1872)
      call add_1342_to_1234(one, X1873, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1873)
      call mem%alloc(X1874, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         rAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1874, &
         wf%n_o)
!
      call mem%alloc(X1875, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X1875, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1876, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X1875, &
         wf%n_v*wf%n_o, &
         X1874, &
         wf%n_o**2, &
         zero, &
         X1876, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1874)
      call mem%dealloc(X1875)
      call mem%alloc(X1877, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X1876, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X1877, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1876)
      call add_1423_to_1234(one, X1877, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1877)
      call mem%alloc(X1878, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1878, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1879, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X1878, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1879, &
         wf%n_o)
!
      call mem%dealloc(X1878)
      call mem%alloc(X1880, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X1879, X1880, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1879)
      call mem%alloc(X1881, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v, &
         X1880, &
         wf%n_o, &
         zero, &
         X1881, &
         wf%n_v)
!
      call mem%dealloc(X1880)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1881, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1881)
      call mem%alloc(X1882, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1882, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1883, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_o, &
         X1882, 1, &
         zero, &
         X1883, 1)
!
      call mem%dealloc(X1882)
      call mem%alloc(X1884, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X1883, 1, &
         zero, &
         X1884, 1)
!
      call mem%dealloc(X1883)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1884, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1884)
      call mem%alloc(X1885, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1885, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1886, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1885, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1886, &
         wf%n_o)
!
      call mem%dealloc(X1885)
      call mem%alloc(X1887, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X1886, X1887, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X1886)
      call mem%alloc(X1888, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         X1887, &
         wf%n_o, &
         uxIxx_vvo, &
         wf%n_v, &
         zero, &
         X1888, &
         wf%n_o)
!
      call mem%dealloc(X1887)
      call mem%alloc(X1889, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1888, 1, &
         X1889, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1888)
      call add_1423_to_1234(one, X1889, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1889)
      call mem%alloc(X1890, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1890, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1891, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X1890, 1, &
         zero, &
         X1891, 1)
!
      call mem%dealloc(X1890)
      call mem%alloc(X1892, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X1891, 1, &
         zero, &
         X1892, 1)
!
      call mem%dealloc(X1891)
      call mem%alloc(X1893, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1892, 1, &
         X1893, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1892)
      call add_1432_to_1234(one, X1893, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1893)
      call mem%alloc(X1894, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1894, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1895, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1894, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1895, &
         wf%n_v)
!
      call mem%dealloc(X1894)
      call mem%alloc(X1896, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(uAxxx_ovo, X1896, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1897, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1896, &
         wf%n_o**2, &
         X1895, &
         wf%n_v*wf%n_o, &
         zero, &
         X1897, &
         wf%n_o**2)
!
      call mem%dealloc(X1895)
      call mem%dealloc(X1896)
      call mem%alloc(X1898, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X1897, X1898, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1897)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1898, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1898)
      call mem%alloc(X1899, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1899, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1900, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1899, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1900, &
         wf%n_o)
!
      call mem%dealloc(X1899)
      call mem%alloc(X1901, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_312(uxIxx_vvo, X1901, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1902, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X1901, &
         wf%n_v*wf%n_o, &
         X1900, &
         wf%n_o**2, &
         zero, &
         X1902, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1900)
      call mem%dealloc(X1901)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1902, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1902)
      call mem%alloc(X1903, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1903, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1904, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1903, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1904, &
         wf%n_v)
!
      call mem%dealloc(X1903)
      call mem%alloc(X1905, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1904, &
         wf%n_v*wf%n_o, &
         zero, &
         X1905, &
         wf%n_o)
!
      call mem%dealloc(X1904)
      call mem%alloc(X1906, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X1906, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1907, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1906, &
         wf%n_v*wf%n_o, &
         X1905, &
         wf%n_v*wf%n_o, &
         zero, &
         X1907, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1905)
      call mem%dealloc(X1906)
      call add_1423_to_1234(one, X1907, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1907)
      call mem%alloc(X1908, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1908, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1909, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1908, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1909, &
         wf%n_v)
!
      call mem%dealloc(X1908)
      call mem%alloc(X1910, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1909, &
         wf%n_v*wf%n_o, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1910, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1909)
      call mem%alloc(X1911, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X1910, X1911, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X1910)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1911, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1911)
      call mem%alloc(X1912, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X1912, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1913, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X1912, 1, &
         zero, &
         X1913, 1)
!
      call mem%dealloc(X1912)
      call mem%alloc(X1914, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         X1913, 1, &
         zero, &
         X1914, 1)
!
      call mem%dealloc(X1913)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1914, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1914)
      call mem%alloc(X1915, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X1915, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1916, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X1915, 1, &
         zero, &
         X1916, 1)
!
      call mem%dealloc(X1915)
      call mem%alloc(X1917, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         X1916, 1, &
         zero, &
         X1917, 1)
!
      call mem%dealloc(X1916)
      call mem%alloc(X1918, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         rAIxx_vo, 1, &
         X1917, 1, &
         X1918, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1917)
      call add_1432_to_1234(one, X1918, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1918)
      call mem%alloc(X1919, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1919, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1920, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1919, &
         wf%n_o, &
         zero, &
         X1920, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1919)
      call mem%alloc(X1921, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X1920, X1921, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1920)
      call mem%alloc(X1922, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1921, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1922, &
         wf%n_o**2)
!
      call mem%dealloc(X1921)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1922, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1922)
      call mem%alloc(X1923, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X1923, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1924, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X1924, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1925, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X1924, &
         wf%n_v**2, &
         X1923, &
         wf%n_o**2, &
         zero, &
         X1925, &
         wf%n_o)
!
      call mem%dealloc(X1923)
      call mem%dealloc(X1924)
      call mem%alloc(X1926, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1925, &
         wf%n_o**2, &
         zero, &
         X1926, &
         wf%n_v)
!
      call mem%dealloc(X1925)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1926, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1926)
      call mem%alloc(X1927, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1927, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1928, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1927, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X1928, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1927)
      call mem%alloc(X1929, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1928, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1929, &
         wf%n_o**2)
!
      call mem%dealloc(X1928)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1929, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1929)
      call mem%alloc(X1930, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1930, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1931, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1930, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1931, &
         wf%n_o)
!
      call mem%dealloc(X1930)
      call mem%alloc(X1932, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rAIxx_vo, &
         wf%n_v, &
         X1931, &
         wf%n_o**2, &
         zero, &
         X1932, &
         wf%n_o)
!
      call mem%dealloc(X1931)
      call mem%alloc(X1933, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X1933, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1934, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X1933, &
         wf%n_v**2, &
         X1932, &
         wf%n_o**2, &
         zero, &
         X1934, &
         wf%n_v**2)
!
      call mem%dealloc(X1932)
      call mem%dealloc(X1933)
      call add_1324_to_1234(one, X1934, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1934)
      call mem%alloc(X1935, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         rAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X1935, &
         wf%n_o)
!
      call mem%alloc(X1936, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X1935, X1936, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1935)
      call mem%alloc(X1937, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X1937, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1938, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X1937, &
         wf%n_o**2, &
         X1936, &
         wf%n_v*wf%n_o, &
         zero, &
         X1938, &
         wf%n_v)
!
      call mem%dealloc(X1936)
      call mem%dealloc(X1937)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1938, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1938)
      call mem%alloc(X1939, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1939, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1940, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X1939, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v, &
         zero, &
         X1940, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1939)
      call mem%alloc(X1941, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X1940, &
         wf%n_v, &
         rAIxx_vo, &
         wf%n_v, &
         zero, &
         X1941, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1940)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X1941, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1941)
      call mem%alloc(X1942, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1942, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1943, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1942, &
         wf%n_v*wf%n_o, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1943, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1942)
      call mem%alloc(X1944, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1342(X1943, X1944, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X1943)
      call mem%alloc(X1945, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1944, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1945, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1944)
      call mem%alloc(X1946, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1945, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1946, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1945)
      call add_1432_to_1234(one, X1946, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1946)
      call mem%alloc(X1947, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1947, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1948, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X1948, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1949, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X1947, &
         wf%n_v*wf%n_o, &
         X1948, &
         wf%n_v*wf%n_o, &
         zero, &
         X1949, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1947)
      call mem%dealloc(X1948)
      call mem%alloc(X1950, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1949, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1950, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1949)
      call mem%alloc(X1951, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1950, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1951, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1950)
      call add_1423_to_1234(one, X1951, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1951)
      call mem%alloc(X1952, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X1952, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1953, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -two, &
         X1952, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X1953, &
         wf%n_v)
!
      call mem%dealloc(X1952)
      call mem%alloc(X1954, wf%n_v, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X1953, &
         wf%n_v, &
         zero, &
         X1954, &
         wf%n_v)
!
      call mem%dealloc(X1953)
      call mem%alloc(X1955, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X1954, 1, &
         rAxAx_oo, 1, &
         X1955, &
         wf%n_v**2)
!
      call mem%dealloc(X1954)
      call add_1324_to_1234(one, X1955, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1955)
      call mem%alloc(X1956, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1243(g_ovov, X1956, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1957, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X1956, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X1957, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1956)
      call mem%alloc(X1958, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1342(X1957, X1958, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call mem%dealloc(X1957)
      call mem%alloc(X1959, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1958, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1959, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X1958)
      call mem%alloc(X1960, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1959, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1960, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1959)
      call add_1432_to_1234(one, X1960, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1960)
      call mem%alloc(X1961, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1961, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1962, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1961, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X1962, 1)
!
      call mem%dealloc(X1961)
      call mem%alloc(X1963, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1962, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1963, &
         wf%n_o)
!
      call mem%dealloc(X1962)
      call mem%alloc(X1964, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X1964, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X1965, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1964, &
         wf%n_v**2*wf%n_o, &
         X1963, &
         wf%n_o, &
         zero, &
         X1965, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X1963)
      call mem%dealloc(X1964)
      call add_1342_to_1234(one, X1965, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1965)
      call mem%alloc(X1966, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1966, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1967, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X1966, &
         wf%n_o**2, &
         rAxAx_oo, 1, &
         zero, &
         X1967, 1)
!
      call mem%dealloc(X1966)
      call mem%alloc(X1968, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X1967, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X1968, &
         wf%n_v)
!
      call mem%dealloc(X1967)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X1968, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X1968)
      call mem%alloc(X1969, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1969, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1970, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X1969, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X1970, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1969)
      call mem%alloc(X1971, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1970, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1971, &
         wf%n_v**2)
!
      call mem%dealloc(X1970)
      call mem%alloc(X1972, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1972, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1973, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1972, &
         wf%n_v*wf%n_o, &
         X1971, &
         wf%n_v, &
         zero, &
         X1973, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1971)
      call mem%dealloc(X1972)
      call add_1432_to_1234(one, X1973, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1973)
      call mem%alloc(X1974, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1974, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1975, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X1975, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1976, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X1974, &
         wf%n_o**2, &
         X1975, &
         wf%n_v**2, &
         zero, &
         X1976, &
         wf%n_o**2)
!
      call mem%dealloc(X1974)
      call mem%dealloc(X1975)
      call mem%alloc(X1977, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1976, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1977, &
         wf%n_o**2)
!
      call mem%dealloc(X1976)
      call mem%alloc(X1978, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X1977, &
         wf%n_o, &
         zero, &
         X1978, &
         wf%n_v**2)
!
      call mem%dealloc(X1977)
      call add_1342_to_1234(one, X1978, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1978)
      call mem%alloc(X1979, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X1979, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1980, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X1979, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X1980, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1979)
      call mem%alloc(X1981, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1980, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1981, &
         wf%n_v**2)
!
      call mem%dealloc(X1980)
      call mem%alloc(X1982, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X1981, &
         wf%n_v, &
         zero, &
         X1982, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1981)
      call add_1432_to_1234(one, X1982, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1982)
      call mem%alloc(X1983, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1983, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1984, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         -four, &
         X1983, &
         wf%n_o**2, &
         rAxAx_oo, 1, &
         zero, &
         X1984, 1)
!
      call mem%dealloc(X1983)
      call mem%alloc(X1985, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1985, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1986, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1984, &
         wf%n_v, &
         X1985, &
         wf%n_v*wf%n_o, &
         zero, &
         X1986, &
         wf%n_v)
!
      call mem%dealloc(X1984)
      call mem%dealloc(X1985)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1986, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1986)
      call mem%alloc(X1987, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X1987, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X1988, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X1987, &
         wf%n_o**2, &
         rAxAx_oo, 1, &
         zero, &
         X1988, 1)
!
      call mem%dealloc(X1987)
      call mem%alloc(X1989, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1988, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X1989, &
         wf%n_v)
!
      call mem%dealloc(X1988)
      call mem%alloc(X1990, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1990, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1991, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1990, &
         wf%n_v*wf%n_o, &
         X1989, &
         wf%n_v, &
         zero, &
         X1991, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1989)
      call mem%dealloc(X1990)
      call add_1432_to_1234(one, X1991, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1991)
      call mem%alloc(X1992, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1992, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1993, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X1992, 1, &
         zero, &
         X1993, 1)
!
      call mem%dealloc(X1992)
      call mem%alloc(X1994, wf%n_v, wf%n_v)
!
      call dgemv('N', &
         wf%n_v**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X1993, 1, &
         zero, &
         X1994, 1)
!
      call mem%dealloc(X1993)
      call mem%alloc(X1995, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         X1994, 1, &
         rAxAx_oo, 1, &
         X1995, &
         wf%n_v**2)
!
      call mem%dealloc(X1994)
      call add_1324_to_1234(one, X1995, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X1995)
      call mem%alloc(X1996, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X1996, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X1997, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X1996, &
         wf%n_v, &
         zero, &
         X1997, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1996)
      call mem%alloc(X1998, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X1997, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X1998, &
         wf%n_v**2)
!
      call mem%dealloc(X1997)
      call mem%alloc(X1999, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X1999, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2000, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X1999, &
         wf%n_v*wf%n_o, &
         X1998, &
         wf%n_v, &
         zero, &
         X2000, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X1998)
      call mem%dealloc(X1999)
      call add_1432_to_1234(one, X2000, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2000)
      call mem%alloc(X2001, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2001, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2002, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X2001, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X2002, &
         wf%n_o**2)
!
      call mem%dealloc(X2001)
      call mem%alloc(X2003, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2002, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X2003, &
         wf%n_o**2)
!
      call mem%dealloc(X2002)
      call mem%alloc(X2004, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X2003, &
         wf%n_o, &
         zero, &
         X2004, &
         wf%n_v**2)
!
      call mem%dealloc(X2003)
      call add_1342_to_1234(one, X2004, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2004)
      call mem%alloc(X2005, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2005, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2006, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2005, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X2006, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2005)
      call mem%alloc(X2007, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2006, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X2007, &
         wf%n_v**2)
!
      call mem%dealloc(X2006)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2007, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2007)
      call mem%alloc(X2008, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2008, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2009, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2009, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2010, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X2008, &
         wf%n_o**2, &
         X2009, &
         wf%n_v**2, &
         zero, &
         X2010, &
         wf%n_o**2)
!
      call mem%dealloc(X2008)
      call mem%dealloc(X2009)
      call mem%alloc(X2011, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2010, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X2011, &
         wf%n_o**2)
!
      call mem%dealloc(X2010)
      call mem%alloc(X2012, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2012, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2013, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2012, &
         wf%n_v**2, &
         X2011, &
         wf%n_o, &
         zero, &
         X2013, &
         wf%n_v**2)
!
      call mem%dealloc(X2011)
      call mem%dealloc(X2012)
      call add_1342_to_1234(one, X2013, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2013)
      call mem%alloc(X2014, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2014, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2015, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2014, &
         wf%n_v, &
         zero, &
         X2015, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2014)
      call mem%alloc(X2016, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2015, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X2016, &
         wf%n_v**2)
!
      call mem%dealloc(X2015)
      call mem%alloc(X2017, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X2016, &
         wf%n_v, &
         zero, &
         X2017, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2016)
      call add_1432_to_1234(one, X2017, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2017)
      call mem%alloc(X2018, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2018, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2019, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2018, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2019, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2018)
      call mem%alloc(X2020, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2019, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X2020, &
         wf%n_v**2)
!
      call mem%dealloc(X2019)
      call mem%alloc(X2021, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2021, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2022, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2021, &
         wf%n_v*wf%n_o, &
         X2020, &
         wf%n_v, &
         zero, &
         X2022, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2020)
      call mem%dealloc(X2021)
      call add_1432_to_1234(one, X2022, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2022)
      call mem%alloc(X2023, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2023, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2024, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2023, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2024, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2023)
      call mem%alloc(X2025, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2024, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X2025, &
         wf%n_v**2)
!
      call mem%dealloc(X2024)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2025, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2025)
      call mem%alloc(X2026, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2026, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2027, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2026, &
         wf%n_v, &
         zero, &
         X2027, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2026)
      call mem%alloc(X2028, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2027, &
         wf%n_o, &
         rAxAx_oo, &
         wf%n_o, &
         zero, &
         X2028, &
         wf%n_v**2)
!
      call mem%dealloc(X2027)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2028, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2028)
      call mem%alloc(X2029, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2029, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2030, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2029, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2030, 1)
!
      call mem%dealloc(X2029)
      call mem%alloc(X2031, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X2031, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2032, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2031, &
         wf%n_v*wf%n_o, &
         X2030, 1, &
         zero, &
         X2032, 1)
!
      call mem%dealloc(X2030)
      call mem%dealloc(X2031)
      call mem%alloc(X2033, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2032, 1, &
         rAxxI_ov, 1, &
         X2033, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2032)
      call add_1423_to_1234(one, X2033, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2033)
      call mem%alloc(X2034, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2034, &
         wf%n_o)
!
      call mem%alloc(X2035, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X2034, &
         wf%n_o**2, &
         zero, &
         X2035, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2034)
      call mem%alloc(X2036, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2035, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2036, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2035)
      call add_1423_to_1234(one, X2036, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2036)
      call mem%alloc(X2037, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2037, &
         wf%n_o)
!
      call mem%alloc(X2038, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(X2037, X2038, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2037)
      call mem%alloc(X2039, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**3, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2038, &
         wf%n_o**3, &
         zero, &
         X2039, &
         wf%n_o)
!
      call mem%dealloc(X2038)
      call mem%alloc(X2040, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(t_aibj, X2040, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2041, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X2040, &
         wf%n_v**2, &
         X2039, &
         wf%n_o**2, &
         zero, &
         X2041, &
         wf%n_v**2)
!
      call mem%dealloc(X2039)
      call mem%dealloc(X2040)
      call add_1324_to_1234(one, X2041, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2041)
      call mem%alloc(X2042, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2042, &
         wf%n_o)
!
      call mem%alloc(X2043, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X2042, &
         wf%n_o**2, &
         zero, &
         X2043, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2042)
      call mem%alloc(X2044, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_2134(X2043, X2044, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X2043)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2044, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2044)
      call mem%alloc(X2045, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2045, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2046, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(t_aibj, X2046, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2047, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2046, &
         wf%n_v**2, &
         X2045, &
         wf%n_o**2, &
         zero, &
         X2047, &
         wf%n_o**2)
!
      call mem%dealloc(X2045)
      call mem%dealloc(X2046)
      call mem%alloc(X2048, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**3, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2047, &
         wf%n_o**3, &
         zero, &
         X2048, &
         wf%n_v)
!
      call mem%dealloc(X2047)
      call mem%alloc(X2049, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2048, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2049, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2048)
      call add_1423_to_1234(one, X2049, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2049)
      call mem%alloc(X2050, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2050, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2051, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2050, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2051, 1)
!
      call mem%dealloc(X2050)
      call mem%alloc(X2052, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X2052, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2053, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2052, &
         wf%n_v*wf%n_o, &
         X2051, 1, &
         zero, &
         X2053, 1)
!
      call mem%dealloc(X2051)
      call mem%dealloc(X2052)
      call mem%alloc(X2054, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2053, 1, &
         rAxxI_ov, 1, &
         X2054, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2053)
      call add_1423_to_1234(one, X2054, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2054)
      call mem%alloc(X2055, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2055, &
         wf%n_o)
!
      call mem%alloc(X2056, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X2055, &
         wf%n_o**2, &
         zero, &
         X2056, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2055)
      call mem%alloc(X2057, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2056, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2057, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2056)
      call add_1423_to_1234(one, X2057, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2057)
      call mem%alloc(X2058, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2058, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X2059, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1342(X2058, X2059, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2058)
      call mem%alloc(X2060, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**3, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2059, &
         wf%n_o**3, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2060, &
         wf%n_o**3)
!
      call mem%dealloc(X2059)
      call mem%alloc(X2061, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(t_aibj, X2061, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2062, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X2061, &
         wf%n_v**2, &
         X2060, &
         wf%n_o**2, &
         zero, &
         X2062, &
         wf%n_v**2)
!
      call mem%dealloc(X2060)
      call mem%dealloc(X2061)
      call add_1324_to_1234(one, X2062, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2062)
      call mem%alloc(X2063, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2063, &
         wf%n_o)
!
      call mem%alloc(X2064, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X2063, &
         wf%n_o**2, &
         zero, &
         X2064, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2063)
      call mem%alloc(X2065, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_2134(X2064, X2065, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X2064)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2065, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2065)
      call mem%alloc(X2066, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2066, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2067, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(t_aibj, X2067, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2068, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2067, &
         wf%n_v**2, &
         X2066, &
         wf%n_o**2, &
         zero, &
         X2068, &
         wf%n_o**2)
!
      call mem%dealloc(X2066)
      call mem%dealloc(X2067)
      call mem%alloc(X2069, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o**3, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2068, &
         wf%n_o**3, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2069, &
         wf%n_o**3)
!
      call mem%dealloc(X2068)
      call mem%alloc(X2070, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1423(X2069, X2070, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X2069)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2070, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2070)
      call mem%alloc(X2071, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2071, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2072, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2072, wf%n_v, wf%n_o)
      call mem%alloc(X2073, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2071, &
         wf%n_v*wf%n_o, &
         X2072, 1, &
         zero, &
         X2073, 1)
!
      call mem%dealloc(X2071)
      call mem%dealloc(X2072)
      call mem%alloc(X2074, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X2073, 1, &
         zero, &
         X2074, 1)
!
      call mem%dealloc(X2073)
      call mem%alloc(X2075, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2074, 1, &
         rAxxI_ov, 1, &
         X2075, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2074)
      call add_1423_to_1234(one, X2075, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2075)
      call mem%alloc(X2076, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2076, &
         wf%n_o)
!
      call mem%alloc(X2077, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(X2076, X2077, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2076)
      call mem%alloc(X2078, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**3, &
         wf%n_v, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X2077, &
         wf%n_o**3, &
         zero, &
         X2078, &
         wf%n_o)
!
      call mem%dealloc(X2077)
      call mem%alloc(X2079, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(t_aibj, X2079, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2080, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X2079, &
         wf%n_v**2, &
         X2078, &
         wf%n_o**2, &
         zero, &
         X2080, &
         wf%n_v**2)
!
      call mem%dealloc(X2078)
      call mem%dealloc(X2079)
      call add_1342_to_1234(one, X2080, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2080)
      call mem%alloc(X2081, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2081, &
         wf%n_o)
!
      call mem%alloc(X2082, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(t_aibj, X2082, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2083, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X2082, &
         wf%n_v*wf%n_o, &
         X2081, &
         wf%n_o**2, &
         zero, &
         X2083, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2081)
      call mem%dealloc(X2082)
      call mem%alloc(X2084, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2083, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2084, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2083)
      call add_1423_to_1234(one, X2084, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2084)
      call mem%alloc(X2085, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2085, &
         wf%n_o)
!
      call mem%alloc(X2086, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X2086, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2087, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         X2086, &
         wf%n_v*wf%n_o, &
         X2085, &
         wf%n_o**2, &
         zero, &
         X2087, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2085)
      call mem%dealloc(X2086)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2087, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2087)
      call mem%alloc(X2088, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2088, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2089, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(t_aibj, X2089, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2090, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X2089, &
         wf%n_v**2, &
         X2088, &
         wf%n_o**2, &
         zero, &
         X2090, &
         wf%n_o**2)
!
      call mem%dealloc(X2088)
      call mem%dealloc(X2089)
      call mem%alloc(X2091, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**3, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2090, &
         wf%n_o**3, &
         zero, &
         X2091, &
         wf%n_v)
!
      call mem%dealloc(X2090)
      call mem%alloc(X2092, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2091, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2092, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2091)
      call add_1243_to_1234(one, X2092, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2092)
      call mem%alloc(X2093, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X2093, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2094, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X2093, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X2094, &
         wf%n_o)
!
      call mem%dealloc(X2093)
      call mem%alloc(X2095, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2094, &
         wf%n_o, &
         zero, &
         X2095, &
         wf%n_v)
!
      call mem%dealloc(X2094)
      call mem%alloc(X2096, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2095, 1, &
         rAxxI_ov, 1, &
         X2096, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2095)
      call add_1423_to_1234(one, X2096, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2096)
      call mem%alloc(X2097, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2097, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2098, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -two, &
         X2097, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X2098, &
         wf%n_v)
!
      call mem%dealloc(X2097)
      call mem%alloc(X2099, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2098, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2099, &
         wf%n_v)
!
      call mem%dealloc(X2098)
      call mem%alloc(X2100, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2099, 1, &
         rAxxI_ov, 1, &
         X2100, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2099)
      call add_1423_to_1234(one, X2100, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2100)
      call mem%alloc(X2101, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2101, &
         wf%n_o)
!
      call mem%alloc(X2102, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X2101, X2102, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2101)
      call mem%alloc(X2103, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X2102, &
         wf%n_o**2, &
         zero, &
         X2103, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2102)
      call mem%alloc(X2104, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2103, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2104, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2103)
      call add_1423_to_1234(one, X2104, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2104)
      call mem%alloc(X2105, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2105, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2106, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2105, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2106, 1)
!
      call mem%dealloc(X2105)
      call mem%alloc(X2107, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2106, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2107, &
         wf%n_o)
!
      call mem%dealloc(X2106)
      call mem%alloc(X2108, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X2108, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2109, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2108, &
         wf%n_v**2*wf%n_o, &
         X2107, &
         wf%n_o, &
         zero, &
         X2109, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X2107)
      call mem%dealloc(X2108)
      call add_1342_to_1234(one, X2109, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2109)
      call mem%alloc(X2110, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2110, &
         wf%n_o)
!
      call mem%alloc(X2111, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X2110, X2111, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2110)
      call mem%alloc(X2112, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X2111, &
         wf%n_o**2, &
         zero, &
         X2112, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2111)
      call mem%alloc(X2113, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_2134(X2112, X2113, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X2112)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2113, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2113)
      call mem%alloc(X2114, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2114, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2115, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2114, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2115, 1)
!
      call mem%dealloc(X2114)
      call mem%alloc(X2116, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2115, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2116, &
         wf%n_v)
!
      call mem%dealloc(X2115)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2116, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2116)
      call mem%alloc(X2117, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2117, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2118, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2117, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2118, 1)
!
      call mem%dealloc(X2117)
      call mem%alloc(X2119, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2118, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2119, &
         wf%n_v)
!
      call mem%dealloc(X2118)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2119, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2119)
      call mem%alloc(X2120, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2120, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2121, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2120, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2121, 1)
!
      call mem%dealloc(X2120)
      call mem%alloc(X2122, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2121, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2122, &
         wf%n_o)
!
      call mem%dealloc(X2121)
      call mem%alloc(X2123, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X2123, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2124, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2123, &
         wf%n_v**2*wf%n_o, &
         X2122, &
         wf%n_o, &
         zero, &
         X2124, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X2122)
      call mem%dealloc(X2123)
      call add_1342_to_1234(one, X2124, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2124)
      call mem%alloc(X2125, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2125, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2126, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -two, &
         X2125, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X2126, &
         wf%n_v)
!
      call mem%dealloc(X2125)
      call mem%alloc(X2127, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2126, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2127, &
         wf%n_v)
!
      call mem%dealloc(X2126)
      call mem%alloc(X2128, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2127, 1, &
         rAxxI_ov, 1, &
         X2128, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2127)
      call add_1423_to_1234(one, X2128, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2128)
      call mem%alloc(X2129, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X2129, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2130, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X2129, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X2130, &
         wf%n_o)
!
      call mem%dealloc(X2129)
      call mem%alloc(X2131, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2130, &
         wf%n_o, &
         zero, &
         X2131, &
         wf%n_v)
!
      call mem%dealloc(X2130)
      call mem%alloc(X2132, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2131, 1, &
         rAxxI_ov, 1, &
         X2132, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2131)
      call add_1423_to_1234(one, X2132, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2132)
      call mem%alloc(X2133, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2133, &
         wf%n_o)
!
      call mem%alloc(X2134, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X2133, X2134, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2133)
      call mem%alloc(X2135, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X2134, &
         wf%n_o**2, &
         zero, &
         X2135, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2134)
      call mem%alloc(X2136, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2135, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2136, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2135)
      call add_1423_to_1234(one, X2136, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2136)
      call mem%alloc(X2137, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2137, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2138, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2137, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2138, 1)
!
      call mem%dealloc(X2137)
      call mem%alloc(X2139, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2138, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2139, &
         wf%n_o)
!
      call mem%dealloc(X2138)
      call mem%alloc(X2140, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X2140, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2141, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2140, &
         wf%n_v**2*wf%n_o, &
         X2139, &
         wf%n_o, &
         zero, &
         X2141, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X2139)
      call mem%dealloc(X2140)
      call add_1342_to_1234(one, X2141, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2141)
      call mem%alloc(X2142, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2142, &
         wf%n_o)
!
      call mem%alloc(X2143, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X2142, X2143, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2142)
      call mem%alloc(X2144, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X2143, &
         wf%n_o**2, &
         zero, &
         X2144, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2143)
      call mem%alloc(X2145, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_2134(X2144, X2145, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X2144)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2145, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2145)
      call mem%alloc(X2146, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2146, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2147, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2146, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2147, 1)
!
      call mem%dealloc(X2146)
      call mem%alloc(X2148, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2147, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2148, &
         wf%n_v)
!
      call mem%dealloc(X2147)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2148, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2148)
      call mem%alloc(X2149, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2149, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2150, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2149, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2150, 1)
!
      call mem%dealloc(X2149)
      call mem%alloc(X2151, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2150, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2151, &
         wf%n_o)
!
      call mem%dealloc(X2150)
      call mem%alloc(X2152, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X2152, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2153, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2152, &
         wf%n_v**2*wf%n_o, &
         X2151, &
         wf%n_o, &
         zero, &
         X2153, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X2151)
      call mem%dealloc(X2152)
      call add_1342_to_1234(one, X2153, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2153)
      call mem%alloc(X2154, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2154, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2155, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2154, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2155, 1)
!
      call mem%dealloc(X2154)
      call mem%alloc(X2156, wf%n_v, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2155, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2156, &
         wf%n_v)
!
      call mem%dealloc(X2155)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2156, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2156)
      call mem%alloc(X2157, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2157, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2158, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X2157, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X2158, &
         wf%n_o**2)
!
      call mem%dealloc(X2157)
      call mem%alloc(X2159, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2159, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2160, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X2159, &
         wf%n_o**2, &
         X2158, &
         wf%n_o**2, &
         zero, &
         X2160, &
         wf%n_v)
!
      call mem%dealloc(X2158)
      call mem%dealloc(X2159)
      call mem%alloc(X2161, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2160, 1, &
         rAxxI_ov, 1, &
         X2161, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2160)
      call add_1423_to_1234(one, X2161, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2161)
      call mem%alloc(X2162, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2162, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2163, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2162, &
         wf%n_v*wf%n_o, &
         zero, &
         X2163, &
         wf%n_v)
!
      call mem%dealloc(X2162)
      call mem%alloc(X2164, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2163, &
         wf%n_v*wf%n_o, &
         zero, &
         X2164, &
         wf%n_o)
!
      call mem%dealloc(X2163)
      call mem%alloc(X2165, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X2165, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2166, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2165, &
         wf%n_v*wf%n_o, &
         X2164, &
         wf%n_v*wf%n_o, &
         zero, &
         X2166, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2164)
      call mem%dealloc(X2165)
      call add_1423_to_1234(one, X2166, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2166)
      call mem%alloc(X2167, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2167, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2168, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2167, &
         wf%n_v*wf%n_o, &
         zero, &
         X2168, &
         wf%n_v)
!
      call mem%dealloc(X2167)
      call mem%alloc(X2169, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2168, &
         wf%n_v*wf%n_o, &
         zero, &
         X2169, &
         wf%n_o)
!
      call mem%dealloc(X2168)
      call mem%alloc(X2170, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X2169, &
         wf%n_v*wf%n_o, &
         zero, &
         X2170, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2169)
      call add_1423_to_1234(one, X2170, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2170)
      call mem%alloc(X2171, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2171, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2172, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2171, &
         wf%n_v*wf%n_o, &
         zero, &
         X2172, &
         wf%n_v)
!
      call mem%dealloc(X2171)
      call mem%alloc(X2173, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2173, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2174, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2173, &
         wf%n_o**2, &
         X2172, &
         wf%n_v*wf%n_o, &
         zero, &
         X2174, &
         wf%n_o**2)
!
      call mem%dealloc(X2172)
      call mem%dealloc(X2173)
      call mem%alloc(X2175, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2174, X2175, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2174)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2175, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2175)
      call mem%alloc(X2176, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2176, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2177, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X2176, &
         wf%n_v*wf%n_o, &
         zero, &
         X2177, &
         wf%n_o)
!
      call mem%dealloc(X2176)
      call mem%alloc(X2178, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_312(txIxx_vvo, X2178, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2179, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2178, &
         wf%n_v*wf%n_o, &
         X2177, &
         wf%n_o**2, &
         zero, &
         X2179, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2177)
      call mem%dealloc(X2178)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2179, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2179)
      call mem%alloc(X2180, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2180, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2181, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2180, &
         wf%n_v*wf%n_o, &
         zero, &
         X2181, &
         wf%n_v)
!
      call mem%dealloc(X2180)
      call mem%alloc(X2182, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(tAxxx_ovo, X2182, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2183, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2182, &
         wf%n_o**2, &
         X2181, &
         wf%n_v*wf%n_o, &
         zero, &
         X2183, &
         wf%n_o**2)
!
      call mem%dealloc(X2181)
      call mem%dealloc(X2182)
      call mem%alloc(X2184, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2183, X2184, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2183)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2184, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2184)
      call mem%alloc(X2185, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2185, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2186, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2185, &
         wf%n_v*wf%n_o, &
         zero, &
         X2186, &
         wf%n_o)
!
      call mem%dealloc(X2185)
      call mem%alloc(X2187, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_312(txIxx_vvo, X2187, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2188, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2187, &
         wf%n_v*wf%n_o, &
         X2186, &
         wf%n_o**2, &
         zero, &
         X2188, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2186)
      call mem%dealloc(X2187)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2188, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2188)
      call mem%alloc(X2189, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2189, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2190, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2189, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2190, 1)
!
      call mem%dealloc(X2189)
      call mem%alloc(X2191, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2191, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2192, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2190, &
         wf%n_v, &
         X2191, &
         wf%n_v*wf%n_o, &
         zero, &
         X2192, &
         wf%n_o)
!
      call mem%dealloc(X2190)
      call mem%dealloc(X2191)
      call mem%alloc(X2193, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2192, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2193, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2192)
      call add_1423_to_1234(one, X2193, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2193)
      call mem%alloc(X2194, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2194, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2195, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2194, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2195, 1)
!
      call mem%dealloc(X2194)
      call mem%alloc(X2196, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2196, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2197, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2195, &
         wf%n_v, &
         X2196, &
         wf%n_o**2, &
         zero, &
         X2197, &
         wf%n_o)
!
      call mem%dealloc(X2195)
      call mem%dealloc(X2196)
      call mem%alloc(X2198, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2197, &
         wf%n_o, &
         zero, &
         X2198, &
         wf%n_v**2)
!
      call mem%dealloc(X2197)
      call add_1324_to_1234(one, X2198, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2198)
      call mem%alloc(X2199, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2199, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2200, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2199, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X2200, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2199)
      call mem%alloc(X2201, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X2200, &
         wf%n_v*wf%n_o, &
         zero, &
         X2201, &
         wf%n_v)
!
      call mem%dealloc(X2200)
      call mem%alloc(X2202, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2201, 1, &
         rAxxI_ov, 1, &
         X2202, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2201)
      call add_1423_to_1234(one, X2202, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2202)
      call mem%alloc(X2203, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2203, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2204, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2204, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2205, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X2203, &
         wf%n_o**2, &
         X2204, &
         wf%n_v**2, &
         zero, &
         X2205, &
         wf%n_o**2)
!
      call mem%dealloc(X2203)
      call mem%dealloc(X2204)
      call mem%alloc(X2206, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2206, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2207, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X2206, &
         wf%n_o**2, &
         X2205, &
         wf%n_o**2, &
         zero, &
         X2207, &
         wf%n_v)
!
      call mem%dealloc(X2205)
      call mem%dealloc(X2206)
      call mem%alloc(X2208, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2207, 1, &
         rAxxI_ov, 1, &
         X2208, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2207)
      call add_1423_to_1234(one, X2208, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2208)
      call mem%alloc(X2209, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2209, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2210, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2209, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2210, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2209)
      call mem%alloc(X2211, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X2210, &
         wf%n_v*wf%n_o, &
         zero, &
         X2211, &
         wf%n_v)
!
      call mem%dealloc(X2210)
      call mem%alloc(X2212, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2211, 1, &
         rAxxI_ov, 1, &
         X2212, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2211)
      call add_1423_to_1234(one, X2212, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2212)
      call mem%alloc(X2213, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2213, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2214, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X2213, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2214, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2213)
      call mem%alloc(X2215, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2214, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2215, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2214)
      call mem%alloc(X2216, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X2216, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2217, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2216, &
         wf%n_v*wf%n_o, &
         X2215, &
         wf%n_o, &
         zero, &
         X2217, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2215)
      call mem%dealloc(X2216)
      call add_1432_to_1234(one, X2217, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2217)
      call mem%alloc(X2218, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2218, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2219, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X2218, &
         wf%n_v*wf%n_o, &
         zero, &
         X2219, &
         wf%n_o)
!
      call mem%dealloc(X2218)
      call mem%alloc(X2220, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2219, &
         wf%n_o**2, &
         zero, &
         X2220, &
         wf%n_o)
!
      call mem%dealloc(X2219)
      call mem%alloc(X2221, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2221, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2222, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2221, &
         wf%n_v**2, &
         X2220, &
         wf%n_o**2, &
         zero, &
         X2222, &
         wf%n_v**2)
!
      call mem%dealloc(X2220)
      call mem%dealloc(X2221)
      call add_1324_to_1234(one, X2222, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2222)
      call mem%alloc(X2223, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2223, &
         wf%n_o)
!
      call mem%alloc(X2224, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X2223, X2224, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2223)
      call mem%alloc(X2225, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2225, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2226, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2225, &
         wf%n_o**2, &
         X2224, &
         wf%n_v*wf%n_o, &
         zero, &
         X2226, &
         wf%n_v)
!
      call mem%dealloc(X2224)
      call mem%dealloc(X2225)
      call mem%alloc(X2227, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X2226, &
         wf%n_v*wf%n_o, &
         zero, &
         X2227, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2226)
      call add_1432_to_1234(one, X2227, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2227)
      call mem%alloc(X2228, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2228, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2229, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2228, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2229, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2228)
      call mem%alloc(X2230, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2229, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2230, &
         wf%n_o**2)
!
      call mem%dealloc(X2229)
      call mem%alloc(X2231, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2231, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2232, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2231, &
         wf%n_v**2, &
         X2230, &
         wf%n_o, &
         zero, &
         X2232, &
         wf%n_v**2)
!
      call mem%dealloc(X2230)
      call mem%dealloc(X2231)
      call add_1342_to_1234(one, X2232, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2232)
      call mem%alloc(X2233, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2233, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2234, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X2233, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2234, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2233)
      call mem%alloc(X2235, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2234, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2235, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2234)
      call mem%alloc(X2236, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X2235, &
         wf%n_o, &
         zero, &
         X2236, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2235)
      call add_1432_to_1234(one, X2236, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2236)
      call mem%alloc(X2237, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2237, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X2238, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1324(X2237, X2238, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2237)
      call mem%alloc(X2239, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2239, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2240, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X2238, &
         wf%n_o**2, &
         X2239, &
         wf%n_o**2, &
         zero, &
         X2240, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2238)
      call mem%dealloc(X2239)
      call mem%alloc(X2241, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X2240, &
         wf%n_v, &
         zero, &
         X2241, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2240)
      call add_1423_to_1234(one, X2241, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2241)
      call mem%alloc(X2242, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2242, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2243, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2243, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2244, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2243, &
         wf%n_v**2, &
         X2242, &
         wf%n_o**2, &
         zero, &
         X2244, &
         wf%n_o)
!
      call mem%dealloc(X2242)
      call mem%dealloc(X2243)
      call mem%alloc(X2245, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2244, &
         wf%n_o**2, &
         zero, &
         X2245, &
         wf%n_v)
!
      call mem%dealloc(X2244)
      call mem%alloc(X2246, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2245, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2246, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2245)
      call add_1423_to_1234(one, X2246, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2246)
      call mem%alloc(X2247, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2247, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2248, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2247, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X2248, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2247)
      call mem%alloc(X2249, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X2248, X2249, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2248)
      call mem%alloc(X2250, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2249, &
         wf%n_o**2, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2250, &
         wf%n_o**2)
!
      call mem%dealloc(X2249)
      call mem%alloc(X2251, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X2250, X2251, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2250)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2251, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2251)
      call mem%alloc(X2252, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2252, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2253, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2253, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2254, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2253, &
         wf%n_v**2, &
         X2252, &
         wf%n_o**2, &
         zero, &
         X2254, &
         wf%n_o)
!
      call mem%dealloc(X2252)
      call mem%dealloc(X2253)
      call mem%alloc(X2255, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2254, &
         wf%n_o**2, &
         zero, &
         X2255, &
         wf%n_v)
!
      call mem%dealloc(X2254)
      call mem%alloc(X2256, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2255, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X2256, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2255)
      call add_1432_to_1234(one, X2256, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2256)
      call mem%alloc(X2257, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2257, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2258, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2257, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2258, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2257)
      call mem%alloc(X2259, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2258, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2259, &
         wf%n_o**2)
!
      call mem%dealloc(X2258)
      call mem%alloc(X2260, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X2259, X2260, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2259)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2260, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2260)
      call mem%alloc(X2261, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2261, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2262, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2261, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2262, 1)
!
      call mem%dealloc(X2261)
      call mem%alloc(X2263, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2262, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2263, &
         wf%n_o)
!
      call mem%dealloc(X2262)
      call mem%alloc(X2264, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2263, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2264, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2263)
      call add_1423_to_1234(one, X2264, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2264)
      call mem%alloc(X2265, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2265, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2266, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2265, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2266, 1)
!
      call mem%dealloc(X2265)
      call mem%alloc(X2267, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2267, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2268, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2266, &
         wf%n_v, &
         X2267, &
         wf%n_o**2, &
         zero, &
         X2268, &
         wf%n_o)
!
      call mem%dealloc(X2266)
      call mem%dealloc(X2267)
      call mem%alloc(X2269, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2269, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2270, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2269, &
         wf%n_v**2, &
         X2268, &
         wf%n_o, &
         zero, &
         X2270, &
         wf%n_v**2)
!
      call mem%dealloc(X2268)
      call mem%dealloc(X2269)
      call add_1324_to_1234(one, X2270, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2270)
      call mem%alloc(X2271, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2271, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2272, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X2271, 1, &
         zero, &
         X2272, 1)
!
      call mem%dealloc(X2271)
      call mem%alloc(X2273, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2272, 1, &
         zero, &
         X2273, 1)
!
      call mem%dealloc(X2272)
      call mem%alloc(X2274, wf%n_v, wf%n_o)
      call sort_to_21(X2273, X2274, wf%n_o, wf%n_v)
      call mem%dealloc(X2273)
      call mem%alloc(X2275, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2274, 1, &
         rAxxI_ov, 1, &
         X2275, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2274)
      call add_1423_to_1234(one, X2275, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2275)
      call mem%alloc(X2276, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2276, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2277, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X2276, 1, &
         zero, &
         X2277, 1)
!
      call mem%dealloc(X2276)
      call mem%alloc(X2278, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X2277, 1, &
         zero, &
         X2278, 1)
!
      call mem%dealloc(X2277)
      call mem%alloc(X2279, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2278, 1, &
         rAxxI_ov, 1, &
         X2279, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2278)
      call add_1423_to_1234(one, X2279, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2279)
      call mem%alloc(X2280, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2280, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2281, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2280, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2281, &
         wf%n_v)
!
      call mem%dealloc(X2280)
      call mem%alloc(X2282, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2281, &
         wf%n_v*wf%n_o, &
         zero, &
         X2282, &
         wf%n_o)
!
      call mem%dealloc(X2281)
      call mem%alloc(X2283, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X2283, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2284, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2283, &
         wf%n_v*wf%n_o, &
         X2282, &
         wf%n_v*wf%n_o, &
         zero, &
         X2284, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2282)
      call mem%dealloc(X2283)
      call add_1423_to_1234(one, X2284, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2284)
      call mem%alloc(X2285, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2285, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2286, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2285, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2286, &
         wf%n_v)
!
      call mem%dealloc(X2285)
      call mem%alloc(X2287, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2286, &
         wf%n_v*wf%n_o, &
         zero, &
         X2287, &
         wf%n_o)
!
      call mem%dealloc(X2286)
      call mem%alloc(X2288, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X2287, &
         wf%n_v*wf%n_o, &
         zero, &
         X2288, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2287)
      call add_1423_to_1234(one, X2288, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2288)
      call mem%alloc(X2289, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2289, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2290, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2289, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2290, &
         wf%n_v)
!
      call mem%dealloc(X2289)
      call mem%alloc(X2291, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2291, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2292, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2291, &
         wf%n_o**2, &
         X2290, &
         wf%n_v*wf%n_o, &
         zero, &
         X2292, &
         wf%n_o**2)
!
      call mem%dealloc(X2290)
      call mem%dealloc(X2291)
      call mem%alloc(X2293, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2292, X2293, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2292)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2293, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2293)
      call mem%alloc(X2294, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2294, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2295, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2294, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2295, &
         wf%n_v)
!
      call mem%dealloc(X2294)
      call mem%alloc(X2296, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(tAxxx_ovo, X2296, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2297, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2296, &
         wf%n_o**2, &
         X2295, &
         wf%n_v*wf%n_o, &
         zero, &
         X2297, &
         wf%n_o**2)
!
      call mem%dealloc(X2295)
      call mem%dealloc(X2296)
      call mem%alloc(X2298, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2297, X2298, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2297)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2298, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2298)
      call mem%alloc(X2299, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2299, 1)
!
      call mem%alloc(X2300, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2300, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2301, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2299, &
         wf%n_o, &
         X2300, &
         wf%n_v*wf%n_o, &
         zero, &
         X2301, &
         wf%n_o)
!
      call mem%dealloc(X2299)
      call mem%dealloc(X2300)
      call mem%alloc(X2302, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2301, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2302, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2301)
      call add_1423_to_1234(one, X2302, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2302)
      call mem%alloc(X2303, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2303, 1)
!
      call mem%alloc(X2304, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2304, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2305, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2303, &
         wf%n_o, &
         X2304, &
         wf%n_o**2, &
         zero, &
         X2305, &
         wf%n_o)
!
      call mem%dealloc(X2303)
      call mem%dealloc(X2304)
      call mem%alloc(X2306, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X2305, &
         wf%n_o, &
         zero, &
         X2306, &
         wf%n_v**2)
!
      call mem%dealloc(X2305)
      call add_1324_to_1234(one, X2306, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2306)
      call mem%alloc(X2307, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2307, &
         wf%n_o)
!
      call mem%alloc(X2308, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X2307, X2308, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2307)
      call mem%alloc(X2309, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2309, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2310, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2309, &
         wf%n_o**2, &
         X2308, &
         wf%n_v*wf%n_o, &
         zero, &
         X2310, &
         wf%n_v)
!
      call mem%dealloc(X2308)
      call mem%dealloc(X2309)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2310, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2310)
      call mem%alloc(X2311, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2311, &
         wf%n_o)
!
      call mem%alloc(X2312, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2311, X2312, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2311)
      call mem%alloc(X2313, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2313, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2314, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2313, &
         wf%n_o**2, &
         X2312, &
         wf%n_v*wf%n_o, &
         zero, &
         X2314, &
         wf%n_v)
!
      call mem%dealloc(X2312)
      call mem%dealloc(X2313)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2314, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2314)
      call mem%alloc(X2315, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2315, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2316, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2315, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X2316, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2315)
      call mem%alloc(X2317, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X2316, X2317, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2316)
      call mem%alloc(X2318, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2317, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2318, &
         wf%n_o**2)
!
      call mem%dealloc(X2317)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2318, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2318)
      call mem%alloc(X2319, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2319, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2320, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2319, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2320, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2319)
      call mem%alloc(X2321, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2320, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2321, &
         wf%n_o**2)
!
      call mem%dealloc(X2320)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2321, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2321)
      call mem%alloc(X2322, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2322, 1)
!
      call mem%alloc(X2323, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2322, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2323, &
         wf%n_o)
!
      call mem%dealloc(X2322)
      call mem%alloc(X2324, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X2323, &
         wf%n_o, &
         zero, &
         X2324, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2323)
      call add_1432_to_1234(one, X2324, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2324)
      call mem%alloc(X2325, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2325, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2326, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2325, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2326, 1)
!
      call mem%dealloc(X2325)
      call mem%alloc(X2327, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2326, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2327, &
         wf%n_o)
!
      call mem%dealloc(X2326)
      call mem%alloc(X2328, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X2327, &
         wf%n_o, &
         zero, &
         X2328, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2327)
      call add_1432_to_1234(one, X2328, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2328)
      call mem%alloc(X2329, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2329, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2330, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2330, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2331, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2329, &
         wf%n_v*wf%n_o, &
         X2330, &
         wf%n_o, &
         zero, &
         X2331, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2329)
      call mem%dealloc(X2330)
      call mem%alloc(X2332, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v, &
         X2331, &
         wf%n_v*wf%n_o, &
         zero, &
         X2332, &
         wf%n_v)
!
      call mem%dealloc(X2331)
      call mem%alloc(X2333, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2333, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2333, 1, &
         X2332, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2332)
      call mem%dealloc(X2333)
      call mem%alloc(X2334, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2334, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2335, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X2334, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X2335, &
         wf%n_o**2)
!
      call mem%dealloc(X2334)
      call mem%alloc(X2336, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2336, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2337, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o**2, &
         one, &
         X2336, &
         wf%n_o**2, &
         X2335, &
         wf%n_o**2, &
         zero, &
         X2337, &
         wf%n_v)
!
      call mem%dealloc(X2335)
      call mem%dealloc(X2336)
      call mem%alloc(X2338, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2338, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2338, 1, &
         X2337, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2337)
      call mem%dealloc(X2338)
      call mem%alloc(X2339, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X2339, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2340, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X2339, 1, &
         zero, &
         X2340, 1)
!
      call mem%dealloc(X2339)
      call mem%alloc(X2341, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2341, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2342, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2341, &
         wf%n_v*wf%n_o, &
         X2340, 1, &
         zero, &
         X2342, 1)
!
      call mem%dealloc(X2340)
      call mem%dealloc(X2341)
      call mem%alloc(X2343, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2342, 1, &
         rAxxI_ov, 1, &
         X2343, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2342)
      call add_1423_to_1234(one, X2343, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2343)
      call mem%alloc(X2344, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2344, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2345, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2345, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2346, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2344, &
         wf%n_v*wf%n_o, &
         X2345, &
         wf%n_o, &
         zero, &
         X2346, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2344)
      call mem%dealloc(X2345)
      call mem%alloc(X2347, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v, &
         X2346, &
         wf%n_v*wf%n_o, &
         zero, &
         X2347, &
         wf%n_v)
!
      call mem%dealloc(X2346)
      call mem%alloc(X2348, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2347, 1, &
         rAxxI_ov, 1, &
         X2348, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2347)
      call add_1423_to_1234(one, X2348, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2348)
      call mem%alloc(X2349, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2349, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2350, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2349, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2350, &
         wf%n_o)
!
      call mem%dealloc(X2349)
      call mem%alloc(X2351, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2350, &
         wf%n_o**2, &
         zero, &
         X2351, &
         wf%n_o)
!
      call mem%dealloc(X2350)
      call mem%alloc(X2352, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2351, &
         wf%n_o**2, &
         zero, &
         X2352, &
         wf%n_v**2)
!
      call mem%dealloc(X2351)
      call add_1324_to_1234(one, X2352, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2352)
      call mem%alloc(X2353, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2353, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2354, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2353, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2354, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2353)
      call mem%alloc(X2355, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2354, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2355, &
         wf%n_o**2)
!
      call mem%dealloc(X2354)
      call mem%alloc(X2356, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2355, &
         wf%n_o, &
         zero, &
         X2356, &
         wf%n_v**2)
!
      call mem%dealloc(X2355)
      call add_1342_to_1234(one, X2356, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2356)
      call mem%alloc(X2357, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         rAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2357, &
         wf%n_o)
!
      call mem%alloc(X2358, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X2357, X2358, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2357)
      call mem%alloc(X2359, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2359, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2360, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2359, &
         wf%n_o**2, &
         X2358, &
         wf%n_v*wf%n_o, &
         zero, &
         X2360, &
         wf%n_v)
!
      call mem%dealloc(X2358)
      call mem%dealloc(X2359)
      call mem%alloc(X2361, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2361, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2362, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2361, &
         wf%n_v*wf%n_o, &
         X2360, &
         wf%n_v*wf%n_o, &
         zero, &
         X2362, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2360)
      call mem%dealloc(X2361)
      call add_1432_to_1234(one, X2362, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2362)
      call mem%alloc(X2363, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2363, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2364, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txIxx_vvo, &
         wf%n_v, &
         X2363, &
         wf%n_v*wf%n_o, &
         zero, &
         X2364, &
         wf%n_v)
!
      call mem%dealloc(X2363)
      call mem%alloc(X2365, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2364, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2365, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2364)
      call mem%alloc(X2366, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2365, X2366, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2365)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2366, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2366)
      call mem%alloc(X2367, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2367, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2368, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2367, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2368, &
         wf%n_o)
!
      call mem%dealloc(X2367)
      call mem%alloc(X2369, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_312(txIxx_vvo, X2369, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2370, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2369, &
         wf%n_v*wf%n_o, &
         X2368, &
         wf%n_o**2, &
         zero, &
         X2370, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2368)
      call mem%dealloc(X2369)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2370, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2370)
      call mem%alloc(X2371, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2371, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2372, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2371, &
         wf%n_o**2, &
         zero, &
         X2372, &
         wf%n_o)
!
      call mem%dealloc(X2371)
      call mem%alloc(X2373, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2372, &
         wf%n_o**2, &
         zero, &
         X2373, &
         wf%n_v)
!
      call mem%dealloc(X2372)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2373, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2373)
      call mem%alloc(X2374, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2374, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2375, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2374, &
         wf%n_o**2, &
         zero, &
         X2375, &
         wf%n_o)
!
      call mem%dealloc(X2374)
      call mem%alloc(X2376, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2375, &
         wf%n_o**2, &
         zero, &
         X2376, &
         wf%n_v)
!
      call mem%dealloc(X2375)
      call mem%alloc(X2377, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2376, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2377, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2376)
      call add_1423_to_1234(one, X2377, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2377)
      call mem%alloc(X2378, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2378, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2379, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2378, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2379, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2378)
      call mem%alloc(X2380, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X2379, &
         wf%n_v*wf%n_o, &
         zero, &
         X2380, &
         wf%n_v)
!
      call mem%dealloc(X2379)
      call mem%alloc(X2381, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2381, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2381, 1, &
         X2380, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2380)
      call mem%dealloc(X2381)
      call mem%alloc(X2382, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X2382, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2383, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X2382, 1, &
         zero, &
         X2383, 1)
!
      call mem%dealloc(X2382)
      call mem%alloc(X2384, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X2383, 1, &
         zero, &
         X2384, 1)
!
      call mem%dealloc(X2383)
      call mem%alloc(X2385, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2384, 1, &
         rAxxI_ov, 1, &
         X2385, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2384)
      call add_1423_to_1234(one, X2385, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2385)
      call mem%alloc(X2386, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2386, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2387, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2386, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2387, &
         wf%n_o)
!
      call mem%dealloc(X2386)
      call mem%alloc(X2388, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2387, &
         wf%n_o**2, &
         zero, &
         X2388, &
         wf%n_o)
!
      call mem%dealloc(X2387)
      call mem%alloc(X2389, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2389, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2390, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2389, &
         wf%n_v**2, &
         X2388, &
         wf%n_o**2, &
         zero, &
         X2390, &
         wf%n_v**2)
!
      call mem%dealloc(X2388)
      call mem%dealloc(X2389)
      call add_1324_to_1234(one, X2390, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2390)
      call mem%alloc(X2391, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2391, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2392, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2391, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2392, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2391)
      call mem%alloc(X2393, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2392, &
         wf%n_v, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2393, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2392)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2393, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2393)
      call mem%alloc(X2394, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2394, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2395, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2394, &
         wf%n_o, &
         zero, &
         X2395, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2394)
      call mem%alloc(X2396, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X2395, X2396, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2395)
      call mem%alloc(X2397, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2396, &
         wf%n_o**2, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2397, &
         wf%n_o**2)
!
      call mem%dealloc(X2396)
      call mem%alloc(X2398, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(X2397, X2398, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2397)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2398, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2398)
      call mem%alloc(X2399, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2399, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2400, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txxxI_vov, &
         wf%n_v, &
         X2399, &
         wf%n_v*wf%n_o, &
         zero, &
         X2400, &
         wf%n_v)
!
      call mem%dealloc(X2399)
      call mem%alloc(X2401, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2401, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2402, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2401, &
         wf%n_o**2, &
         X2400, &
         wf%n_v*wf%n_o, &
         zero, &
         X2402, &
         wf%n_o**2)
!
      call mem%dealloc(X2400)
      call mem%dealloc(X2401)
      call mem%alloc(X2403, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2402, X2403, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2402)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2403, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2403)
      call mem%alloc(X2404, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2404, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2405, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2405, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2406, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X2405, &
         wf%n_v**2, &
         X2404, &
         wf%n_o**2, &
         zero, &
         X2406, &
         wf%n_o)
!
      call mem%dealloc(X2404)
      call mem%dealloc(X2405)
      call mem%alloc(X2407, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2406, &
         wf%n_o**2, &
         zero, &
         X2407, &
         wf%n_v)
!
      call mem%dealloc(X2406)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2407, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2407)
      call mem%alloc(X2408, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2408, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2409, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         two, &
         X2408, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X2409, &
         wf%n_v)
!
      call mem%dealloc(X2408)
      call mem%alloc(X2410, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2409, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2410, &
         wf%n_v)
!
      call mem%dealloc(X2409)
      call mem%alloc(X2411, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2411, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2411, 1, &
         X2410, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2410)
      call mem%dealloc(X2411)
      call mem%alloc(X2412, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X2412, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2413, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X2412, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X2413, &
         wf%n_o)
!
      call mem%dealloc(X2412)
      call mem%alloc(X2414, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_o, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X2413, &
         wf%n_o, &
         zero, &
         X2414, &
         wf%n_v)
!
      call mem%dealloc(X2413)
      call mem%alloc(X2415, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2415, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2415, 1, &
         X2414, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2414)
      call mem%dealloc(X2415)
      call mem%alloc(X2416, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2416, wf%n_v, wf%n_o)
      call mem%alloc(X2417, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2416, 1, &
         zero, &
         X2417, 1)
!
      call mem%dealloc(X2416)
      call mem%alloc(X2418, wf%n_v, wf%n_o)
      call sort_to_21(X2417, X2418, wf%n_o, wf%n_v)
      call mem%dealloc(X2417)
      call mem%alloc(X2419, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X2418, 1, &
         zero, &
         X2419, 1)
!
      call mem%dealloc(X2418)
      call mem%alloc(X2420, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2419, 1, &
         rAxxI_ov, 1, &
         X2420, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2419)
      call add_1423_to_1234(one, X2420, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2420)
      call mem%alloc(X2421, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2421, wf%n_v, wf%n_o)
      call mem%alloc(X2422, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2421, 1, &
         zero, &
         X2422, 1)
!
      call mem%dealloc(X2421)
      call mem%alloc(X2423, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2422, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2423, &
         wf%n_o)
!
      call mem%dealloc(X2422)
      call mem%alloc(X2424, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X2424, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2425, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2424, &
         wf%n_v**2*wf%n_o, &
         X2423, &
         wf%n_o, &
         zero, &
         X2425, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X2423)
      call mem%dealloc(X2424)
      call add_1342_to_1234(one, X2425, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2425)
      call mem%alloc(X2426, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2426, wf%n_v, wf%n_o)
      call mem%alloc(X2427, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2426, 1, &
         zero, &
         X2427, 1)
!
      call mem%dealloc(X2426)
      call mem%alloc(X2428, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2427, &
         wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2428, &
         wf%n_v)
!
      call mem%dealloc(X2427)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2428, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2428)
      call mem%alloc(X2429, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2429, 1)
!
      call mem%alloc(X2430, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2429, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2430, &
         wf%n_o)
!
      call mem%dealloc(X2429)
      call mem%alloc(X2431, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X2431, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2432, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X2431, &
         wf%n_v**2*wf%n_o, &
         X2430, &
         wf%n_o, &
         zero, &
         X2432, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X2430)
      call mem%dealloc(X2431)
      call add_1342_to_1234(one, X2432, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2432)
      call mem%alloc(X2433, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2433, 1)
!
      call mem%alloc(X2434, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2433, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2434, &
         wf%n_v)
!
      call mem%dealloc(X2433)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2434, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2434)
      call mem%alloc(X2435, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2435, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2436, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2435, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2436, &
         wf%n_o)
!
      call mem%dealloc(X2435)
      call mem%alloc(X2437, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X2436, X2437, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X2436)
      call mem%alloc(X2438, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v, &
         X2437, &
         wf%n_o, &
         zero, &
         X2438, &
         wf%n_v)
!
      call mem%dealloc(X2437)
      call mem%alloc(X2439, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2439, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2439, 1, &
         X2438, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2438)
      call mem%dealloc(X2439)
      call mem%alloc(X2440, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2440, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2441, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_o, &
         X2440, 1, &
         zero, &
         X2441, 1)
!
      call mem%dealloc(X2440)
      call mem%alloc(X2442, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X2441, 1, &
         zero, &
         X2442, 1)
!
      call mem%dealloc(X2441)
      call mem%alloc(X2443, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2443, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2443, 1, &
         X2442, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2442)
      call mem%dealloc(X2443)
      call mem%alloc(X2444, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2444, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2445, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2444, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2445, &
         wf%n_o)
!
      call mem%dealloc(X2444)
      call mem%alloc(X2446, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X2445, X2446, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X2445)
      call mem%alloc(X2447, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v, &
         X2446, &
         wf%n_o, &
         zero, &
         X2447, &
         wf%n_v)
!
      call mem%dealloc(X2446)
      call mem%alloc(X2448, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2447, 1, &
         rAxxI_ov, 1, &
         X2448, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2447)
      call add_1423_to_1234(one, X2448, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2448)
      call mem%alloc(X2449, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2449, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2450, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2449, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2450, &
         wf%n_v)
!
      call mem%dealloc(X2449)
      call mem%alloc(X2451, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2450, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, &
         wf%n_o, &
         zero, &
         X2451, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2450)
      call mem%alloc(X2452, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2451, X2452, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2451)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2452, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2452)
      call mem%alloc(X2453, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X2453, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2454, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X2453, 1, &
         zero, &
         X2454, 1)
!
      call mem%dealloc(X2453)
      call mem%alloc(X2455, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         X2454, 1, &
         zero, &
         X2455, 1)
!
      call mem%dealloc(X2454)
      call mem%alloc(X2456, wf%n_v, wf%n_o)
      call sort_to_21(rAxxI_ov, X2456, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2456, 1, &
         X2455, 1, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2455)
      call mem%dealloc(X2456)
      call mem%alloc(X2457, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2457, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2458, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2457, &
         wf%n_o, &
         zero, &
         X2458, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2457)
      call mem%alloc(X2459, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X2458, X2459, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2458)
      call mem%alloc(X2460, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2459, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2460, &
         wf%n_o**2)
!
      call mem%dealloc(X2459)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         rAxxI_ov, &
         wf%n_o, &
         X2460, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2460)
      call mem%alloc(X2461, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2461, 1)
!
      call mem%alloc(X2462, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2461, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2462, &
         wf%n_o)
!
      call mem%dealloc(X2461)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X2462, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2462)
      call mem%alloc(X2463, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2463, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2464, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2463, &
         wf%n_v*wf%n_o, &
         rAxxI_ov, 1, &
         zero, &
         X2464, 1)
!
      call mem%dealloc(X2463)
      call mem%alloc(X2465, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2464, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2465, &
         wf%n_o)
!
      call mem%dealloc(X2464)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X2465, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2465)
      call mem%alloc(X2466, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2466, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2467, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         -two, &
         X2466, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X2467, &
         wf%n_v)
!
      call mem%dealloc(X2466)
      call mem%alloc(X2468, wf%n_v)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_v, &
         one, &
         X2467, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X2468, 1)
!
      call mem%dealloc(X2467)
      call mem%alloc(X2469, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2469, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2470, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2469, 1, &
         X2468, 1, &
         X2470, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2468)
      call mem%dealloc(X2469)
      call add_1243_to_1234(one, X2470, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2470)
      call mem%alloc(X2471, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2471, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2472, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         four, &
         X2471, &
         wf%n_v*wf%n_o**2, &
         u_aibj, &
         wf%n_v, &
         zero, &
         X2472, &
         wf%n_v)
!
      call mem%dealloc(X2471)
      call mem%alloc(X2473, wf%n_v)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_v, &
         one, &
         X2472, &
         wf%n_v, &
         tAIxI_v, 1, &
         zero, &
         X2473, 1)
!
      call mem%dealloc(X2472)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2473, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2473)
      call mem%alloc(X2474, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X2474, 1)
!
      call mem%alloc(X2475, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(X2474, X2475, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2474)
      call mem%alloc(X2476, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2475, &
         wf%n_v*wf%n_o, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X2476, &
         wf%n_o)
!
      call mem%dealloc(X2475)
      call mem%alloc(X2477, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2476, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2477, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2476)
      call add_1423_to_1234(one, X2477, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2477)
      call mem%alloc(X2478, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X2478, 1)
!
      call mem%alloc(X2479, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X2479, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2480, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X2478, &
         wf%n_o, &
         X2479, &
         wf%n_v*wf%n_o, &
         zero, &
         X2480, &
         wf%n_o)
!
      call mem%dealloc(X2478)
      call mem%dealloc(X2479)
      call mem%alloc(X2481, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2480, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2481, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2480)
      call add_1423_to_1234(one, X2481, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2481)
      call mem%alloc(X2482, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemv('N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         tAIxI_v, 1, &
         zero, &
         X2482, 1)
!
      call mem%alloc(X2483, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X2482, X2483, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2482)
      call mem%alloc(X2484, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2484, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2485, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2483, &
         wf%n_o**2, &
         X2484, &
         wf%n_o**2, &
         zero, &
         X2485, &
         wf%n_o**2)
!
      call mem%dealloc(X2483)
      call mem%dealloc(X2484)
      call mem%alloc(X2486, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X2486, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2487, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X2486, &
         wf%n_v**2, &
         X2485, &
         wf%n_o**2, &
         zero, &
         X2487, &
         wf%n_v**2)
!
      call mem%dealloc(X2485)
      call mem%dealloc(X2486)
      call add_1324_to_1234(one, X2487, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2487)
      call mem%alloc(X2488, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2488, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2489, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2488, &
         wf%n_v*wf%n_o, &
         zero, &
         X2489, &
         wf%n_v)
!
      call mem%dealloc(X2488)
      call mem%alloc(X2490, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2489, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2490, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2489)
      call mem%alloc(X2491, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2490, X2491, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2490)
      call mem%alloc(X2492, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2492, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2492, &
         wf%n_v*wf%n_o, &
         X2491, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2491)
      call mem%dealloc(X2492)
      call mem%alloc(X2493, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2493, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2494, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         txIxx_vvo, &
         wf%n_v, &
         X2493, &
         wf%n_v*wf%n_o, &
         zero, &
         X2494, &
         wf%n_v)
!
      call mem%dealloc(X2493)
      call mem%alloc(X2495, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2494, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2495, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2494)
      call mem%alloc(X2496, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2495, X2496, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2495)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2496, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2496)
      call mem%alloc(X2497, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2497, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2498, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2497, &
         wf%n_v*wf%n_o, &
         zero, &
         X2498, &
         wf%n_v)
!
      call mem%dealloc(X2497)
      call mem%alloc(X2499, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2498, &
         wf%n_v*wf%n_o, &
         zero, &
         X2499, &
         wf%n_o)
!
      call mem%dealloc(X2498)
      call mem%alloc(X2500, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2499, &
         wf%n_v*wf%n_o, &
         zero, &
         X2500, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2499)
      call add_1423_to_1234(one, X2500, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2500)
      call mem%alloc(X2501, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2501, &
         wf%n_o)
!
      call mem%alloc(X2502, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2501, X2502, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2501)
      call mem%alloc(X2503, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2503, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2504, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2503, &
         wf%n_o**2, &
         X2502, &
         wf%n_v*wf%n_o, &
         zero, &
         X2504, &
         wf%n_v)
!
      call mem%dealloc(X2502)
      call mem%dealloc(X2503)
      call mem%alloc(X2505, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2505, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2506, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2504, &
         wf%n_v*wf%n_o, &
         X2505, &
         wf%n_v*wf%n_o, &
         zero, &
         X2506, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2504)
      call mem%dealloc(X2505)
      call add_1432_to_1234(one, X2506, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2506)
      call mem%alloc(X2507, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2507, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2508, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2507, &
         wf%n_v*wf%n_o, &
         zero, &
         X2508, &
         wf%n_o)
!
      call mem%dealloc(X2507)
      call mem%alloc(X2509, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2509, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2510, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2509, &
         wf%n_v*wf%n_o, &
         X2508, &
         wf%n_o**2, &
         zero, &
         X2510, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2508)
      call mem%dealloc(X2509)
      call mem%alloc(X2511, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2510, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2511, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2510)
      call add_1423_to_1234(one, X2511, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2511)
      call mem%alloc(X2512, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2512, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2513, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2512, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2513, 1)
!
      call mem%dealloc(X2512)
      call mem%alloc(X2514, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X2513, 1, &
         zero, &
         X2514, 1)
!
      call mem%dealloc(X2513)
      call mem%alloc(X2515, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2515, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2516, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2515, 1, &
         X2514, 1, &
         X2516, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2514)
      call mem%dealloc(X2515)
      call add_1243_to_1234(one, X2516, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2516)
      call mem%alloc(X2517, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2517, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2518, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2518, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2519, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2518, &
         wf%n_v**2, &
         X2517, &
         wf%n_o**2, &
         zero, &
         X2519, &
         wf%n_o)
!
      call mem%dealloc(X2517)
      call mem%dealloc(X2518)
      call mem%alloc(X2520, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2519, &
         wf%n_o**2, &
         zero, &
         X2520, &
         wf%n_v)
!
      call mem%dealloc(X2519)
      call mem%alloc(X2521, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2521, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2521, &
         wf%n_v*wf%n_o, &
         X2520, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2520)
      call mem%dealloc(X2521)
      call mem%alloc(X2522, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2522, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2523, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X2522, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2523, 1)
!
      call mem%dealloc(X2522)
      call mem%alloc(X2524, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X2523, 1, &
         zero, &
         X2524, 1)
!
      call mem%dealloc(X2523)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2524, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2524)
      call mem%alloc(X2525, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2525, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2526, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2525, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2526, 1)
!
      call mem%dealloc(X2525)
      call mem%alloc(X2527, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2526, &
         wf%n_o, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2527, &
         wf%n_o)
!
      call mem%dealloc(X2526)
      call mem%alloc(X2528, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2527, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2528, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2527)
      call add_1423_to_1234(one, X2528, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2528)
      call mem%alloc(X2529, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2529, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2530, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X2529, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2530, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2529)
      call mem%alloc(X2531, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2530, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2531, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2530)
      call mem%alloc(X2532, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2531, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2532, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2531)
      call add_1423_to_1234(one, X2532, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2532)
      call mem%alloc(X2533, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2533, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2534, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X2533, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2534, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2533)
      call mem%alloc(X2535, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2535, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2536, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2534, &
         wf%n_v, &
         X2535, &
         wf%n_o**2, &
         zero, &
         X2536, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2534)
      call mem%dealloc(X2535)
      call mem%alloc(X2537, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2536, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2537, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2536)
      call add_1243_to_1234(one, X2537, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2537)
      call mem%alloc(X2538, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2538, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2539, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2538, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2539, 1)
!
      call mem%dealloc(X2538)
      call mem%alloc(X2540, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2540, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2541, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2539, &
         wf%n_o, &
         X2540, &
         wf%n_o**2, &
         zero, &
         X2541, &
         wf%n_o)
!
      call mem%dealloc(X2539)
      call mem%dealloc(X2540)
      call mem%alloc(X2542, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2542, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2543, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2542, &
         wf%n_v**2, &
         X2541, &
         wf%n_o, &
         zero, &
         X2543, &
         wf%n_v**2)
!
      call mem%dealloc(X2541)
      call mem%dealloc(X2542)
      call add_1324_to_1234(one, X2543, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2543)
      call mem%alloc(X2544, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2544, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2545, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2545, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2546, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -four, &
         X2545, &
         wf%n_v**2, &
         X2544, &
         wf%n_o**2, &
         zero, &
         X2546, &
         wf%n_o)
!
      call mem%dealloc(X2544)
      call mem%dealloc(X2545)
      call mem%alloc(X2547, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2546, &
         wf%n_o**2, &
         zero, &
         X2547, &
         wf%n_v)
!
      call mem%dealloc(X2546)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2547, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2547)
      call mem%alloc(X2548, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2548, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2549, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2549, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2550, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2549, &
         wf%n_v**2, &
         X2548, &
         wf%n_o**2, &
         zero, &
         X2550, &
         wf%n_o)
!
      call mem%dealloc(X2548)
      call mem%dealloc(X2549)
      call mem%alloc(X2551, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2550, &
         wf%n_o**2, &
         zero, &
         X2551, &
         wf%n_v)
!
      call mem%dealloc(X2550)
      call mem%alloc(X2552, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2551, &
         wf%n_v*wf%n_o, &
         zero, &
         X2552, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2551)
      call add_1432_to_1234(one, X2552, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2552)
      call mem%alloc(X2553, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2553, &
         wf%n_o)
!
      call mem%alloc(X2554, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X2553, &
         wf%n_o**2, &
         zero, &
         X2554, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2553)
      call mem%alloc(X2555, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2554, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2555, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2554)
      call add_1423_to_1234(one, X2555, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2555)
      call mem%alloc(X2556, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2556, &
         wf%n_o)
!
      call mem%alloc(X2557, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2556, &
         wf%n_o**2, &
         zero, &
         X2557, &
         wf%n_o)
!
      call mem%dealloc(X2556)
      call mem%alloc(X2558, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2558, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2559, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2558, &
         wf%n_v**2, &
         X2557, &
         wf%n_o**2, &
         zero, &
         X2559, &
         wf%n_v**2)
!
      call mem%dealloc(X2557)
      call mem%dealloc(X2558)
      call add_1342_to_1234(one, X2559, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2559)
      call mem%alloc(X2560, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2560, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2561, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X2560, 1, &
         zero, &
         X2561, 1)
!
      call mem%dealloc(X2560)
      call mem%alloc(X2562, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2561, 1, &
         zero, &
         X2562, 1)
!
      call mem%dealloc(X2561)
      call mem%alloc(X2563, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2563, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2564, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2563, 1, &
         X2562, 1, &
         X2564, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2562)
      call mem%dealloc(X2563)
      call add_1243_to_1234(one, X2564, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2564)
      call mem%alloc(X2565, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2565, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2566, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2565, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2566, &
         wf%n_v)
!
      call mem%dealloc(X2565)
      call mem%alloc(X2567, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2566, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2567, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2566)
      call mem%alloc(X2568, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2567, X2568, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2567)
      call mem%alloc(X2569, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2569, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2569, &
         wf%n_v*wf%n_o, &
         X2568, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2568)
      call mem%dealloc(X2569)
      call mem%alloc(X2570, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2570, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2571, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         four, &
         g_ovov, &
         wf%n_o, &
         X2570, 1, &
         zero, &
         X2571, 1)
!
      call mem%dealloc(X2570)
      call mem%alloc(X2572, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2571, 1, &
         zero, &
         X2572, 1)
!
      call mem%dealloc(X2571)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2572, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2572)
      call mem%alloc(X2573, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2573, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2574, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2573, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2574, &
         wf%n_v)
!
      call mem%dealloc(X2573)
      call mem%alloc(X2575, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2575, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2576, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2575, &
         wf%n_o**2, &
         X2574, &
         wf%n_v*wf%n_o, &
         zero, &
         X2576, &
         wf%n_o**2)
!
      call mem%dealloc(X2574)
      call mem%dealloc(X2575)
      call mem%alloc(X2577, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2576, X2577, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2576)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2577, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2577)
      call mem%alloc(X2578, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2578, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2579, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X2578, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2579, &
         wf%n_v)
!
      call mem%dealloc(X2578)
      call mem%alloc(X2580, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2579, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2580, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2579)
      call mem%alloc(X2581, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2580, X2581, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2580)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2581, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2581)
      call mem%alloc(X2582, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2582, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2583, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2582, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2583, &
         wf%n_v)
!
      call mem%dealloc(X2582)
      call mem%alloc(X2584, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2583, &
         wf%n_v*wf%n_o, &
         zero, &
         X2584, &
         wf%n_o)
!
      call mem%dealloc(X2583)
      call mem%alloc(X2585, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2584, &
         wf%n_v*wf%n_o, &
         zero, &
         X2585, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2584)
      call add_1423_to_1234(one, X2585, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2585)
      call mem%alloc(X2586, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2586, &
         wf%n_o)
!
      call mem%alloc(X2587, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X2586, X2587, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2586)
      call mem%alloc(X2588, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2588, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2589, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2588, &
         wf%n_o**2, &
         X2587, &
         wf%n_v*wf%n_o, &
         zero, &
         X2589, &
         wf%n_v)
!
      call mem%dealloc(X2587)
      call mem%dealloc(X2588)
      call mem%alloc(X2590, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2590, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2591, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2589, &
         wf%n_v*wf%n_o, &
         X2590, &
         wf%n_v*wf%n_o, &
         zero, &
         X2591, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2589)
      call mem%dealloc(X2590)
      call add_1432_to_1234(one, X2591, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2591)
      call mem%alloc(X2592, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2592, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2593, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2592, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2593, 1)
!
      call mem%dealloc(X2592)
      call mem%alloc(X2594, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2593, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2594, &
         wf%n_o)
!
      call mem%dealloc(X2593)
      call mem%alloc(X2595, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2595, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2595, &
         wf%n_v*wf%n_o, &
         X2594, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2594)
      call mem%dealloc(X2595)
      call mem%alloc(X2596, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2596, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2597, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X2597, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2598, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X2597, &
         wf%n_v**2, &
         X2596, &
         wf%n_o**2, &
         zero, &
         X2598, &
         wf%n_o)
!
      call mem%dealloc(X2596)
      call mem%dealloc(X2597)
      call mem%alloc(X2599, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2598, &
         wf%n_o**2, &
         zero, &
         X2599, &
         wf%n_v)
!
      call mem%dealloc(X2598)
      call mem%alloc(X2600, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2599, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2600, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2599)
      call add_1423_to_1234(one, X2600, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2600)
      call mem%alloc(X2601, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2601, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2602, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2601, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v, &
         zero, &
         X2602, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2601)
      call mem%alloc(X2603, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2603, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2604, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2603, &
         wf%n_o**2, &
         X2602, &
         wf%n_v, &
         zero, &
         X2604, &
         wf%n_o**2)
!
      call mem%dealloc(X2602)
      call mem%dealloc(X2603)
      call mem%alloc(X2605, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1423(X2604, X2605, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X2604)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2605, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2605)
      call mem%alloc(X2606, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2606, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2607, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X2606, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2607, 1)
!
      call mem%dealloc(X2606)
      call mem%alloc(X2608, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2607, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2608, &
         wf%n_o)
!
      call mem%dealloc(X2607)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2608, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2608)
      call mem%alloc(X2609, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2609, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2610, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2609, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X2610, 1)
!
      call mem%dealloc(X2609)
      call mem%alloc(X2611, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2610, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2611, &
         wf%n_o)
!
      call mem%dealloc(X2610)
      call mem%alloc(X2612, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2611, &
         wf%n_o, &
         zero, &
         X2612, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2611)
      call add_1432_to_1234(one, X2612, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2612)
      call mem%alloc(X2613, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2613, &
         wf%n_o)
!
      call mem%alloc(X2614, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X2613, X2614, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2613)
      call mem%alloc(X2615, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2615, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2616, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2615, &
         wf%n_o**2, &
         X2614, &
         wf%n_v*wf%n_o, &
         zero, &
         X2616, &
         wf%n_v)
!
      call mem%dealloc(X2614)
      call mem%dealloc(X2615)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2616, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2616)
      call mem%alloc(X2617, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2617, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X2618, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X2617, X2618, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2617)
      call mem%alloc(X2619, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2618, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2619, &
         wf%n_o**2)
!
      call mem%dealloc(X2618)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X2619, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2619)
      call mem%alloc(X2620, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2620, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2621, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2620, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2621, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2620)
      call mem%alloc(X2622, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2621, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X2622, &
         wf%n_o**2)
!
      call mem%dealloc(X2621)
      call mem%alloc(X2623, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X2623, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2624, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2623, &
         wf%n_v**2, &
         X2622, &
         wf%n_o, &
         zero, &
         X2624, &
         wf%n_v**2)
!
      call mem%dealloc(X2622)
      call mem%dealloc(X2623)
      call add_1324_to_1234(one, X2624, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2624)
      call mem%alloc(X2625, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2625, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2626, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2625, &
         wf%n_v*wf%n_o, &
         zero, &
         X2626, &
         wf%n_v)
!
      call mem%dealloc(X2625)
      call mem%alloc(X2627, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2626, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2627, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2626)
      call mem%alloc(X2628, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2627, X2628, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2627)
      call mem%alloc(X2629, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2629, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2629, &
         wf%n_v*wf%n_o, &
         X2628, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2628)
      call mem%dealloc(X2629)
      call mem%alloc(X2630, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2630, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2631, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         txIxx_vvo, &
         wf%n_v, &
         X2630, &
         wf%n_v*wf%n_o, &
         zero, &
         X2631, &
         wf%n_v)
!
      call mem%dealloc(X2630)
      call mem%alloc(X2632, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2631, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2632, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2631)
      call mem%alloc(X2633, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2632, X2633, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2632)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2633, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2633)
      call mem%alloc(X2634, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2634, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2635, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         txIxx_vvo, &
         wf%n_v, &
         X2634, &
         wf%n_v*wf%n_o, &
         zero, &
         X2635, &
         wf%n_v)
!
      call mem%dealloc(X2634)
      call mem%alloc(X2636, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2635, &
         wf%n_v*wf%n_o, &
         zero, &
         X2636, &
         wf%n_o)
!
      call mem%dealloc(X2635)
      call mem%alloc(X2637, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2636, &
         wf%n_v*wf%n_o, &
         zero, &
         X2637, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2636)
      call add_1423_to_1234(one, X2637, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2637)
      call mem%alloc(X2638, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2638, &
         wf%n_o)
!
      call mem%alloc(X2639, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2638, X2639, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2638)
      call mem%alloc(X2640, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2640, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2641, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2640, &
         wf%n_o**2, &
         X2639, &
         wf%n_v*wf%n_o, &
         zero, &
         X2641, &
         wf%n_v)
!
      call mem%dealloc(X2639)
      call mem%dealloc(X2640)
      call mem%alloc(X2642, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2642, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2643, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2641, &
         wf%n_v*wf%n_o, &
         X2642, &
         wf%n_v*wf%n_o, &
         zero, &
         X2643, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2641)
      call mem%dealloc(X2642)
      call add_1432_to_1234(one, X2643, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2643)
      call mem%alloc(X2644, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2644, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2645, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2644, &
         wf%n_v*wf%n_o, &
         zero, &
         X2645, &
         wf%n_o)
!
      call mem%dealloc(X2644)
      call mem%alloc(X2646, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2646, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2647, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2646, &
         wf%n_v*wf%n_o, &
         X2645, &
         wf%n_o**2, &
         zero, &
         X2647, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2645)
      call mem%dealloc(X2646)
      call mem%alloc(X2648, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2647, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2648, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2647)
      call add_1423_to_1234(one, X2648, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2648)
      call mem%alloc(X2649, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2649, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2650, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2649, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2650, 1)
!
      call mem%dealloc(X2649)
      call mem%alloc(X2651, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X2650, 1, &
         zero, &
         X2651, 1)
!
      call mem%dealloc(X2650)
      call mem%alloc(X2652, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2652, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2653, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2652, 1, &
         X2651, 1, &
         X2653, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2651)
      call mem%dealloc(X2652)
      call add_1243_to_1234(one, X2653, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2653)
      call mem%alloc(X2654, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2654, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2655, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2655, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2656, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2655, &
         wf%n_v**2, &
         X2654, &
         wf%n_o**2, &
         zero, &
         X2656, &
         wf%n_o)
!
      call mem%dealloc(X2654)
      call mem%dealloc(X2655)
      call mem%alloc(X2657, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2656, &
         wf%n_o**2, &
         zero, &
         X2657, &
         wf%n_v)
!
      call mem%dealloc(X2656)
      call mem%alloc(X2658, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2658, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2658, &
         wf%n_v*wf%n_o, &
         X2657, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2657)
      call mem%dealloc(X2658)
      call mem%alloc(X2659, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2659, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2660, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X2659, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2660, 1)
!
      call mem%dealloc(X2659)
      call mem%alloc(X2661, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         txxxI_vov, &
         wf%n_v, &
         X2660, 1, &
         zero, &
         X2661, 1)
!
      call mem%dealloc(X2660)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2661, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2661)
      call mem%alloc(X2662, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2662, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2663, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X2662, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2663, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2662)
      call mem%alloc(X2664, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2663, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2664, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2663)
      call mem%alloc(X2665, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2664, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2665, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2664)
      call add_1423_to_1234(one, X2665, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2665)
      call mem%alloc(X2666, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2666, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2667, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2666, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2667, 1)
!
      call mem%dealloc(X2666)
      call mem%alloc(X2668, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2667, &
         wf%n_o, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2668, &
         wf%n_o)
!
      call mem%dealloc(X2667)
      call mem%alloc(X2669, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2668, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2669, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2668)
      call add_1423_to_1234(one, X2669, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2669)
      call mem%alloc(X2670, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2670, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2671, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2670, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2671, 1)
!
      call mem%dealloc(X2670)
      call mem%alloc(X2672, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2672, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2673, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2671, &
         wf%n_v, &
         X2672, &
         wf%n_o**2, &
         zero, &
         X2673, &
         wf%n_o)
!
      call mem%dealloc(X2671)
      call mem%dealloc(X2672)
      call mem%alloc(X2674, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2674, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2675, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2674, &
         wf%n_v**2, &
         X2673, &
         wf%n_o, &
         zero, &
         X2675, &
         wf%n_v**2)
!
      call mem%dealloc(X2673)
      call mem%dealloc(X2674)
      call add_1324_to_1234(one, X2675, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2675)
      call mem%alloc(X2676, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2676, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2677, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X2676, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2677, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2676)
      call mem%alloc(X2678, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2678, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2679, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2677, &
         wf%n_v, &
         X2678, &
         wf%n_o**2, &
         zero, &
         X2679, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2677)
      call mem%dealloc(X2678)
      call mem%alloc(X2680, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2679, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2680, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2679)
      call add_1243_to_1234(one, X2680, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2680)
      call mem%alloc(X2681, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2681, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2682, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2682, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2683, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -four, &
         X2682, &
         wf%n_v**2, &
         X2681, &
         wf%n_o**2, &
         zero, &
         X2683, &
         wf%n_o)
!
      call mem%dealloc(X2681)
      call mem%dealloc(X2682)
      call mem%alloc(X2684, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2683, &
         wf%n_o**2, &
         zero, &
         X2684, &
         wf%n_v)
!
      call mem%dealloc(X2683)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2684, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2684)
      call mem%alloc(X2685, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2685, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2686, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2686, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2687, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2686, &
         wf%n_v**2, &
         X2685, &
         wf%n_o**2, &
         zero, &
         X2687, &
         wf%n_o)
!
      call mem%dealloc(X2685)
      call mem%dealloc(X2686)
      call mem%alloc(X2688, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2687, &
         wf%n_o**2, &
         zero, &
         X2688, &
         wf%n_v)
!
      call mem%dealloc(X2687)
      call mem%alloc(X2689, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2688, &
         wf%n_v*wf%n_o, &
         zero, &
         X2689, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2688)
      call add_1432_to_1234(one, X2689, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2689)
      call mem%alloc(X2690, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2690, &
         wf%n_o)
!
      call mem%alloc(X2691, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2690, &
         wf%n_o**2, &
         zero, &
         X2691, &
         wf%n_o)
!
      call mem%dealloc(X2690)
      call mem%alloc(X2692, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X2692, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2693, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2692, &
         wf%n_v**2, &
         X2691, &
         wf%n_o**2, &
         zero, &
         X2693, &
         wf%n_v**2)
!
      call mem%dealloc(X2691)
      call mem%dealloc(X2692)
      call add_1342_to_1234(one, X2693, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2693)
      call mem%alloc(X2694, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2694, &
         wf%n_o)
!
      call mem%alloc(X2695, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X2694, &
         wf%n_o**2, &
         zero, &
         X2695, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2694)
      call mem%alloc(X2696, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2695, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2696, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2695)
      call add_1423_to_1234(one, X2696, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2696)
      call mem%alloc(X2697, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2697, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2698, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X2697, 1, &
         zero, &
         X2698, 1)
!
      call mem%dealloc(X2697)
      call mem%alloc(X2699, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2698, 1, &
         zero, &
         X2699, 1)
!
      call mem%dealloc(X2698)
      call mem%alloc(X2700, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2700, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2701, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2700, 1, &
         X2699, 1, &
         X2701, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2699)
      call mem%dealloc(X2700)
      call add_1243_to_1234(one, X2701, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2701)
      call mem%alloc(X2702, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2702, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2703, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2702, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2703, &
         wf%n_v)
!
      call mem%dealloc(X2702)
      call mem%alloc(X2704, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2703, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2704, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2703)
      call mem%alloc(X2705, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2704, X2705, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2704)
      call mem%alloc(X2706, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2706, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2706, &
         wf%n_v*wf%n_o, &
         X2705, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2705)
      call mem%dealloc(X2706)
      call mem%alloc(X2707, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2707, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2708, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         four, &
         g_ovov, &
         wf%n_o, &
         X2707, 1, &
         zero, &
         X2708, 1)
!
      call mem%dealloc(X2707)
      call mem%alloc(X2709, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2708, 1, &
         zero, &
         X2709, 1)
!
      call mem%dealloc(X2708)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2709, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2709)
      call mem%alloc(X2710, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2710, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2711, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2710, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2711, &
         wf%n_v)
!
      call mem%dealloc(X2710)
      call mem%alloc(X2712, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2712, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2713, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2712, &
         wf%n_o**2, &
         X2711, &
         wf%n_v*wf%n_o, &
         zero, &
         X2713, &
         wf%n_o**2)
!
      call mem%dealloc(X2711)
      call mem%dealloc(X2712)
      call mem%alloc(X2714, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2713, X2714, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2713)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2714, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2714)
      call mem%alloc(X2715, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2715, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2716, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X2715, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2716, &
         wf%n_v)
!
      call mem%dealloc(X2715)
      call mem%alloc(X2717, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2716, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2717, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2716)
      call mem%alloc(X2718, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2717, X2718, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2717)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2718, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2718)
      call mem%alloc(X2719, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2719, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2720, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2719, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2720, &
         wf%n_v)
!
      call mem%dealloc(X2719)
      call mem%alloc(X2721, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2720, &
         wf%n_v*wf%n_o, &
         zero, &
         X2721, &
         wf%n_o)
!
      call mem%dealloc(X2720)
      call mem%alloc(X2722, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2721, &
         wf%n_v*wf%n_o, &
         zero, &
         X2722, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2721)
      call add_1423_to_1234(one, X2722, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2722)
      call mem%alloc(X2723, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2723, &
         wf%n_o)
!
      call mem%alloc(X2724, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X2723, X2724, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2723)
      call mem%alloc(X2725, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2725, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2726, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2725, &
         wf%n_o**2, &
         X2724, &
         wf%n_v*wf%n_o, &
         zero, &
         X2726, &
         wf%n_v)
!
      call mem%dealloc(X2724)
      call mem%dealloc(X2725)
      call mem%alloc(X2727, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2727, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2728, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2726, &
         wf%n_v*wf%n_o, &
         X2727, &
         wf%n_v*wf%n_o, &
         zero, &
         X2728, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2726)
      call mem%dealloc(X2727)
      call add_1432_to_1234(one, X2728, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2728)
      call mem%alloc(X2729, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2729, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2730, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2729, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2730, 1)
!
      call mem%dealloc(X2729)
      call mem%alloc(X2731, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2730, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2731, &
         wf%n_o)
!
      call mem%dealloc(X2730)
      call mem%alloc(X2732, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2732, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2732, &
         wf%n_v*wf%n_o, &
         X2731, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2731)
      call mem%dealloc(X2732)
      call mem%alloc(X2733, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2733, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2734, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X2734, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2735, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X2734, &
         wf%n_v**2, &
         X2733, &
         wf%n_o**2, &
         zero, &
         X2735, &
         wf%n_o)
!
      call mem%dealloc(X2733)
      call mem%dealloc(X2734)
      call mem%alloc(X2736, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2735, &
         wf%n_o**2, &
         zero, &
         X2736, &
         wf%n_v)
!
      call mem%dealloc(X2735)
      call mem%alloc(X2737, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2736, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2737, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2736)
      call add_1423_to_1234(one, X2737, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2737)
      call mem%alloc(X2738, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2738, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2739, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2738, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v, &
         zero, &
         X2739, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2738)
      call mem%alloc(X2740, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2740, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2741, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2740, &
         wf%n_o**2, &
         X2739, &
         wf%n_v, &
         zero, &
         X2741, &
         wf%n_o**2)
!
      call mem%dealloc(X2739)
      call mem%dealloc(X2740)
      call mem%alloc(X2742, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1423(X2741, X2742, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X2741)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2742, &
         wf%n_v*wf%n_o**2, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2742)
      call mem%alloc(X2743, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2743, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2744, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X2743, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2744, 1)
!
      call mem%dealloc(X2743)
      call mem%alloc(X2745, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2744, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2745, &
         wf%n_o)
!
      call mem%dealloc(X2744)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2745, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2745)
      call mem%alloc(X2746, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2746, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2747, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2746, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X2747, 1)
!
      call mem%dealloc(X2746)
      call mem%alloc(X2748, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2747, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2748, &
         wf%n_o)
!
      call mem%dealloc(X2747)
      call mem%alloc(X2749, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2748, &
         wf%n_o, &
         zero, &
         X2749, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2748)
      call add_1432_to_1234(one, X2749, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2749)
      call mem%alloc(X2750, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2750, &
         wf%n_o)
!
      call mem%alloc(X2751, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X2750, X2751, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2750)
      call mem%alloc(X2752, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2752, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2753, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2752, &
         wf%n_o**2, &
         X2751, &
         wf%n_v*wf%n_o, &
         zero, &
         X2753, &
         wf%n_v)
!
      call mem%dealloc(X2751)
      call mem%dealloc(X2752)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2753, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2753)
      call mem%alloc(X2754, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2754, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X2755, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(X2754, X2755, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2754)
      call mem%alloc(X2756, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2755, &
         wf%n_o**2, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2756, &
         wf%n_o**2)
!
      call mem%dealloc(X2755)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X2756, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2756)
      call mem%alloc(X2757, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2757, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2758, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2757, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2758, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2757)
      call mem%alloc(X2759, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2758, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X2759, &
         wf%n_o**2)
!
      call mem%dealloc(X2758)
      call mem%alloc(X2760, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X2760, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2761, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X2760, &
         wf%n_v**2, &
         X2759, &
         wf%n_o, &
         zero, &
         X2761, &
         wf%n_v**2)
!
      call mem%dealloc(X2759)
      call mem%dealloc(X2760)
      call add_1324_to_1234(one, X2761, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2761)
      call mem%alloc(X2762, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2762, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2763, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2762, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X2763, 1)
!
      call mem%dealloc(X2762)
      call mem%alloc(X2764, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2764, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2765, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2764, &
         wf%n_o**2, &
         X2763, 1, &
         zero, &
         X2765, 1)
!
      call mem%dealloc(X2763)
      call mem%dealloc(X2764)
      call mem%alloc(X2766, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2766, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2767, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2766, 1, &
         X2765, 1, &
         X2767, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2765)
      call mem%dealloc(X2766)
      call add_1243_to_1234(one, X2767, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2767)
      call mem%alloc(X2768, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2768, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2769, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X2768, &
         wf%n_v*wf%n_o, &
         zero, &
         X2769, &
         wf%n_o)
!
      call mem%dealloc(X2768)
      call mem%alloc(X2770, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2769, &
         wf%n_o**2, &
         zero, &
         X2770, &
         wf%n_v)
!
      call mem%dealloc(X2769)
      call mem%alloc(X2771, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2771, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2771, &
         wf%n_v*wf%n_o, &
         X2770, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2770)
      call mem%dealloc(X2771)
      call mem%alloc(X2772, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2772, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2773, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2772, &
         wf%n_v*wf%n_o, &
         zero, &
         X2773, &
         wf%n_o)
!
      call mem%dealloc(X2772)
      call mem%alloc(X2774, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2773, &
         wf%n_o**2, &
         zero, &
         X2774, &
         wf%n_v)
!
      call mem%dealloc(X2773)
      call mem%alloc(X2775, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2775, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2775, &
         wf%n_v*wf%n_o, &
         X2774, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2774)
      call mem%dealloc(X2775)
      call mem%alloc(X2776, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2776, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2777, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         -four, &
         X2776, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X2777, 1)
!
      call mem%dealloc(X2776)
      call mem%alloc(X2778, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2778, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2779, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2778, &
         wf%n_o**2, &
         X2777, 1, &
         zero, &
         X2779, 1)
!
      call mem%dealloc(X2777)
      call mem%dealloc(X2778)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2779, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2779)
      call mem%alloc(X2780, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2780, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2781, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2780, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X2781, 1)
!
      call mem%dealloc(X2780)
      call mem%alloc(X2782, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2781, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2782, &
         wf%n_o)
!
      call mem%dealloc(X2781)
      call mem%alloc(X2783, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X2783, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2784, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2783, &
         wf%n_v*wf%n_o, &
         X2782, &
         wf%n_o, &
         zero, &
         X2784, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2782)
      call mem%dealloc(X2783)
      call add_1423_to_1234(one, X2784, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2784)
      call mem%alloc(X2785, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2785, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2786, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X2785, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X2786, 1)
!
      call mem%dealloc(X2785)
      call mem%alloc(X2787, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2786, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X2787, &
         wf%n_o)
!
      call mem%dealloc(X2786)
      call mem%alloc(X2788, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2787, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2788, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2787)
      call add_1423_to_1234(one, X2788, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2788)
      call mem%alloc(X2789, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2789, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2790, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2790, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2791, wf%n_v, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_v, &
         wf%n_o**2, &
         two, &
         X2789, &
         wf%n_o**2, &
         X2790, &
         wf%n_o**2, &
         zero, &
         X2791, &
         wf%n_v**2)
!
      call mem%dealloc(X2789)
      call mem%dealloc(X2790)
      call mem%alloc(X2792, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2792, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2793, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2791, &
         wf%n_v, &
         X2792, &
         wf%n_o**2, &
         zero, &
         X2793, &
         wf%n_v**2)
!
      call mem%dealloc(X2791)
      call mem%dealloc(X2792)
      call mem%alloc(X2794, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X2793, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X2794, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2793)
      call add_1243_to_1234(one, X2794, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2794)
      call mem%alloc(X2795, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X2795, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2796, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2796, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2797, wf%n_v, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_v, &
         wf%n_o**2, &
         two, &
         X2795, &
         wf%n_o**2, &
         X2796, &
         wf%n_o**2, &
         zero, &
         X2797, &
         wf%n_v**2)
!
      call mem%dealloc(X2795)
      call mem%dealloc(X2796)
      call mem%alloc(X2798, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2798, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2799, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2797, &
         wf%n_v, &
         X2798, &
         wf%n_o**2, &
         zero, &
         X2799, &
         wf%n_v**2)
!
      call mem%dealloc(X2797)
      call mem%dealloc(X2798)
      call mem%alloc(X2800, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X2799, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X2800, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2799)
      call add_1243_to_1234(one, X2800, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2800)
      call mem%alloc(X2801, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2801, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2802, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         tAxxx_ovo, &
         wf%n_o, &
         X2801, &
         wf%n_v*wf%n_o, &
         zero, &
         X2802, &
         wf%n_o)
!
      call mem%dealloc(X2801)
      call mem%alloc(X2803, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2802, &
         wf%n_o**2, &
         zero, &
         X2803, &
         wf%n_v)
!
      call mem%dealloc(X2802)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2803, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2803)
      call mem%alloc(X2804, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2804, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2805, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2804, &
         wf%n_v*wf%n_o, &
         zero, &
         X2805, &
         wf%n_o)
!
      call mem%dealloc(X2804)
      call mem%alloc(X2806, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2805, &
         wf%n_o**2, &
         zero, &
         X2806, &
         wf%n_v)
!
      call mem%dealloc(X2805)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2806, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2806)
      call mem%alloc(X2807, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2807, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2808, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X2807, &
         wf%n_v*wf%n_o, &
         zero, &
         X2808, &
         wf%n_o)
!
      call mem%dealloc(X2807)
      call mem%alloc(X2809, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2808, &
         wf%n_o**2, &
         zero, &
         X2809, &
         wf%n_v)
!
      call mem%dealloc(X2808)
      call mem%alloc(X2810, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2809, &
         wf%n_v*wf%n_o, &
         zero, &
         X2810, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2809)
      call add_1432_to_1234(one, X2810, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2810)
      call mem%alloc(X2811, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2811, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2812, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2811, &
         wf%n_v*wf%n_o, &
         zero, &
         X2812, &
         wf%n_o)
!
      call mem%dealloc(X2811)
      call mem%alloc(X2813, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2812, &
         wf%n_o**2, &
         zero, &
         X2813, &
         wf%n_v)
!
      call mem%dealloc(X2812)
      call mem%alloc(X2814, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2813, &
         wf%n_v*wf%n_o, &
         zero, &
         X2814, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2813)
      call add_1432_to_1234(one, X2814, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2814)
      call mem%alloc(X2815, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X2815, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X2816, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(X2815, X2816, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X2815)
      call mem%alloc(X2817, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2817, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2818, wf%n_o, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2816, &
         wf%n_v*wf%n_o**2, &
         X2817, &
         wf%n_o**2, &
         zero, &
         X2818, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2816)
      call mem%dealloc(X2817)
      call mem%alloc(X2819, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2819, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2820, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X2819, &
         wf%n_o**2, &
         X2818, &
         wf%n_o**2, &
         zero, &
         X2820, &
         wf%n_v)
!
      call mem%dealloc(X2818)
      call mem%dealloc(X2819)
      call add_1324_to_1234(one, X2820, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2820)
      call mem%alloc(X2821, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X2821, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2822, wf%n_o, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         X2821, &
         wf%n_o**2, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2822, &
         wf%n_o**2)
!
      call mem%dealloc(X2821)
      call mem%alloc(X2823, wf%n_o, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_12453(X2822, X2823, wf%n_o, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2822)
      call mem%alloc(X2824, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2824, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2825, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X2824, &
         wf%n_o**2, &
         X2823, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2825, &
         wf%n_v)
!
      call mem%dealloc(X2823)
      call mem%dealloc(X2824)
      call mem%alloc(X2826, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X2825, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X2826, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2825)
      call add_1423_to_1234(one, X2826, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2826)
      call mem%alloc(X2827, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2827, &
         wf%n_o)
!
      call mem%alloc(X2828, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2827, &
         wf%n_o**2, &
         zero, &
         X2828, &
         wf%n_v)
!
      call mem%dealloc(X2827)
      call mem%alloc(X2829, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X2829, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2830, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2829, &
         wf%n_v*wf%n_o, &
         X2828, &
         wf%n_v*wf%n_o, &
         zero, &
         X2830, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2828)
      call mem%dealloc(X2829)
      call add_1432_to_1234(one, X2830, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2830)
      call mem%alloc(X2831, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2831, &
         wf%n_o)
!
      call mem%alloc(X2832, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2831, &
         wf%n_o**2, &
         zero, &
         X2832, &
         wf%n_v)
!
      call mem%dealloc(X2831)
      call mem%alloc(X2833, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X2832, &
         wf%n_v*wf%n_o, &
         zero, &
         X2833, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2832)
      call add_1432_to_1234(one, X2833, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2833)
      call mem%alloc(X2834, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X2834, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2835, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X2834, 1, &
         zero, &
         X2835, 1)
!
      call mem%dealloc(X2834)
      call mem%alloc(X2836, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2835, 1, &
         zero, &
         X2836, 1)
!
      call mem%dealloc(X2835)
      call mem%alloc(X2837, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2837, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2838, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2837, 1, &
         X2836, 1, &
         X2838, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2836)
      call mem%dealloc(X2837)
      call add_1243_to_1234(one, X2838, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2838)
      call mem%alloc(X2839, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2839, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2840, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2839, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2840, &
         wf%n_o)
!
      call mem%dealloc(X2839)
      call mem%alloc(X2841, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2840, &
         wf%n_o**2, &
         zero, &
         X2841, &
         wf%n_v)
!
      call mem%dealloc(X2840)
      call mem%alloc(X2842, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2842, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2842, &
         wf%n_v*wf%n_o, &
         X2841, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2841)
      call mem%dealloc(X2842)
      call mem%alloc(X2843, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2843, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2844, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X2843, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X2844, 1)
!
      call mem%dealloc(X2843)
      call mem%alloc(X2845, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2844, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2845, &
         wf%n_o)
!
      call mem%dealloc(X2844)
      call mem%alloc(X2846, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X2845, X2846, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X2845)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2846, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2846)
      call mem%alloc(X2847, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X2847, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2848, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         four, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X2847, 1, &
         zero, &
         X2848, 1)
!
      call mem%dealloc(X2847)
      call mem%alloc(X2849, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2848, 1, &
         zero, &
         X2849, 1)
!
      call mem%dealloc(X2848)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2849, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2849)
      call mem%alloc(X2850, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2850, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2851, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2850, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2851, &
         wf%n_o)
!
      call mem%dealloc(X2850)
      call mem%alloc(X2852, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2851, &
         wf%n_o**2, &
         zero, &
         X2852, &
         wf%n_v)
!
      call mem%dealloc(X2851)
      call mem%alloc(X2853, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2852, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2853, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2852)
      call add_1423_to_1234(one, X2853, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2853)
      call mem%alloc(X2854, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2854, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2855, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2854, &
         wf%n_v*wf%n_o, &
         zero, &
         X2855, &
         wf%n_o)
!
      call mem%dealloc(X2854)
      call mem%alloc(X2856, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2855, &
         wf%n_o**2, &
         zero, &
         X2856, &
         wf%n_v)
!
      call mem%dealloc(X2855)
      call mem%alloc(X2857, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2856, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2857, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2856)
      call add_1423_to_1234(one, X2857, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2857)
      call mem%alloc(X2858, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X2858, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X2859, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(X2858, X2859, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X2858)
      call mem%alloc(X2860, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2860, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2861, wf%n_o, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2859, &
         wf%n_v*wf%n_o**2, &
         X2860, &
         wf%n_o**2, &
         zero, &
         X2861, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2859)
      call mem%dealloc(X2860)
      call mem%alloc(X2862, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_312(uAxxx_ovo, X2862, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2863, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X2861, &
         wf%n_o**2, &
         X2862, &
         wf%n_o**2, &
         zero, &
         X2863, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2861)
      call mem%dealloc(X2862)
      call add_1243_to_1234(one, X2863, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2863)
      call mem%alloc(X2864, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2864, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2865, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X2864, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2865, &
         wf%n_o)
!
      call mem%dealloc(X2864)
      call mem%alloc(X2866, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2865, &
         wf%n_o**2, &
         zero, &
         X2866, &
         wf%n_v)
!
      call mem%dealloc(X2865)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2866, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2866)
      call mem%alloc(X2867, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2867, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2868, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         four, &
         X2867, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X2868, 1)
!
      call mem%dealloc(X2867)
      call mem%alloc(X2869, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2868, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_o, &
         zero, &
         X2869, &
         wf%n_o)
!
      call mem%dealloc(X2868)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2869, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2869)
      call mem%alloc(X2870, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2870, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2871, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2870, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2871, &
         wf%n_o)
!
      call mem%dealloc(X2870)
      call mem%alloc(X2872, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2871, &
         wf%n_o**2, &
         zero, &
         X2872, &
         wf%n_v)
!
      call mem%dealloc(X2871)
      call mem%alloc(X2873, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2872, &
         wf%n_v*wf%n_o, &
         zero, &
         X2873, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2872)
      call add_1432_to_1234(one, X2873, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2873)
      call mem%alloc(X2874, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2874, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2875, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X2874, &
         wf%n_o**2, &
         txIxI_vv, 1, &
         zero, &
         X2875, 1)
!
      call mem%dealloc(X2874)
      call mem%alloc(X2876, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2875, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X2876, &
         wf%n_o)
!
      call mem%dealloc(X2875)
      call mem%alloc(X2877, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2876, &
         wf%n_o, &
         zero, &
         X2877, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2876)
      call add_1432_to_1234(one, X2877, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2877)
      call mem%alloc(X2878, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X2878, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2879, wf%n_o, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X2878, &
         wf%n_o**2, &
         zero, &
         X2879, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2878)
      call mem%alloc(X2880, wf%n_o, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_13452(X2879, X2880, wf%n_o, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
      call mem%dealloc(X2879)
      call mem%alloc(X2881, wf%n_o, wf%n_o, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o**4, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X2880, &
         wf%n_o**4, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X2881, &
         wf%n_o**4)
!
      call mem%dealloc(X2880)
      call mem%alloc(X2882, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2882, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2883, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X2882, &
         wf%n_o**2, &
         X2881, &
         wf%n_o**2, &
         zero, &
         X2883, &
         wf%n_v)
!
      call mem%dealloc(X2881)
      call mem%dealloc(X2882)
      call add_1423_to_1234(one, X2883, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2883)
      call mem%alloc(X2884, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2884, &
         wf%n_o)
!
      call mem%alloc(X2885, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2884, &
         wf%n_o**2, &
         zero, &
         X2885, &
         wf%n_v)
!
      call mem%dealloc(X2884)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2885, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2885)
      call mem%alloc(X2886, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2886, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2887, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2886, &
         wf%n_v*wf%n_o, &
         zero, &
         X2887, &
         wf%n_o)
!
      call mem%dealloc(X2886)
      call mem%alloc(X2888, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txIxI_vv, &
         wf%n_v, &
         X2887, &
         wf%n_o**2, &
         zero, &
         X2888, &
         wf%n_v)
!
      call mem%dealloc(X2887)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2888, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2888)
      call mem%alloc(X2889, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2889, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2890, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2889, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2890, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2889)
      call mem%alloc(X2891, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X2890, &
         wf%n_v, &
         txIxI_vv, &
         wf%n_v, &
         zero, &
         X2891, &
         wf%n_o**2)
!
      call mem%dealloc(X2890)
      call mem%alloc(X2892, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X2892, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2893, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2892, &
         wf%n_v*wf%n_o, &
         X2891, &
         wf%n_o, &
         zero, &
         X2893, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2891)
      call mem%dealloc(X2892)
      call add_1423_to_1234(one, X2893, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2893)
      call mem%alloc(X2894, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2894, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2895, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2895, wf%n_v, wf%n_o)
      call mem%alloc(X2896, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2894, &
         wf%n_v*wf%n_o, &
         X2895, 1, &
         zero, &
         X2896, 1)
!
      call mem%dealloc(X2894)
      call mem%dealloc(X2895)
      call mem%alloc(X2897, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v, &
         X2896, 1, &
         zero, &
         X2897, 1)
!
      call mem%dealloc(X2896)
      call mem%alloc(X2898, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2898, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2899, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2898, 1, &
         X2897, 1, &
         X2899, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2897)
      call mem%dealloc(X2898)
      call add_1243_to_1234(one, X2899, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2899)
      call mem%alloc(X2900, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2900, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2901, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2900, &
         wf%n_o**2, &
         zero, &
         X2901, &
         wf%n_o)
!
      call mem%dealloc(X2900)
      call mem%alloc(X2902, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X2901, &
         wf%n_o**2, &
         zero, &
         X2902, &
         wf%n_v)
!
      call mem%dealloc(X2901)
      call mem%alloc(X2903, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2903, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2903, &
         wf%n_v*wf%n_o, &
         X2902, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2902)
      call mem%dealloc(X2903)
      call mem%alloc(X2904, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2904, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2905, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2905, wf%n_v, wf%n_o)
      call mem%alloc(X2906, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X2904, &
         wf%n_v*wf%n_o, &
         X2905, 1, &
         zero, &
         X2906, 1)
!
      call mem%dealloc(X2904)
      call mem%dealloc(X2905)
      call mem%alloc(X2907, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v, &
         X2906, 1, &
         zero, &
         X2907, 1)
!
      call mem%dealloc(X2906)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2907, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2907)
      call mem%alloc(X2908, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2908, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2909, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txIxx_vvo, &
         wf%n_v, &
         X2908, &
         wf%n_v*wf%n_o, &
         zero, &
         X2909, &
         wf%n_v)
!
      call mem%dealloc(X2908)
      call mem%alloc(X2910, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2909, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2910, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2909)
      call mem%alloc(X2911, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2910, X2911, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2910)
      call mem%alloc(X2912, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2911, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2912, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2911)
      call add_1423_to_1234(one, X2912, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2912)
      call mem%alloc(X2913, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2913, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2914, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2913, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, 1, &
         zero, &
         X2914, 1)
!
      call mem%dealloc(X2913)
      call mem%alloc(X2915, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2915, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2916, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2914, &
         wf%n_o, &
         X2915, &
         wf%n_v*wf%n_o, &
         zero, &
         X2916, &
         wf%n_o)
!
      call mem%dealloc(X2914)
      call mem%dealloc(X2915)
      call mem%alloc(X2917, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2916, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2917, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2916)
      call add_1423_to_1234(one, X2917, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2917)
      call mem%alloc(X2918, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2918, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2919, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X2918, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, 1, &
         zero, &
         X2919, 1)
!
      call mem%dealloc(X2918)
      call mem%alloc(X2920, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2920, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2921, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2919, &
         wf%n_o, &
         X2920, &
         wf%n_o**2, &
         zero, &
         X2921, &
         wf%n_o)
!
      call mem%dealloc(X2919)
      call mem%dealloc(X2920)
      call mem%alloc(X2922, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2921, &
         wf%n_o, &
         zero, &
         X2922, &
         wf%n_v**2)
!
      call mem%dealloc(X2921)
      call add_1324_to_1234(one, X2922, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2922)
      call mem%alloc(X2923, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2923, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2924, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2924, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2925, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2923, &
         wf%n_v*wf%n_o, &
         X2924, &
         wf%n_v, &
         zero, &
         X2925, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2923)
      call mem%dealloc(X2924)
      call mem%alloc(X2926, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2926, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2927, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2925, &
         wf%n_v, &
         X2926, &
         wf%n_o**2, &
         zero, &
         X2927, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2925)
      call mem%dealloc(X2926)
      call mem%alloc(X2928, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2927, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2928, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2927)
      call add_1243_to_1234(one, X2928, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2928)
      call mem%alloc(X2929, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2929, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2930, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         four, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2929, &
         wf%n_o**2, &
         zero, &
         X2930, &
         wf%n_o)
!
      call mem%dealloc(X2929)
      call mem%alloc(X2931, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X2930, &
         wf%n_o**2, &
         zero, &
         X2931, &
         wf%n_v)
!
      call mem%dealloc(X2930)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2931, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2931)
      call mem%alloc(X2932, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X2932, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2933, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2932, &
         wf%n_o**2, &
         zero, &
         X2933, &
         wf%n_o)
!
      call mem%dealloc(X2932)
      call mem%alloc(X2934, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X2933, &
         wf%n_o**2, &
         zero, &
         X2934, &
         wf%n_v)
!
      call mem%dealloc(X2933)
      call mem%alloc(X2935, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2934, &
         wf%n_v*wf%n_o, &
         zero, &
         X2935, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2934)
      call add_1432_to_1234(one, X2935, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2935)
      call mem%alloc(X2936, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2936, &
         wf%n_o)
!
      call mem%alloc(X2937, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X2936, &
         wf%n_o**2, &
         zero, &
         X2937, &
         wf%n_o)
!
      call mem%dealloc(X2936)
      call mem%alloc(X2938, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X2937, &
         wf%n_o**2, &
         zero, &
         X2938, &
         wf%n_v**2)
!
      call mem%dealloc(X2937)
      call add_1342_to_1234(one, X2938, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2938)
      call mem%alloc(X2939, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2939, &
         wf%n_o)
!
      call mem%alloc(X2940, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X2940, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2941, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2940, &
         wf%n_v*wf%n_o, &
         X2939, &
         wf%n_o**2, &
         zero, &
         X2941, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2939)
      call mem%dealloc(X2940)
      call mem%alloc(X2942, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2941, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2942, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2941)
      call add_1423_to_1234(one, X2942, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2942)
      call mem%alloc(X2943, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2943, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2944, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X2943, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2944, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2943)
      call mem%alloc(X2945, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2944, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2945, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2944)
      call mem%alloc(X2946, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2946, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2946, &
         wf%n_v*wf%n_o, &
         X2945, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2945)
      call mem%dealloc(X2946)
      call mem%alloc(X2947, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X2947, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2948, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         four, &
         X2947, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X2948, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2947)
      call mem%alloc(X2949, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2948, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2949, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2948)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2949, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2949)
      call mem%alloc(X2950, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2950, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2951, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         txxxI_vov, &
         wf%n_v, &
         X2950, &
         wf%n_v*wf%n_o, &
         zero, &
         X2951, &
         wf%n_v)
!
      call mem%dealloc(X2950)
      call mem%alloc(X2952, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X2951, &
         wf%n_v*wf%n_o, &
         zero, &
         X2952, &
         wf%n_o)
!
      call mem%dealloc(X2951)
      call mem%alloc(X2953, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X2952, &
         wf%n_v*wf%n_o, &
         zero, &
         X2953, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2952)
      call add_1423_to_1234(one, X2953, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2953)
      call mem%alloc(X2954, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X2954, &
         wf%n_o)
!
      call mem%alloc(X2955, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X2954, X2955, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2954)
      call mem%alloc(X2956, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2956, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2957, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X2956, &
         wf%n_o**2, &
         X2955, &
         wf%n_v*wf%n_o, &
         zero, &
         X2957, &
         wf%n_v)
!
      call mem%dealloc(X2955)
      call mem%dealloc(X2956)
      call mem%alloc(X2958, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2957, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2958, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2957)
      call add_1432_to_1234(one, X2958, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2958)
      call mem%alloc(X2959, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X2959, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X2960, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X2959, &
         wf%n_v*wf%n_o, &
         zero, &
         X2960, &
         wf%n_o)
!
      call mem%dealloc(X2959)
      call mem%alloc(X2961, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         X2960, &
         wf%n_o**2, &
         zero, &
         X2961, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2960)
      call mem%alloc(X2962, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2961, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2962, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2961)
      call add_1423_to_1234(one, X2962, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2962)
      call mem%alloc(X2963, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2963, wf%n_v, wf%n_o)
      call mem%alloc(X2964, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2963, 1, &
         zero, &
         X2964, 1)
!
      call mem%dealloc(X2963)
      call mem%alloc(X2965, wf%n_v, wf%n_o)
      call sort_to_21(X2964, X2965, wf%n_o, wf%n_v)
      call mem%dealloc(X2964)
      call mem%alloc(X2966, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v, &
         X2965, 1, &
         zero, &
         X2966, 1)
!
      call mem%dealloc(X2965)
      call mem%alloc(X2967, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2967, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2968, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dger(wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X2967, 1, &
         X2966, 1, &
         X2968, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2966)
      call mem%dealloc(X2967)
      call add_1243_to_1234(one, X2968, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2968)
      call mem%alloc(X2969, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2969, wf%n_v, wf%n_o)
      call mem%alloc(X2970, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2969, 1, &
         zero, &
         X2970, 1)
!
      call mem%dealloc(X2969)
      call mem%alloc(X2971, wf%n_v, wf%n_o)
      call sort_to_21(X2970, X2971, wf%n_o, wf%n_v)
      call mem%dealloc(X2970)
      call mem%alloc(X2972, wf%n_v)
!
      call dgemv('N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v, &
         X2971, 1, &
         zero, &
         X2972, 1)
!
      call mem%dealloc(X2971)
!
      call dger(wf%n_v, &
         wf%n_v*wf%n_o**2, &
         one, &
         X2972, 1, &
         rAxxx_ovo, 1, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X2972)
      call mem%alloc(X2973, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2973, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2974, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X2973, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2974, &
         wf%n_v)
!
      call mem%dealloc(X2973)
      call mem%alloc(X2975, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X2974, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2975, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2974)
      call mem%alloc(X2976, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X2975, X2976, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X2975)
      call mem%alloc(X2977, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2976, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2977, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2976)
      call add_1423_to_1234(one, X2977, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2977)
      call mem%alloc(X2978, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2978, wf%n_v, wf%n_o)
      call mem%alloc(X2979, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2978, 1, &
         zero, &
         X2979, 1)
!
      call mem%dealloc(X2978)
      call mem%alloc(X2980, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2980, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2981, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2979, &
         wf%n_o, &
         X2980, &
         wf%n_v*wf%n_o, &
         zero, &
         X2981, &
         wf%n_o)
!
      call mem%dealloc(X2979)
      call mem%dealloc(X2980)
      call mem%alloc(X2982, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2981, &
         wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X2982, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2981)
      call add_1423_to_1234(one, X2982, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2982)
      call mem%alloc(X2983, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X2983, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X2984, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2983, &
         wf%n_v, &
         zero, &
         X2984, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2983)
      call mem%alloc(X2985, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_132(X2984, X2985, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X2984)
      call mem%alloc(X2986, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2986, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2987, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2985, &
         wf%n_v*wf%n_o, &
         X2986, &
         wf%n_o**2, &
         zero, &
         X2987, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2985)
      call mem%dealloc(X2986)
      call mem%alloc(X2988, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X2987, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X2988, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X2987)
      call add_1243_to_1234(one, X2988, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2988)
      call mem%alloc(X2989, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2989, wf%n_v, wf%n_o)
      call mem%alloc(X2990, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2989, 1, &
         zero, &
         X2990, 1)
!
      call mem%dealloc(X2989)
      call mem%alloc(X2991, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X2991, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X2992, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X2990, &
         wf%n_o, &
         X2991, &
         wf%n_o**2, &
         zero, &
         X2992, &
         wf%n_o)
!
      call mem%dealloc(X2990)
      call mem%dealloc(X2991)
      call mem%alloc(X2993, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uxIxx_vvo, &
         wf%n_v**2, &
         X2992, &
         wf%n_o, &
         zero, &
         X2993, &
         wf%n_v**2)
!
      call mem%dealloc(X2992)
      call add_1324_to_1234(one, X2993, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X2993)
      call mem%alloc(X2994, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2994, wf%n_v, wf%n_o)
      call mem%alloc(X2995, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2994, 1, &
         zero, &
         X2995, 1)
!
      call mem%dealloc(X2994)
      call mem%alloc(X2996, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2995, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X2996, &
         wf%n_o)
!
      call mem%dealloc(X2995)
      call mem%alloc(X2997, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(rAxxx_ovo, X2997, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X2997, &
         wf%n_v*wf%n_o, &
         X2996, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X2996)
      call mem%dealloc(X2997)
      call mem%alloc(X2998, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X2998, wf%n_v, wf%n_o)
      call mem%alloc(X2999, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X2998, 1, &
         zero, &
         X2999, 1)
!
      call mem%dealloc(X2998)
      call mem%alloc(X3000, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X2999, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3000, &
         wf%n_o)
!
      call mem%dealloc(X2999)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X3000, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3000)
      call mem%alloc(X3001, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3001, wf%n_v, wf%n_o)
      call mem%alloc(X3002, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3001, 1, &
         zero, &
         X3002, 1)
!
      call mem%dealloc(X3001)
      call mem%alloc(X3003, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3002, &
         wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3003, &
         wf%n_o)
!
      call mem%dealloc(X3002)
      call mem%alloc(X3004, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         rAxxx_ovo, &
         wf%n_o, &
         X3003, &
         wf%n_o, &
         zero, &
         X3004, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3003)
      call add_1432_to_1234(one, X3004, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3004)
      call mem%alloc(X3005, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3005, &
         wf%n_o)
!
      call mem%alloc(X3006, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X3005, X3006, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3005)
      call mem%alloc(X3007, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(rAxxx_ovo, X3007, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3008, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3007, &
         wf%n_o**2, &
         X3006, &
         wf%n_v*wf%n_o, &
         zero, &
         X3008, &
         wf%n_v)
!
      call mem%dealloc(X3006)
      call mem%dealloc(X3007)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3008, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3008)
      call mem%alloc(X3009, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3009, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3010, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3009, &
         wf%n_v*wf%n_o, &
         rAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3010, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3009)
      call mem%alloc(X3011, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3010, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3011, &
         wf%n_o**2)
!
      call mem%dealloc(X3010)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X3011, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X3011)
      call mem%alloc(X3012, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3012, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3013, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         t_aibj, &
         wf%n_v*wf%n_o, &
         X3012, &
         wf%n_v*wf%n_o, &
         zero, &
         X3013, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3012)
      call mem%alloc(X3014, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3013, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3014, &
         wf%n_v)
!
      call mem%dealloc(X3013)
      call mem%alloc(X3015, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3014, &
         wf%n_v**2*wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3015, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3014)
      call add_1324_to_1234(one, X3015, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3015)
      call mem%alloc(X3016, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3016, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3017, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(t_aibj, X3017, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3018, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3017, &
         wf%n_v*wf%n_o, &
         X3016, &
         wf%n_v*wf%n_o, &
         zero, &
         X3018, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3016)
      call mem%dealloc(X3017)
      call mem%alloc(X3019, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3018, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3019, &
         wf%n_v)
!
      call mem%dealloc(X3018)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3019, &
         wf%n_v**2*wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3019)
      call mem%alloc(X3020, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X3020, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3021, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X3020, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X3021, &
         wf%n_o)
!
      call mem%dealloc(X3020)
      call mem%alloc(X3022, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3021, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3022, &
         wf%n_o)
!
      call mem%dealloc(X3021)
      call mem%alloc(X3023, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X3022, 1, &
         X3023, &
         wf%n_v**2)
!
      call mem%dealloc(X3022)
      call add_1342_to_1234(one, X3023, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3023)
      call mem%alloc(X3024, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1243(g_ovov, X3024, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3025, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         X3024, &
         wf%n_v*wf%n_o, &
         zero, &
         X3025, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3024)
      call mem%alloc(X3026, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3025, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3026, &
         wf%n_v)
!
      call mem%dealloc(X3025)
      call mem%alloc(X3027, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3026, &
         wf%n_v**2*wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3027, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3026)
      call add_1324_to_1234(one, X3027, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3027)
      call mem%alloc(X3028, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3028, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3029, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X3028, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3029, 1)
!
      call mem%dealloc(X3028)
      call mem%alloc(X3030, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v, &
         wf%n_v, &
         one, &
         X3029, &
         wf%n_v, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X3030, &
         wf%n_v)
!
      call mem%dealloc(X3029)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         X3030, &
         wf%n_v, &
         u_aibj, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v)
!
      call mem%dealloc(X3030)
      call mem%alloc(X3031, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3031, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3032, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X3031, &
         wf%n_o**2, &
         rxIxI_vv, 1, &
         zero, &
         X3032, 1)
!
      call mem%dealloc(X3031)
      call mem%alloc(X3033, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3032, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3033, &
         wf%n_o)
!
      call mem%dealloc(X3032)
      call mem%alloc(X3034, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(u_aibj, X3034, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3035, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2*wf%n_o, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3034, &
         wf%n_v**2*wf%n_o, &
         X3033, &
         wf%n_o, &
         zero, &
         X3035, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3033)
      call mem%dealloc(X3034)
      call add_1342_to_1234(one, X3035, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3035)
      call mem%alloc(X3036, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3036, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3037, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3036, &
         wf%n_v*wf%n_o, &
         zero, &
         X3037, &
         wf%n_o)
!
      call mem%dealloc(X3036)
      call mem%alloc(X3038, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3037, &
         wf%n_o**2, &
         zero, &
         X3038, &
         wf%n_v)
!
      call mem%dealloc(X3037)
      call mem%alloc(X3039, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3038, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3039, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3038)
      call add_1423_to_1234(one, X3039, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3039)
      call mem%alloc(X3040, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3040, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3041, wf%n_o, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o**2, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         X3040, &
         wf%n_o**2, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3041, &
         wf%n_o**2)
!
      call mem%dealloc(X3040)
      call mem%alloc(X3042, wf%n_o, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_12453(X3041, X3042, wf%n_o, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3041)
      call mem%alloc(X3043, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3043, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3044, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         one, &
         X3043, &
         wf%n_o**2, &
         X3042, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3044, &
         wf%n_v)
!
      call mem%dealloc(X3042)
      call mem%dealloc(X3043)
      call mem%alloc(X3045, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3044, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3045, &
         wf%n_v)
!
      call mem%dealloc(X3044)
      call add_1324_to_1234(one, X3045, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3045)
      call mem%alloc(X3046, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3046, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3047, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3047, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3048, wf%n_v, wf%n_v, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v**2, &
         wf%n_v, &
         wf%n_o**2, &
         two, &
         X3046, &
         wf%n_o**2, &
         X3047, &
         wf%n_o**2, &
         zero, &
         X3048, &
         wf%n_v**2)
!
      call mem%dealloc(X3046)
      call mem%dealloc(X3047)
      call mem%alloc(X3049, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3049, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3050, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3048, &
         wf%n_v, &
         X3049, &
         wf%n_o**2, &
         zero, &
         X3050, &
         wf%n_v**2)
!
      call mem%dealloc(X3048)
      call mem%dealloc(X3049)
      call mem%alloc(X3051, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3050, &
         wf%n_v, &
         zero, &
         X3051, &
         wf%n_v)
!
      call mem%dealloc(X3050)
      call add_1342_to_1234(one, X3051, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3051)
      call mem%alloc(X3052, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3052, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3053, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3052, &
         wf%n_v*wf%n_o, &
         zero, &
         X3053, &
         wf%n_o)
!
      call mem%dealloc(X3052)
      call mem%alloc(X3054, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3053, &
         wf%n_o**2, &
         zero, &
         X3054, &
         wf%n_v)
!
      call mem%dealloc(X3053)
      call mem%alloc(X3055, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3054, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3055, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3054)
      call add_1432_to_1234(one, X3055, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3055)
      call mem%alloc(X3056, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3056, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3057, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         -four, &
         X3056, &
         wf%n_o**2, &
         rxIxI_vv, 1, &
         zero, &
         X3057, 1)
!
      call mem%dealloc(X3056)
      call mem%alloc(X3058, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3057, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3058, &
         wf%n_o)
!
      call mem%dealloc(X3057)
      call mem%alloc(X3059, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_132(X3058, X3059, wf%n_o, wf%n_o, wf%n_v)
      call mem%dealloc(X3058)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3059, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3059)
      call mem%alloc(X3060, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3060, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3061, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X3060, &
         wf%n_o**2, &
         rxIxI_vv, 1, &
         zero, &
         X3061, 1)
!
      call mem%dealloc(X3060)
      call mem%alloc(X3062, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3061, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3062, &
         wf%n_o)
!
      call mem%dealloc(X3061)
      call mem%alloc(X3063, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3062, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3063, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3062)
      call add_1423_to_1234(one, X3063, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3063)
      call mem%alloc(X3064, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X3064, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3065, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X3064, 1, &
         zero, &
         X3065, 1)
!
      call mem%dealloc(X3064)
      call mem%alloc(X3066, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3066, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3067, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3066, &
         wf%n_o**2, &
         X3065, 1, &
         zero, &
         X3067, 1)
!
      call mem%dealloc(X3065)
      call mem%dealloc(X3066)
      call mem%alloc(X3068, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2, &
         wf%n_o**2, &
         one, &
         rxIxI_vv, 1, &
         X3067, 1, &
         X3068, &
         wf%n_v**2)
!
      call mem%dealloc(X3067)
      call add_1324_to_1234(one, X3068, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3068)
      call mem%alloc(X3069, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3069, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3070, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3069, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3070, &
         wf%n_o)
!
      call mem%dealloc(X3069)
      call mem%alloc(X3071, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3070, &
         wf%n_o**2, &
         zero, &
         X3071, &
         wf%n_v)
!
      call mem%dealloc(X3070)
      call mem%alloc(X3072, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3071, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3072, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3071)
      call add_1423_to_1234(one, X3072, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3072)
      call mem%alloc(X3073, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3073, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3074, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3073, &
         wf%n_v*wf%n_o, &
         zero, &
         X3074, &
         wf%n_o)
!
      call mem%dealloc(X3073)
      call mem%alloc(X3075, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3074, &
         wf%n_o**2, &
         zero, &
         X3075, &
         wf%n_v)
!
      call mem%dealloc(X3074)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3075, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3075)
      call mem%alloc(X3076, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3076, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3077, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3076, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3077, &
         wf%n_o)
!
      call mem%dealloc(X3076)
      call mem%alloc(X3078, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3077, &
         wf%n_o**2, &
         zero, &
         X3078, &
         wf%n_v)
!
      call mem%dealloc(X3077)
      call mem%alloc(X3079, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3078, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3079, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3078)
      call add_1432_to_1234(one, X3079, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3079)
      call mem%alloc(X3080, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X3080, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3081, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_v, &
         -two, &
         X3080, &
         wf%n_v*wf%n_o**2, &
         rxIxI_vv, &
         wf%n_v, &
         zero, &
         X3081, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3080)
      call mem%alloc(X3082, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1243(X3081, X3082, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X3081)
      call mem%alloc(X3083, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3083, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3084, wf%n_o, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3082, &
         wf%n_v*wf%n_o**2, &
         X3083, &
         wf%n_o**2, &
         zero, &
         X3084, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3082)
      call mem%dealloc(X3083)
      call mem%alloc(X3085, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3085, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3086, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X3084, &
         wf%n_o**2, &
         X3085, &
         wf%n_o**2, &
         zero, &
         X3086, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3084)
      call mem%dealloc(X3085)
      call add_1243_to_1234(one, X3086, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3086)
      call mem%alloc(X3087, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3087, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3088, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3087, &
         wf%n_v*wf%n_o, &
         zero, &
         X3088, &
         wf%n_o)
!
      call mem%dealloc(X3087)
      call mem%alloc(X3089, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3088, &
         wf%n_o**2, &
         zero, &
         X3089, &
         wf%n_v)
!
      call mem%dealloc(X3088)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3089, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3089)
      call mem%alloc(X3090, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3090, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3091, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3090, &
         wf%n_v*wf%n_o, &
         zero, &
         X3091, &
         wf%n_o)
!
      call mem%dealloc(X3090)
      call mem%alloc(X3092, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3091, &
         wf%n_o**2, &
         zero, &
         X3092, &
         wf%n_v)
!
      call mem%dealloc(X3091)
      call mem%alloc(X3093, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3092, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3093, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3092)
      call add_1423_to_1234(one, X3093, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3093)
      call mem%alloc(X3094, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3094, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3095, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3094, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3095, &
         wf%n_o)
!
      call mem%dealloc(X3094)
      call mem%alloc(X3096, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxIxI_vv, &
         wf%n_v, &
         X3095, &
         wf%n_o**2, &
         zero, &
         X3096, &
         wf%n_v)
!
      call mem%dealloc(X3095)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3096, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3096)
      call mem%alloc(X3097, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X3097, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3098, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X3097, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X3098, &
         wf%n_o)
!
      call mem%dealloc(X3097)
      call mem%alloc(X3099, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3098, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X3099, 1)
!
      call mem%dealloc(X3098)
      call mem%alloc(X3100, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3100, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3100, 1, &
         X3099, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3099)
      call mem%dealloc(X3100)
      call mem%alloc(X3101, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1432(u_aibj, X3101, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3102, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o, &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         four, &
         g_ovov, &
         wf%n_o, &
         X3101, &
         wf%n_v**2*wf%n_o, &
         zero, &
         X3102, &
         wf%n_o)
!
      call mem%dealloc(X3101)
      call mem%alloc(X3103, wf%n_o)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3102, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X3103, 1)
!
      call mem%dealloc(X3102)
      call mem%alloc(X3104, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3103, 1, &
         X3104, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3103)
      call add_1342_to_1234(one, X3104, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3104)
      call mem%alloc(X3105, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3105, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3106, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(u_aibj, X3106, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3107, wf%n_o, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X3106, &
         wf%n_v**2, &
         X3105, &
         wf%n_o**2, &
         zero, &
         X3107, &
         wf%n_o**2)
!
      call mem%dealloc(X3105)
      call mem%dealloc(X3106)
      call mem%alloc(X3108, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemv('N', &
         wf%n_o**3, &
         wf%n_o, &
         one, &
         X3107, &
         wf%n_o**3, &
         tAIAx_o, 1, &
         zero, &
         X3108, 1)
!
      call mem%dealloc(X3107)
      call mem%alloc(X3109, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3108, &
         wf%n_o**2, &
         zero, &
         X3109, &
         wf%n_v**2)
!
      call mem%dealloc(X3108)
      call add_1342_to_1234(one, X3109, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3109)
      call mem%alloc(X3110, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X3110, 1)
!
      call mem%alloc(X3111, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(X3110, X3111, wf%n_v, wf%n_o, wf%n_v)
      call mem%dealloc(X3110)
      call mem%alloc(X3112, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X3111, &
         wf%n_v, &
         u_aibj, &
         wf%n_v*wf%n_o, &
         zero, &
         X3112, &
         wf%n_v)
!
      call mem%dealloc(X3111)
      call mem%alloc(X3113, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3113, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3114, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3113, &
         wf%n_v*wf%n_o, &
         X3112, &
         wf%n_v, &
         zero, &
         X3114, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3112)
      call mem%dealloc(X3113)
      call add_1432_to_1234(one, X3114, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3114)
      call mem%alloc(X3115, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         tAIAx_o, 1, &
         zero, &
         X3115, 1)
!
      call mem%alloc(X3116, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_1423(u_aibj, X3116, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3117, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         X3115, &
         wf%n_v*wf%n_o, &
         X3116, &
         wf%n_v*wf%n_o, &
         zero, &
         X3117, &
         wf%n_v)
!
      call mem%dealloc(X3115)
      call mem%dealloc(X3116)
      call mem%alloc(X3118, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3118, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3119, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3118, &
         wf%n_v*wf%n_o, &
         X3117, &
         wf%n_v, &
         zero, &
         X3119, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3117)
      call mem%dealloc(X3118)
      call add_1423_to_1234(one, X3119, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3119)
      call mem%alloc(X3120, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3120, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3121, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3120, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X3121, 1)
!
      call mem%dealloc(X3120)
      call mem%alloc(X3122, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3121, 1, &
         zero, &
         X3122, 1)
!
      call mem%dealloc(X3121)
      call mem%alloc(X3123, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3123, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3123, 1, &
         X3122, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3122)
      call mem%dealloc(X3123)
      call mem%alloc(X3124, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3124, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3125, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X3124, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X3125, 1)
!
      call mem%dealloc(X3124)
      call mem%alloc(X3126, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3125, 1, &
         zero, &
         X3126, 1)
!
      call mem%dealloc(X3125)
      call mem%alloc(X3127, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3126, 1, &
         X3127, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3126)
      call add_1342_to_1234(one, X3127, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3127)
      call mem%alloc(X3128, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3128, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3129, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3128, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X3129, 1)
!
      call mem%dealloc(X3128)
      call mem%alloc(X3130, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3130, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3131, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3129, &
         wf%n_o, &
         X3130, &
         wf%n_o**2, &
         zero, &
         X3131, &
         wf%n_o)
!
      call mem%dealloc(X3129)
      call mem%dealloc(X3130)
      call mem%alloc(X3132, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3131, &
         wf%n_o, &
         zero, &
         X3132, &
         wf%n_v**2)
!
      call mem%dealloc(X3131)
      call add_1342_to_1234(one, X3132, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3132)
      call mem%alloc(X3133, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3133, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3134, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3133, &
         wf%n_v*wf%n_o, &
         zero, &
         X3134, &
         wf%n_o)
!
      call mem%dealloc(X3133)
      call mem%alloc(X3135, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X3134, &
         wf%n_o**2, &
         zero, &
         X3135, &
         wf%n_o)
!
      call mem%dealloc(X3134)
      call mem%alloc(X3136, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3135, &
         wf%n_o**2, &
         zero, &
         X3136, &
         wf%n_v**2)
!
      call mem%dealloc(X3135)
      call add_1342_to_1234(one, X3136, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3136)
      call mem%alloc(X3137, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3137, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3138, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3137, &
         wf%n_v*wf%n_o, &
         zero, &
         X3138, &
         wf%n_o)
!
      call mem%dealloc(X3137)
      call mem%alloc(X3139, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3139, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3140, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3139, &
         wf%n_v*wf%n_o, &
         X3138, &
         wf%n_o**2, &
         zero, &
         X3140, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3138)
      call mem%dealloc(X3139)
      call mem%alloc(X3141, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3140, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3141, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3140)
      call add_1243_to_1234(one, X3141, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3141)
      call mem%alloc(X3142, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3142, &
         wf%n_o)
!
      call mem%alloc(X3143, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3142, X3143, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3142)
      call mem%alloc(X3144, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3144, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3145, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3144, &
         wf%n_o**2, &
         X3143, &
         wf%n_v*wf%n_o, &
         zero, &
         X3145, &
         wf%n_v)
!
      call mem%dealloc(X3143)
      call mem%dealloc(X3144)
      call mem%alloc(X3146, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3146, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3146, &
         wf%n_v*wf%n_o, &
         X3145, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3145)
      call mem%dealloc(X3146)
      call mem%alloc(X3147, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3147, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3148, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3147, &
         wf%n_v*wf%n_o, &
         zero, &
         X3148, &
         wf%n_o)
!
      call mem%dealloc(X3147)
      call mem%alloc(X3149, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3149, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3150, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3149, &
         wf%n_v*wf%n_o, &
         X3148, &
         wf%n_o**2, &
         zero, &
         X3150, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3148)
      call mem%dealloc(X3149)
      call mem%alloc(X3151, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3150, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3151, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3150)
      call add_1423_to_1234(one, X3151, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3151)
      call mem%alloc(X3152, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3152, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3153, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3152, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X3153, 1)
!
      call mem%dealloc(X3152)
      call mem%alloc(X3154, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3154, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3155, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3153, &
         wf%n_o, &
         X3154, &
         wf%n_v*wf%n_o, &
         zero, &
         X3155, &
         wf%n_o)
!
      call mem%dealloc(X3153)
      call mem%dealloc(X3154)
      call mem%alloc(X3156, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3155, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3156, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3155)
      call add_1432_to_1234(one, X3156, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3156)
      call mem%alloc(X3157, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3157, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3158, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3157, &
         wf%n_o**2, &
         zero, &
         X3158, &
         wf%n_o)
!
      call mem%dealloc(X3157)
      call mem%alloc(X3159, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X3158, &
         wf%n_o**2, &
         zero, &
         X3159, &
         wf%n_v)
!
      call mem%dealloc(X3158)
      call mem%alloc(X3160, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X3160, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3161, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3160, &
         wf%n_v*wf%n_o, &
         X3159, &
         wf%n_v*wf%n_o, &
         zero, &
         X3161, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3159)
      call mem%dealloc(X3160)
      call add_1432_to_1234(one, X3161, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3161)
      call mem%alloc(X3162, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X3162, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3163, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X3162, 1, &
         zero, &
         X3163, 1)
!
      call mem%dealloc(X3162)
      call mem%alloc(X3164, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X3163, 1, &
         zero, &
         X3164, 1)
!
      call mem%dealloc(X3163)
      call mem%alloc(X3165, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3165, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3165, 1, &
         X3164, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3164)
      call mem%dealloc(X3165)
      call mem%alloc(X3166, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X3166, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3167, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         four, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X3166, 1, &
         zero, &
         X3167, 1)
!
      call mem%dealloc(X3166)
      call mem%alloc(X3168, wf%n_o)
!
      call dgemv('T', &
         wf%n_v, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X3167, 1, &
         zero, &
         X3168, 1)
!
      call mem%dealloc(X3167)
      call mem%alloc(X3169, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3168, 1, &
         X3169, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3168)
      call add_1342_to_1234(one, X3169, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3169)
      call mem%alloc(X3170, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3170, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3171, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3170, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3171, &
         wf%n_o)
!
      call mem%dealloc(X3170)
      call mem%alloc(X3172, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X3171, &
         wf%n_o**2, &
         zero, &
         X3172, &
         wf%n_o)
!
      call mem%dealloc(X3171)
      call mem%alloc(X3173, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3172, &
         wf%n_o**2, &
         zero, &
         X3173, &
         wf%n_v**2)
!
      call mem%dealloc(X3172)
      call add_1324_to_1234(one, X3173, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3173)
      call mem%alloc(X3174, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3174, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3175, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3174, &
         wf%n_v*wf%n_o, &
         zero, &
         X3175, &
         wf%n_o)
!
      call mem%dealloc(X3174)
      call mem%alloc(X3176, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X3175, &
         wf%n_o**2, &
         zero, &
         X3176, &
         wf%n_o)
!
      call mem%dealloc(X3175)
      call mem%alloc(X3177, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3176, &
         wf%n_o**2, &
         zero, &
         X3177, &
         wf%n_v**2)
!
      call mem%dealloc(X3176)
      call add_1324_to_1234(one, X3177, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3177)
      call mem%alloc(X3178, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3178, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3179, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3178, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3179, &
         wf%n_o)
!
      call mem%dealloc(X3178)
      call mem%alloc(X3180, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3180, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3181, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3180, &
         wf%n_v*wf%n_o, &
         X3179, &
         wf%n_o**2, &
         zero, &
         X3181, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3179)
      call mem%dealloc(X3180)
      call mem%alloc(X3182, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3181, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3182, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3181)
      call add_1243_to_1234(one, X3182, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3182)
      call mem%alloc(X3183, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3183, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3184, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3183, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X3184, 1)
!
      call mem%dealloc(X3183)
      call mem%alloc(X3185, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3185, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3186, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3184, &
         wf%n_o, &
         X3185, &
         wf%n_v*wf%n_o, &
         zero, &
         X3186, &
         wf%n_o)
!
      call mem%dealloc(X3184)
      call mem%dealloc(X3185)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3186, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3186)
      call mem%alloc(X3187, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3187, &
         wf%n_o)
!
      call mem%alloc(X3188, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3187, X3188, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3187)
      call mem%alloc(X3189, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3189, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3190, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3189, &
         wf%n_o**2, &
         X3188, &
         wf%n_v*wf%n_o, &
         zero, &
         X3190, &
         wf%n_v)
!
      call mem%dealloc(X3188)
      call mem%dealloc(X3189)
      call mem%alloc(X3191, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3191, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3192, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3191, &
         wf%n_v*wf%n_o, &
         X3190, &
         wf%n_v*wf%n_o, &
         zero, &
         X3192, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3190)
      call mem%dealloc(X3191)
      call add_1432_to_1234(one, X3192, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3192)
      call mem%alloc(X3193, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X3193, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3194, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3193, &
         wf%n_o**2, &
         zero, &
         X3194, &
         wf%n_o)
!
      call mem%dealloc(X3193)
      call mem%alloc(X3195, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAIxx_vo, &
         wf%n_v, &
         X3194, &
         wf%n_o**2, &
         zero, &
         X3195, &
         wf%n_v)
!
      call mem%dealloc(X3194)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3195, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3195)
      call mem%alloc(X3196, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3196, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3197, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X3196, &
         wf%n_o**2, &
         rxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X3197, &
         wf%n_o**2)
!
      call mem%dealloc(X3196)
      call mem%alloc(X3198, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3197, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3198, &
         wf%n_o**2)
!
      call mem%dealloc(X3197)
      call mem%alloc(X3199, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X3199, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3200, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3199, &
         wf%n_v*wf%n_o, &
         X3198, &
         wf%n_o, &
         zero, &
         X3200, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3198)
      call mem%dealloc(X3199)
      call add_1423_to_1234(one, X3200, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3200)
      call mem%alloc(X3201, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3201, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3202, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         two, &
         X3201, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X3202, &
         wf%n_o**2)
!
      call mem%dealloc(X3201)
      call mem%alloc(X3203, wf%n_o)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X3202, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3203, 1)
!
      call mem%dealloc(X3202)
      call mem%alloc(X3204, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3204, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3204, 1, &
         X3203, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3203)
      call mem%dealloc(X3204)
      call mem%alloc(X3205, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3205, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3206, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -four, &
         X3205, &
         wf%n_o**2, &
         txIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X3206, &
         wf%n_o**2)
!
      call mem%dealloc(X3205)
      call mem%alloc(X3207, wf%n_o)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X3206, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3207, 1)
!
      call mem%dealloc(X3206)
      call mem%alloc(X3208, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3207, 1, &
         X3208, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3207)
      call add_1342_to_1234(one, X3208, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3208)
      call mem%alloc(X3209, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3209, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3210, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         txIxx_vvo, &
         wf%n_v**2, &
         X3209, &
         wf%n_o**2, &
         zero, &
         X3210, &
         wf%n_o)
!
      call mem%dealloc(X3209)
      call mem%alloc(X3211, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxAx_oo, &
         wf%n_o, &
         X3210, &
         wf%n_o**2, &
         zero, &
         X3211, &
         wf%n_o)
!
      call mem%dealloc(X3210)
      call mem%alloc(X3212, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3211, &
         wf%n_o**2, &
         zero, &
         X3212, &
         wf%n_v**2)
!
      call mem%dealloc(X3211)
      call add_1342_to_1234(one, X3212, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3212)
      call mem%alloc(X3213, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3213, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3214, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X3213, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X3214, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3213)
      call mem%alloc(X3215, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3214, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3215, &
         wf%n_v**2)
!
      call mem%dealloc(X3214)
      call mem%alloc(X3216, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3216, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3216, &
         wf%n_v*wf%n_o, &
         X3215, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3215)
      call mem%dealloc(X3216)
      call mem%alloc(X3217, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3217, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3218, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X3217, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3218, 1)
!
      call mem%dealloc(X3217)
      call mem%alloc(X3219, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X3219, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3220, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3218, &
         wf%n_v, &
         X3219, &
         wf%n_v*wf%n_o, &
         zero, &
         X3220, &
         wf%n_v)
!
      call mem%dealloc(X3218)
      call mem%dealloc(X3219)
      call mem%alloc(X3221, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3221, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3222, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3221, &
         wf%n_v*wf%n_o, &
         X3220, &
         wf%n_v, &
         zero, &
         X3222, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3220)
      call mem%dealloc(X3221)
      call add_1432_to_1234(one, X3222, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3222)
      call mem%alloc(X3223, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3223, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3224, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3223, &
         wf%n_o**2, &
         zero, &
         X3224, &
         wf%n_o)
!
      call mem%dealloc(X3223)
      call mem%alloc(X3225, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxAx_oo, &
         wf%n_o, &
         X3224, &
         wf%n_o**2, &
         zero, &
         X3225, &
         wf%n_o)
!
      call mem%dealloc(X3224)
      call mem%alloc(X3226, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         txIxx_vvo, &
         wf%n_v**2, &
         X3225, &
         wf%n_o**2, &
         zero, &
         X3226, &
         wf%n_v**2)
!
      call mem%dealloc(X3225)
      call add_1342_to_1234(one, X3226, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3226)
      call mem%alloc(X3227, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3227, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3228, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X3228, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3229, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X3228, &
         wf%n_v**2, &
         X3227, &
         wf%n_o**2, &
         zero, &
         X3229, &
         wf%n_o)
!
      call mem%dealloc(X3227)
      call mem%dealloc(X3228)
      call mem%alloc(X3230, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxAx_oo, &
         wf%n_o, &
         X3229, &
         wf%n_o**2, &
         zero, &
         X3230, &
         wf%n_o)
!
      call mem%dealloc(X3229)
      call mem%alloc(X3231, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3230, &
         wf%n_o**2, &
         zero, &
         X3231, &
         wf%n_v**2)
!
      call mem%dealloc(X3230)
      call add_1342_to_1234(one, X3231, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3231)
      call mem%alloc(X3232, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3232, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3233, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X3232, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X3233, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3232)
      call mem%alloc(X3234, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3233, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3234, &
         wf%n_v**2)
!
      call mem%dealloc(X3233)
      call mem%alloc(X3235, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3235, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3235, &
         wf%n_v*wf%n_o, &
         X3234, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3234)
      call mem%dealloc(X3235)
      call mem%alloc(X3236, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3236, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3237, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         X3236, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3237, 1)
!
      call mem%dealloc(X3236)
      call mem%alloc(X3238, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3237, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3238, &
         wf%n_v)
!
      call mem%dealloc(X3237)
      call mem%alloc(X3239, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3239, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3240, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3239, &
         wf%n_v*wf%n_o, &
         X3238, &
         wf%n_v, &
         zero, &
         X3240, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3238)
      call mem%dealloc(X3239)
      call add_1432_to_1234(one, X3240, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3240)
      call mem%alloc(X3241, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3241, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3242, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3241, &
         wf%n_o**2, &
         zero, &
         X3242, &
         wf%n_o)
!
      call mem%dealloc(X3241)
      call mem%alloc(X3243, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxAx_oo, &
         wf%n_o, &
         X3242, &
         wf%n_o**2, &
         zero, &
         X3243, &
         wf%n_o)
!
      call mem%dealloc(X3242)
      call mem%alloc(X3244, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(txxxI_vov, X3244, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3245, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X3244, &
         wf%n_v**2, &
         X3243, &
         wf%n_o**2, &
         zero, &
         X3245, &
         wf%n_v**2)
!
      call mem%dealloc(X3243)
      call mem%dealloc(X3244)
      call add_1342_to_1234(one, X3245, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3245)
      call mem%alloc(X3246, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X3246, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3247, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_o, &
         X3246, 1, &
         zero, &
         X3247, 1)
!
      call mem%dealloc(X3246)
      call mem%alloc(X3248, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_o, &
         one, &
         tAxAx_oo, &
         wf%n_o, &
         X3247, 1, &
         zero, &
         X3248, 1)
!
      call mem%dealloc(X3247)
      call mem%alloc(X3249, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3249, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3249, 1, &
         X3248, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3248)
      call mem%dealloc(X3249)
      call mem%alloc(X3250, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X3250, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3251, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v**2*wf%n_o, &
         four, &
         g_ovov, &
         wf%n_o, &
         X3250, 1, &
         zero, &
         X3251, 1)
!
      call mem%dealloc(X3250)
      call mem%alloc(X3252, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_o, &
         one, &
         tAxAx_oo, &
         wf%n_o, &
         X3251, 1, &
         zero, &
         X3252, 1)
!
      call mem%dealloc(X3251)
      call mem%alloc(X3253, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3252, 1, &
         X3253, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3252)
      call add_1342_to_1234(one, X3253, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3253)
      call mem%alloc(X3254, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X3254, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3255, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3254, &
         wf%n_v, &
         zero, &
         X3255, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3254)
      call mem%alloc(X3256, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3255, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3256, &
         wf%n_v**2)
!
      call mem%dealloc(X3255)
      call mem%alloc(X3257, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3257, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3257, &
         wf%n_v*wf%n_o, &
         X3256, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3256)
      call mem%dealloc(X3257)
      call mem%alloc(X3258, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X3258, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3259, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3258, &
         wf%n_v, &
         zero, &
         X3259, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3258)
      call mem%alloc(X3260, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3259, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3260, &
         wf%n_v**2)
!
      call mem%dealloc(X3259)
      call mem%alloc(X3261, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3261, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3262, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3261, &
         wf%n_v*wf%n_o, &
         X3260, &
         wf%n_v, &
         zero, &
         X3262, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3260)
      call mem%dealloc(X3261)
      call add_1432_to_1234(one, X3262, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3262)
      call mem%alloc(X3263, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3263, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3264, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X3264, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3265, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X3264, &
         wf%n_v**2, &
         X3263, &
         wf%n_o**2, &
         zero, &
         X3265, &
         wf%n_o)
!
      call mem%dealloc(X3263)
      call mem%dealloc(X3264)
      call mem%alloc(X3266, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxAx_oo, &
         wf%n_o, &
         X3265, &
         wf%n_o**2, &
         zero, &
         X3266, &
         wf%n_o)
!
      call mem%dealloc(X3265)
      call mem%alloc(X3267, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3266, &
         wf%n_o**2, &
         zero, &
         X3267, &
         wf%n_v**2)
!
      call mem%dealloc(X3266)
      call add_1324_to_1234(one, X3267, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3267)
      call mem%alloc(X3268, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3268, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3269, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X3268, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3269, 1)
!
      call mem%dealloc(X3268)
      call mem%alloc(X3270, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3269, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3270, &
         wf%n_v)
!
      call mem%dealloc(X3269)
      call mem%alloc(X3271, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3271, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3271, &
         wf%n_v*wf%n_o, &
         X3270, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3270)
      call mem%dealloc(X3271)
      call mem%alloc(X3272, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3272, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3273, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X3272, &
         wf%n_v*wf%n_o, &
         uxxxI_vov, &
         wf%n_v, &
         zero, &
         X3273, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3272)
      call mem%alloc(X3274, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3273, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3274, &
         wf%n_v**2)
!
      call mem%dealloc(X3273)
      call mem%alloc(X3275, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3275, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3276, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3275, &
         wf%n_v*wf%n_o, &
         X3274, &
         wf%n_v, &
         zero, &
         X3276, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3274)
      call mem%dealloc(X3275)
      call add_1432_to_1234(one, X3276, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3276)
      call mem%alloc(X3277, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3277, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3278, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X3277, &
         wf%n_o**2, &
         rxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X3278, &
         wf%n_o**2)
!
      call mem%dealloc(X3277)
      call mem%alloc(X3279, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3278, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3279, &
         wf%n_o**2)
!
      call mem%dealloc(X3278)
      call mem%alloc(X3280, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_132(uxxxI_vov, X3280, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3281, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         X3280, &
         wf%n_v**2, &
         X3279, &
         wf%n_o, &
         zero, &
         X3281, &
         wf%n_v**2)
!
      call mem%dealloc(X3279)
      call mem%dealloc(X3280)
      call add_1324_to_1234(one, X3281, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3281)
      call mem%alloc(X3282, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3282, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3283, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3282, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X3283, 1)
!
      call mem%dealloc(X3282)
      call mem%alloc(X3284, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3283, 1, &
         zero, &
         X3284, 1)
!
      call mem%dealloc(X3283)
      call mem%alloc(X3285, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3285, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3285, 1, &
         X3284, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3284)
      call mem%dealloc(X3285)
      call mem%alloc(X3286, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3286, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3287, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         X3286, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X3287, 1)
!
      call mem%dealloc(X3286)
      call mem%alloc(X3288, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3287, 1, &
         zero, &
         X3288, 1)
!
      call mem%dealloc(X3287)
      call mem%alloc(X3289, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3288, 1, &
         X3289, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3288)
      call add_1342_to_1234(one, X3289, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3289)
      call mem%alloc(X3290, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3290, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3291, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3290, &
         wf%n_v*wf%n_o, &
         zero, &
         X3291, &
         wf%n_o)
!
      call mem%dealloc(X3290)
      call mem%alloc(X3292, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X3291, &
         wf%n_o**2, &
         zero, &
         X3292, &
         wf%n_o)
!
      call mem%dealloc(X3291)
      call mem%alloc(X3293, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3292, &
         wf%n_o**2, &
         zero, &
         X3293, &
         wf%n_v**2)
!
      call mem%dealloc(X3292)
      call add_1342_to_1234(one, X3293, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3293)
      call mem%alloc(X3294, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3294, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3295, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3294, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X3295, 1)
!
      call mem%dealloc(X3294)
      call mem%alloc(X3296, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3296, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3297, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3295, &
         wf%n_o, &
         X3296, &
         wf%n_o**2, &
         zero, &
         X3297, &
         wf%n_o)
!
      call mem%dealloc(X3295)
      call mem%dealloc(X3296)
      call mem%alloc(X3298, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3297, &
         wf%n_o, &
         zero, &
         X3298, &
         wf%n_v**2)
!
      call mem%dealloc(X3297)
      call add_1342_to_1234(one, X3298, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3298)
      call mem%alloc(X3299, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3299, &
         wf%n_o)
!
      call mem%alloc(X3300, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3299, X3300, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3299)
      call mem%alloc(X3301, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3301, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3302, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3301, &
         wf%n_o**2, &
         X3300, &
         wf%n_v*wf%n_o, &
         zero, &
         X3302, &
         wf%n_v)
!
      call mem%dealloc(X3300)
      call mem%dealloc(X3301)
      call mem%alloc(X3303, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3303, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3303, &
         wf%n_v*wf%n_o, &
         X3302, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3302)
      call mem%dealloc(X3303)
      call mem%alloc(X3304, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3304, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3305, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3304, &
         wf%n_v*wf%n_o, &
         zero, &
         X3305, &
         wf%n_o)
!
      call mem%dealloc(X3304)
      call mem%alloc(X3306, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3306, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3307, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3306, &
         wf%n_v*wf%n_o, &
         X3305, &
         wf%n_o**2, &
         zero, &
         X3307, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3305)
      call mem%dealloc(X3306)
      call mem%alloc(X3308, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3307, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3308, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3307)
      call add_1243_to_1234(one, X3308, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3308)
      call mem%alloc(X3309, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3309, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3310, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3309, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X3310, 1)
!
      call mem%dealloc(X3309)
      call mem%alloc(X3311, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3311, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3312, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3310, &
         wf%n_v, &
         X3311, &
         wf%n_v*wf%n_o, &
         zero, &
         X3312, &
         wf%n_o)
!
      call mem%dealloc(X3310)
      call mem%dealloc(X3311)
      call mem%alloc(X3313, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3312, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3313, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3312)
      call add_1432_to_1234(one, X3313, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3313)
      call mem%alloc(X3314, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3314, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3315, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3314, &
         wf%n_v*wf%n_o, &
         zero, &
         X3315, &
         wf%n_o)
!
      call mem%dealloc(X3314)
      call mem%alloc(X3316, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3316, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3317, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3316, &
         wf%n_v*wf%n_o, &
         X3315, &
         wf%n_o**2, &
         zero, &
         X3317, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3315)
      call mem%dealloc(X3316)
      call mem%alloc(X3318, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3317, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3318, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3317)
      call add_1423_to_1234(one, X3318, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3318)
      call mem%alloc(X3319, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3319, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3320, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3319, &
         wf%n_o**2, &
         zero, &
         X3320, &
         wf%n_o)
!
      call mem%dealloc(X3319)
      call mem%alloc(X3321, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X3320, &
         wf%n_o**2, &
         zero, &
         X3321, &
         wf%n_v)
!
      call mem%dealloc(X3320)
      call mem%alloc(X3322, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(tAxxx_ovo, X3322, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3323, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3322, &
         wf%n_v*wf%n_o, &
         X3321, &
         wf%n_v*wf%n_o, &
         zero, &
         X3323, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3321)
      call mem%dealloc(X3322)
      call add_1432_to_1234(one, X3323, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3323)
      call mem%alloc(X3324, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X3324, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3325, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X3324, 1, &
         zero, &
         X3325, 1)
!
      call mem%dealloc(X3324)
      call mem%alloc(X3326, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X3325, 1, &
         zero, &
         X3326, 1)
!
      call mem%dealloc(X3325)
      call mem%alloc(X3327, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3327, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3327, 1, &
         X3326, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3326)
      call mem%dealloc(X3327)
      call mem%alloc(X3328, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_321(uAxxx_ovo, X3328, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3329, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         four, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         X3328, 1, &
         zero, &
         X3329, 1)
!
      call mem%dealloc(X3328)
      call mem%alloc(X3330, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X3329, 1, &
         zero, &
         X3330, 1)
!
      call mem%dealloc(X3329)
      call mem%alloc(X3331, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3330, 1, &
         X3331, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3330)
      call add_1342_to_1234(one, X3331, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3331)
      call mem%alloc(X3332, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3332, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3333, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3332, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3333, &
         wf%n_o)
!
      call mem%dealloc(X3332)
      call mem%alloc(X3334, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X3333, &
         wf%n_o**2, &
         zero, &
         X3334, &
         wf%n_o)
!
      call mem%dealloc(X3333)
      call mem%alloc(X3335, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3334, &
         wf%n_o**2, &
         zero, &
         X3335, &
         wf%n_v**2)
!
      call mem%dealloc(X3334)
      call add_1324_to_1234(one, X3335, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3335)
      call mem%alloc(X3336, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3336, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3337, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3336, &
         wf%n_v*wf%n_o, &
         zero, &
         X3337, &
         wf%n_o)
!
      call mem%dealloc(X3336)
      call mem%alloc(X3338, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X3337, &
         wf%n_o**2, &
         zero, &
         X3338, &
         wf%n_o)
!
      call mem%dealloc(X3337)
      call mem%alloc(X3339, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3338, &
         wf%n_o**2, &
         zero, &
         X3339, &
         wf%n_v**2)
!
      call mem%dealloc(X3338)
      call add_1324_to_1234(one, X3339, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3339)
      call mem%alloc(X3340, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3340, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3341, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3340, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3341, &
         wf%n_o)
!
      call mem%dealloc(X3340)
      call mem%alloc(X3342, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3342, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3343, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3342, &
         wf%n_v*wf%n_o, &
         X3341, &
         wf%n_o**2, &
         zero, &
         X3343, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3341)
      call mem%dealloc(X3342)
      call mem%alloc(X3344, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3343, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3344, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3343)
      call add_1243_to_1234(one, X3344, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3344)
      call mem%alloc(X3345, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3345, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3346, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3345, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X3346, 1)
!
      call mem%dealloc(X3345)
      call mem%alloc(X3347, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3347, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3348, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3346, &
         wf%n_v, &
         X3347, &
         wf%n_v*wf%n_o, &
         zero, &
         X3348, &
         wf%n_o)
!
      call mem%dealloc(X3346)
      call mem%dealloc(X3347)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3348, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3348)
      call mem%alloc(X3349, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3349, &
         wf%n_o)
!
      call mem%alloc(X3350, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3349, X3350, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3349)
      call mem%alloc(X3351, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3351, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3352, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3351, &
         wf%n_o**2, &
         X3350, &
         wf%n_v*wf%n_o, &
         zero, &
         X3352, &
         wf%n_v)
!
      call mem%dealloc(X3350)
      call mem%dealloc(X3351)
      call mem%alloc(X3353, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3353, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3354, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3353, &
         wf%n_v*wf%n_o, &
         X3352, &
         wf%n_v*wf%n_o, &
         zero, &
         X3354, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3352)
      call mem%dealloc(X3353)
      call add_1432_to_1234(one, X3354, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3354)
      call mem%alloc(X3355, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1342(g_ovov, X3355, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3356, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3355, &
         wf%n_o**2, &
         zero, &
         X3356, &
         wf%n_o)
!
      call mem%dealloc(X3355)
      call mem%alloc(X3357, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         tAxxI_ov, &
         wf%n_o, &
         X3356, &
         wf%n_o**2, &
         zero, &
         X3357, &
         wf%n_v)
!
      call mem%dealloc(X3356)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3357, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3357)
      call mem%alloc(X3358, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3358, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3359, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_o**2, &
         wf%n_o, &
         wf%n_v**2, &
         -two, &
         X3358, &
         wf%n_o**2, &
         rxIxx_vvo, &
         wf%n_v**2, &
         zero, &
         X3359, &
         wf%n_o**2)
!
      call mem%dealloc(X3358)
      call mem%alloc(X3360, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3359, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3360, &
         wf%n_o**2)
!
      call mem%dealloc(X3359)
      call mem%alloc(X3361, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_213(uAxxx_ovo, X3361, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3362, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3361, &
         wf%n_v*wf%n_o, &
         X3360, &
         wf%n_o, &
         zero, &
         X3362, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3360)
      call mem%dealloc(X3361)
      call add_1423_to_1234(one, X3362, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3362)
      call mem%alloc(X3363, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3363, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3364, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3364, wf%n_v, wf%n_o)
      call mem%alloc(X3365, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3363, &
         wf%n_v*wf%n_o, &
         X3364, 1, &
         zero, &
         X3365, 1)
!
      call mem%dealloc(X3363)
      call mem%dealloc(X3364)
      call mem%alloc(X3366, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X3365, 1, &
         zero, &
         X3366, 1)
!
      call mem%dealloc(X3365)
      call mem%alloc(X3367, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3367, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3367, 1, &
         X3366, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3366)
      call mem%dealloc(X3367)
      call mem%alloc(X3368, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3368, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3369, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3369, wf%n_v, wf%n_o)
      call mem%alloc(X3370, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X3368, &
         wf%n_v*wf%n_o, &
         X3369, 1, &
         zero, &
         X3370, 1)
!
      call mem%dealloc(X3368)
      call mem%dealloc(X3369)
      call mem%alloc(X3371, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X3370, 1, &
         zero, &
         X3371, 1)
!
      call mem%dealloc(X3370)
      call mem%alloc(X3372, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3371, 1, &
         X3372, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3371)
      call add_1342_to_1234(one, X3372, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3372)
      call mem%alloc(X3373, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3373, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3374, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3373, &
         wf%n_v*wf%n_o, &
         zero, &
         X3374, &
         wf%n_o)
!
      call mem%dealloc(X3373)
      call mem%alloc(X3375, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X3374, &
         wf%n_o**2, &
         zero, &
         X3375, &
         wf%n_o)
!
      call mem%dealloc(X3374)
      call mem%alloc(X3376, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3375, &
         wf%n_o**2, &
         zero, &
         X3376, &
         wf%n_v**2)
!
      call mem%dealloc(X3375)
      call add_1342_to_1234(one, X3376, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3376)
      call mem%alloc(X3377, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3377, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3378, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3377, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, 1, &
         zero, &
         X3378, 1)
!
      call mem%dealloc(X3377)
      call mem%alloc(X3379, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3379, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3380, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3378, &
         wf%n_o, &
         X3379, &
         wf%n_o**2, &
         zero, &
         X3380, &
         wf%n_o)
!
      call mem%dealloc(X3378)
      call mem%dealloc(X3379)
      call mem%alloc(X3381, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3380, &
         wf%n_o, &
         zero, &
         X3381, &
         wf%n_v**2)
!
      call mem%dealloc(X3380)
      call add_1324_to_1234(one, X3381, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3381)
      call mem%alloc(X3382, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -two, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3382, &
         wf%n_o)
!
      call mem%alloc(X3383, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X3382, X3383, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3382)
      call mem%alloc(X3384, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3384, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3385, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3384, &
         wf%n_o**2, &
         X3383, &
         wf%n_v*wf%n_o, &
         zero, &
         X3385, &
         wf%n_v)
!
      call mem%dealloc(X3383)
      call mem%dealloc(X3384)
      call mem%alloc(X3386, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3386, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3386, &
         wf%n_v*wf%n_o, &
         X3385, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3385)
      call mem%dealloc(X3386)
      call mem%alloc(X3387, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3387, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3388, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3387, &
         wf%n_v*wf%n_o, &
         zero, &
         X3388, &
         wf%n_o)
!
      call mem%dealloc(X3387)
      call mem%alloc(X3389, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3389, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3390, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3389, &
         wf%n_v*wf%n_o, &
         X3388, &
         wf%n_o**2, &
         zero, &
         X3390, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3388)
      call mem%dealloc(X3389)
      call mem%alloc(X3391, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3390, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3391, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3390)
      call add_1243_to_1234(one, X3391, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3391)
      call mem%alloc(X3392, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3392, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3393, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3392, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, 1, &
         zero, &
         X3393, 1)
!
      call mem%dealloc(X3392)
      call mem%alloc(X3394, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3394, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3395, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3393, &
         wf%n_o, &
         X3394, &
         wf%n_v*wf%n_o, &
         zero, &
         X3395, &
         wf%n_o)
!
      call mem%dealloc(X3393)
      call mem%dealloc(X3394)
      call mem%alloc(X3396, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3395, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3396, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3395)
      call add_1423_to_1234(one, X3396, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3396)
      call mem%alloc(X3397, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3397, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3398, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3397, &
         wf%n_v*wf%n_o, &
         zero, &
         X3398, &
         wf%n_o)
!
      call mem%dealloc(X3397)
      call mem%alloc(X3399, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3399, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3400, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3399, &
         wf%n_v*wf%n_o, &
         X3398, &
         wf%n_o**2, &
         zero, &
         X3400, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3398)
      call mem%dealloc(X3399)
      call mem%alloc(X3401, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3400, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3401, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3400)
      call add_1423_to_1234(one, X3401, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3401)
      call mem%alloc(X3402, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3402, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3403, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3402, &
         wf%n_o**2, &
         zero, &
         X3403, &
         wf%n_o)
!
      call mem%dealloc(X3402)
      call mem%alloc(X3404, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X3403, &
         wf%n_o**2, &
         zero, &
         X3404, &
         wf%n_v)
!
      call mem%dealloc(X3403)
      call mem%alloc(X3405, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         tAxxx_ovo, &
         wf%n_o, &
         X3404, &
         wf%n_v*wf%n_o, &
         zero, &
         X3405, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3404)
      call add_1432_to_1234(one, X3405, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3405)
      call mem%alloc(X3406, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3406, wf%n_v, wf%n_o)
      call mem%alloc(X3407, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3406, 1, &
         zero, &
         X3407, 1)
!
      call mem%dealloc(X3406)
      call mem%alloc(X3408, wf%n_v, wf%n_o)
      call sort_to_21(X3407, X3408, wf%n_o, wf%n_v)
      call mem%dealloc(X3407)
      call mem%alloc(X3409, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X3408, 1, &
         zero, &
         X3409, 1)
!
      call mem%dealloc(X3408)
      call mem%alloc(X3410, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3410, wf%n_v, wf%n_v, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         X3410, 1, &
         X3409, 1, &
         rho_aibj, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3409)
      call mem%dealloc(X3410)
      call mem%alloc(X3411, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3411, wf%n_v, wf%n_o)
      call mem%alloc(X3412, wf%n_o, wf%n_v)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3411, 1, &
         zero, &
         X3412, 1)
!
      call mem%dealloc(X3411)
      call mem%alloc(X3413, wf%n_v, wf%n_o)
      call sort_to_21(X3412, X3413, wf%n_o, wf%n_v)
      call mem%dealloc(X3412)
      call mem%alloc(X3414, wf%n_o)
!
      call dgemv('N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         one, &
         uAxxx_ovo, &
         wf%n_o, &
         X3413, 1, &
         zero, &
         X3414, 1)
!
      call mem%dealloc(X3413)
      call mem%alloc(X3415, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dger(wf%n_v**2*wf%n_o, &
         wf%n_o, &
         one, &
         rxIxx_vvo, 1, &
         X3414, 1, &
         X3415, &
         wf%n_v**2*wf%n_o)
!
      call mem%dealloc(X3414)
      call add_1342_to_1234(one, X3415, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3415)
      call mem%alloc(X3416, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3416, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3417, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3416, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3417, &
         wf%n_o)
!
      call mem%dealloc(X3416)
      call mem%alloc(X3418, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X3417, &
         wf%n_o**2, &
         zero, &
         X3418, &
         wf%n_o)
!
      call mem%dealloc(X3417)
      call mem%alloc(X3419, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3418, &
         wf%n_o**2, &
         zero, &
         X3419, &
         wf%n_v**2)
!
      call mem%dealloc(X3418)
      call add_1342_to_1234(one, X3419, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3419)
      call mem%alloc(X3420, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3420, wf%n_v, wf%n_o)
      call mem%alloc(X3421, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3420, 1, &
         zero, &
         X3421, 1)
!
      call mem%dealloc(X3420)
      call mem%alloc(X3422, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3422, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3423, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3421, &
         wf%n_o, &
         X3422, &
         wf%n_o**2, &
         zero, &
         X3423, &
         wf%n_o)
!
      call mem%dealloc(X3421)
      call mem%dealloc(X3422)
      call mem%alloc(X3424, wf%n_v, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v**2, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3423, &
         wf%n_o, &
         zero, &
         X3424, &
         wf%n_v**2)
!
      call mem%dealloc(X3423)
      call add_1324_to_1234(one, X3424, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3424)
      call mem%alloc(X3425, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3425, wf%n_v, wf%n_o)
      call mem%alloc(X3426, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3425, 1, &
         zero, &
         X3426, 1)
!
      call mem%dealloc(X3425)
      call mem%alloc(X3427, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3427, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3428, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3426, &
         wf%n_o, &
         X3427, &
         wf%n_v*wf%n_o, &
         zero, &
         X3428, &
         wf%n_o)
!
      call mem%dealloc(X3426)
      call mem%dealloc(X3427)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3428, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3428)
      call mem%alloc(X3429, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3429, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3430, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         X3429, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3430, &
         wf%n_o)
!
      call mem%dealloc(X3429)
      call mem%alloc(X3431, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3431, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3432, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3431, &
         wf%n_v*wf%n_o, &
         X3430, &
         wf%n_o**2, &
         zero, &
         X3432, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3430)
      call mem%dealloc(X3431)
      call mem%alloc(X3433, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3432, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3433, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3432)
      call add_1423_to_1234(one, X3433, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3433)
      call mem%alloc(X3434, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3434, wf%n_v, wf%n_o)
      call mem%alloc(X3435, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3434, 1, &
         zero, &
         X3435, 1)
!
      call mem%dealloc(X3434)
      call mem%alloc(X3436, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(rxIxx_vvo, X3436, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3437, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3435, &
         wf%n_o, &
         X3436, &
         wf%n_v*wf%n_o, &
         zero, &
         X3437, &
         wf%n_o)
!
      call mem%dealloc(X3435)
      call mem%dealloc(X3436)
      call mem%alloc(X3438, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3437, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3438, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3437)
      call add_1423_to_1234(one, X3438, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3438)
      call mem%alloc(X3439, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3439, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3440, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_o**2, &
         wf%n_v**2, &
         two, &
         rxIxx_vvo, &
         wf%n_v**2, &
         X3439, &
         wf%n_o**2, &
         zero, &
         X3440, &
         wf%n_o)
!
      call mem%dealloc(X3439)
      call mem%alloc(X3441, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_o**2, &
         wf%n_o, &
         one, &
         uAIxx_vo, &
         wf%n_v, &
         X3440, &
         wf%n_o**2, &
         zero, &
         X3441, &
         wf%n_v)
!
      call mem%dealloc(X3440)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3441, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3441)
      call mem%alloc(X3442, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3442, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3443, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         tAxxx_ovo, &
         wf%n_o, &
         X3442, &
         wf%n_v*wf%n_o, &
         zero, &
         X3443, &
         wf%n_o)
!
      call mem%dealloc(X3442)
      call mem%alloc(X3444, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3443, &
         wf%n_o**2, &
         zero, &
         X3444, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3443)
      call mem%alloc(X3445, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3444, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3445, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3444)
      call add_1243_to_1234(one, X3445, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3445)
      call mem%alloc(X3446, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -four, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3446, &
         wf%n_o)
!
      call mem%alloc(X3447, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3446, X3447, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3446)
      call mem%alloc(X3448, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3448, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3449, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3448, &
         wf%n_o**2, &
         X3447, &
         wf%n_v*wf%n_o, &
         zero, &
         X3449, &
         wf%n_v)
!
      call mem%dealloc(X3447)
      call mem%dealloc(X3448)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3449, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3449)
      call mem%alloc(X3450, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3450, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3451, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3450, &
         wf%n_v*wf%n_o, &
         zero, &
         X3451, &
         wf%n_o)
!
      call mem%dealloc(X3450)
      call mem%alloc(X3452, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3451, &
         wf%n_o**2, &
         zero, &
         X3452, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3451)
      call mem%alloc(X3453, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3452, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3453, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3452)
      call add_1423_to_1234(one, X3453, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3453)
      call mem%alloc(X3454, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3454, &
         wf%n_o)
!
      call mem%alloc(X3455, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3454, X3455, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3454)
      call mem%alloc(X3456, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3456, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3457, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3456, &
         wf%n_o**2, &
         X3455, &
         wf%n_v*wf%n_o, &
         zero, &
         X3457, &
         wf%n_v)
!
      call mem%dealloc(X3455)
      call mem%dealloc(X3456)
      call mem%alloc(X3458, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3457, &
         wf%n_v*wf%n_o, &
         zero, &
         X3458, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3457)
      call add_1432_to_1234(one, X3458, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3458)
      call mem%alloc(X3459, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3459, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X3460, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_132(X3459, X3460, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X3459)
      call mem%alloc(X3461, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3461, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3462, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3460, &
         wf%n_v*wf%n_o, &
         X3461, &
         wf%n_o**2, &
         zero, &
         X3462, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3460)
      call mem%dealloc(X3461)
      call mem%alloc(X3463, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3462, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3463, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3462)
      call add_1423_to_1234(one, X3463, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3463)
      call mem%alloc(X3464, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rxxxI_vov, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3464, &
         wf%n_v)
!
      call mem%alloc(X3465, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3464, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3465, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3464)
      call mem%alloc(X3466, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X3465, X3466, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X3465)
      call mem%alloc(X3467, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3466, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3467, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3466)
      call add_1432_to_1234(one, X3467, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3467)
      call mem%alloc(X3468, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3468, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3469, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X3468, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3469, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3468)
      call mem%alloc(X3470, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3469, &
         wf%n_v, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3470, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3469)
      call mem%alloc(X3471, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3470, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3471, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3470)
      call add_1423_to_1234(one, X3471, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3471)
      call mem%alloc(X3472, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3472, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3473, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X3472, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3473, &
         wf%n_o)
!
      call mem%dealloc(X3472)
      call mem%alloc(X3474, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3473, &
         wf%n_o**2, &
         zero, &
         X3474, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3473)
      call mem%alloc(X3475, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3474, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3475, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3474)
      call add_1243_to_1234(one, X3475, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3475)
      call mem%alloc(X3476, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3476, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3477, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X3476, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X3477, 1)
!
      call mem%dealloc(X3476)
      call mem%alloc(X3478, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3477, &
         wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3478, &
         wf%n_o)
!
      call mem%dealloc(X3477)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3478, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3478)
      call mem%alloc(X3479, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3479, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3480, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3479, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3480, &
         wf%n_o)
!
      call mem%dealloc(X3479)
      call mem%alloc(X3481, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3480, &
         wf%n_o**2, &
         zero, &
         X3481, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3480)
      call mem%alloc(X3482, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3481, &
         wf%n_v*wf%n_o**2, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3482, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3481)
      call add_1423_to_1234(one, X3482, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3482)
      call mem%alloc(X3483, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3483, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3484, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3483, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, 1, &
         zero, &
         X3484, 1)
!
      call mem%dealloc(X3483)
      call mem%alloc(X3485, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3484, &
         wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3485, &
         wf%n_o)
!
      call mem%dealloc(X3484)
      call mem%alloc(X3486, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3485, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3486, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3485)
      call add_1432_to_1234(one, X3486, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3486)
      call mem%alloc(X3487, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rxxxI_vov, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3487, &
         wf%n_v)
!
      call mem%alloc(X3488, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3487, &
         wf%n_v*wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3488, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3487)
      call mem%alloc(X3489, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X3488, X3489, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X3488)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3489, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3489)
      call mem%alloc(X3490, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3490, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3491, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X3490, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3491, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3490)
      call mem%alloc(X3492, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3492, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3493, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3491, &
         wf%n_v, &
         X3492, &
         wf%n_o**2, &
         zero, &
         X3493, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3491)
      call mem%dealloc(X3492)
      call mem%alloc(X3494, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3493, &
         wf%n_o, &
         tAIxx_vo, &
         wf%n_v, &
         zero, &
         X3494, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3493)
      call add_1423_to_1234(one, X3494, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3494)
      call mem%alloc(X3495, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3495, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3496, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -four, &
         X3495, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X3496, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3495)
      call mem%alloc(X3497, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3496, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3497, &
         wf%n_v**2)
!
      call mem%dealloc(X3496)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3497, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3497)
      call mem%alloc(X3498, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3498, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3499, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X3498, &
         wf%n_v*wf%n_o, &
         txIxx_vvo, &
         wf%n_v, &
         zero, &
         X3499, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3498)
      call mem%alloc(X3500, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3499, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3500, &
         wf%n_v**2)
!
      call mem%dealloc(X3499)
      call mem%alloc(X3501, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3500, &
         wf%n_v, &
         zero, &
         X3501, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3500)
      call add_1432_to_1234(one, X3501, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3501)
      call mem%alloc(X3502, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3502, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X3503, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3502, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3503, &
         wf%n_v**2)
!
      call mem%dealloc(X3502)
      call mem%alloc(X3504, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(txIxx_vvo, X3504, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3505, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3503, &
         wf%n_v, &
         X3504, &
         wf%n_v*wf%n_o, &
         zero, &
         X3505, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3503)
      call mem%dealloc(X3504)
      call add_1432_to_1234(one, X3505, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3505)
      call mem%alloc(X3506, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3506, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3507, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -four, &
         X3506, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X3507, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3506)
      call mem%alloc(X3508, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3507, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3508, &
         wf%n_v**2)
!
      call mem%dealloc(X3507)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3508, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3508)
      call mem%alloc(X3509, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3509, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3510, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X3509, &
         wf%n_v*wf%n_o, &
         txxxI_vov, &
         wf%n_v, &
         zero, &
         X3510, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3509)
      call mem%alloc(X3511, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3510, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3511, &
         wf%n_v**2)
!
      call mem%dealloc(X3510)
      call mem%alloc(X3512, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3511, &
         wf%n_v, &
         zero, &
         X3512, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3511)
      call add_1432_to_1234(one, X3512, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3512)
      call mem%alloc(X3513, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3513, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X3514, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3513, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3514, &
         wf%n_v**2)
!
      call mem%dealloc(X3513)
      call mem%alloc(X3515, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3514, &
         wf%n_v, &
         txxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3515, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3514)
      call add_1432_to_1234(one, X3515, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3515)
      call mem%alloc(X3516, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X3516, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3517, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3516, &
         wf%n_v, &
         zero, &
         X3517, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3516)
      call mem%alloc(X3518, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3517, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3518, &
         wf%n_v**2)
!
      call mem%dealloc(X3517)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3518, &
         wf%n_v, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3518)
      call mem%alloc(X3519, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X3519, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3520, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3519, &
         wf%n_v, &
         zero, &
         X3520, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3519)
      call mem%alloc(X3521, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3520, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3521, &
         wf%n_v**2)
!
      call mem%dealloc(X3520)
      call mem%alloc(X3522, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3521, &
         wf%n_v, &
         zero, &
         X3522, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3521)
      call add_1432_to_1234(one, X3522, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3522)
      call mem%alloc(X3523, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3523, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3524, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X3523, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3524, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3523)
      call mem%alloc(X3525, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3524, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3525, &
         wf%n_v**2)
!
      call mem%dealloc(X3524)
      call mem%alloc(X3526, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_132(uxIxx_vvo, X3526, wf%n_v, wf%n_v, wf%n_o)
      call mem%alloc(X3527, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3525, &
         wf%n_v, &
         X3526, &
         wf%n_v*wf%n_o, &
         zero, &
         X3527, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3525)
      call mem%dealloc(X3526)
      call add_1432_to_1234(one, X3527, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3527)
      call mem%alloc(X3528, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3528, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3529, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         four, &
         X3528, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3529, 1)
!
      call mem%dealloc(X3528)
      call mem%alloc(X3530, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3529, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3530, &
         wf%n_v)
!
      call mem%dealloc(X3529)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3530, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3530)
      call mem%alloc(X3531, wf%n_o, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_1324(g_ovov, X3531, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3532, wf%n_v, wf%n_v)
!
      call dgemv('T', &
         wf%n_o**2, &
         wf%n_v**2, &
         -two, &
         X3531, &
         wf%n_o**2, &
         tAxAx_oo, 1, &
         zero, &
         X3532, 1)
!
      call mem%dealloc(X3531)
      call mem%alloc(X3533, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3532, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3533, &
         wf%n_v)
!
      call mem%dealloc(X3532)
      call mem%alloc(X3534, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3533, &
         wf%n_v, &
         zero, &
         X3534, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3533)
      call add_1432_to_1234(one, X3534, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3534)
      call mem%alloc(X3535, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3535, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X3536, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3535, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3536, &
         wf%n_v**2)
!
      call mem%dealloc(X3535)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3536, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3536)
      call mem%alloc(X3537, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3537, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3538, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X3537, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3538, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3537)
      call mem%alloc(X3539, wf%n_v, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v**2, &
         wf%n_o, &
         wf%n_o, &
         one, &
         X3538, &
         wf%n_o, &
         tAxAx_oo, &
         wf%n_o, &
         zero, &
         X3539, &
         wf%n_v**2)
!
      call mem%dealloc(X3538)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3539, &
         wf%n_v, &
         uxxxI_vov, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3539)
      call mem%alloc(X3540, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         -four, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3540, &
         wf%n_o)
!
      call mem%alloc(X3541, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3540, X3541, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3540)
      call mem%alloc(X3542, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3542, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3543, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3542, &
         wf%n_o**2, &
         X3541, &
         wf%n_v*wf%n_o, &
         zero, &
         X3543, &
         wf%n_v)
!
      call mem%dealloc(X3541)
      call mem%dealloc(X3542)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3543, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3543)
      call mem%alloc(X3544, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3544, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3545, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         tAxxx_ovo, &
         wf%n_o, &
         X3544, &
         wf%n_v*wf%n_o, &
         zero, &
         X3545, &
         wf%n_o)
!
      call mem%dealloc(X3544)
      call mem%alloc(X3546, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3545, &
         wf%n_o**2, &
         zero, &
         X3546, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3545)
      call mem%alloc(X3547, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3546, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3547, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3546)
      call add_1243_to_1234(one, X3547, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3547)
      call mem%alloc(X3548, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         two, &
         tAxxI_ov, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3548, &
         wf%n_o)
!
      call mem%alloc(X3549, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1342(X3548, X3549, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3548)
      call mem%alloc(X3550, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3550, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3551, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3550, &
         wf%n_o**2, &
         X3549, &
         wf%n_v*wf%n_o, &
         zero, &
         X3551, &
         wf%n_v)
!
      call mem%dealloc(X3549)
      call mem%dealloc(X3550)
      call mem%alloc(X3552, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3551, &
         wf%n_v*wf%n_o, &
         zero, &
         X3552, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3551)
      call add_1432_to_1234(one, X3552, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3552)
      call mem%alloc(X3553, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3553, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3554, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         tAxxx_ovo, &
         wf%n_o, &
         X3553, &
         wf%n_v*wf%n_o, &
         zero, &
         X3554, &
         wf%n_o)
!
      call mem%dealloc(X3553)
      call mem%alloc(X3555, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3554, &
         wf%n_o**2, &
         zero, &
         X3555, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3554)
      call mem%alloc(X3556, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3555, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3556, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3555)
      call add_1423_to_1234(one, X3556, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3556)
      call mem%alloc(X3557, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         rxxxI_vov, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3557, &
         wf%n_v)
!
      call mem%alloc(X3558, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3557, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3558, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3557)
      call mem%alloc(X3559, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X3558, X3559, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X3558)
      call mem%alloc(X3560, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3559, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3560, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3559)
      call add_1432_to_1234(one, X3560, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3560)
      call mem%alloc(X3561, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3561, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X3562, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_132(X3561, X3562, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X3561)
      call mem%alloc(X3563, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3563, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3564, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3562, &
         wf%n_v*wf%n_o, &
         X3563, &
         wf%n_o**2, &
         zero, &
         X3564, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3562)
      call mem%dealloc(X3563)
      call mem%alloc(X3565, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3564, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3565, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3564)
      call add_1423_to_1234(one, X3565, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3565)
      call mem%alloc(X3566, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3566, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3567, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X3566, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3567, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3566)
      call mem%alloc(X3568, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3567, &
         wf%n_v, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3568, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3567)
      call mem%alloc(X3569, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3568, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3569, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3568)
      call add_1423_to_1234(one, X3569, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3569)
      call mem%alloc(X3570, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3570, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3571, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X3570, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3571, &
         wf%n_o)
!
      call mem%dealloc(X3570)
      call mem%alloc(X3572, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3571, &
         wf%n_o**2, &
         zero, &
         X3572, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3571)
      call mem%alloc(X3573, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3572, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3573, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3572)
      call add_1243_to_1234(one, X3573, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3573)
      call mem%alloc(X3574, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3574, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3575, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         X3574, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X3575, 1)
!
      call mem%dealloc(X3574)
      call mem%alloc(X3576, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3575, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3576, &
         wf%n_o)
!
      call mem%dealloc(X3575)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3576, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3576)
      call mem%alloc(X3577, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3577, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3578, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3577, &
         wf%n_o, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3578, &
         wf%n_o)
!
      call mem%dealloc(X3577)
      call mem%alloc(X3579, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3578, &
         wf%n_o**2, &
         zero, &
         X3579, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3578)
      call mem%alloc(X3580, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3579, &
         wf%n_v*wf%n_o**2, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3580, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3579)
      call add_1423_to_1234(one, X3580, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3580)
      call mem%alloc(X3581, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3581, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3582, wf%n_v, wf%n_o)
!
      call dgemv('T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         X3581, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, 1, &
         zero, &
         X3582, 1)
!
      call mem%dealloc(X3581)
      call mem%alloc(X3583, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3582, &
         wf%n_v, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3583, &
         wf%n_o)
!
      call mem%dealloc(X3582)
      call mem%alloc(X3584, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3583, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3584, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3583)
      call add_1432_to_1234(one, X3584, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3584)
      call mem%alloc(X3585, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rxxxI_vov, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3585, &
         wf%n_v)
!
      call mem%alloc(X3586, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3585, &
         wf%n_v*wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3586, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3585)
      call mem%alloc(X3587, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X3586, X3587, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X3586)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3587, &
         wf%n_v*wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3587)
      call mem%alloc(X3588, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3588, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3589, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X3588, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3589, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3588)
      call mem%alloc(X3590, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(uAxxx_ovo, X3590, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3591, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3589, &
         wf%n_v, &
         X3590, &
         wf%n_o**2, &
         zero, &
         X3591, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3589)
      call mem%dealloc(X3590)
      call mem%alloc(X3592, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3591, &
         wf%n_o, &
         tAxxI_ov, &
         wf%n_o, &
         zero, &
         X3592, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3591)
      call add_1423_to_1234(one, X3592, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3592)
      call mem%alloc(X3593, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         four, &
         uAIxx_vo, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         zero, &
         X3593, &
         wf%n_o)
!
      call mem%alloc(X3594, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_1324(X3593, X3594, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3593)
      call mem%alloc(X3595, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3595, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3596, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         one, &
         X3595, &
         wf%n_o**2, &
         X3594, &
         wf%n_v*wf%n_o, &
         zero, &
         X3596, &
         wf%n_v)
!
      call mem%dealloc(X3594)
      call mem%dealloc(X3595)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3596, &
         wf%n_v*wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3596)
      call mem%alloc(X3597, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3597, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3598, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         four, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3597, &
         wf%n_v*wf%n_o, &
         zero, &
         X3598, &
         wf%n_o)
!
      call mem%dealloc(X3597)
      call mem%alloc(X3599, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3598, &
         wf%n_o**2, &
         zero, &
         X3599, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3598)
      call mem%alloc(X3600, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3599, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3600, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3599)
      call add_1243_to_1234(one, X3600, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3600)
      call mem%alloc(X3601, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o**2, &
         wf%n_o, &
         wf%n_v, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3601, &
         wf%n_v*wf%n_o**2)
!
      call mem%alloc(X3602, wf%n_o, wf%n_o, wf%n_v, wf%n_o)
      call sort_to_1324(X3601, X3602, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X3601)
      call mem%alloc(X3603, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3603, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3604, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_o**2, &
         one, &
         X3602, &
         wf%n_o**2, &
         X3603, &
         wf%n_o**2, &
         zero, &
         X3604, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3602)
      call mem%dealloc(X3603)
      call mem%alloc(X3605, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3604, &
         wf%n_v, &
         zero, &
         X3605, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3604)
      call add_1423_to_1234(one, X3605, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3605)
      call mem%alloc(X3606, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call sort_to_1432(g_ovov, X3606, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3607, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'N', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         X3606, &
         wf%n_v*wf%n_o, &
         zero, &
         X3607, &
         wf%n_o)
!
      call mem%dealloc(X3606)
      call mem%alloc(X3608, wf%n_v, wf%n_o, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         X3607, &
         wf%n_o**2, &
         zero, &
         X3608, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3607)
      call mem%alloc(X3609, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3608, &
         wf%n_v*wf%n_o**2, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3609, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3608)
      call add_1423_to_1234(one, X3609, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3609)
      call mem%alloc(X3610, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('N', 'N', &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -two, &
         rxxxI_vov, &
         wf%n_v, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3610, &
         wf%n_v)
!
      call mem%alloc(X3611, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3610, &
         wf%n_v*wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3611, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3610)
      call mem%alloc(X3612, wf%n_v, wf%n_o, wf%n_o)
      call sort_to_132(X3611, X3612, wf%n_v, wf%n_o, wf%n_o)
      call mem%dealloc(X3611)
      call mem%alloc(X3613, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3612, &
         wf%n_v*wf%n_o, &
         tAxxx_ovo, &
         wf%n_v*wf%n_o, &
         zero, &
         X3613, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3612)
      call add_1423_to_1234(one, X3613, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3613)
      call mem%alloc(X3614, wf%n_o, wf%n_v, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3614, &
         wf%n_v*wf%n_o)
!
      call mem%alloc(X3615, wf%n_o, wf%n_v, wf%n_v)
      call sort_to_132(X3614, X3615, wf%n_o, wf%n_v, wf%n_v)
      call mem%dealloc(X3614)
      call mem%alloc(X3616, wf%n_o, wf%n_o, wf%n_v)
      call sort_to_132(tAxxx_ovo, X3616, wf%n_o, wf%n_v, wf%n_o)
      call mem%alloc(X3617, wf%n_o, wf%n_v, wf%n_o, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_o**2, &
         wf%n_v, &
         one, &
         X3615, &
         wf%n_v*wf%n_o, &
         X3616, &
         wf%n_o**2, &
         zero, &
         X3617, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3615)
      call mem%dealloc(X3616)
      call mem%alloc(X3618, wf%n_v, wf%n_o, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o**2, &
         wf%n_v, &
         wf%n_o, &
         one, &
         X3617, &
         wf%n_o, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3618, &
         wf%n_v*wf%n_o**2)
!
      call mem%dealloc(X3617)
      call add_1243_to_1234(one, X3618, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3618)
      call mem%alloc(X3619, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3619, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3620, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         -two, &
         X3619, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3620, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3619)
      call mem%alloc(X3621, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3620, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3621, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3620)
      call mem%alloc(X3622, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3621, &
         wf%n_o, &
         tAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3622, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3621)
      call add_1432_to_1234(one, X3622, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3622)
      call mem%alloc(X3623, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3623, wf%n_v, wf%n_o)
      call mem%alloc(X3624, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         -four, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3623, 1, &
         zero, &
         X3624, 1)
!
      call mem%dealloc(X3623)
      call mem%alloc(X3625, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3624, &
         wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3625, &
         wf%n_o)
!
      call mem%dealloc(X3624)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3625, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3625)
      call mem%alloc(X3626, wf%n_o, wf%n_v)
      call sort_to_21(uAIxx_vo, X3626, wf%n_v, wf%n_o)
      call mem%alloc(X3627, wf%n_o, wf%n_v)
!
      call dgemv('N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         two, &
         g_ovov, &
         wf%n_v*wf%n_o, &
         X3626, 1, &
         zero, &
         X3627, 1)
!
      call mem%dealloc(X3626)
      call mem%alloc(X3628, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('N', 'T', &
         wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         one, &
         X3627, &
         wf%n_o, &
         rxxxI_vov, &
         wf%n_v*wf%n_o, &
         zero, &
         X3628, &
         wf%n_o)
!
      call mem%dealloc(X3627)
      call mem%alloc(X3629, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3628, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         zero, &
         X3629, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3628)
      call add_1432_to_1234(one, X3629, rho_aibj, wf%n_v, wf%n_o, wf%n_v, wf%n_o)
      call mem%dealloc(X3629)
      call mem%alloc(X3630, wf%n_o, wf%n_v, wf%n_v, wf%n_o)
      call sort_to_1423(g_ovov, X3630, wf%n_o, wf%n_v, wf%n_o, wf%n_v)
      call mem%alloc(X3631, wf%n_v, wf%n_o, wf%n_v)
!
      call dgemm('T', 'T', &
         wf%n_v*wf%n_o, &
         wf%n_v, &
         wf%n_v*wf%n_o, &
         two, &
         X3630, &
         wf%n_v*wf%n_o, &
         rxxxI_vov, &
         wf%n_v, &
         zero, &
         X3631, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3630)
      call mem%alloc(X3632, wf%n_o, wf%n_v, wf%n_o)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         wf%n_v, &
         one, &
         X3631, &
         wf%n_v, &
         uAIxx_vo, &
         wf%n_v, &
         zero, &
         X3632, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3631)
!
      call dgemm('T', 'N', &
         wf%n_v*wf%n_o, &
         wf%n_v*wf%n_o, &
         wf%n_o, &
         one, &
         X3632, &
         wf%n_o, &
         uAxxx_ovo, &
         wf%n_o, &
         one, &
         rho_aibj, &
         wf%n_v*wf%n_o)
!
      call mem%dealloc(X3632)
!
   end subroutine mu_4_H_nu_1_s_doublet_ccsd

